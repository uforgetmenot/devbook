<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RTSP åè®®å¼€å‘å®Œæ•´å­¦ä¹ ç¬”è®° - å¼€å‘</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">å¼€å‘</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="æœç´¢æœ¬ä¹¦å†…å®¹..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="rtsp-åè®®å¼€å‘å®Œæ•´å­¦ä¹ ç¬”è®°"><a class="header" href="#rtsp-åè®®å¼€å‘å®Œæ•´å­¦ä¹ ç¬”è®°">RTSP åè®®å¼€å‘å®Œæ•´å­¦ä¹ ç¬”è®°</a></h1>
<h2 id="-å­¦ä¹ è€…è§’è‰²å®šä½"><a class="header" href="#-å­¦ä¹ è€…è§’è‰²å®šä½">ğŸ“‹ å­¦ä¹ è€…è§’è‰²å®šä½</a></h2>
<ul>
<li><strong>ç›®æ ‡ç¾¤ä½“</strong>ï¼š0-5å¹´ç»éªŒçš„æµåª’ä½“å¼€å‘è€…ã€è§†é¢‘ç›‘æ§ç³»ç»Ÿå·¥ç¨‹å¸ˆã€å®æ—¶é€šä¿¡å¼€å‘äººå‘˜</li>
<li><strong>å‰ç½®çŸ¥è¯†</strong>ï¼šç½‘ç»œç¼–ç¨‹åŸºç¡€ã€TCP/UDPåè®®ã€HTTPåè®®åŸºç¡€ã€éŸ³è§†é¢‘ç¼–ç åŸºç¡€</li>
<li><strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæŒæ¡RTSPåè®®åŸç†ï¼Œèƒ½å¤Ÿç‹¬ç«‹å¼€å‘RTSPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼Œå®ç°æµåª’ä½“ä¼ è¾“åº”ç”¨</li>
</ul>
<hr />
<h2 id="1-rtspåè®®åŸºç¡€"><a class="header" href="#1-rtspåè®®åŸºç¡€">1. RTSPåè®®åŸºç¡€</a></h2>
<h3 id="11-åè®®æ¦‚è¿°"><a class="header" href="#11-åè®®æ¦‚è¿°">1.1 åè®®æ¦‚è¿°</a></h3>
<h4 id="rtspå®šä¹‰ä¸ä½œç”¨"><a class="header" href="#rtspå®šä¹‰ä¸ä½œç”¨">RTSPå®šä¹‰ä¸ä½œç”¨</a></h4>
<p><strong>RTSP (Real Time Streaming Protocol)</strong> æ˜¯ä¸€ä¸ªåº”ç”¨å±‚åè®®ï¼Œç”¨äºå»ºç«‹å’Œæ§åˆ¶æµåª’ä½“æœåŠ¡å™¨çš„ä¼šè¯ã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>æ§åˆ¶åè®®</strong>ï¼šRTSPæœ¬èº«ä¸ä¼ è¾“åª’ä½“æ•°æ®ï¼Œä»…æ§åˆ¶æµçš„ä¼ è¾“</li>
<li><strong>ç±»HTTPè®¾è®¡</strong>ï¼šæ¶ˆæ¯æ ¼å¼ç±»ä¼¼HTTPï¼Œæ˜“äºç†è§£å’Œæ‰©å±•</li>
<li><strong>å¤šä¼ è¾“æ–¹å¼</strong>ï¼šæ”¯æŒRTP/UDPã€RTP/TCPã€HTTPéš§é“ç­‰</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>ï¼šç»´æŠ¤ä¼šè¯çŠ¶æ€ï¼Œæ”¯æŒæš‚åœã€å¿«è¿›ã€å®šä½ç­‰æ“ä½œ</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯</strong>ï¼š</p>
<pre><code>è§†é¢‘ç›‘æ§        â†’ IPæ‘„åƒå¤´å®æ—¶æµä¼ è¾“
è§†é¢‘ç‚¹æ’­        â†’ VODç³»ç»Ÿæµåª’ä½“æ§åˆ¶
ç½‘ç»œç›´æ’­        â†’ å®æ—¶æµåˆ†å‘å’Œæ§åˆ¶
è§†é¢‘ä¼šè®®        â†’ å¤šæ–¹æµåª’ä½“ä¼šè¯ç®¡ç†
æ™ºèƒ½å®¶å±…        â†’ å¯è§†é—¨é“ƒã€ç›‘æ§è®¾å¤‡
</code></pre>
<h4 id="rtsp-vs-http-vs-rtp"><a class="header" href="#rtsp-vs-http-vs-rtp">RTSP vs HTTP vs RTP</a></h4>
<p><strong>åè®®å¯¹æ¯”è¡¨</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>RTSP</th><th>HTTP</th><th>RTP</th></tr></thead><tbody>
<tr><td><strong>å±‚çº§</strong></td><td>åº”ç”¨å±‚</td><td>åº”ç”¨å±‚</td><td>ä¼ è¾“å±‚</td></tr>
<tr><td><strong>ä½œç”¨</strong></td><td>æµåª’ä½“æ§åˆ¶</td><td>æ•°æ®ä¼ è¾“</td><td>åª’ä½“æ•°æ®ä¼ è¾“</td></tr>
<tr><td><strong>çŠ¶æ€</strong></td><td>æœ‰çŠ¶æ€</td><td>æ— çŠ¶æ€</td><td>æ— çŠ¶æ€</td></tr>
<tr><td><strong>ä¼ è¾“</strong></td><td>TCP</td><td>TCP</td><td>UDP/TCP</td></tr>
<tr><td><strong>å®æ—¶æ€§</strong></td><td>é«˜</td><td>ä½</td><td>é«˜</td></tr>
<tr><td><strong>å…¸å‹ç«¯å£</strong></td><td>554</td><td>80/443</td><td>åŠ¨æ€åˆ†é…</td></tr>
</tbody></table>
</div>
<p><strong>åè®®å…³ç³»</strong>ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        åº”ç”¨å±‚ (Application)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   RTSP   â”‚ â—„â”€â”€â”€â”€â–º â”‚   SDP    â”‚  â”‚
â”‚  â”‚  (æ§åˆ¶)   â”‚        â”‚ (æè¿°)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         ä¼ è¾“å±‚ (Transport)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   RTP    â”‚        â”‚   RTCP   â”‚  â”‚
â”‚  â”‚ (æ•°æ®æµ)  â”‚        â”‚ (æ§åˆ¶)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       ç½‘ç»œå±‚ (TCP/UDP)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å·¥ä½œæµç¨‹ç¤ºä¾‹</strong>ï¼š</p>
<pre><code>å®¢æˆ·ç«¯                     æœåŠ¡å™¨
  â”‚                          â”‚
  â”‚â”€â”€â”€â”€ OPTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (1) æŸ¥è¯¢æœåŠ¡å™¨èƒ½åŠ›
  â”‚â†â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                          â”‚
  â”‚â”€â”€â”€â”€ DESCRIBE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (2) è·å–åª’ä½“æè¿°(SDP)
  â”‚â†â”€â”€â”€ 200 OK + SDP â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                          â”‚
  â”‚â”€â”€â”€â”€ SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (3) å»ºç«‹ä¼ è¾“é€šé“
  â”‚â†â”€â”€â”€ 200 OK + Session â”€â”€â”€â”€â”‚
  â”‚                          â”‚
  â”‚â”€â”€â”€â”€ PLAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (4) å¼€å§‹æ’­æ”¾
  â”‚â†â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                          â”‚
  â”‚â—„â•â•â• RTP åª’ä½“æµ â•â•â•â•â•â•â•â•â•â†’â”‚  (åª’ä½“æ•°æ®ä¼ è¾“)
  â”‚                          â”‚
  â”‚â”€â”€â”€â”€ TEARDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (5) ç»ˆæ­¢ä¼šè¯
  â”‚â†â”€â”€â”€ 200 OK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
</code></pre>
<h4 id="åè®®æ¶æ„ä¸ç»„ä»¶"><a class="header" href="#åè®®æ¶æ„ä¸ç»„ä»¶">åè®®æ¶æ„ä¸ç»„ä»¶</a></h4>
<p><strong>RTSPç³»ç»Ÿæ¶æ„</strong>ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RTSP å®¢æˆ·ç«¯                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ§åˆ¶æ¨¡å—    â”‚  â”‚  åª’ä½“æ’­æ”¾å™¨      â”‚   â”‚
â”‚  â”‚ (RTSP)     â”‚  â”‚  (RTP/RTCP)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚              â”‚
              â”‚ RTSP/TCP     â”‚ RTP/UDP
              â†“              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            RTSP æœåŠ¡å™¨                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¼šè¯ç®¡ç†    â”‚  â”‚  æµåª’ä½“å¼•æ“      â”‚   â”‚
â”‚  â”‚            â”‚  â”‚  (ç¼–ç /è½¬å‘)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è®¤è¯æˆæƒ    â”‚  â”‚  å­˜å‚¨/é‡‡é›†       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒç»„ä»¶è¯´æ˜</strong>ï¼š</p>
<ol>
<li>
<p><strong>RTSPæ§åˆ¶å±‚</strong></p>
<ul>
<li>è§£æRTSPæ¶ˆæ¯</li>
<li>ç»´æŠ¤ä¼šè¯çŠ¶æ€</li>
<li>å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚</li>
</ul>
</li>
<li>
<p><strong>RTPä¼ è¾“å±‚</strong></p>
<ul>
<li>å°è£…åª’ä½“æ•°æ®</li>
<li>æ—¶é—´æˆ³ç®¡ç†</li>
<li>åºåˆ—å·æ§åˆ¶</li>
</ul>
</li>
<li>
<p><strong>RTCPæ§åˆ¶å±‚</strong></p>
<ul>
<li>ä¼ è¾“è´¨é‡ç›‘æ§</li>
<li>åŒæ­¥æ§åˆ¶</li>
<li>å¸¦å®½è‡ªé€‚åº”</li>
</ul>
</li>
<li>
<p><strong>SDPæè¿°å±‚</strong></p>
<ul>
<li>åª’ä½“æ ¼å¼æè¿°</li>
<li>ä¼ è¾“å‚æ•°åå•†</li>
<li>å¤šåª’ä½“ä¼šè¯ä¿¡æ¯</li>
</ul>
</li>
</ol>
<h3 id="12-åè®®ç‰¹æ€§"><a class="header" href="#12-åè®®ç‰¹æ€§">1.2 åè®®ç‰¹æ€§</a></h3>
<h4 id="å®æ—¶æµåª’ä½“ä¼ è¾“"><a class="header" href="#å®æ—¶æµåª’ä½“ä¼ è¾“">å®æ—¶æµåª’ä½“ä¼ è¾“</a></h4>
<p><strong>å®æ—¶æ€§ä¿è¯</strong>ï¼š</p>
<pre><code>å»¶è¿Ÿæ§åˆ¶æªæ–½ï¼š
â”œâ”€ ä¼ è¾“å±‚ä¼˜åŒ–
â”‚  â”œâ”€ UDPä¼ è¾“ï¼ˆæ— é‡ä¼ å¼€é”€ï¼‰
â”‚  â”œâ”€ å°æ•°æ®åŒ…ï¼ˆå‡å°‘ç­‰å¾…æ—¶é—´ï¼‰
â”‚  â””â”€ ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆé‡è¦å¸§ä¼˜å…ˆï¼‰
â”œâ”€ ç¼“å†²ç­–ç•¥
â”‚  â”œâ”€ Jitter Bufferï¼ˆæŠ–åŠ¨ç¼“å†²ï¼‰
â”‚  â”œâ”€ è‡ªé€‚åº”ç¼“å†²ï¼ˆåŠ¨æ€è°ƒæ•´ï¼‰
â”‚  â””â”€ ä¸¢åŒ…è¡¥å¿ï¼ˆFEC/é‡ä¼ ï¼‰
â””â”€ ç¼–ç ä¼˜åŒ–
   â”œâ”€ ä½å»¶è¿Ÿç¼–ç å™¨
   â”œâ”€ å…³é”®å¸§ç­–ç•¥
   â””â”€ ç ç‡è‡ªé€‚åº”
</code></pre>
<p><strong>å…¸å‹å»¶è¿Ÿå¯¹æ¯”</strong>ï¼š</p>
<pre><code>åè®®/åœºæ™¯          ç«¯åˆ°ç«¯å»¶è¿Ÿ      é€‚ç”¨åœºæ™¯
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RTSP/UDP          100-300ms      è§†é¢‘ç›‘æ§ã€ç›´æ’­
RTSP/TCP          300-500ms      å¯é ä¼ è¾“åœºæ™¯
HLS               10-30s         ç‚¹æ’­ã€å¤§è§„æ¨¡åˆ†å‘
HTTP-FLV          2-5s           ç½‘é¡µç›´æ’­
WebRTC            50-150ms       å®æ—¶é€šä¿¡ã€äº’åŠ¨
</code></pre>
<h4 id="å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼"><a class="header" href="#å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼">å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å¼</a></h4>
<p><strong>è¯·æ±‚-å“åº”æœºåˆ¶</strong>ï¼š</p>
<pre><code>å®¢æˆ·ç«¯è¯·æ±‚æ ¼å¼ï¼š
PLAY rtsp://server.com/stream RTSP/1.0
CSeq: 4
Session: 12345678

æœåŠ¡å™¨å“åº”æ ¼å¼ï¼š
RTSP/1.0 200 OK
CSeq: 4
Session: 12345678
RTP-Info: url=rtsp://server.com/stream;seq=9810092;rtptime=3450012
</code></pre>
<p><strong>å¼‚æ­¥äº‹ä»¶æ”¯æŒ</strong>ï¼š</p>
<ul>
<li>æœåŠ¡å™¨å¯ä¸»åŠ¨æ¨é€äº‹ä»¶</li>
<li>æ”¯æŒé‡å®šå‘å’Œè´Ÿè½½å‡è¡¡</li>
<li>å®æ—¶çŠ¶æ€é€šçŸ¥</li>
</ul>
<h4 id="çŠ¶æ€ç®¡ç†"><a class="header" href="#çŠ¶æ€ç®¡ç†">çŠ¶æ€ç®¡ç†</a></h4>
<p><strong>ä¼šè¯ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INIT   â”‚ åˆå§‹çŠ¶æ€
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ SETUP
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  READY  â”‚ å‡†å¤‡å°±ç»ª
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ PLAY
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PLAYING â”‚ æ­£åœ¨æ’­æ”¾ â†â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜            â”‚ PLAY (æ¢å¤)
     â”‚ PAUSE          â”‚
     â†“                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ PAUSED  â”‚ æš‚åœ â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ TEARDOWN
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLOSED â”‚ ä¼šè¯å…³é—­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>çŠ¶æ€è½¬æ¢è§„åˆ™</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>å½“å‰çŠ¶æ€</th><th>å…è®¸çš„æ“ä½œ</th><th>è½¬æ¢ç›®æ ‡çŠ¶æ€</th></tr></thead><tbody>
<tr><td>INIT</td><td>DESCRIBE, SETUP</td><td>READY</td></tr>
<tr><td>READY</td><td>PLAY, TEARDOWN, SETUP</td><td>PLAYING, CLOSED, READY</td></tr>
<tr><td>PLAYING</td><td>PAUSE, TEARDOWN, PLAY</td><td>PAUSED, CLOSED, PLAYING</td></tr>
<tr><td>PAUSED</td><td>PLAY, TEARDOWN</td><td>PLAYING, CLOSED</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="2-rtspæ¶ˆæ¯æ ¼å¼"><a class="header" href="#2-rtspæ¶ˆæ¯æ ¼å¼">2. RTSPæ¶ˆæ¯æ ¼å¼</a></h2>
<h3 id="21-è¯·æ±‚æ¶ˆæ¯"><a class="header" href="#21-è¯·æ±‚æ¶ˆæ¯">2.1 è¯·æ±‚æ¶ˆæ¯</a></h3>
<h4 id="describe---è·å–åª’ä½“æè¿°"><a class="header" href="#describe---è·å–åª’ä½“æè¿°">DESCRIBE - è·å–åª’ä½“æè¿°</a></h4>
<p><strong>åŠŸèƒ½</strong>ï¼šè¯·æ±‚æœåŠ¡å™¨è¿”å›åª’ä½“èµ„æºçš„æè¿°ä¿¡æ¯ï¼ˆSDPï¼‰</p>
<p><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š</p>
<pre><code>DESCRIBE rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 2
User-Agent: MyPlayer/1.0
Accept: application/sdp
</code></pre>
<p><strong>å“åº”ç¤ºä¾‹</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 2
Content-Type: application/sdp
Content-Length: 458

v=0
o=- 1234567890 1234567890 IN IP4 192.168.1.100
s=Stream 1
t=0 0
m=video 0 RTP/AVP 96
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1;profile-level-id=42E01E
a=control:track1
m=audio 0 RTP/AVP 97
a=rtpmap:97 MPEG4-GENERIC/44100/2
a=control:track2
</code></pre>
<p><strong>SDPå­—æ®µè§£æ</strong>ï¼š</p>
<pre><code>v=0                    â†’ SDPç‰ˆæœ¬
o=                     â†’ ä¼šè¯å‘èµ·è€…ä¿¡æ¯
s=                     â†’ ä¼šè¯åç§°
t=0 0                  â†’ ä¼šè¯æ—¶é—´ï¼ˆ0è¡¨ç¤ºæ°¸ä¹…ï¼‰
m=video                â†’ è§†é¢‘åª’ä½“æµ
  0                    â†’ ç«¯å£ï¼ˆ0è¡¨ç¤ºç”±SETUPåå•†ï¼‰
  RTP/AVP              â†’ ä¼ è¾“åè®®
  96                   â†’ RTPè´Ÿè½½ç±»å‹
a=rtpmap:96 H264/90000 â†’ ç¼–ç æ ¼å¼å’Œæ—¶é’Ÿé¢‘ç‡
a=control:track1       â†’ æ§åˆ¶URL
</code></pre>
<h4 id="setup---å»ºç«‹ä¼ è¾“é€šé“"><a class="header" href="#setup---å»ºç«‹ä¼ è¾“é€šé“">SETUP - å»ºç«‹ä¼ è¾“é€šé“</a></h4>
<p><strong>åŠŸèƒ½</strong>ï¼šåå•†ä¼ è¾“å‚æ•°ï¼Œå»ºç«‹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ä¼ è¾“é€šé“</p>
<p><strong>UDPå•æ’­è¯·æ±‚</strong>ï¼š</p>
<pre><code>SETUP rtsp://192.168.1.100:554/stream1/track1 RTSP/1.0
CSeq: 3
Transport: RTP/AVP;unicast;client_port=8000-8001
User-Agent: MyPlayer/1.0
</code></pre>
<p><strong>UDPå•æ’­å“åº”</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 3
Session: 12345678;timeout=60
Transport: RTP/AVP;unicast;client_port=8000-8001;server_port=9000-9001;ssrc=12AB34CD
</code></pre>
<p><strong>TCPäº¤é”™ä¼ è¾“è¯·æ±‚</strong>ï¼š</p>
<pre><code>SETUP rtsp://192.168.1.100:554/stream1/track1 RTSP/1.0
CSeq: 3
Transport: RTP/AVP/TCP;unicast;interleaved=0-1
</code></pre>
<p><strong>TCPäº¤é”™ä¼ è¾“å“åº”</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 3
Session: 12345678
Transport: RTP/AVP/TCP;unicast;interleaved=0-1;ssrc=12AB34CD
</code></pre>
<p><strong>Transportå‚æ•°è¯¦è§£</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>å‚æ•°</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody>
<tr><td><strong>åè®®</strong></td><td>ä¼ è¾“åè®®ç±»å‹</td><td>RTP/AVP, RTP/AVP/TCP</td></tr>
<tr><td><strong>unicast/multicast</strong></td><td>å•æ’­æˆ–ç»„æ’­</td><td>unicast</td></tr>
<tr><td><strong>client_port</strong></td><td>å®¢æˆ·ç«¯RTP/RTCPç«¯å£</td><td>8000-8001</td></tr>
<tr><td><strong>server_port</strong></td><td>æœåŠ¡å™¨RTP/RTCPç«¯å£</td><td>9000-9001</td></tr>
<tr><td><strong>interleaved</strong></td><td>TCPé€šé“ç¼–å·</td><td>0-1 (0=RTP, 1=RTCP)</td></tr>
<tr><td><strong>ssrc</strong></td><td>åŒæ­¥æºæ ‡è¯†</td><td>12AB34CD</td></tr>
<tr><td><strong>mode</strong></td><td>ä¼ è¾“æ¨¡å¼</td><td>PLAY, RECORD</td></tr>
</tbody></table>
</div>
<h4 id="play---å¼€å§‹æ’­æ”¾"><a class="header" href="#play---å¼€å§‹æ’­æ”¾">PLAY - å¼€å§‹æ’­æ”¾</a></h4>
<p><strong>åŸºç¡€æ’­æ”¾è¯·æ±‚</strong>ï¼š</p>
<pre><code>PLAY rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 4
Session: 12345678
Range: npt=0.000-
</code></pre>
<p><strong>æ’­æ”¾å“åº”</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 4
Session: 12345678
Range: npt=0.000-
RTP-Info: url=rtsp://192.168.1.100:554/stream1/track1;seq=12345;rtptime=1234567890,
          url=rtsp://192.168.1.100:554/stream1/track2;seq=23456;rtptime=987654321
</code></pre>
<p><strong>Rangeå‚æ•°</strong>ï¼ˆæ—¶é—´å®šä½ï¼‰ï¼š</p>
<pre><code>Range: npt=0.000-              â†’ ä»å¼€å§‹æ’­æ”¾åˆ°ç»“æŸ
Range: npt=10.5-20.5           â†’ æ’­æ”¾10.5ç§’åˆ°20.5ç§’
Range: npt=30-                 â†’ ä»30ç§’æ’­æ”¾åˆ°ç»“æŸ
Range: smpte=00:05:00-00:10:00 â†’ SMPTEæ—¶é—´æ ¼å¼
Range: clock=20240101T120000Z- â†’ ç»å¯¹æ—¶é—´
</code></pre>
<p><strong>Scaleå‚æ•°</strong>ï¼ˆæ’­æ”¾é€Ÿåº¦ï¼‰ï¼š</p>
<pre><code>Scale: 1.0    â†’ æ­£å¸¸é€Ÿåº¦
Scale: 2.0    â†’ 2å€é€Ÿå¿«è¿›
Scale: 0.5    â†’ 0.5å€é€Ÿæ…¢æ”¾
Scale: -1.0   â†’ å€’æ”¾
</code></pre>
<h4 id="pause---æš‚åœæ’­æ”¾"><a class="header" href="#pause---æš‚åœæ’­æ”¾">PAUSE - æš‚åœæ’­æ”¾</a></h4>
<p><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š</p>
<pre><code>PAUSE rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 5
Session: 12345678
</code></pre>
<p><strong>å“åº”æ ¼å¼</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 5
Session: 12345678
</code></pre>
<h4 id="teardown---ç»ˆæ­¢ä¼šè¯"><a class="header" href="#teardown---ç»ˆæ­¢ä¼šè¯">TEARDOWN - ç»ˆæ­¢ä¼šè¯</a></h4>
<p><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š</p>
<pre><code>TEARDOWN rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 6
Session: 12345678
</code></pre>
<p><strong>å“åº”æ ¼å¼</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 6
Session: 12345678
</code></pre>
<h4 id="options---æŸ¥è¯¢æœåŠ¡å™¨èƒ½åŠ›"><a class="header" href="#options---æŸ¥è¯¢æœåŠ¡å™¨èƒ½åŠ›">OPTIONS - æŸ¥è¯¢æœåŠ¡å™¨èƒ½åŠ›</a></h4>
<p><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š</p>
<pre><code>OPTIONS rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 1
User-Agent: MyPlayer/1.0
</code></pre>
<p><strong>å“åº”æ ¼å¼</strong>ï¼š</p>
<pre><code>RTSP/1.0 200 OK
CSeq: 1
Public: OPTIONS, DESCRIBE, SETUP, PLAY, PAUSE, TEARDOWN, GET_PARAMETER, SET_PARAMETER
</code></pre>
<h4 id="announce---å‘å¸ƒæµä¿¡æ¯"><a class="header" href="#announce---å‘å¸ƒæµä¿¡æ¯">ANNOUNCE - å‘å¸ƒæµä¿¡æ¯</a></h4>
<p><strong>å®¢æˆ·ç«¯æ¨æµ</strong>ï¼š</p>
<pre><code>ANNOUNCE rtsp://server.com/live/stream1 RTSP/1.0
CSeq: 1
Content-Type: application/sdp
Content-Length: 256

v=0
o=- 1234567890 1234567890 IN IP4 192.168.1.50
s=Live Stream
t=0 0
m=video 0 RTP/AVP 96
a=rtpmap:96 H264/90000
</code></pre>
<h4 id="record---å¼€å§‹å½•åˆ¶"><a class="header" href="#record---å¼€å§‹å½•åˆ¶">RECORD - å¼€å§‹å½•åˆ¶</a></h4>
<p><strong>è¯·æ±‚æ ¼å¼</strong>ï¼š</p>
<pre><code>RECORD rtsp://server.com/live/stream1 RTSP/1.0
CSeq: 5
Session: 87654321
Range: npt=0.000-
</code></pre>
<h3 id="22-å“åº”æ¶ˆæ¯"><a class="header" href="#22-å“åº”æ¶ˆæ¯">2.2 å“åº”æ¶ˆæ¯</a></h3>
<h4 id="çŠ¶æ€ç åˆ†ç±»"><a class="header" href="#çŠ¶æ€ç åˆ†ç±»">çŠ¶æ€ç åˆ†ç±»</a></h4>
<p><strong>1xx - ä¿¡æ¯æ€§å“åº”</strong>ï¼š</p>
<pre><code>100 Continue           â†’ ç»§ç»­å‘é€è¯·æ±‚ä½“
</code></pre>
<p><strong>2xx - æˆåŠŸå“åº”</strong>ï¼š</p>
<pre><code>200 OK                 â†’ è¯·æ±‚æˆåŠŸ
201 Created            â†’ èµ„æºå·²åˆ›å»º
250 Low on Storage     â†’ å­˜å‚¨ç©ºé—´ä¸è¶³è­¦å‘Š
</code></pre>
<p><strong>3xx - é‡å®šå‘</strong>ï¼š</p>
<pre><code>301 Moved Permanently  â†’ æ°¸ä¹…ç§»åŠ¨
302 Moved Temporarily  â†’ ä¸´æ—¶ç§»åŠ¨
304 Not Modified       â†’ æœªä¿®æ”¹ï¼ˆç¼“å­˜æœ‰æ•ˆï¼‰
</code></pre>
<p><strong>4xx - å®¢æˆ·ç«¯é”™è¯¯</strong>ï¼š</p>
<pre><code>400 Bad Request        â†’ é”™è¯¯çš„è¯·æ±‚
401 Unauthorized       â†’ éœ€è¦è®¤è¯
403 Forbidden          â†’ ç¦æ­¢è®¿é—®
404 Not Found          â†’ èµ„æºä¸å­˜åœ¨
405 Method Not Allowed â†’ æ–¹æ³•ä¸å…è®¸
415 Unsupported Media  â†’ ä¸æ”¯æŒçš„åª’ä½“ç±»å‹
451 Parameter Not Understood â†’ å‚æ•°æ— æ³•ç†è§£
454 Session Not Found  â†’ ä¼šè¯ä¸å­˜åœ¨
455 Method Not Valid   â†’ æ–¹æ³•åœ¨æ­¤çŠ¶æ€æ— æ•ˆ
456 Header Field Not Valid â†’ å¤´å­—æ®µæ— æ•ˆ
457 Invalid Range      â†’ æ— æ•ˆçš„æ—¶é—´èŒƒå›´
458 Parameter Is Read-Only â†’ å‚æ•°åªè¯»
459 Aggregate Operation Not Allowed â†’ ä¸å…è®¸èšåˆæ“ä½œ
460 Only Aggregate Operation Allowed â†’ ä»…å…è®¸èšåˆæ“ä½œ
461 Unsupported Transport â†’ ä¸æ”¯æŒçš„ä¼ è¾“æ–¹å¼
462 Destination Unreachable â†’ ç›®æ ‡ä¸å¯è¾¾
</code></pre>
<p><strong>5xx - æœåŠ¡å™¨é”™è¯¯</strong>ï¼š</p>
<pre><code>500 Internal Server Error â†’ æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
501 Not Implemented    â†’ æœªå®ç°
503 Service Unavailable â†’ æœåŠ¡ä¸å¯ç”¨
504 Gateway Timeout    â†’ ç½‘å…³è¶…æ—¶
505 RTSP Version Not Supported â†’ RTSPç‰ˆæœ¬ä¸æ”¯æŒ
551 Option Not Supported â†’ é€‰é¡¹ä¸æ”¯æŒ
</code></pre>
<h4 id="å“åº”å¤´å­—æ®µ"><a class="header" href="#å“åº”å¤´å­—æ®µ">å“åº”å¤´å­—æ®µ</a></h4>
<p><strong>å¸¸ç”¨å“åº”å¤´</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>å¤´å­—æ®µ</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr></thead><tbody>
<tr><td><strong>CSeq</strong></td><td>å‘½ä»¤åºåˆ—å·ï¼ˆå¿…é¡»ï¼‰</td><td>CSeq: 4</td></tr>
<tr><td><strong>Session</strong></td><td>ä¼šè¯æ ‡è¯†</td><td>Session: 12345678;timeout=60</td></tr>
<tr><td><strong>Transport</strong></td><td>ä¼ è¾“å‚æ•°</td><td>Transport: RTP/AVP;unicast;...</td></tr>
<tr><td><strong>RTP-Info</strong></td><td>RTPæµä¿¡æ¯</td><td>RTP-Info: url=...;seq=...;rtptime=...</td></tr>
<tr><td><strong>Range</strong></td><td>æ—¶é—´èŒƒå›´</td><td>Range: npt=0.000-</td></tr>
<tr><td><strong>Scale</strong></td><td>æ’­æ”¾é€Ÿåº¦</td><td>Scale: 1.0</td></tr>
<tr><td><strong>Content-Type</strong></td><td>å†…å®¹ç±»å‹</td><td>Content-Type: application/sdp</td></tr>
<tr><td><strong>Content-Length</strong></td><td>å†…å®¹é•¿åº¦</td><td>Content-Length: 458</td></tr>
</tbody></table>
</div>
<h4 id="é”™è¯¯å¤„ç†"><a class="header" href="#é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</a></h4>
<p><strong>è®¤è¯å¤±è´¥å¤„ç†</strong>ï¼š</p>
<pre><code>è¯·æ±‚ï¼š
OPTIONS rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 1

å“åº”ï¼š
RTSP/1.0 401 Unauthorized
CSeq: 1
WWW-Authenticate: Digest realm="RTSP Server", nonce="7ypf/xlj9XXwfDPEoM4URrv/xwf94BcCAzFZH4GiTo0v",
                  stale=FALSE
</code></pre>
<p><strong>é‡è¯•è¯·æ±‚ï¼ˆå¸¦è®¤è¯ï¼‰</strong>ï¼š</p>
<pre><code>OPTIONS rtsp://192.168.1.100:554/stream1 RTSP/1.0
CSeq: 2
Authorization: Digest username="admin", realm="RTSP Server",
               nonce="7ypf/xlj9XXwfDPEoM4URrv/xwf94BcCAzFZH4GiTo0v",
               uri="rtsp://192.168.1.100:554/stream1",
               response="8ca523f5e9506fed4657c9700eebdbec"
</code></pre>
<p><strong>ä¼šè¯è¶…æ—¶å¤„ç†</strong>ï¼š</p>
<pre><code>å“åº”ï¼š
RTSP/1.0 454 Session Not Found
CSeq: 5

å¤„ç†ç­–ç•¥ï¼š
1. é‡æ–°å‘èµ·SETUPè¯·æ±‚
2. è·å–æ–°çš„Session ID
3. å‘é€PLAYç»§ç»­æ’­æ”¾
</code></pre>
<h3 id="23-æ¶ˆæ¯å¤´å­—æ®µ"><a class="header" href="#23-æ¶ˆæ¯å¤´å­—æ®µ">2.3 æ¶ˆæ¯å¤´å­—æ®µ</a></h3>
<h4 id="cseq---å‘½ä»¤åºåˆ—å·"><a class="header" href="#cseq---å‘½ä»¤åºåˆ—å·">CSeq - å‘½ä»¤åºåˆ—å·</a></h4>
<p><strong>ä½œç”¨</strong>ï¼šæ¯ä¸ªè¯·æ±‚/å“åº”å¯¹çš„å”¯ä¸€æ ‡è¯†</p>
<p><strong>ä½¿ç”¨è§„åˆ™</strong>ï¼š</p>
<pre><code>âœ“ æ­£ç¡®ä½¿ç”¨ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ï¼šCSeq: 1
æœåŠ¡å™¨å“åº”ï¼šCSeq: 1

å®¢æˆ·ç«¯è¯·æ±‚ï¼šCSeq: 2
æœåŠ¡å™¨å“åº”ï¼šCSeq: 2

âœ— é”™è¯¯ä½¿ç”¨ï¼š
å®¢æˆ·ç«¯è¯·æ±‚ï¼šCSeq: 1
æœåŠ¡å™¨å“åº”ï¼šCSeq: 2  â† é”™è¯¯ï¼å¿…é¡»åŒ¹é…
</code></pre>
<h4 id="session---ä¼šè¯æ ‡è¯†"><a class="header" href="#session---ä¼šè¯æ ‡è¯†">Session - ä¼šè¯æ ‡è¯†</a></h4>
<p><strong>æ ¼å¼</strong>ï¼š</p>
<pre><code>Session: &lt;session-id&gt;[;timeout=&lt;seconds&gt;]

ç¤ºä¾‹ï¼š
Session: QKyjN8nt2WqbWw4tIYof52    â†’ ä»…ä¼šè¯ID
Session: 12345678;timeout=60       â†’ ä¼šè¯ID + è¶…æ—¶æ—¶é—´
</code></pre>
<p><strong>è¶…æ—¶ç®¡ç†</strong>ï¼š</p>
<pre><code class="language-python"># å®¢æˆ·ç«¯ä¿æ´»ç­–ç•¥
import time

session_timeout = 60  # æœåŠ¡å™¨æŒ‡å®šçš„è¶…æ—¶æ—¶é—´
keepalive_interval = session_timeout * 0.5  # ä¿æ´»é—´éš”ï¼ˆè¶…æ—¶æ—¶é—´çš„ä¸€åŠï¼‰

while streaming:
    # å‘é€GET_PARAMETERæˆ–OPTIONSä¿æ´»
    send_keepalive()
    time.sleep(keepalive_interval)
</code></pre>
<h4 id="transport---ä¼ è¾“å‚æ•°"><a class="header" href="#transport---ä¼ è¾“å‚æ•°">Transport - ä¼ è¾“å‚æ•°</a></h4>
<p><strong>å®Œæ•´æ ¼å¼</strong>ï¼š</p>
<pre><code>Transport: &lt;protocol&gt;/&lt;profile&gt;[/&lt;lower-transport&gt;];
           &lt;parameter&gt;=&lt;value&gt;[;&lt;parameter&gt;=&lt;value&gt;]*
</code></pre>
<p><strong>å…¸å‹é…ç½®</strong>ï¼š</p>
<pre><code>1. UDPå•æ’­ï¼š
Transport: RTP/AVP;unicast;client_port=8000-8001;server_port=9000-9001

2. UDPç»„æ’­ï¼š
Transport: RTP/AVP;multicast;destination=239.255.1.1;port=5000-5001;ttl=127

3. TCPäº¤é”™ï¼š
Transport: RTP/AVP/TCP;unicast;interleaved=0-1

4. HTTPéš§é“ï¼š
Transport: RTP/AVP/TCP;unicast;interleaved=0-1;mode=play
</code></pre>
<h4 id="range---æ—¶é—´èŒƒå›´"><a class="header" href="#range---æ—¶é—´èŒƒå›´">Range - æ—¶é—´èŒƒå›´</a></h4>
<p><strong>NPTæ ¼å¼ï¼ˆNormal Play Timeï¼‰</strong>ï¼š</p>
<pre><code>Range: npt=&lt;start&gt;-&lt;end&gt;

ç¤ºä¾‹ï¼š
Range: npt=0.000-              â†’ ä»å¤´æ’­æ”¾
Range: npt=50.5-60.0           â†’ æ’­æ”¾50.5ç§’åˆ°60ç§’
Range: npt=now-                â†’ ä»å½“å‰æ—¶é—´æ’­æ”¾ï¼ˆç›´æ’­ï¼‰
</code></pre>
<p><strong>SMPTEæ ¼å¼</strong>ï¼š</p>
<pre><code>Range: smpte=&lt;start&gt;-&lt;end&gt;

ç¤ºä¾‹ï¼š
Range: smpte=00:05:00:00-00:10:00:00  â†’ 5åˆ†é’Ÿåˆ°10åˆ†é’Ÿ
</code></pre>
<p><strong>ç»å¯¹æ—¶é—´æ ¼å¼</strong>ï¼š</p>
<pre><code>Range: clock=&lt;start&gt;-&lt;end&gt;

ç¤ºä¾‹ï¼š
Range: clock=20240115T080000Z-20240115T090000Z
</code></pre>
<h4 id="user-agent---å®¢æˆ·ç«¯æ ‡è¯†"><a class="header" href="#user-agent---å®¢æˆ·ç«¯æ ‡è¯†">User-Agent - å®¢æˆ·ç«¯æ ‡è¯†</a></h4>
<p><strong>æ ¼å¼</strong>ï¼š</p>
<pre><code>User-Agent: &lt;product&gt;/&lt;version&gt; [&lt;comment&gt;]

ç¤ºä¾‹ï¼š
User-Agent: VLC/3.0.16
User-Agent: FFmpeg/4.4.1
User-Agent: MyPlayer/1.0 (Linux; Android 12)
</code></pre>
<hr />
<h2 id="3-rtspä¼šè¯ç®¡ç†"><a class="header" href="#3-rtspä¼šè¯ç®¡ç†">3. RTSPä¼šè¯ç®¡ç†</a></h2>
<h3 id="31-ä¼šè¯å»ºç«‹"><a class="header" href="#31-ä¼šè¯å»ºç«‹">3.1 ä¼šè¯å»ºç«‹</a></h3>
<h4 id="å®Œæ•´ä¼šè¯å»ºç«‹æµç¨‹"><a class="header" href="#å®Œæ•´ä¼šè¯å»ºç«‹æµç¨‹">å®Œæ•´ä¼šè¯å»ºç«‹æµç¨‹</a></h4>
<pre><code class="language-python"># Python ä¼ªä»£ç ç¤ºä¾‹
class RTSPClient:
    def establish_session(self, url):
        # 1. OPTIONS - æŸ¥è¯¢æœåŠ¡å™¨èƒ½åŠ›
        self.send_options(url)

        # 2. DESCRIBE - è·å–åª’ä½“æè¿°
        sdp = self.send_describe(url)
        self.parse_sdp(sdp)

        # 3. SETUP - ä¸ºæ¯ä¸ªåª’ä½“è½¨é“å»ºç«‹ä¼ è¾“
        for track in self.tracks:
            session_id = self.send_setup(track.control_url)

        # 4. PLAY - å¼€å§‹æ’­æ”¾
        self.send_play(url, session_id)

        # 5. æ¥æ”¶åª’ä½“æ•°æ®
        self.receive_rtp_data()
</code></pre>
<p><strong>è¯¦ç»†æ­¥éª¤</strong>ï¼š</p>
<p><strong>æ­¥éª¤1ï¼šOPTIONS</strong></p>
<pre><code>â†’ OPTIONS rtsp://192.168.1.100:554/stream1 RTSP/1.0
  CSeq: 1

â† RTSP/1.0 200 OK
  CSeq: 1
  Public: OPTIONS, DESCRIBE, SETUP, PLAY, PAUSE, TEARDOWN
</code></pre>
<p><strong>æ­¥éª¤2ï¼šDESCRIBE</strong></p>
<pre><code>â†’ DESCRIBE rtsp://192.168.1.100:554/stream1 RTSP/1.0
  CSeq: 2
  Accept: application/sdp

â† RTSP/1.0 200 OK
  CSeq: 2
  Content-Type: application/sdp
  Content-Length: 458

  v=0
  o=- 1234567890 1234567890 IN IP4 192.168.1.100
  s=Stream 1
  m=video 0 RTP/AVP 96
  a=rtpmap:96 H264/90000
  a=control:track1
  m=audio 0 RTP/AVP 97
  a=rtpmap:97 mpeg4-generic/44100/2
  a=control:track2
</code></pre>
<p><strong>æ­¥éª¤3ï¼šSETUPï¼ˆè§†é¢‘è½¨é“ï¼‰</strong></p>
<pre><code>â†’ SETUP rtsp://192.168.1.100:554/stream1/track1 RTSP/1.0
  CSeq: 3
  Transport: RTP/AVP;unicast;client_port=8000-8001

â† RTSP/1.0 200 OK
  CSeq: 3
  Session: 12345678;timeout=60
  Transport: RTP/AVP;unicast;client_port=8000-8001;server_port=9000-9001
</code></pre>
<p><strong>æ­¥éª¤4ï¼šSETUPï¼ˆéŸ³é¢‘è½¨é“ï¼‰</strong></p>
<pre><code>â†’ SETUP rtsp://192.168.1.100:554/stream1/track2 RTSP/1.0
  CSeq: 4
  Session: 12345678
  Transport: RTP/AVP;unicast;client_port=8002-8003

â† RTSP/1.0 200 OK
  CSeq: 4
  Session: 12345678
  Transport: RTP/AVP;unicast;client_port=8002-8003;server_port=9002-9003
</code></pre>
<p><strong>æ­¥éª¤5ï¼šPLAY</strong></p>
<pre><code>â†’ PLAY rtsp://192.168.1.100:554/stream1 RTSP/1.0
  CSeq: 5
  Session: 12345678
  Range: npt=0.000-

â† RTSP/1.0 200 OK
  CSeq: 5
  Session: 12345678
  RTP-Info: url=rtsp://192.168.1.100:554/stream1/track1;seq=12345;rtptime=1234567890,
            url=rtsp://192.168.1.100:554/stream1/track2;seq=23456;rtptime=987654321
</code></pre>
<h4 id="åª’ä½“æè¿°è·å–"><a class="header" href="#åª’ä½“æè¿°è·å–">åª’ä½“æè¿°è·å–</a></h4>
<p><strong>SDPç»“æ„è§£æ</strong>ï¼š</p>
<pre><code>v=0                               â† ç‰ˆæœ¬
o=&lt;username&gt; &lt;sess-id&gt; &lt;sess-version&gt; &lt;nettype&gt; &lt;addrtype&gt; &lt;address&gt;
s=&lt;session name&gt;                  â† ä¼šè¯åç§°
i=&lt;session description&gt;           â† ä¼šè¯æè¿°ï¼ˆå¯é€‰ï¼‰
u=&lt;URI&gt;                           â† URIï¼ˆå¯é€‰ï¼‰
e=&lt;email&gt;                         â† é‚®ç®±ï¼ˆå¯é€‰ï¼‰
c=&lt;nettype&gt; &lt;addrtype&gt; &lt;connection-address&gt;  â† è¿æ¥ä¿¡æ¯
t=&lt;start-time&gt; &lt;stop-time&gt;        â† æ—¶é—´æè¿°
a=&lt;attribute&gt;                     â† ä¼šè¯å±æ€§
m=&lt;media&gt; &lt;port&gt; &lt;proto&gt; &lt;fmt&gt;    â† åª’ä½“æè¿°
a=&lt;attribute&gt;                     â† åª’ä½“å±æ€§
</code></pre>
<p><strong>å®ä¾‹è§£æ</strong>ï¼š</p>
<pre><code class="language-sdp">v=0
o=- 1609459200 1609459200 IN IP4 192.168.1.100
  â”‚   â”‚          â”‚          â”‚  â”‚    â””â”€ æœåŠ¡å™¨IP
  â”‚   â”‚          â”‚          â”‚  â””â”€ åœ°å€ç±»å‹ï¼ˆIPv4ï¼‰
  â”‚   â”‚          â”‚          â””â”€ ç½‘ç»œç±»å‹ï¼ˆInternetï¼‰
  â”‚   â”‚          â””â”€ ä¼šè¯ç‰ˆæœ¬ï¼ˆæ—¶é—´æˆ³ï¼‰
  â”‚   â””â”€ ä¼šè¯IDï¼ˆæ—¶é—´æˆ³ï¼‰
  â””â”€ ç”¨æˆ·åï¼ˆ- è¡¨ç¤ºæ— ï¼‰

s=H.264/AAC Video Stream

c=IN IP4 192.168.1.100
  â””â”€ è¿æ¥åœ°å€

t=0 0
  â””â”€ æ—¶é—´ï¼š0 0 è¡¨ç¤ºæ°¸ä¹…ä¼šè¯

m=video 0 RTP/AVP 96
  â”‚     â”‚ â”‚       â””â”€ RTPè´Ÿè½½ç±»å‹
  â”‚     â”‚ â””â”€ ä¼ è¾“åè®®
  â”‚     â””â”€ ç«¯å£ï¼ˆ0è¡¨ç¤ºåœ¨SETUPä¸­åå•†ï¼‰
  â””â”€ åª’ä½“ç±»å‹

a=rtpmap:96 H264/90000
  â”‚         â”‚   â””â”€ æ—¶é’Ÿé¢‘ç‡ï¼ˆ90kHzï¼‰
  â”‚         â””â”€ ç¼–ç æ ¼å¼
  â””â”€ RTPæ˜ å°„

a=fmtp:96 packetization-mode=1;profile-level-id=42E01E;sprop-parameter-sets=Z0IAH5WoFAFuQA==,aM48gA==
  â””â”€ æ ¼å¼å‚æ•°ï¼ˆH.264ç‰¹å®šå‚æ•°ï¼‰

a=control:track1
  â””â”€ æ§åˆ¶URLåç¼€
</code></pre>
<h4 id="ä¼ è¾“å‚æ•°åå•†"><a class="header" href="#ä¼ è¾“å‚æ•°åå•†">ä¼ è¾“å‚æ•°åå•†</a></h4>
<p><strong>UDP vs TCPé€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<pre><code>é€‰æ‹©UDPçš„åœºæ™¯ï¼š
âœ“ å†…ç½‘ç¯å¢ƒï¼Œç½‘ç»œç¨³å®š
âœ“ å®æ—¶æ€§è¦æ±‚é«˜
âœ“ å¯æ¥å—å°‘é‡ä¸¢åŒ…
âœ“ ä½å»¶è¿Ÿåº”ç”¨

é€‰æ‹©TCPçš„åœºæ™¯ï¼š
âœ“ è·¨å…¬ç½‘ä¼ è¾“
âœ“ é˜²ç«å¢™/NATç¯å¢ƒ
âœ“ å¯é æ€§è¦æ±‚é«˜
âœ“ ä¸å…è®¸ä¸¢åŒ…
</code></pre>
<p><strong>åå•†æµç¨‹</strong>ï¼š</p>
<pre><code class="language-python">def negotiate_transport(self, prefer_tcp=False):
    if prefer_tcp:
        # å°è¯•TCPäº¤é”™ä¼ è¾“
        transport = "RTP/AVP/TCP;unicast;interleaved=0-1"
    else:
        # å°è¯•UDPä¼ è¾“
        local_rtp_port = self.allocate_port()
        local_rtcp_port = local_rtp_port + 1
        transport = f"RTP/AVP;unicast;client_port={local_rtp_port}-{local_rtcp_port}"

    response = self.send_setup(transport)

    if response.status == 200:
        # åå•†æˆåŠŸï¼Œè§£ææœåŠ¡å™¨è¿”å›çš„å‚æ•°
        return self.parse_transport(response.transport)
    elif response.status == 461:  # Unsupported Transport
        # ä¼ è¾“æ–¹å¼ä¸æ”¯æŒï¼Œå°è¯•å¤‡ç”¨æ–¹æ¡ˆ
        return self.negotiate_transport(prefer_tcp=not prefer_tcp)
    else:
        raise Exception(f"Setup failed: {response.status}")
</code></pre>
<h3 id="32-ä¼šè¯æ§åˆ¶"><a class="header" href="#32-ä¼šè¯æ§åˆ¶">3.2 ä¼šè¯æ§åˆ¶</a></h3>
<h4 id="æ’­æ”¾æ§åˆ¶"><a class="header" href="#æ’­æ”¾æ§åˆ¶">æ’­æ”¾æ§åˆ¶</a></h4>
<p><strong>æ­£å¸¸æ’­æ”¾</strong>ï¼š</p>
<pre><code class="language-python">def play(self, session_id, start_time=0):
    """å¼€å§‹æ’­æ”¾"""
    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Range: npt={start_time}-
"""
    return self.send_request(request)
</code></pre>
<p><strong>å®šä½æ’­æ”¾</strong>ï¼š</p>
<pre><code class="language-python">def seek(self, session_id, position):
    """è·³è½¬åˆ°æŒ‡å®šä½ç½®"""
    # å…ˆæš‚åœ
    self.pause(session_id)

    # å†ä»æ–°ä½ç½®æ’­æ”¾
    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Range: npt={position}-
"""
    return self.send_request(request)
</code></pre>
<p><strong>å˜é€Ÿæ’­æ”¾</strong>ï¼š</p>
<pre><code class="language-python">def set_speed(self, session_id, scale):
    """è®¾ç½®æ’­æ”¾é€Ÿåº¦
    scale: 1.0=æ­£å¸¸, 2.0=2å€é€Ÿ, 0.5=æ…¢æ”¾, -1.0=å€’æ”¾
    """
    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Scale: {scale}
Range: npt=0.000-
"""
    return self.send_request(request)
</code></pre>
<h4 id="æš‚åœæ¢å¤"><a class="header" href="#æš‚åœæ¢å¤">æš‚åœ/æ¢å¤</a></h4>
<p><strong>æš‚åœå®ç°</strong>ï¼š</p>
<pre><code class="language-python">def pause(self, session_id):
    """æš‚åœæ’­æ”¾"""
    request = f"""PAUSE {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
"""
    response = self.send_request(request)

    if response.status == 200:
        # è®°å½•æš‚åœä½ç½®
        self.paused_position = self.get_current_position()
        # åœæ­¢æ¥æ”¶RTPæ•°æ®
        self.stop_rtp_receiver()

    return response
</code></pre>
<p><strong>æ¢å¤æ’­æ”¾</strong>ï¼š</p>
<pre><code class="language-python">def resume(self, session_id):
    """æ¢å¤æ’­æ”¾"""
    # ä»æš‚åœä½ç½®ç»§ç»­æ’­æ”¾
    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Range: npt={self.paused_position}-
"""
    response = self.send_request(request)

    if response.status == 200:
        # æ¢å¤RTPæ•°æ®æ¥æ”¶
        self.start_rtp_receiver()

    return response
</code></pre>
<h4 id="å¿«è¿›å¿«é€€"><a class="header" href="#å¿«è¿›å¿«é€€">å¿«è¿›/å¿«é€€</a></h4>
<p><strong>å¿«è¿›å®ç°</strong>ï¼š</p>
<pre><code class="language-python">def fast_forward(self, session_id, speed=2.0):
    """å¿«è¿›
    speed: å€é€Ÿï¼Œå¦‚2.0è¡¨ç¤º2å€é€Ÿ
    """
    return self.set_speed(session_id, speed)
</code></pre>
<p><strong>å¿«é€€å®ç°</strong>ï¼š</p>
<pre><code class="language-python">def fast_backward(self, session_id, speed=2.0):
    """å¿«é€€
    speed: å€é€Ÿï¼Œè´Ÿå€¼è¡¨ç¤ºå€’æ”¾
    """
    return self.set_speed(session_id, -speed)
</code></pre>
<p><strong>é€å¸§æ’­æ”¾</strong>ï¼š</p>
<pre><code class="language-python">def step_forward(self, session_id):
    """å‘å‰ä¸€å¸§"""
    # æš‚åœå½“å‰æ’­æ”¾
    self.pause(session_id)

    # è®¡ç®—ä¸‹ä¸€å¸§çš„æ—¶é—´
    current_pos = self.get_current_position()
    frame_duration = 1.0 / self.fps  # å¸§æ—¶é•¿
    next_pos = current_pos + frame_duration

    # æ’­æ”¾ä¸€å¸§çš„æ—¶é•¿
    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Range: npt={next_pos}-{next_pos + frame_duration}
"""
    return self.send_request(request)
</code></pre>
<h4 id="è·³è½¬å®šä½"><a class="header" href="#è·³è½¬å®šä½">è·³è½¬å®šä½</a></h4>
<p><strong>æ—¶é—´è·³è½¬</strong>ï¼š</p>
<pre><code class="language-python">def seek_to_time(self, session_id, hours=0, minutes=0, seconds=0):
    """è·³è½¬åˆ°æŒ‡å®šæ—¶é—´

    Args:
        hours: å°æ—¶
        minutes: åˆ†é’Ÿ
        seconds: ç§’ï¼ˆå¯ä»¥æ˜¯æµ®ç‚¹æ•°ï¼‰
    """
    total_seconds = hours * 3600 + minutes * 60 + seconds

    request = f"""PLAY {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
Range: npt={total_seconds}-
"""
    return self.send_request(request)
</code></pre>
<p><strong>ç™¾åˆ†æ¯”è·³è½¬</strong>ï¼š</p>
<pre><code class="language-python">def seek_to_percent(self, session_id, percent):
    """è·³è½¬åˆ°ç™¾åˆ†æ¯”ä½ç½®

    Args:
        percent: 0-100çš„ç™¾åˆ†æ¯”
    """
    if not 0 &lt;= percent &lt;= 100:
        raise ValueError("Percent must be between 0 and 100")

    duration = self.get_duration()
    position = duration * (percent / 100.0)

    return self.seek_to_time(session_id, seconds=position)
</code></pre>
<h3 id="33-ä¼šè¯ç»ˆæ­¢"><a class="header" href="#33-ä¼šè¯ç»ˆæ­¢">3.3 ä¼šè¯ç»ˆæ­¢</a></h3>
<h4 id="æ­£å¸¸ç»ˆæ­¢"><a class="header" href="#æ­£å¸¸ç»ˆæ­¢">æ­£å¸¸ç»ˆæ­¢</a></h4>
<pre><code class="language-python">def teardown(self, session_id):
    """æ­£å¸¸ç»ˆæ­¢ä¼šè¯"""
    request = f"""TEARDOWN {self.url} RTSP/1.0
CSeq: {self.cseq}
Session: {session_id}
"""
    response = self.send_request(request)

    if response.status == 200:
        # æ¸…ç†èµ„æº
        self.close_rtp_sockets()
        self.session_id = None
        self.state = 'CLOSED'

    return response
</code></pre>
<h4 id="å¼‚å¸¸å¤„ç†"><a class="header" href="#å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</a></h4>
<p><strong>è¶…æ—¶å¤„ç†</strong>ï¼š</p>
<pre><code class="language-python">def handle_session_timeout(self):
    """å¤„ç†ä¼šè¯è¶…æ—¶"""
    # å°è¯•é‡æ–°å»ºç«‹ä¼šè¯
    try:
        self.establish_session(self.url)
    except Exception as e:
        print(f"é‡è¿å¤±è´¥: {e}")
        self.notify_error("ä¼šè¯è¶…æ—¶ä¸”é‡è¿å¤±è´¥")
</code></pre>
<p><strong>ç½‘ç»œä¸­æ–­å¤„ç†</strong>ï¼š</p>
<pre><code class="language-python">def handle_network_error(self):
    """å¤„ç†ç½‘ç»œä¸­æ–­"""
    retry_count = 0
    max_retries = 3

    while retry_count &lt; max_retries:
        time.sleep(2 ** retry_count)  # æŒ‡æ•°é€€é¿

        try:
            # å°è¯•é‡æ–°è¿æ¥
            self.reconnect()
            return
        except Exception:
            retry_count += 1

    # é‡è¯•å¤±è´¥
    self.notify_error("ç½‘ç»œè¿æ¥å¤±è´¥")
</code></pre>
<h4 id="èµ„æºæ¸…ç†"><a class="header" href="#èµ„æºæ¸…ç†">èµ„æºæ¸…ç†</a></h4>
<pre><code class="language-python">def cleanup(self):
    """æ¸…ç†æ‰€æœ‰èµ„æº"""
    try:
        # 1. å‘é€TEARDOWN
        if self.session_id:
            self.teardown(self.session_id)
    except:
        pass

    # 2. å…³é—­å¥—æ¥å­—
    for sock in [self.rtsp_socket, self.rtp_socket, self.rtcp_socket]:
        if sock:
            try:
                sock.close()
            except:
                pass

    # 3. åœæ­¢æ¥æ”¶çº¿ç¨‹
    if self.receiver_thread:
        self.receiver_thread.stop()
        self.receiver_thread.join()

    # 4. æ¸…ç†ç¼“å†²åŒº
    self.video_buffer.clear()
    self.audio_buffer.clear()

    # 5. é‡ç½®çŠ¶æ€
    self.state = 'CLOSED'
    self.session_id = None
</code></pre>
<hr />
<h2 id="4-ä¼ è¾“åè®®"><a class="header" href="#4-ä¼ è¾“åè®®">4. ä¼ è¾“åè®®</a></h2>
<h3 id="41-rtprtcp"><a class="header" href="#41-rtprtcp">4.1 RTP/RTCP</a></h3>
<h4 id="rtpæ•°æ®ä¼ è¾“"><a class="header" href="#rtpæ•°æ®ä¼ è¾“">RTPæ•°æ®ä¼ è¾“</a></h4>
<p><strong>RTPå¤´ç»“æ„</strong>ï¼š</p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|V=2|P|X|  CC   |M|     PT      |       Sequence Number         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                           Timestamp                           |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Synchronization Source (SSRC) identifier            |
+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
|            Contributing Source (CSRC) identifiers             |
|                             ....                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p><strong>å­—æ®µè¯´æ˜</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>å­—æ®µ</th><th>é•¿åº¦</th><th>è¯´æ˜</th></tr></thead><tbody>
<tr><td>V</td><td>2 bits</td><td>ç‰ˆæœ¬å·ï¼Œå›ºå®šä¸º2</td></tr>
<tr><td>P</td><td>1 bit</td><td>å¡«å……æ ‡å¿—</td></tr>
<tr><td>X</td><td>1 bit</td><td>æ‰©å±•æ ‡å¿—</td></tr>
<tr><td>CC</td><td>4 bits</td><td>CSRCè®¡æ•°</td></tr>
<tr><td>M</td><td>1 bit</td><td>æ ‡è®°ä½ï¼ˆå¸§ç»“æŸç­‰ï¼‰</td></tr>
<tr><td>PT</td><td>7 bits</td><td>è´Ÿè½½ç±»å‹</td></tr>
<tr><td>Sequence Number</td><td>16 bits</td><td>åºåˆ—å·</td></tr>
<tr><td>Timestamp</td><td>32 bits</td><td>æ—¶é—´æˆ³</td></tr>
<tr><td>SSRC</td><td>32 bits</td><td>åŒæ­¥æºæ ‡è¯†</td></tr>
</tbody></table>
</div>
<p><strong>RTPåŒ…è§£æ</strong>ï¼š</p>
<pre><code class="language-python">import struct

class RTPPacket:
    def __init__(self, data):
        # è§£æå›ºå®šå¤´ï¼ˆ12å­—èŠ‚ï¼‰
        header = struct.unpack('!BBHII', data[:12])

        # ç‰ˆæœ¬å’Œæ ‡å¿—
        vpxcc = header[0]
        self.version = (vpxcc &gt;&gt; 6) &amp; 0x03
        self.padding = (vpxcc &gt;&gt; 5) &amp; 0x01
        self.extension = (vpxcc &gt;&gt; 4) &amp; 0x01
        self.csrc_count = vpxcc &amp; 0x0F

        # æ ‡è®°å’Œè´Ÿè½½ç±»å‹
        mpt = header[1]
        self.marker = (mpt &gt;&gt; 7) &amp; 0x01
        self.payload_type = mpt &amp; 0x7F

        # åºåˆ—å·ã€æ—¶é—´æˆ³ã€SSRC
        self.sequence = header[2]
        self.timestamp = header[3]
        self.ssrc = header[4]

        # è´Ÿè½½æ•°æ®
        offset = 12 + 4 * self.csrc_count
        self.payload = data[offset:]

    def __repr__(self):
        return f"RTP(seq={self.sequence}, ts={self.timestamp}, pt={self.payload_type}, size={len(self.payload)})"
</code></pre>
<p><strong>RTPå‘é€å™¨</strong>ï¼š</p>
<pre><code class="language-python">class RTPSender:
    def __init__(self, dest_ip, dest_port, payload_type):
        self.socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.dest = (dest_ip, dest_port)
        self.sequence = 0
        self.timestamp = 0
        self.ssrc = random.randint(0, 0xFFFFFFFF)
        self.payload_type = payload_type

    def send_packet(self, payload, marker=False):
        """å‘é€RTPåŒ…"""
        # æ„å»ºRTPå¤´
        vpxcc = (2 &lt;&lt; 6)  # Version 2
        mpt = (marker &lt;&lt; 7) | self.payload_type

        header = struct.pack('!BBHII',
            vpxcc,
            mpt,
            self.sequence,
            self.timestamp,
            self.ssrc
        )

        # å‘é€
        packet = header + payload
        self.socket.sendto(packet, self.dest)

        # æ›´æ–°åºåˆ—å·
        self.sequence = (self.sequence + 1) &amp; 0xFFFF
</code></pre>
<h4 id="rtcpæ§åˆ¶åè®®"><a class="header" href="#rtcpæ§åˆ¶åè®®">RTCPæ§åˆ¶åè®®</a></h4>
<p><strong>RTCPåŒ…ç±»å‹</strong>ï¼š</p>
<pre><code>SR   (200)  â†’ Sender Reportï¼ˆå‘é€è€…æŠ¥å‘Šï¼‰
RR   (201)  â†’ Receiver Reportï¼ˆæ¥æ”¶è€…æŠ¥å‘Šï¼‰
SDES (202)  â†’ Source Descriptionï¼ˆæºæè¿°ï¼‰
BYE  (203)  â†’ Goodbyeï¼ˆç¦»å¼€é€šçŸ¥ï¼‰
APP  (204)  â†’ Application-definedï¼ˆåº”ç”¨è‡ªå®šä¹‰ï¼‰
</code></pre>
<p><strong>Sender Reportç»“æ„</strong>ï¼š</p>
<pre><code class="language-python">class RTCPSenderReport:
    def __init__(self):
        self.ssrc = 0
        self.ntp_timestamp = 0      # NTPæ—¶é—´æˆ³
        self.rtp_timestamp = 0      # RTPæ—¶é—´æˆ³
        self.sender_packet_count = 0  # å‘é€åŒ…æ•°
        self.sender_octet_count = 0   # å‘é€å­—èŠ‚æ•°
        self.report_blocks = []     # æ¥æ”¶æŠ¥å‘Šå—

    def pack(self):
        """æ‰“åŒ…æˆå­—èŠ‚"""
        # RTCPå¤´
        header = struct.pack('!BBH',
            0x80,  # V=2, P=0, RC=0
            200,   # PT=SR
            6      # Length
        )

        # SRæ•°æ®
        data = struct.pack('!IQQII',
            self.ssrc,
            self.ntp_timestamp,
            self.rtp_timestamp,
            self.sender_packet_count,
            self.sender_octet_count
        )

        return header + data
</code></pre>
<p><strong>Receiver Reportè§£æ</strong>ï¼š</p>
<pre><code class="language-python">def parse_receiver_report(data):
    """è§£ææ¥æ”¶è€…æŠ¥å‘Š"""
    # è§£æRTCPå¤´
    vprc = data[0]
    pt = data[1]
    length = struct.unpack('!H', data[2:4])[0]

    if pt != 201:  # RR
        return None

    # è§£ææŠ¥å‘Šå—
    ssrc = struct.unpack('!I', data[4:8])[0]

    report = {
        'ssrc': ssrc,
        'fraction_lost': data[8],
        'cumulative_lost': struct.unpack('!I', b'\x00' + data[9:12])[0],
        'highest_seq': struct.unpack('!I', data[12:16])[0],
        'jitter': struct.unpack('!I', data[16:20])[0],
        'lsr': struct.unpack('!I', data[20:24])[0],
        'dlsr': struct.unpack('!I', data[24:28])[0]
    }

    return report
</code></pre>
<h4 id="è´Ÿè½½ç±»å‹"><a class="header" href="#è´Ÿè½½ç±»å‹">è´Ÿè½½ç±»å‹</a></h4>
<p><strong>å¸¸ç”¨PTå€¼</strong>ï¼š</p>
<div class="table-wrapper"><table><thead><tr><th>PT</th><th>ç¼–ç </th><th>é‡‡æ ·ç‡</th><th>è¯´æ˜</th></tr></thead><tbody>
<tr><td>0</td><td>PCMU</td><td>8000</td><td>G.711 Î¼-law</td></tr>
<tr><td>3</td><td>GSM</td><td>8000</td><td>GSM</td></tr>
<tr><td>4</td><td>G723</td><td>8000</td><td>G.723</td></tr>
<tr><td>8</td><td>PCMA</td><td>8000</td><td>G.711 A-law</td></tr>
<tr><td>9</td><td>G722</td><td>8000</td><td>G.722</td></tr>
<tr><td>14</td><td>MPA</td><td>90000</td><td>MPEG Audio</td></tr>
<tr><td>26</td><td>JPEG</td><td>90000</td><td>JPEG</td></tr>
<tr><td>31</td><td>H261</td><td>90000</td><td>H.261</td></tr>
<tr><td>32</td><td>MPV</td><td>90000</td><td>MPEG Video</td></tr>
<tr><td>33</td><td>MP2T</td><td>90000</td><td>MPEG-2 TS</td></tr>
<tr><td>34</td><td>H263</td><td>90000</td><td>H.263</td></tr>
<tr><td>96-127</td><td>dynamic</td><td>-</td><td>åŠ¨æ€è´Ÿè½½ç±»å‹</td></tr>
</tbody></table>
</div>
<p><strong>åŠ¨æ€è´Ÿè½½æ˜ å°„ï¼ˆSDPä¸­å®šä¹‰ï¼‰</strong>ï¼š</p>
<pre><code class="language-sdp">m=video 0 RTP/AVP 96
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1

m=audio 0 RTP/AVP 97
a=rtpmap:97 mpeg4-generic/44100/2
</code></pre>
<h3 id="42-ä¼ è¾“æ¨¡å¼"><a class="header" href="#42-ä¼ è¾“æ¨¡å¼">4.2 ä¼ è¾“æ¨¡å¼</a></h3>
<h4 id="udpå•æ’­"><a class="header" href="#udpå•æ’­">UDPå•æ’­</a></h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<pre><code>ä¼˜ç‚¹ï¼š
âœ“ å»¶è¿Ÿä½ï¼ˆ100-300msï¼‰
âœ“ å®æ—¶æ€§å¥½
âœ“ æœåŠ¡å™¨è´Ÿè½½ä½
âœ“ é€‚åˆå®æ—¶ç›‘æ§

ç¼ºç‚¹ï¼š
âœ— å¯èƒ½ä¸¢åŒ…
âœ— æ— æ‹¥å¡æ§åˆ¶
âœ— é˜²ç«å¢™/NATé—®é¢˜
</code></pre>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">class UDPUnicastReceiver:
    def __init__(self, local_port):
        # åˆ›å»ºRTPå¥—æ¥å­—
        self.rtp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.rtp_socket.bind(('0.0.0.0', local_port))

        # åˆ›å»ºRTCPå¥—æ¥å­—
        self.rtcp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.rtcp_socket.bind(('0.0.0.0', local_port + 1))

        self.running = False

    def start(self):
        """å¼€å§‹æ¥æ”¶"""
        self.running = True

        # RTPæ¥æ”¶çº¿ç¨‹
        rtp_thread = threading.Thread(target=self.receive_rtp)
        rtp_thread.start()

        # RTCPæ¥æ”¶çº¿ç¨‹
        rtcp_thread = threading.Thread(target=self.receive_rtcp)
        rtcp_thread.start()

    def receive_rtp(self):
        """æ¥æ”¶RTPæ•°æ®"""
        while self.running:
            try:
                data, addr = self.rtp_socket.recvfrom(2048)
                packet = RTPPacket(data)
                self.process_rtp_packet(packet)
            except Exception as e:
                print(f"RTPæ¥æ”¶é”™è¯¯: {e}")

    def receive_rtcp(self):
        """æ¥æ”¶RTCPæ•°æ®"""
        while self.running:
            try:
                data, addr = self.rtcp_socket.recvfrom(1024)
                self.process_rtcp_packet(data)
            except Exception as e:
                print(f"RTCPæ¥æ”¶é”™è¯¯: {e}")
</code></pre>
<h4 id="udpç»„æ’­"><a class="header" href="#udpç»„æ’­">UDPç»„æ’­</a></h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<pre><code>ä¼˜ç‚¹ï¼š
âœ“ ä¸€å¯¹å¤šä¼ è¾“æ•ˆç‡é«˜
âœ“ èŠ‚çœå¸¦å®½
âœ“ é€‚åˆå¤§è§„æ¨¡åˆ†å‘

ç¼ºç‚¹ï¼š
âœ— éœ€è¦ç½‘ç»œæ”¯æŒ
âœ— ç®¡ç†å¤æ‚
âœ— å…¬ç½‘ä¸å¯ç”¨
</code></pre>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">class MulticastReceiver:
    def __init__(self, multicast_group, port):
        self.socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

        # ç»‘å®šç«¯å£
        self.socket.bind(('', port))

        # åŠ å…¥ç»„æ’­ç»„
        mreq = struct.pack('4sL',
                          socket.inet_aton(multicast_group),
                          socket.INADDR_ANY)
        self.socket.setsockopt(socket.IPPROTO_IP,
                              socket.IP_ADD_MEMBERSHIP,
                              mreq)

    def receive(self):
        """æ¥æ”¶ç»„æ’­æ•°æ®"""
        while True:
            data, addr = self.socket.recvfrom(2048)
            packet = RTPPacket(data)
            self.process_packet(packet)
</code></pre>
<h4 id="tcpäº¤é”™ä¼ è¾“"><a class="header" href="#tcpäº¤é”™ä¼ è¾“">TCPäº¤é”™ä¼ è¾“</a></h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<pre><code>ä¼˜ç‚¹ï¼š
âœ“ å¯é ä¼ è¾“ï¼Œæ— ä¸¢åŒ…
âœ“ ç©¿é€é˜²ç«å¢™/NAT
âœ“ å•ä¸€TCPè¿æ¥

ç¼ºç‚¹ï¼š
âœ— å»¶è¿Ÿè¾ƒé«˜ï¼ˆ300-500msï¼‰
âœ— å¤´éƒ¨å¼€é”€
âœ— æ‹¥å¡æ§åˆ¶å½±å“å®æ—¶æ€§
</code></pre>
<p><strong>äº¤é”™å¸§æ ¼å¼</strong>ï¼š</p>
<pre><code> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|   Magic ($)   |   Channel ID  |          Data Length          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                          RTP/RTCP Data                        |
|                             ....                              |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

Magic: 0x24 ('$')
Channel ID: 0=video RTP, 1=video RTCP, 2=audio RTP, 3=audio RTCP
Data Length: RTP/RTCPåŒ…é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰
</code></pre>
<p><strong>å®ç°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-python">class InterleavedReceiver:
    def __init__(self, rtsp_socket):
        self.socket = rtsp_socket
        self.channels = {}  # channel_id -&gt; handler

    def register_channel(self, channel_id, handler):
        """æ³¨å†Œé€šé“å¤„ç†å™¨"""
        self.channels[channel_id] = handler

    def receive_loop(self):
        """æ¥æ”¶å¾ªç¯"""
        while True:
            # è¯»å–ç¬¬ä¸€ä¸ªå­—èŠ‚
            magic = self.socket.recv(1)

            if magic == b'$':
                # äº¤é”™å¸§
                header = self.socket.recv(3)
                channel_id = header[0]
                length = struct.unpack('!H', header[1:3])[0]

                # è¯»å–æ•°æ®
                data = self.socket.recv(length)

                # åˆ†å‘åˆ°å¯¹åº”å¤„ç†å™¨
                if channel_id in self.channels:
                    self.channels[channel_id](data)

            elif magic == b'R':
                # RTSPå“åº”
                line = magic + self.socket.recv_until(b'\r\n')
                response = self.parse_rtsp_response(line)
                self.handle_rtsp_response(response)
</code></pre>
<h4 id="httpéš§é“"><a class="header" href="#httpéš§é“">HTTPéš§é“</a></h4>
<p><strong>åœºæ™¯</strong>ï¼šç©¿é€ä¸¥æ ¼çš„é˜²ç«å¢™ï¼Œä»…å…è®¸HTTPæµé‡</p>
<p><strong>å®ç°æ–¹å¼</strong>ï¼š</p>
<pre><code>1. GETé€šé“ï¼šæ¥æ”¶æœåŠ¡å™¨æ•°æ®
GET /stream HTTP/1.1
Host: server.com
Connection: keep-alive

2. POSTé€šé“ï¼šå‘é€å®¢æˆ·ç«¯å‘½ä»¤
POST /stream HTTP/1.1
Host: server.com
Content-Type: application/x-rtsp-tunnelled
</code></pre>
<p><strong>ä¼˜ç¼ºç‚¹</strong>ï¼š</p>
<pre><code>ä¼˜ç‚¹ï¼š
âœ“ æœ€å¤§å…¼å®¹æ€§
âœ“ ç©¿é€ä»»ä½•é˜²ç«å¢™

ç¼ºç‚¹ï¼š
âœ— å»¶è¿Ÿæœ€é«˜
âœ— å¼€é”€å¤§
âœ— å¤æ‚åº¦é«˜
</code></pre>
<h3 id="43-ç«¯å£ç®¡ç†"><a class="header" href="#43-ç«¯å£ç®¡ç†">4.3 ç«¯å£ç®¡ç†</a></h3>
<h4 id="åŠ¨æ€ç«¯å£åˆ†é…"><a class="header" href="#åŠ¨æ€ç«¯å£åˆ†é…">åŠ¨æ€ç«¯å£åˆ†é…</a></h4>
<pre><code class="language-python">class PortManager:
    def __init__(self, port_range=(10000, 20000)):
        self.min_port, self.max_port = port_range
        self.used_ports = set()

    def allocate_rtp_pair(self):
        """åˆ†é…RTP/RTCPç«¯å£å¯¹

        Returns:
            (rtp_port, rtcp_port): ç«¯å£å¯¹ï¼ŒRTCPç«¯å£ = RTPç«¯å£ + 1
        """
        for port in range(self.min_port, self.max_port, 2):
            if port not in self.used_ports and port + 1 not in self.used_ports:
                # å°è¯•ç»‘å®šæµ‹è¯•
                if self.try_bind(port) and self.try_bind(port + 1):
                    self.used_ports.add(port)
                    self.used_ports.add(port + 1)
                    return (port, port + 1)

        raise Exception("æ— å¯ç”¨ç«¯å£")

    def try_bind(self, port):
        """æµ‹è¯•ç«¯å£æ˜¯å¦å¯ç”¨"""
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            sock.bind(('0.0.0.0', port))
            sock.close()
            return True
        except:
            return False

    def release_port(self, port):
        """é‡Šæ”¾ç«¯å£"""
        self.used_ports.discard(port)
</code></pre>
<h4 id="ç«¯å£èŒƒå›´é…ç½®"><a class="header" href="#ç«¯å£èŒƒå›´é…ç½®">ç«¯å£èŒƒå›´é…ç½®</a></h4>
<p><strong>æ¨èé…ç½®</strong>ï¼š</p>
<pre><code>åº”ç”¨åœºæ™¯           ç«¯å£èŒƒå›´          è¯´æ˜
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ¡Œé¢åº”ç”¨         10000-20000      10000ä¸ªç«¯å£å¯¹
æœåŠ¡å™¨           30000-40000      å¤§è§„æ¨¡å¹¶å‘
åµŒå…¥å¼è®¾å¤‡       50000-51000      èµ„æºå—é™
</code></pre>
<p><strong>é˜²ç«å¢™é…ç½®ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-bash"># Linux iptables
# å…è®¸RTSPæ§åˆ¶ç«¯å£
iptables -A INPUT -p tcp --dport 554 -j ACCEPT

# å…è®¸RTP/RTCPæ•°æ®ç«¯å£
iptables -A INPUT -p udp --dport 10000:20000 -j ACCEPT
</code></pre>
<h4 id="natç©¿é€"><a class="header" href="#natç©¿é€">NATç©¿é€</a></h4>
<p><strong>STUNæ–¹å¼</strong>ï¼š</p>
<pre><code class="language-python">import stun

def get_external_address():
    """è·å–å¤–ç½‘åœ°å€å’Œç«¯å£"""
    nat_type, external_ip, external_port = stun.get_ip_info()
    return external_ip, external_port

# åœ¨SETUPä¸­ä½¿ç”¨å¤–ç½‘åœ°å€
external_ip, external_port = get_external_address()
transport = f"RTP/AVP;unicast;client_port={external_port}-{external_port+1}"
</code></pre>
<p><strong>TCPç©¿é€</strong>ï¼š</p>
<pre><code>å½“UDPè¢«é˜»æ­¢æ—¶ï¼Œä½¿ç”¨TCPäº¤é”™ä¼ è¾“ï¼š
Transport: RTP/AVP/TCP;unicast;interleaved=0-1
</code></pre>
<p><strong>ä¸­ç»§æ–¹å¼</strong>ï¼š</p>
<pre><code>ä½¿ç”¨TURNæœåŠ¡å™¨ä¸­ç»§ï¼š
å®¢æˆ·ç«¯ &lt;-&gt; TURNæœåŠ¡å™¨ &lt;-&gt; RTSPæœåŠ¡å™¨
</code></pre>
<hr />
<h2 id="5-åª’ä½“æ ¼å¼æ”¯æŒ"><a class="header" href="#5-åª’ä½“æ ¼å¼æ”¯æŒ">5. åª’ä½“æ ¼å¼æ”¯æŒ</a></h2>
<h3 id="51-è§†é¢‘ç¼–ç "><a class="header" href="#51-è§†é¢‘ç¼–ç ">5.1 è§†é¢‘ç¼–ç </a></h3>
<h4 id="h264avc"><a class="header" href="#h264avc">H.264/AVC</a></h4>
<p><strong>RTPå°è£…</strong>ï¼š</p>
<pre><code>H.264 RTPè´Ÿè½½æ ¼å¼ï¼ˆRFC 6184ï¼‰ï¼š

å•ä¸ªNALUæ¨¡å¼ï¼š
+-+-+-+-+-+-+-+-+
|F|NRI|  Type   |  NALU Header (1 byte)
+-+-+-+-+-+-+-+-+
|               |
|  NALU Payload |
|               |
+-+-+-+-+-+-+-+-+

åˆ†ç‰‡å•å…ƒï¼ˆFU-Aï¼‰ï¼š
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|F|NRI|  Type=28|S|E|R| FU Type |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|            Fragment Data      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</code></pre>
<p><strong>è§£æå®ç°</strong>ï¼š</p>
<pre><code class="language-python">class H264RTPPayload:
    NALU_TYPE_SINGLE = range(1, 24)
    NALU_TYPE_FU_A = 28

    def parse(self, rtp_payload):
        """è§£æH.264 RTPè´Ÿè½½"""
        nalu_header = rtp_payload[0]
        nalu_type = nalu_header &amp; 0x1F

        if nalu_type in self.NALU_TYPE_SINGLE:
            # å•ä¸ªNALU
            return [rtp_payload]

        elif nalu_type == self.NALU_TYPE_FU_A:
            # åˆ†ç‰‡å•å…ƒ
            fu_header = rtp_payload[1]
            start_bit = (fu_header &gt;&gt; 7) &amp; 0x01
            end_bit = (fu_header &gt;&gt; 6) &amp; 0x01
            fu_type = fu_header &amp; 0x1F

            if start_bit:
                # ç¬¬ä¸€ä¸ªåˆ†ç‰‡ï¼Œé‡å»ºNALUå¤´
                reconstructed_nalu_header = (nalu_header &amp; 0xE0) | fu_type
                return [bytes([reconstructed_nalu_header]) + rtp_payload[2:]]
            else:
                # åç»­åˆ†ç‰‡
                return [rtp_payload[2:]]
</code></pre>
<p><strong>SDPç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-sdp">m=video 0 RTP/AVP 96
a=rtpmap:96 H264/90000
a=fmtp:96 packetization-mode=1;profile-level-id=42E01E;sprop-parameter-sets=Z0IAH5WoFAFuQA==,aM48gA==
</code></pre>
<h4 id="h265hevc"><a class="header" href="#h265hevc">H.265/HEVC</a></h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<pre><code>ç›¸æ¯”H.264ï¼š
âœ“ å‹ç¼©ç‡æå‡30-50%
âœ“ æ”¯æŒæ›´é«˜åˆ†è¾¨ç‡ï¼ˆ4K/8Kï¼‰
âœ“ æ›´å¥½çš„å¹¶è¡Œå¤„ç†

ç¼ºç‚¹ï¼š
âœ— ç¼–ç å¤æ‚åº¦é«˜
âœ— ä¸“åˆ©è´¹ç”¨
âœ— è®¾å¤‡æ”¯æŒåº¦è¾ƒä½
</code></pre>
<p><strong>SDPç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-sdp">m=video 0 RTP/AVP 96
a=rtpmap:96 H265/90000
a=fmtp:96 profile-id=1;level-id=93;sprop-vps=&lt;base64&gt;;sprop-sps=&lt;base64&gt;;sprop-pps=&lt;base64&gt;
</code></pre>
<h3 id="52-éŸ³é¢‘ç¼–ç "><a class="header" href="#52-éŸ³é¢‘ç¼–ç ">5.2 éŸ³é¢‘ç¼–ç </a></h3>
<h4 id="aac"><a class="header" href="#aac">AAC</a></h4>
<p><strong>MPEG-4 Generic RTPå°è£…</strong>ï¼š</p>
<pre><code class="language-sdp">m=audio 0 RTP/AVP 97
a=rtpmap:97 mpeg4-generic/44100/2
a=fmtp:97 streamtype=5;profile-level-id=1;mode=AAC-hbr;sizelength=13;indexlength=3;indexdeltalength=3;config=1190
</code></pre>
<p><strong>è§£æå®ç°</strong>ï¼š</p>
<pre><code class="language-python">def parse_aac_config(config_hex):
    """è§£æAACé…ç½®"""
    config_bits = bin(int(config_hex, 16))[2:].zfill(16)

    # éŸ³é¢‘å¯¹è±¡ç±»å‹ï¼ˆ5 bitsï¼‰
    audio_object_type = int(config_bits[0:5], 2)

    # é‡‡æ ·ç‡ç´¢å¼•ï¼ˆ4 bitsï¼‰
    sample_rate_index = int(config_bits[5:9], 2)

    # å£°é“é…ç½®ï¼ˆ4 bitsï¼‰
    channel_config = int(config_bits[9:13], 2)

    # é‡‡æ ·ç‡è¡¨
    sample_rates = [96000, 88200, 64000, 48000, 44100, 32000,
                   24000, 22050, 16000, 12000, 11025, 8000, 7350]

    return {
        'object_type': audio_object_type,
        'sample_rate': sample_rates[sample_rate_index],
        'channels': channel_config
    }
</code></pre>
<h4 id="g711"><a class="header" href="#g711">G.711</a></h4>
<p><strong>ç‰¹ç‚¹</strong>ï¼š</p>
<pre><code>âœ“ ä½å¤æ‚åº¦
âœ“ æ— ä¸“åˆ©é™åˆ¶
âœ“ å›ºå®š64kbpsç ç‡
âœ— éŸ³è´¨ä¸€èˆ¬
âœ— å¸¦å®½å ç”¨å¤§
</code></pre>
<p><strong>SDPç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-sdp">m=audio 0 RTP/AVP 0 8
a=rtpmap:0 PCMU/8000    # Î¼-law
a=rtpmap:8 PCMA/8000    # A-law
</code></pre>
<hr />
<p>ç”±äºå†…å®¹è¾ƒå¤šï¼Œæˆ‘å°†RTSP.mdåˆ†æˆä¸»æ–‡ä»¶+å®è·µéƒ¨åˆ†ã€‚ç°åœ¨ä¿å­˜å½“å‰å†…å®¹ï¼Œç„¶åç»§ç»­è¡¥å……å®è·µç« èŠ‚ã€‚</p>
<h2 id="ç»§ç»­è¡¥å……å†…å®¹"><a class="header" href="#ç»§ç»­è¡¥å……å†…å®¹">ç»§ç»­è¡¥å……å†…å®¹...</a></h2>
<p>(ä¸ºæ§åˆ¶è¾“å‡ºé•¿åº¦ï¼Œæˆ‘ä¼šå°†å‰©ä½™å†…å®¹åˆ†æ¬¡è¡¥å……æˆ–åˆ›å»ºè¡¥å……æ–‡ä»¶)</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ç¼–ç¨‹/video/FFMpeg.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ç¼–ç¨‹/video/RTSP_å®è·µæŒ‡å—.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ç¼–ç¨‹/video/FFMpeg.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ç¼–ç¨‹/video/RTSP_å®è·µæŒ‡å—.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

