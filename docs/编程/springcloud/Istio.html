<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Istio æœåŠ¡ç½‘æ ¼æŠ€æœ¯å­¦ä¹ ç¬”è®° - å¼€å‘</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">å¼€å‘</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="æœç´¢æœ¬ä¹¦å†…å®¹..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="istio-æœåŠ¡ç½‘æ ¼æŠ€æœ¯å­¦ä¹ ç¬”è®°"><a class="header" href="#istio-æœåŠ¡ç½‘æ ¼æŠ€æœ¯å­¦ä¹ ç¬”è®°">Istio æœåŠ¡ç½‘æ ¼æŠ€æœ¯å­¦ä¹ ç¬”è®°</a></h1>
<blockquote>
<p><strong>å­¦ä¹ ç›®æ ‡å®šä½</strong>: é¢å‘0-5å¹´ç»éªŒçš„å¾®æœåŠ¡å¼€å‘è€…ï¼Œå¸®åŠ©ä½ ç³»ç»ŸæŒæ¡IstioæœåŠ¡ç½‘æ ¼æŠ€æœ¯ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°ç”Ÿäº§å®è·µ</p>
<p><strong>é¢„æœŸå­¦ä¹ æˆæœ</strong>:</p>
<ul>
<li>ç†è§£æœåŠ¡ç½‘æ ¼çš„æ ¸å¿ƒæ¦‚å¿µå’Œåº”ç”¨åœºæ™¯</li>
<li>æŒæ¡Istioçš„å®‰è£…ã€é…ç½®å’Œæ ¸å¿ƒåŠŸèƒ½</li>
<li>èƒ½å¤Ÿä½¿ç”¨Istioå®ç°æµé‡ç®¡ç†ã€å®‰å…¨æ§åˆ¶å’Œå¯è§‚æµ‹æ€§</li>
<li>å…·å¤‡åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œè¿ç»´Istioçš„èƒ½åŠ›</li>
</ul>
</blockquote>
<hr />
<h2 id="-å­¦ä¹ è·¯å¾„è§„åˆ’"><a class="header" href="#-å­¦ä¹ è·¯å¾„è§„åˆ’">ğŸ“š å­¦ä¹ è·¯å¾„è§„åˆ’</a></h2>
<pre><code class="language-mermaid">graph LR
    A[åŸºç¡€æ¦‚å¿µ] --&gt; B[æ¶æ„ç†è§£]
    B --&gt; C[ç¯å¢ƒæ­å»º]
    C --&gt; D[æµé‡ç®¡ç†]
    D --&gt; E[å®‰å…¨æ§åˆ¶]
    E --&gt; F[å¯è§‚æµ‹æ€§]
    F --&gt; G[ç”Ÿäº§å®è·µ]
</code></pre>
<p><strong>å»ºè®®å­¦ä¹ æ—¶é—´</strong>: 15-20å¤©</p>
<ul>
<li>åŸºç¡€é˜¶æ®µï¼ˆ1-3å¤©ï¼‰: æ¦‚å¿µç†è§£ + ç¯å¢ƒæ­å»º</li>
<li>æ ¸å¿ƒåŠŸèƒ½ï¼ˆ4-10å¤©ï¼‰: æµé‡ç®¡ç† + å®‰å…¨ + å¯è§‚æµ‹æ€§</li>
<li>å®æˆ˜è¿›é˜¶ï¼ˆ11-15å¤©ï¼‰: ç»¼åˆæ¡ˆä¾‹ + ç”Ÿäº§éƒ¨ç½²</li>
<li>ä¼˜åŒ–æå‡ï¼ˆ16-20å¤©ï¼‰: æ€§èƒ½è°ƒä¼˜ + æ•…éšœæ’æŸ¥</li>
</ul>
<hr />
<h2 id="1-istio-åŸºç¡€æ¦‚å¿µ"><a class="header" href="#1-istio-åŸºç¡€æ¦‚å¿µ">1. Istio åŸºç¡€æ¦‚å¿µ</a></h2>
<h3 id="11-ä»€ä¹ˆæ˜¯-istio"><a class="header" href="#11-ä»€ä¹ˆæ˜¯-istio">1.1 ä»€ä¹ˆæ˜¯ Istio</a></h3>
<p><strong>Istio</strong> æ˜¯ä¸€ä¸ªå¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰å¹³å°ï¼Œä¸ºåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„æä¾›è¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚å¯ŸæœåŠ¡çš„ç»Ÿä¸€æ–¹å¼ã€‚</p>
<h4 id="æ ¸å¿ƒä»·å€¼"><a class="header" href="#æ ¸å¿ƒä»·å€¼">æ ¸å¿ƒä»·å€¼</a></h4>
<div class="table-wrapper"><table><thead><tr><th>åŠŸèƒ½é¢†åŸŸ</th><th>æä¾›èƒ½åŠ›</th><th>ä¸šåŠ¡ä»·å€¼</th></tr></thead><tbody>
<tr><td><strong>æµé‡ç®¡ç†</strong></td><td>æ™ºèƒ½è·¯ç”±ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤</td><td>æå‡æœåŠ¡å¯ç”¨æ€§å’Œç”¨æˆ·ä½“éªŒ</td></tr>
<tr><td><strong>å®‰å…¨</strong></td><td>æœåŠ¡é—´åŠ å¯†ã€èº«ä»½è®¤è¯ã€è®¿é—®æ§åˆ¶</td><td>ä¿éšœå¾®æœåŠ¡é€šä¿¡å®‰å…¨</td></tr>
<tr><td><strong>å¯è§‚æµ‹æ€§</strong></td><td>æŒ‡æ ‡æ”¶é›†ã€æ—¥å¿—èšåˆã€åˆ†å¸ƒå¼è¿½è¸ª</td><td>å¿«é€Ÿå®šä½é—®é¢˜ï¼Œä¼˜åŒ–æ€§èƒ½</td></tr>
<tr><td><strong>ç­–ç•¥æ‰§è¡Œ</strong></td><td>é™æµã€é…é¢ç®¡ç†ã€é»‘ç™½åå•</td><td>ä¿æŠ¤æœåŠ¡ç¨³å®šæ€§</td></tr>
</tbody></table>
</div>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼"><a class="header" href="#ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼">ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘æ ¼ï¼Ÿ</a></h4>
<p><strong>ä¼ ç»Ÿå¾®æœåŠ¡æ¶æ„çš„ç—›ç‚¹</strong>:</p>
<pre><code class="language-java">// ä¼ ç»Ÿæ–¹å¼ï¼šæ¯ä¸ªæœåŠ¡éƒ½éœ€è¦å®ç°è¿™äº›åŠŸèƒ½
@Service
public class OrderService {

    @HystrixCommand(fallbackMethod = "fallback")  // ç†”æ–­
    @RateLimiter(limit = 100)                     // é™æµ
    public Order createOrder() {
        // é‡è¯•é€»è¾‘
        // è¶…æ—¶æ§åˆ¶
        // è´Ÿè½½å‡è¡¡
        // é“¾è·¯è¿½è¸ª
        // å®‰å…¨è®¤è¯
        // ... ä¸šåŠ¡é€»è¾‘è¢«æ·¹æ²¡åœ¨åŸºç¡€è®¾æ–½ä»£ç ä¸­
    }
}
</code></pre>
<p><strong>ä½¿ç”¨Istioå</strong>:</p>
<pre><code class="language-java">// æœåŠ¡ç½‘æ ¼æ–¹å¼ï¼šä¸šåŠ¡ä»£ç ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘
@Service
public class OrderService {
    public Order createOrder() {
        // çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘
        // æ‰€æœ‰æµé‡ç®¡ç†ã€å®‰å…¨ã€å¯è§‚æµ‹æ€§ç”±Istioé€æ˜å¤„ç†
    }
}
</code></pre>
<h3 id="12-æœåŠ¡ç½‘æ ¼æ¶æ„"><a class="header" href="#12-æœåŠ¡ç½‘æ ¼æ¶æ„">1.2 æœåŠ¡ç½‘æ ¼æ¶æ„</a></h3>
<h4 id="æœåŠ¡ç½‘æ ¼çš„æœ¬è´¨"><a class="header" href="#æœåŠ¡ç½‘æ ¼çš„æœ¬è´¨">æœåŠ¡ç½‘æ ¼çš„æœ¬è´¨</a></h4>
<p>æœåŠ¡ç½‘æ ¼å°†æœåŠ¡é—´é€šä¿¡çš„å¤æ‚æ€§ä»åº”ç”¨å±‚ä¸‹æ²‰åˆ°åŸºç¡€è®¾æ–½å±‚ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ï¼ˆå¾®æœåŠ¡ï¼‰                          â”‚
â”‚  [Service A]  [Service B]  [Service C]              â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚           â”‚              â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           æœåŠ¡ç½‘æ ¼å±‚ï¼ˆIstioï¼‰                          â”‚
â”‚  æµé‡ç®¡ç† | å®‰å…¨ | å¯è§‚æµ‹æ€§ | ç­–ç•¥                     â”‚
â”‚  [Proxy]   [Proxy]   [Proxy]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="istioæ¶æ„æ¨¡å¼"><a class="header" href="#istioæ¶æ„æ¨¡å¼">Istioæ¶æ„æ¨¡å¼</a></h4>
<p>Istioé‡‡ç”¨<strong>æ§åˆ¶å¹³é¢ + æ•°æ®å¹³é¢</strong>çš„æ¶æ„ï¼š</p>
<pre><code>           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      æ§åˆ¶å¹³é¢ (istiod)           â”‚
           â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
           â”‚  â”‚  Pilot   â”‚  â”‚ Citadel  â”‚    â”‚
           â”‚  â”‚ é…ç½®åˆ†å‘  â”‚  â”‚  è¯ä¹¦ç®¡ç† â”‚    â”‚
           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ é…ç½®ä¸‹å‘
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚            â”‚            â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”
    â”‚Service â”‚   â”‚Service â”‚   â”‚Service â”‚
    â”‚   A    â”‚   â”‚   B    â”‚   â”‚   C    â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”
    â”‚ Envoy  â”‚   â”‚ Envoy  â”‚   â”‚ Envoy  â”‚  æ•°æ®å¹³é¢
    â”‚ Proxy  â”œâ”€â”€â”€â”¤ Proxy  â”œâ”€â”€â”€â”¤ Proxy  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 id="13-istio-æ ¸å¿ƒåŠŸèƒ½"><a class="header" href="#13-istio-æ ¸å¿ƒåŠŸèƒ½">1.3 Istio æ ¸å¿ƒåŠŸèƒ½</a></h3>
<h4 id="åŠŸèƒ½å…¨æ™¯å›¾"><a class="header" href="#åŠŸèƒ½å…¨æ™¯å›¾">åŠŸèƒ½å…¨æ™¯å›¾</a></h4>
<pre><code class="language-yaml">Istioæ ¸å¿ƒåŠŸèƒ½:
  æµé‡ç®¡ç†:
    - è¯·æ±‚è·¯ç”±: åŸºäºHTTP headerã€æƒé‡ã€URLè·¯å¾„
    - è´Ÿè½½å‡è¡¡: è½®è¯¢ã€éšæœºã€æœ€å°‘è¿æ¥
    - æ•…éšœæ¢å¤: è¶…æ—¶ã€é‡è¯•ã€ç†”æ–­
    - æ•…éšœæ³¨å…¥: å»¶è¿Ÿæ³¨å…¥ã€é”™è¯¯æ³¨å…¥
    - æµé‡é•œåƒ: ç”Ÿäº§æµé‡å¤åˆ¶åˆ°æµ‹è¯•ç¯å¢ƒ

  å®‰å…¨:
    - åŒå‘TLS: è‡ªåŠ¨åŠ å¯†æœåŠ¡é—´é€šä¿¡
    - èº«ä»½è®¤è¯: JWTã€mTLS
    - è®¿é—®æ§åˆ¶: RBACã€é»‘ç™½åå•
    - å®¡è®¡æ—¥å¿—: è®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸º

  å¯è§‚æµ‹æ€§:
    - æŒ‡æ ‡: è¯·æ±‚é‡ã€é”™è¯¯ç‡ã€å»¶è¿Ÿ
    - æ—¥å¿—: è®¿é—®æ—¥å¿—ã€åº”ç”¨æ—¥å¿—
    - è¿½è¸ª: åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
    - æ‹“æ‰‘: æœåŠ¡ä¾èµ–å…³ç³»å¯è§†åŒ–

  ç­–ç•¥æ‰§è¡Œ:
    - é€Ÿç‡é™åˆ¶: QPSé™æµ
    - é…é¢ç®¡ç†: èµ„æºé…é¢
    - é»‘ç™½åå•: IP/æœåŠ¡è®¿é—®æ§åˆ¶
</code></pre>
<h3 id="14-istio-vs-å…¶ä»–æœåŠ¡ç½‘æ ¼"><a class="header" href="#14-istio-vs-å…¶ä»–æœåŠ¡ç½‘æ ¼">1.4 Istio vs å…¶ä»–æœåŠ¡ç½‘æ ¼</a></h3>
<h4 id="æŠ€æœ¯å¯¹æ¯”"><a class="header" href="#æŠ€æœ¯å¯¹æ¯”">æŠ€æœ¯å¯¹æ¯”</a></h4>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>Istio</th><th>Linkerd</th><th>Consul Connect</th></tr></thead><tbody>
<tr><td><strong>å¤æ‚åº¦</strong></td><td>è¾ƒé«˜</td><td>ä½</td><td>ä¸­ç­‰</td></tr>
<tr><td><strong>æ€§èƒ½å¼€é”€</strong></td><td>ä¸­ç­‰</td><td>ä½</td><td>ä¸­ç­‰</td></tr>
<tr><td><strong>åŠŸèƒ½å®Œæ•´æ€§</strong></td><td>éå¸¸å®Œå–„</td><td>åŸºç¡€åŠŸèƒ½</td><td>å®Œå–„</td></tr>
<tr><td><strong>ç¤¾åŒºæ´»è·ƒåº¦</strong></td><td>éå¸¸é«˜</td><td>é«˜</td><td>é«˜</td></tr>
<tr><td><strong>å­¦ä¹ æ›²çº¿</strong></td><td>é™¡å³­</td><td>å¹³ç¼“</td><td>ä¸­ç­‰</td></tr>
<tr><td><strong>å¤šé›†ç¾¤æ”¯æŒ</strong></td><td>ä¼˜ç§€</td><td>è‰¯å¥½</td><td>è‰¯å¥½</td></tr>
<tr><td><strong>äº‘åŸç”Ÿé›†æˆ</strong></td><td>Kubernetesä¸ºä¸»</td><td>Kubernetes</td><td>å¤šå¹³å°</td></tr>
</tbody></table>
</div>
<h4 id="é€‰å‹å»ºè®®"><a class="header" href="#é€‰å‹å»ºè®®">é€‰å‹å»ºè®®</a></h4>
<p><strong>é€‰æ‹©Istioçš„åœºæ™¯</strong>:</p>
<ul>
<li>âœ… éœ€è¦å®Œæ•´çš„æœåŠ¡ç½‘æ ¼åŠŸèƒ½ï¼ˆæµé‡ç®¡ç†ã€å®‰å…¨ã€å¯è§‚æµ‹æ€§ï¼‰</li>
<li>âœ… åŸºäºKubernetesçš„å¾®æœåŠ¡æ¶æ„</li>
<li>âœ… å›¢é˜Ÿæœ‰è¾ƒå¼ºçš„è¿ç»´èƒ½åŠ›</li>
<li>âœ… éœ€è¦ç²¾ç»†çš„æµé‡æ§åˆ¶å’Œç­–ç•¥ç®¡ç†</li>
</ul>
<p><strong>ä¸å»ºè®®ä½¿ç”¨Istioçš„åœºæ™¯</strong>:</p>
<ul>
<li>âŒ å›¢é˜Ÿè§„æ¨¡å°ï¼Œè¿ç»´èƒ½åŠ›æœ‰é™</li>
<li>âŒ å¾®æœåŠ¡æ•°é‡å°‘ï¼ˆ&lt;10ä¸ªï¼‰</li>
<li>âŒ å¯¹æ€§èƒ½æåº¦æ•æ„Ÿçš„åœºæ™¯</li>
<li>âŒ éKubernetesç¯å¢ƒ</li>
</ul>
<hr />
<h2 id="2-istio-æ¶æ„ç»„ä»¶"><a class="header" href="#2-istio-æ¶æ„ç»„ä»¶">2. Istio æ¶æ„ç»„ä»¶</a></h2>
<h3 id="21-æ§åˆ¶å¹³é¢-control-plane"><a class="header" href="#21-æ§åˆ¶å¹³é¢-control-plane">2.1 æ§åˆ¶å¹³é¢ (Control Plane)</a></h3>
<h4 id="istiod---ç»Ÿä¸€æ§åˆ¶å¹³é¢"><a class="header" href="#istiod---ç»Ÿä¸€æ§åˆ¶å¹³é¢">istiod - ç»Ÿä¸€æ§åˆ¶å¹³é¢</a></h4>
<p>ä»Istio 1.5å¼€å§‹ï¼Œæ§åˆ¶å¹³é¢ç»„ä»¶ï¼ˆPilotã€Citadelã€Galleyï¼‰æ•´åˆä¸ºå•ä¸€çš„<strong>istiod</strong>è¿›ç¨‹ï¼Œé™ä½äº†å¤æ‚åº¦ã€‚</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           istiod                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Pilot (æœåŠ¡å‘ç°å’Œæµé‡ç®¡ç†)        â”‚  â”‚
â”‚  â”‚  - ä»K8s APIè·å–æœåŠ¡ä¿¡æ¯           â”‚  â”‚
â”‚  â”‚  - è½¬æ¢ä¸ºEnvoyé…ç½®                â”‚  â”‚
â”‚  â”‚  - ä¸‹å‘é…ç½®åˆ°Envoyä»£ç†             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Citadel (è¯ä¹¦å’Œå¯†é’¥ç®¡ç†)         â”‚  â”‚
â”‚  â”‚  - ç”Ÿæˆå’Œåˆ†å‘è¯ä¹¦                 â”‚  â”‚
â”‚  â”‚  - ç®¡ç†æœåŠ¡èº«ä»½                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Galley (é…ç½®éªŒè¯å’Œåˆ†å‘)          â”‚  â”‚
â”‚  â”‚  - éªŒè¯Istioé…ç½®                  â”‚  â”‚
â”‚  â”‚  - å¤„ç†å’Œåˆ†å‘é…ç½®                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="pilot---æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†"><a class="header" href="#pilot---æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†">Pilot - æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†</a></h4>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ol>
<li><strong>æœåŠ¡å‘ç°</strong>: ä»Kubernetesç­‰å¹³å°è·å–æœåŠ¡æ³¨å†Œä¿¡æ¯</li>
<li><strong>æµé‡ç®¡ç†é…ç½®</strong>: å¤„ç†VirtualServiceã€DestinationRuleç­‰èµ„æº</li>
<li><strong>é…ç½®åˆ†å‘</strong>: å°†é…ç½®è½¬æ¢ä¸ºEnvoy xDS APIæ ¼å¼å¹¶æ¨é€</li>
</ol>
<p><strong>å·¥ä½œæµç¨‹</strong>:</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ K8s Service  â”‚
â”‚   Endpoint   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. ç›‘å¬å˜åŒ–
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     2. è½¬æ¢é…ç½®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Pilot     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Envoy      â”‚
â”‚  (istiod)    â”‚                       â”‚    Proxy     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. è¯»å–Istioé…ç½®
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚VirtualServiceâ”‚
â”‚ DestRule     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="citadel---å®‰å…¨å’Œè¯ä¹¦ç®¡ç†"><a class="header" href="#citadel---å®‰å…¨å’Œè¯ä¹¦ç®¡ç†">Citadel - å®‰å…¨å’Œè¯ä¹¦ç®¡ç†</a></h4>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ol>
<li><strong>å¯†é’¥å’Œè¯ä¹¦ç®¡ç†</strong>: è‡ªåŠ¨ç”Ÿæˆã€åˆ†å‘ã€è½®æ¢è¯ä¹¦</li>
<li><strong>èº«ä»½ç®¡ç†</strong>: ä¸ºæ¯ä¸ªæœåŠ¡æä¾›å¼ºèº«ä»½æ ‡è¯†</li>
<li><strong>è®¤è¯ç­–ç•¥</strong>: æ‰§è¡ŒæœåŠ¡é—´è®¤è¯ç­–ç•¥</li>
</ol>
<p><strong>è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ</strong>:</p>
<pre><code class="language-yaml">è¯ä¹¦ç”Ÿå‘½å‘¨æœŸ:
  1. è¯ä¹¦ç”Ÿæˆ: Citadelä½œä¸ºCAç­¾å‘è¯ä¹¦
  2. è¯ä¹¦åˆ†å‘: é€šè¿‡SDS (Secret Discovery Service) åˆ†å‘åˆ°Envoy
  3. è¯ä¹¦ä½¿ç”¨: Envoyä½¿ç”¨è¯ä¹¦å»ºç«‹mTLSè¿æ¥
  4. è¯ä¹¦è½®æ¢: è¯ä¹¦è¿‡æœŸå‰è‡ªåŠ¨è½®æ¢ï¼ˆé»˜è®¤24å°æ—¶æœ‰æ•ˆæœŸï¼‰
</code></pre>
<h4 id="galley---é…ç½®éªŒè¯å’Œå¤„ç†"><a class="header" href="#galley---é…ç½®éªŒè¯å’Œå¤„ç†">Galley - é…ç½®éªŒè¯å’Œå¤„ç†</a></h4>
<p><strong>æ ¸å¿ƒèŒè´£</strong>:</p>
<ol>
<li><strong>é…ç½®éªŒè¯</strong>: éªŒè¯Istioé…ç½®çš„æ­£ç¡®æ€§</li>
<li><strong>é…ç½®è½¬æ¢</strong>: å°†ç”¨æˆ·é…ç½®è½¬æ¢ä¸ºå†…éƒ¨æ ¼å¼</li>
<li><strong>é…ç½®åˆ†å‘</strong>: å‘å…¶ä»–æ§åˆ¶å¹³é¢ç»„ä»¶åˆ†å‘é…ç½®</li>
</ol>
<h3 id="22-æ•°æ®å¹³é¢-data-plane"><a class="header" href="#22-æ•°æ®å¹³é¢-data-plane">2.2 æ•°æ®å¹³é¢ (Data Plane)</a></h3>
<h4 id="envoy-proxy---é«˜æ€§èƒ½ä»£ç†"><a class="header" href="#envoy-proxy---é«˜æ€§èƒ½ä»£ç†">Envoy Proxy - é«˜æ€§èƒ½ä»£ç†</a></h4>
<p><strong>Envoy</strong> æ˜¯Istioæ•°æ®å¹³é¢çš„æ ¸å¿ƒï¼Œæ˜¯ä¸€ä¸ªç”¨C++ç¼–å†™çš„é«˜æ€§èƒ½L7ä»£ç†ã€‚</p>
<p><strong>Envoyæ ¸å¿ƒç‰¹æ€§</strong>:</p>
<pre><code class="language-yaml">Envoyç‰¹æ€§:
  æ€§èƒ½:
    - C++å®ç°ï¼Œé«˜æ€§èƒ½ä½å»¶è¿Ÿ
    - å¼‚æ­¥éé˜»å¡æ¶æ„
    - æ”¯æŒHTTP/1.1ã€HTTP/2ã€gRPC

  å¯è§‚æµ‹æ€§:
    - ä¸°å¯Œçš„æŒ‡æ ‡ç»Ÿè®¡
    - åˆ†å¸ƒå¼è¿½è¸ªæ”¯æŒ
    - è®¿é—®æ—¥å¿—è®°å½•

  é«˜çº§åŠŸèƒ½:
    - åŠ¨æ€é…ç½®æ›´æ–°ï¼ˆxDS APIï¼‰
    - å¥åº·æ£€æŸ¥å’Œç†”æ–­
    - å¤šç§è´Ÿè½½å‡è¡¡ç®—æ³•
    - æµé‡é•œåƒå’Œæ•…éšœæ³¨å…¥
</code></pre>
<p><strong>Envoyé…ç½®ç»“æ„</strong>:</p>
<pre><code class="language-yaml"># Envoyé…ç½®ç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
static_resources:
  listeners:  # ç›‘å¬å™¨ï¼šç›‘å¬å…¥ç«™æµé‡
    - name: listener_0
      address:
        socket_address:
          address: 0.0.0.0
          port_value: 15001
      filter_chains:
        - filters:
            - name: envoy.http_connection_manager
              typed_config:
                stat_prefix: ingress_http
                route_config:  # è·¯ç”±é…ç½®
                  virtual_hosts:
                    - name: backend
                      domains: ["*"]
                      routes:
                        - match: { prefix: "/" }
                          route: { cluster: service_backend }

  clusters:  # é›†ç¾¤ï¼šåç«¯æœåŠ¡é›†ç¾¤
    - name: service_backend
      connect_timeout: 0.25s
      type: STRICT_DNS
      lb_policy: ROUND_ROBIN
      load_assignment:
        cluster_name: service_backend
        endpoints:
          - lb_endpoints:
              - endpoint:
                  address:
                    socket_address:
                      address: backend-service
                      port_value: 8080
</code></pre>
<h4 id="sidecar-æ¨¡å¼"><a class="header" href="#sidecar-æ¨¡å¼">Sidecar æ¨¡å¼</a></h4>
<p><strong>Sidecaræ³¨å…¥åŸç†</strong>:</p>
<p>Istioä½¿ç”¨Kubernetesçš„<strong>MutatingAdmissionWebhook</strong>æœºåˆ¶ï¼Œåœ¨Podåˆ›å»ºæ—¶è‡ªåŠ¨æ³¨å…¥Envoyå®¹å™¨ã€‚</p>
<pre><code>åŸå§‹Pod:                     æ³¨å…¥åçš„Pod:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Container   â”‚            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  (åº”ç”¨)      â”‚            â”‚  â”‚ Init Container     â”‚  â”‚
â”‚              â”‚            â”‚  â”‚ (istio-init)       â”‚  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  â”‚ é…ç½®iptablesè§„åˆ™   â”‚  â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                            â”‚  â”‚ App Container      â”‚  â”‚
                            â”‚  â”‚ (åº”ç”¨)             â”‚  â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                            â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                            â”‚  â”‚ Sidecar Container  â”‚  â”‚
                            â”‚  â”‚ (istio-proxy)      â”‚  â”‚
                            â”‚  â”‚ Envoyä»£ç†          â”‚  â”‚
                            â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æµé‡æ‹¦æˆªæœºåˆ¶</strong>:</p>
<pre><code class="language-bash"># istio-initå®¹å™¨é…ç½®çš„iptablesè§„åˆ™
iptables -t nat -A OUTPUT -p tcp -j ISTIO_OUTPUT
iptables -t nat -A ISTIO_OUTPUT -d 127.0.0.1/32 -j RETURN
iptables -t nat -A ISTIO_OUTPUT -j ISTIO_REDIRECT
iptables -t nat -A ISTIO_REDIRECT -p tcp -j REDIRECT --to-ports 15001

# æ•ˆæœï¼šæ‰€æœ‰å‡ºç«™æµé‡é‡å®šå‘åˆ°Envoyçš„15001ç«¯å£
</code></pre>
<hr />
<h2 id="3-istio-å®‰è£…ä¸é…ç½®"><a class="header" href="#3-istio-å®‰è£…ä¸é…ç½®">3. Istio å®‰è£…ä¸é…ç½®</a></h2>
<h3 id="31-ç¯å¢ƒè¦æ±‚"><a class="header" href="#31-ç¯å¢ƒè¦æ±‚">3.1 ç¯å¢ƒè¦æ±‚</a></h3>
<h4 id="ç¡¬ä»¶å’Œè½¯ä»¶è¦æ±‚"><a class="header" href="#ç¡¬ä»¶å’Œè½¯ä»¶è¦æ±‚">ç¡¬ä»¶å’Œè½¯ä»¶è¦æ±‚</a></h4>
<pre><code class="language-yaml">æœ€ä½è¦æ±‚:
  Kubernetesç‰ˆæœ¬: 1.22+
  èŠ‚ç‚¹é…ç½®:
    - CPU: 2æ ¸å¿ƒ
    - å†…å­˜: 4GB
    - å­˜å‚¨: 20GB

æ¨èé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰:
  Kubernetesç‰ˆæœ¬: 1.24+
  èŠ‚ç‚¹é…ç½®:
    - CPU: 4æ ¸å¿ƒ
    - å†…å­˜: 8GB
    - å­˜å‚¨: 50GB
  é›†ç¾¤è§„æ¨¡:
    - æœ€å°: 3ä¸ªèŠ‚ç‚¹
    - æ¨è: 5+ä¸ªèŠ‚ç‚¹
</code></pre>
<h4 id="å‡†å¤‡kubernetesé›†ç¾¤"><a class="header" href="#å‡†å¤‡kubernetesé›†ç¾¤">å‡†å¤‡Kubernetesé›†ç¾¤</a></h4>
<pre><code class="language-bash"># éªŒè¯é›†ç¾¤çŠ¶æ€
kubectl cluster-info
kubectl get nodes

# æ£€æŸ¥Kubernetesç‰ˆæœ¬
kubectl version --short

# ç¡®ä¿æœ‰è¶³å¤Ÿçš„èµ„æº
kubectl top nodes
</code></pre>
<h3 id="32-å®‰è£…æ–¹å¼"><a class="header" href="#32-å®‰è£…æ–¹å¼">3.2 å®‰è£…æ–¹å¼</a></h3>
<h4 id="321-istioctl-å®‰è£…æ¨è"><a class="header" href="#321-istioctl-å®‰è£…æ¨è">3.2.1 istioctl å®‰è£…ï¼ˆæ¨èï¼‰</a></h4>
<p><strong>æ­¥éª¤1: ä¸‹è½½Istio</strong></p>
<pre><code class="language-bash"># ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„Istio
curl -L https://istio.io/downloadIstio | sh -

# æˆ–è€…æŒ‡å®šç‰ˆæœ¬
curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.20.0 sh -

# è¿›å…¥Istioç›®å½•
cd istio-1.20.0

# å°†istioctlæ·»åŠ åˆ°PATH
export PATH=$PWD/bin:$PATH

# éªŒè¯å®‰è£…
istioctl version
</code></pre>
<p><strong>æ­¥éª¤2: é¢„æ£€æŸ¥</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥é›†ç¾¤æ˜¯å¦æ»¡è¶³Istioè¦æ±‚
istioctl x precheck

# è¾“å‡ºç¤ºä¾‹ï¼š
âœ” No issues found when checking the cluster. Istio is safe to install or upgrade!
</code></pre>
<p><strong>æ­¥éª¤3: å®‰è£…Istio</strong></p>
<pre><code class="language-bash"># ä½¿ç”¨é»˜è®¤é…ç½®å®‰è£…
istioctl install --set profile=default -y

# å®‰è£…è¿‡ç¨‹è¾“å‡ºï¼š
âœ” Istio core installed
âœ” Istiod installed
âœ” Ingress gateways installed
âœ” Installation complete
</code></pre>
<p><strong>é…ç½®Profileè¯´æ˜</strong>:</p>
<div class="table-wrapper"><table><thead><tr><th>Profile</th><th>æè¿°</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody>
<tr><td><strong>default</strong></td><td>é»˜è®¤é…ç½®ï¼ŒåŒ…å«æ ¸å¿ƒç»„ä»¶å’ŒIngress Gateway</td><td>ç”Ÿäº§ç¯å¢ƒæ¨è</td></tr>
<tr><td><strong>demo</strong></td><td>åŒ…å«æ‰€æœ‰åŠŸèƒ½ï¼Œç”¨äºæ¼”ç¤º</td><td>å­¦ä¹ å’Œæµ‹è¯•</td></tr>
<tr><td><strong>minimal</strong></td><td>æœ€å°å®‰è£…ï¼Œåªæœ‰æ§åˆ¶å¹³é¢</td><td>èµ„æºå—é™ç¯å¢ƒ</td></tr>
<tr><td><strong>production</strong></td><td>ç”Ÿäº§ä¼˜åŒ–é…ç½®</td><td>ç”Ÿäº§ç¯å¢ƒé«˜å¯ç”¨</td></tr>
<tr><td><strong>preview</strong></td><td>åŒ…å«å®éªŒæ€§åŠŸèƒ½</td><td>æµ‹è¯•æ–°ç‰¹æ€§</td></tr>
</tbody></table>
</div>
<p><strong>æ­¥éª¤4: éªŒè¯å®‰è£…</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥ç»„ä»¶çŠ¶æ€
kubectl get pods -n istio-system

# æœŸæœ›è¾“å‡ºï¼š
NAME                                    READY   STATUS    RESTARTS   AGE
istiod-5847c59c69-lwkxj                 1/1     Running   0          2m
istio-ingressgateway-7d6b8f5c9f-xyz     1/1     Running   0          2m

# æ£€æŸ¥æœåŠ¡
kubectl get svc -n istio-system

# éªŒè¯istioé…ç½®
istioctl verify-install
</code></pre>
<h4 id="322-helm-å®‰è£…"><a class="header" href="#322-helm-å®‰è£…">3.2.2 Helm å®‰è£…</a></h4>
<p><strong>æ­¥éª¤1: æ·»åŠ Helmä»“åº“</strong></p>
<pre><code class="language-bash"># æ·»åŠ Istio Helmä»“åº“
helm repo add istio https://istio-release.storage.googleapis.com/charts
helm repo update
</code></pre>
<p><strong>æ­¥éª¤2: åˆ›å»ºå‘½åç©ºé—´</strong></p>
<pre><code class="language-bash">kubectl create namespace istio-system
</code></pre>
<p><strong>æ­¥éª¤3: å®‰è£…Istio Base</strong></p>
<pre><code class="language-bash"># å®‰è£…IstioåŸºç¡€ç»„ä»¶ï¼ˆCRDç­‰ï¼‰
helm install istio-base istio/base -n istio-system
</code></pre>
<p><strong>æ­¥éª¤4: å®‰è£…Istiod</strong></p>
<pre><code class="language-bash"># å®‰è£…Istioæ§åˆ¶å¹³é¢
helm install istiod istio/istiod -n istio-system --wait
</code></pre>
<p><strong>æ­¥éª¤5: å®‰è£…Ingress Gateway</strong></p>
<pre><code class="language-bash"># å®‰è£…Ingress Gateway
helm install istio-ingressgateway istio/gateway -n istio-system
</code></pre>
<h4 id="323-operator-å®‰è£…"><a class="header" href="#323-operator-å®‰è£…">3.2.3 Operator å®‰è£…</a></h4>
<pre><code class="language-bash"># å®‰è£…Istio Operator
istioctl operator init

# åˆ›å»ºIstioOperatorèµ„æº
kubectl apply -f - &lt;&lt;EOF
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  namespace: istio-system
  name: istio-controlplane
spec:
  profile: default
  components:
    egressGateways:
    - name: istio-egressgateway
      enabled: true
EOF

# æŸ¥çœ‹operatorçŠ¶æ€
kubectl get istiooperator -n istio-system
</code></pre>
<h3 id="33-é…ç½®æ–‡ä»¶è¯¦è§£"><a class="header" href="#33-é…ç½®æ–‡ä»¶è¯¦è§£">3.3 é…ç½®æ–‡ä»¶è¯¦è§£</a></h3>
<h4 id="istiooperator-é…ç½®ç»“æ„"><a class="header" href="#istiooperator-é…ç½®ç»“æ„">IstioOperator é…ç½®ç»“æ„</a></h4>
<pre><code class="language-yaml">apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  namespace: istio-system
  name: istio-installation
spec:
  # é…ç½®Profile
  profile: default

  # å…¨å±€é…ç½®
  meshConfig:
    # è®¿é—®æ—¥å¿—
    accessLogFile: /dev/stdout
    accessLogEncoding: JSON

    # é»˜è®¤é…ç½®
    defaultConfig:
      # è¿½è¸ªé…ç½®
      tracing:
        sampling: 100.0  # é‡‡æ ·ç‡100%
        zipkin:
          address: zipkin.istio-system:9411

      # ä»£ç†èµ„æºé™åˆ¶
      proxyMetadata:
        CPU_LIMIT: "2000m"
        MEMORY_LIMIT: "1024Mi"

    # å‡ºç«™æµé‡ç­–ç•¥
    outboundTrafficPolicy:
      mode: ALLOW_ANY  # ALLOW_ANY æˆ– REGISTRY_ONLY

    # å¯ç”¨è‡ªåŠ¨mTLS
    enableAutoMtls: true

  # ç»„ä»¶é…ç½®
  components:
    # Piloté…ç½®
    pilot:
      enabled: true
      k8s:
        resources:
          requests:
            cpu: 500m
            memory: 2048Mi
        hpaSpec:
          minReplicas: 2
          maxReplicas: 5

    # Ingress Gatewayé…ç½®
    ingressGateways:
    - name: istio-ingressgateway
      enabled: true
      k8s:
        service:
          type: LoadBalancer
          ports:
          - port: 80
            name: http
          - port: 443
            name: https
        resources:
          requests:
            cpu: 1000m
            memory: 1024Mi
        hpaSpec:
          minReplicas: 2
          maxReplicas: 5

    # Egress Gatewayé…ç½®
    egressGateways:
    - name: istio-egressgateway
      enabled: false

  # å€¼è¦†ç›–
  values:
    global:
      # ä»£ç†é…ç½®
      proxy:
        # èµ„æºé™åˆ¶
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 2000m
            memory: 1024Mi
        # æ—¥å¿—çº§åˆ«
        logLevel: warning

      # å¤šé›†ç¾¤é…ç½®
      multiCluster:
        clusterName: cluster-1
</code></pre>
<h3 id="34-éªŒè¯å®‰è£…"><a class="header" href="#34-éªŒè¯å®‰è£…">3.4 éªŒè¯å®‰è£…</a></h3>
<h4 id="å®Œæ•´éªŒè¯æµç¨‹"><a class="header" href="#å®Œæ•´éªŒè¯æµç¨‹">å®Œæ•´éªŒè¯æµç¨‹</a></h4>
<p><strong>1. æ£€æŸ¥æ§åˆ¶å¹³é¢çŠ¶æ€</strong></p>
<pre><code class="language-bash"># æŸ¥çœ‹æ‰€æœ‰Istioç»„ä»¶
kubectl get all -n istio-system

# æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯
kubectl describe pod -n istio-system -l app=istiod

# æ£€æŸ¥istiodæ—¥å¿—
kubectl logs -n istio-system -l app=istiod --tail=100
</code></pre>
<p><strong>2. éƒ¨ç½²ç¤ºä¾‹åº”ç”¨</strong></p>
<pre><code class="language-bash"># åˆ›å»ºæµ‹è¯•å‘½åç©ºé—´å¹¶å¯ç”¨è‡ªåŠ¨æ³¨å…¥
kubectl create namespace bookinfo
kubectl label namespace bookinfo istio-injection=enabled

# éƒ¨ç½²Bookinfoç¤ºä¾‹åº”ç”¨
kubectl apply -n bookinfo -f samples/bookinfo/platform/kube/bookinfo.yaml

# æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
kubectl get pods -n bookinfo

# æœŸæœ›è¾“å‡ºï¼šæ¯ä¸ªPodéƒ½æœ‰2ä¸ªå®¹å™¨ï¼ˆåº”ç”¨+Envoyï¼‰
NAME                             READY   STATUS    RESTARTS   AGE
details-v1-5f4d584748-xyz        2/2     Running   0          1m
productpage-v1-564d4686f-abc     2/2     Running   0          1m
ratings-v1-686ccfb5d8-def        2/2     Running   0          1m
reviews-v1-86896b7648-ghi        2/2     Running   0          1m
</code></pre>
<p><strong>3. éªŒè¯æœåŠ¡è¿é€šæ€§</strong></p>
<pre><code class="language-bash"># è¿›å…¥productpage podæµ‹è¯•
kubectl exec -n bookinfo deploy/productpage-v1 -c productpage -- curl -s ratings:9080/ratings/0

# æœŸæœ›è¾“å‡ºï¼š
{"id":0,"ratings":{"Reviewer1":5,"Reviewer2":4}}
</code></pre>
<p><strong>4. é…ç½®Ingress Gateway</strong></p>
<pre><code class="language-yaml"># åˆ›å»ºGatewayå’ŒVirtualService
kubectl apply -n bookinfo -f - &lt;&lt;EOF
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: bookinfo-gateway
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "*"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: bookinfo
spec:
  hosts:
  - "*"
  gateways:
  - bookinfo-gateway
  http:
  - match:
    - uri:
        exact: /productpage
    route:
    - destination:
        host: productpage
        port:
          number: 9080
EOF
</code></pre>
<p><strong>5. è®¿é—®åº”ç”¨</strong></p>
<pre><code class="language-bash"># è·å–Ingress Gatewayåœ°å€
export INGRESS_HOST=$(kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.status.loadBalancer.ingress[0].ip}')
export INGRESS_PORT=$(kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.spec.ports[?(@.name=="http")].port}')
export GATEWAY_URL=$INGRESS_HOST:$INGRESS_PORT

# è®¿é—®åº”ç”¨
curl -s http://${GATEWAY_URL}/productpage | grep -o "&lt;title&gt;.*&lt;/title&gt;"

# æœŸæœ›è¾“å‡ºï¼š
&lt;title&gt;Simple Bookstore App&lt;/title&gt;
</code></pre>
<p><strong>6. éªŒè¯Sidecaræ³¨å…¥</strong></p>
<pre><code class="language-bash"># æŸ¥çœ‹Podçš„å®¹å™¨
kubectl get pod -n bookinfo -l app=productpage -o jsonpath='{.items[0].spec.containers[*].name}'

# æœŸæœ›è¾“å‡ºï¼š
productpage istio-proxy

# æŸ¥çœ‹Sidecaré…ç½®
istioctl proxy-config listener -n bookinfo deploy/productpage-v1
</code></pre>
<hr />
<h2 id="4-æµé‡ç®¡ç†-traffic-management"><a class="header" href="#4-æµé‡ç®¡ç†-traffic-management">4. æµé‡ç®¡ç† (Traffic Management)</a></h2>
<h3 id="41-virtual-service"><a class="header" href="#41-virtual-service">4.1 Virtual Service</a></h3>
<p><strong>VirtualService</strong> æ˜¯Istioæµé‡è·¯ç”±çš„æ ¸å¿ƒèµ„æºï¼Œå®šä¹‰äº†å¦‚ä½•å°†è¯·æ±‚è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡ã€‚</p>
<h4 id="åŸºæœ¬æ¦‚å¿µ"><a class="header" href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-route
spec:
  hosts:              # ç›®æ ‡ä¸»æœº
  - reviews
  http:               # HTTPè·¯ç”±è§„åˆ™
  - match:            # åŒ¹é…æ¡ä»¶
    - headers:
        end-user:
          exact: jason
    route:            # è·¯ç”±ç›®æ ‡
    - destination:
        host: reviews
        subset: v2
  - route:            # é»˜è®¤è·¯ç”±
    - destination:
        host: reviews
        subset: v1
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹1-åŸºäºç”¨æˆ·çš„è·¯ç”±"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹1-åŸºäºç”¨æˆ·çš„è·¯ç”±">å®æˆ˜æ¡ˆä¾‹1: åŸºäºç”¨æˆ·çš„è·¯ç”±</a></h4>
<p><strong>åœºæ™¯</strong>: å°†ç‰¹å®šç”¨æˆ·çš„è¯·æ±‚è·¯ç”±åˆ°v2ç‰ˆæœ¬ï¼Œå…¶ä»–ç”¨æˆ·ä½¿ç”¨v1ç‰ˆæœ¬</p>
<pre><code class="language-yaml"># 1. åˆ›å»ºDestinationRuleå®šä¹‰æœåŠ¡ç‰ˆæœ¬
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews-destination
spec:
  host: reviews
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
  - name: v3
    labels:
      version: v3
---
# 2. åˆ›å»ºVirtualServiceé…ç½®è·¯ç”±
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews
spec:
  hosts:
  - reviews
  http:
  - match:
    - headers:
        end-user:
          exact: jason
    route:
    - destination:
        host: reviews
        subset: v2
  - route:
    - destination:
        host: reviews
        subset: v1
</code></pre>
<p><strong>éªŒè¯</strong>:</p>
<pre><code class="language-bash"># ä¸å¸¦headerè®¿é—®
kubectl exec -n bookinfo deploy/productpage-v1 -c productpage -- \
  curl -s productpage:9080/productpage | grep reviews-v1

# å¸¦headerè®¿é—®
kubectl exec -n bookinfo deploy/productpage-v1 -c productpage -- \
  curl -s -H "end-user: jason" productpage:9080/productpage | grep reviews-v2
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹2-uriè·¯å¾„è·¯ç”±"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹2-uriè·¯å¾„è·¯ç”±">å®æˆ˜æ¡ˆä¾‹2: URIè·¯å¾„è·¯ç”±</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-routing
spec:
  hosts:
  - api.example.com
  http:
  # /api/v1/* è·¯ç”±åˆ°v1æœåŠ¡
  - match:
    - uri:
        prefix: /api/v1/
    rewrite:
      uri: /
    route:
    - destination:
        host: api-service-v1

  # /api/v2/* è·¯ç”±åˆ°v2æœåŠ¡
  - match:
    - uri:
        prefix: /api/v2/
    rewrite:
      uri: /
    route:
    - destination:
        host: api-service-v2

  # é»˜è®¤è·¯ç”±
  - route:
    - destination:
        host: api-service-v1
</code></pre>
<h3 id="42-destination-rule"><a class="header" href="#42-destination-rule">4.2 Destination Rule</a></h3>
<p><strong>DestinationRule</strong> å®šä¹‰äº†æµé‡è·¯ç”±åˆ°ç›®æ ‡æœåŠ¡åçš„ç­–ç•¥ï¼ŒåŒ…æ‹¬è´Ÿè½½å‡è¡¡ã€è¿æ¥æ± ã€ç†”æ–­ç­‰ã€‚</p>
<h4 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a class="header" href="#è´Ÿè½½å‡è¡¡ç­–ç•¥">è´Ÿè½½å‡è¡¡ç­–ç•¥</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: reviews-lb
spec:
  host: reviews
  trafficPolicy:
    loadBalancer:
      simple: LEAST_REQUEST  # æœ€å°‘è¯·æ±‚æ•°
      # å…¶ä»–é€‰é¡¹:
      # ROUND_ROBIN      - è½®è¯¢ï¼ˆé»˜è®¤ï¼‰
      # RANDOM           - éšæœº
      # PASSTHROUGH      - ç›´ä¼ 
      # LEAST_CONN       - æœ€å°‘è¿æ¥æ•°

    # è¿æ¥æ± é…ç½®
    connectionPool:
      tcp:
        maxConnections: 100         # TCPæœ€å¤§è¿æ¥æ•°
        connectTimeout: 30ms        # è¿æ¥è¶…æ—¶
      http:
        http1MaxPendingRequests: 50 # HTTP/1.1æœ€å¤§ç­‰å¾…è¯·æ±‚æ•°
        http2MaxRequests: 100       # HTTP/2æœ€å¤§è¯·æ±‚æ•°
        maxRequestsPerConnection: 2 # æ¯è¿æ¥æœ€å¤§è¯·æ±‚æ•°
        maxRetries: 3               # æœ€å¤§é‡è¯•æ¬¡æ•°

    # ç†”æ–­é…ç½®
    outlierDetection:
      consecutiveErrors: 5          # è¿ç»­é”™è¯¯æ¬¡æ•°
      interval: 30s                 # æ£€æµ‹é—´éš”
      baseEjectionTime: 30s         # åŸºç¡€é©±é€æ—¶é—´
      maxEjectionPercent: 50        # æœ€å¤§é©±é€ç™¾åˆ†æ¯”
      minHealthPercent: 30          # æœ€å°å¥åº·ç™¾åˆ†æ¯”
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹-ç†”æ–­é…ç½®"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹-ç†”æ–­é…ç½®">å®æˆ˜æ¡ˆä¾‹: ç†”æ–­é…ç½®</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: httpbin-circuit-breaker
spec:
  host: httpbin
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 1
      http:
        http1MaxPendingRequests: 1
        maxRequestsPerConnection: 1
    outlierDetection:
      consecutiveErrors: 1
      interval: 1s
      baseEjectionTime: 3m
      maxEjectionPercent: 100
</code></pre>
<p><strong>æµ‹è¯•ç†”æ–­</strong>:</p>
<pre><code class="language-bash"># éƒ¨ç½²æµ‹è¯•å®¢æˆ·ç«¯
kubectl apply -f samples/httpbin/sample-client/fortio-deploy.yaml

# æ­£å¸¸è¯·æ±‚ï¼ˆå•çº¿ç¨‹ï¼‰
kubectl exec deploy/fortio -c fortio -- fortio load -c 1 -qps 0 -n 20 http://httpbin:8000/get
# è¾“å‡º: Code 200 : 20 (100.0 %)

# è§¦å‘ç†”æ–­ï¼ˆå¤šçº¿ç¨‹ï¼‰
kubectl exec deploy/fortio -c fortio -- fortio load -c 3 -qps 0 -n 30 http://httpbin:8000/get
# è¾“å‡º: Code 200 : 25 (83.3 %), Code 503 : 5 (16.7 %)  # éƒ¨åˆ†è¯·æ±‚è¢«ç†”æ–­
</code></pre>
<h3 id="43-gateway"><a class="header" href="#43-gateway">4.3 Gateway</a></h3>
<p><strong>Gateway</strong> ç®¡ç†è¿›å‡ºç½‘æ ¼çš„æµé‡ï¼Œç±»ä¼¼äºKubernetes Ingressï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p>
<h4 id="ingress-gatewayé…ç½®"><a class="header" href="#ingress-gatewayé…ç½®">Ingress Gatewayé…ç½®</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: my-gateway
spec:
  selector:
    istio: ingressgateway  # ä½¿ç”¨é»˜è®¤Ingress Gateway
  servers:
  - port:
      number: 80
      name: http
      protocol: HTTP
    hosts:
    - "example.com"
    - "api.example.com"

  - port:
      number: 443
      name: https
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: example-com-cert  # K8s Secretåç§°
    hosts:
    - "example.com"
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹-httpsé…ç½®"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹-httpsé…ç½®">å®æˆ˜æ¡ˆä¾‹: HTTPSé…ç½®</a></h4>
<p><strong>æ­¥éª¤1: åˆ›å»ºè¯ä¹¦Secret</strong></p>
<pre><code class="language-bash"># åˆ›å»ºè‡ªç­¾åè¯ä¹¦ï¼ˆæµ‹è¯•ç”¨ï¼‰
openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes -subj "/CN=example.com"

# åˆ›å»ºSecret
kubectl create secret tls example-com-cert \
  --cert=cert.pem \
  --key=key.pem \
  -n istio-system
</code></pre>
<p><strong>æ­¥éª¤2: é…ç½®Gatewayå’ŒVirtualService</strong></p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: https-gateway
spec:
  selector:
    istio: ingressgateway
  servers:
  - port:
      number: 443
      name: https
      protocol: HTTPS
    tls:
      mode: SIMPLE
      credentialName: example-com-cert
    hosts:
    - "example.com"
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: example-vs
spec:
  hosts:
  - "example.com"
  gateways:
  - https-gateway
  http:
  - route:
    - destination:
        host: my-service
        port:
          number: 8080
</code></pre>
<h3 id="44-service-entry"><a class="header" href="#44-service-entry">4.4 Service Entry</a></h3>
<p><strong>ServiceEntry</strong> å…è®¸å°†å¤–éƒ¨æœåŠ¡æ³¨å†Œåˆ°æœåŠ¡ç½‘æ ¼ä¸­ï¼Œä½¿å…¶å¯ä»¥è¢«ç½‘æ ¼ç®¡ç†ã€‚</p>
<h4 id="å®æˆ˜æ¡ˆä¾‹-è®¿é—®å¤–éƒ¨api"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹-è®¿é—®å¤–éƒ¨api">å®æˆ˜æ¡ˆä¾‹: è®¿é—®å¤–éƒ¨API</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: external-api
spec:
  hosts:
  - api.external.com
  ports:
  - number: 443
    name: https
    protocol: HTTPS
  location: MESH_EXTERNAL
  resolution: DNS
---
# é…ç½®VirtualServiceæ§åˆ¶è®¿é—®
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: external-api-vs
spec:
  hosts:
  - api.external.com
  http:
  - timeout: 3s
    retries:
      attempts: 3
      perTryTimeout: 1s
    route:
    - destination:
        host: api.external.com
</code></pre>
<h3 id="45-æµé‡è·¯ç”±ç­–ç•¥"><a class="header" href="#45-æµé‡è·¯ç”±ç­–ç•¥">4.5 æµé‡è·¯ç”±ç­–ç•¥</a></h3>
<h4 id="451-åŸºäºæƒé‡çš„è·¯ç”±é‡‘ä¸é›€å‘å¸ƒ"><a class="header" href="#451-åŸºäºæƒé‡çš„è·¯ç”±é‡‘ä¸é›€å‘å¸ƒ">4.5.1 åŸºäºæƒé‡çš„è·¯ç”±ï¼ˆé‡‘ä¸é›€å‘å¸ƒï¼‰</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-canary
spec:
  hosts:
  - reviews
  http:
  - route:
    - destination:
        host: reviews
        subset: v1
      weight: 90  # 90%æµé‡åˆ°v1
    - destination:
        host: reviews
        subset: v2
      weight: 10  # 10%æµé‡åˆ°v2ï¼ˆé‡‘ä¸é›€ï¼‰
</code></pre>
<p><strong>æ¸è¿›å¼å‘å¸ƒæµç¨‹</strong>:</p>
<pre><code class="language-bash"># é˜¶æ®µ1: 10%æµé‡åˆ°v2
kubectl apply -f canary-10percent.yaml

# è§‚å¯ŸæŒ‡æ ‡ï¼Œå¦‚æœæ­£å¸¸ï¼Œå¢åŠ åˆ°50%
kubectl apply -f canary-50percent.yaml

# ç»§ç»­è§‚å¯Ÿï¼Œå¦‚æœæ­£å¸¸ï¼Œå…¨é‡åˆ‡æ¢åˆ°v2
kubectl apply -f canary-100percent.yaml
</code></pre>
<h4 id="452-åŸºäºå†…å®¹çš„è·¯ç”±"><a class="header" href="#452-åŸºäºå†…å®¹çš„è·¯ç”±">4.5.2 åŸºäºå†…å®¹çš„è·¯ç”±</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: content-based-routing
spec:
  hosts:
  - myservice
  http:
  # ç§»åŠ¨ç«¯æµé‡
  - match:
    - headers:
        user-agent:
          regex: ".*Mobile.*"
    route:
    - destination:
        host: myservice
        subset: mobile

  # APIè¯·æ±‚
  - match:
    - uri:
        prefix: /api/
    route:
    - destination:
        host: myservice
        subset: api

  # é»˜è®¤è·¯ç”±
  - route:
    - destination:
        host: myservice
        subset: web
</code></pre>
<h4 id="453-æ•…éšœæ³¨å…¥"><a class="header" href="#453-æ•…éšœæ³¨å…¥">4.5.3 æ•…éšœæ³¨å…¥</a></h4>
<p><strong>å»¶è¿Ÿæ³¨å…¥</strong>:</p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: ratings-delay
spec:
  hosts:
  - ratings
  http:
  - fault:
      delay:
        percentage:
          value: 50.0      # 50%è¯·æ±‚æ³¨å…¥å»¶è¿Ÿ
        fixedDelay: 7s     # å»¶è¿Ÿ7ç§’
    route:
    - destination:
        host: ratings
</code></pre>
<p><strong>é”™è¯¯æ³¨å…¥</strong>:</p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: ratings-abort
spec:
  hosts:
  - ratings
  http:
  - fault:
      abort:
        percentage:
          value: 20.0      # 20%è¯·æ±‚è¿”å›é”™è¯¯
        httpStatus: 500    # è¿”å›HTTP 500
    route:
    - destination:
        host: ratings
</code></pre>
<h4 id="454-è¶…æ—¶å’Œé‡è¯•"><a class="header" href="#454-è¶…æ—¶å’Œé‡è¯•">4.5.4 è¶…æ—¶å’Œé‡è¯•</a></h4>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: reviews-timeout-retry
spec:
  hosts:
  - reviews
  http:
  - route:
    - destination:
        host: reviews
    timeout: 10s              # æ€»è¶…æ—¶10ç§’
    retries:
      attempts: 3             # æœ€å¤šé‡è¯•3æ¬¡
      perTryTimeout: 2s       # æ¯æ¬¡å°è¯•è¶…æ—¶2ç§’
      retryOn: 5xx,reset,connect-failure,refused-stream
</code></pre>
<hr />
<h2 id="5-å®‰å…¨ç®¡ç†-security"><a class="header" href="#5-å®‰å…¨ç®¡ç†-security">5. å®‰å…¨ç®¡ç† (Security)</a></h2>
<h3 id="51-è®¤è¯-authentication"><a class="header" href="#51-è®¤è¯-authentication">5.1 è®¤è¯ (Authentication)</a></h3>
<h4 id="511-åŒå‘-tls-mtls"><a class="header" href="#511-åŒå‘-tls-mtls">5.1.1 åŒå‘ TLS (mTLS)</a></h4>
<p><strong>mTLSå·¥ä½œåŸç†</strong>:</p>
<pre><code>å®¢æˆ·ç«¯æœåŠ¡                         æœåŠ¡ç«¯æœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  App A      â”‚                   â”‚  App B      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
â”‚Envoy Proxy Aâ”‚â—„â”€â”€â”€â”€ mTLSæ¡æ‰‹ â”€â”€â”€â”€â–ºâ”‚Envoy Proxy Bâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                      â”‚
    â”‚ 1. å®¢æˆ·ç«¯å‘é€è¯ä¹¦                      â”‚
    â”‚ 2. æœåŠ¡ç«¯éªŒè¯è¯ä¹¦                      â”‚
    â”‚ 3. æœåŠ¡ç«¯å‘é€è¯ä¹¦                      â”‚
    â”‚ 4. å®¢æˆ·ç«¯éªŒè¯è¯ä¹¦                      â”‚
    â”‚ 5. å»ºç«‹åŠ å¯†è¿æ¥                        â”‚
</code></pre>
<p><strong>å…¨å±€å¯ç”¨mTLS</strong>:</p>
<pre><code class="language-yaml"># PeerAuthentication: é…ç½®æœåŠ¡ç«¯å¦‚ä½•æ¥å—è¿æ¥
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: istio-system  # åº”ç”¨åˆ°æ•´ä¸ªç½‘æ ¼
spec:
  mtls:
    mode: STRICT  # STRICT | PERMISSIVE | DISABLE
</code></pre>
<p><strong>æ¨¡å¼è¯´æ˜</strong>:</p>
<ul>
<li><code>STRICT</code>: åªæ¥å—mTLSè¿æ¥</li>
<li><code>PERMISSIVE</code>: åŒæ—¶æ¥å—mTLSå’Œæ˜æ–‡è¿æ¥ï¼ˆç”¨äºè¿ç§»æœŸï¼‰</li>
<li><code>DISABLE</code>: ç¦ç”¨mTLS</li>
</ul>
<p><strong>å‘½åç©ºé—´çº§åˆ«mTLS</strong>:</p>
<pre><code class="language-yaml">apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: namespace-policy
  namespace: my-namespace
spec:
  mtls:
    mode: STRICT
</code></pre>
<p><strong>æœåŠ¡çº§åˆ«mTLS</strong>:</p>
<pre><code class="language-yaml">apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: service-policy
  namespace: my-namespace
spec:
  selector:
    matchLabels:
      app: myapp
  mtls:
    mode: STRICT
  portLevelMtls:
    8080:
      mode: DISABLE  # 8080ç«¯å£ç¦ç”¨mTLS
</code></pre>
<p><strong>éªŒè¯mTLS</strong>:</p>
<pre><code class="language-bash"># æ£€æŸ¥mTLSé…ç½®
istioctl x describe pod &lt;pod-name&gt; -n &lt;namespace&gt;

# æ£€æŸ¥è¿æ¥æ˜¯å¦ä½¿ç”¨mTLS
istioctl proxy-config secret &lt;pod-name&gt; -n &lt;namespace&gt;

# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
kubectl exec &lt;pod-name&gt; -n &lt;namespace&gt; -c istio-proxy -- \
  openssl s_client -showcerts -connect &lt;service&gt;:8080
</code></pre>
<h4 id="512-jwt-è®¤è¯"><a class="header" href="#512-jwt-è®¤è¯">5.1.2 JWT è®¤è¯</a></h4>
<pre><code class="language-yaml">apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-auth
  namespace: my-namespace
spec:
  selector:
    matchLabels:
      app: myapp
  jwtRules:
  - issuer: "https://accounts.google.com"
    jwksUri: "https://www.googleapis.com/oauth2/v3/certs"
    audiences:
    - "myapp-audience"
    forwardOriginalToken: true
    outputPayloadToHeader: "x-jwt-payload"
</code></pre>
<p><strong>å®æˆ˜æ¡ˆä¾‹: JWT + OAuth2</strong></p>
<pre><code class="language-yaml"># 1. é…ç½®JWTè®¤è¯
apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: oauth2-jwt
spec:
  selector:
    matchLabels:
      app: api-server
  jwtRules:
  - issuer: "https://auth.example.com"
    jwksUri: "https://auth.example.com/.well-known/jwks.json"
---
# 2. é…ç½®æˆæƒç­–ç•¥ï¼ˆè¦æ±‚å¿…é¡»æœ‰æœ‰æ•ˆJWTï¼‰
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: require-jwt
spec:
  selector:
    matchLabels:
      app: api-server
  action: ALLOW
  rules:
  - from:
    - source:
        requestPrincipals: ["*"]  # å¿…é¡»æœ‰æœ‰æ•ˆçš„JWT
</code></pre>
<p><strong>æµ‹è¯•JWTè®¤è¯</strong>:</p>
<pre><code class="language-bash"># ä¸å¸¦Tokenè®¿é—®ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰
curl -X GET http://$GATEWAY_URL/api/data

# å¸¦Tokenè®¿é—®
TOKEN=$(curl -s https://auth.example.com/token -d "client_id=xxx&amp;client_secret=yyy" | jq -r .access_token)
curl -X GET http://$GATEWAY_URL/api/data -H "Authorization: Bearer $TOKEN"
</code></pre>
<h3 id="52-æˆæƒ-authorization"><a class="header" href="#52-æˆæƒ-authorization">5.2 æˆæƒ (Authorization)</a></h3>
<h4 id="authorizationpolicy-æ ¸å¿ƒæ¦‚å¿µ"><a class="header" href="#authorizationpolicy-æ ¸å¿ƒæ¦‚å¿µ">AuthorizationPolicy æ ¸å¿ƒæ¦‚å¿µ</a></h4>
<pre><code class="language-yaml">apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: policy-name
  namespace: my-namespace
spec:
  selector:        # åº”ç”¨åˆ°å“ªäº›å·¥ä½œè´Ÿè½½
    matchLabels:
      app: myapp

  action: ALLOW    # ALLOW | DENY | AUDIT | CUSTOM

  rules:
  - from:          # æ¥æºæ¡ä»¶
    - source:
        principals: ["cluster.local/ns/default/sa/myapp"]
        namespaces: ["default"]

    to:            # ç›®æ ‡æ¡ä»¶
    - operation:
        methods: ["GET", "POST"]
        paths: ["/api/*"]
        ports: ["8080"]

    when:          # é¢å¤–æ¡ä»¶
    - key: request.headers[x-api-key]
      values: ["secret-key"]
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹1-åŸºäºå‘½åç©ºé—´çš„è®¿é—®æ§åˆ¶"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹1-åŸºäºå‘½åç©ºé—´çš„è®¿é—®æ§åˆ¶">å®æˆ˜æ¡ˆä¾‹1: åŸºäºå‘½åç©ºé—´çš„è®¿é—®æ§åˆ¶</a></h4>
<pre><code class="language-yaml"># åªå…è®¸defaultå‘½åç©ºé—´çš„æœåŠ¡è®¿é—®
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-default-ns
  namespace: production
spec:
  action: ALLOW
  rules:
  - from:
    - source:
        namespaces: ["default"]
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹2-åŸºäºæœåŠ¡è´¦å·çš„rbac"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹2-åŸºäºæœåŠ¡è´¦å·çš„rbac">å®æˆ˜æ¡ˆä¾‹2: åŸºäºæœåŠ¡è´¦å·çš„RBAC</a></h4>
<pre><code class="language-yaml"># åªå…è®¸ç‰¹å®šServiceAccountè®¿é—®
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: service-account-rbac
spec:
  selector:
    matchLabels:
      app: database
  action: ALLOW
  rules:
  - from:
    - source:
        principals:
        - "cluster.local/ns/default/sa/api-service"
        - "cluster.local/ns/default/sa/worker-service"
    to:
    - operation:
        methods: ["GET", "POST"]
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹3-åŸºäºhttpæ–¹æ³•çš„è®¿é—®æ§åˆ¶"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹3-åŸºäºhttpæ–¹æ³•çš„è®¿é—®æ§åˆ¶">å®æˆ˜æ¡ˆä¾‹3: åŸºäºHTTPæ–¹æ³•çš„è®¿é—®æ§åˆ¶</a></h4>
<pre><code class="language-yaml">apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: http-method-policy
spec:
  selector:
    matchLabels:
      app: api-server
  action: ALLOW
  rules:
  # å…è®¸æ‰€æœ‰äººGET
  - to:
    - operation:
        methods: ["GET"]

  # åªå…è®¸adminæ‰§è¡ŒPOST/PUT/DELETE
  - from:
    - source:
        requestPrincipals: ["*"]
    to:
    - operation:
        methods: ["POST", "PUT", "DELETE"]
    when:
    - key: request.auth.claims[role]
      values: ["admin"]
</code></pre>
<h4 id="å®æˆ˜æ¡ˆä¾‹4-ipé»‘ç™½åå•"><a class="header" href="#å®æˆ˜æ¡ˆä¾‹4-ipé»‘ç™½åå•">å®æˆ˜æ¡ˆä¾‹4: IPé»‘ç™½åå•</a></h4>
<pre><code class="language-yaml"># IPç™½åå•
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: ip-whitelist
spec:
  selector:
    matchLabels:
      app: admin-panel
  action: ALLOW
  rules:
  - from:
    - source:
        ipBlocks:
        - "10.0.0.0/8"      # å†…ç½‘
        - "192.168.1.100"   # ç‰¹å®šIP
---
# IPé»‘åå•
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: ip-blacklist
spec:
  selector:
    matchLabels:
      app: public-api
  action: DENY
  rules:
  - from:
    - source:
        ipBlocks:
        - "203.0.113.0/24"  # æ¶æ„IPæ®µ
</code></pre>
<h3 id="53-å®‰å…¨ç­–ç•¥é…ç½®"><a class="header" href="#53-å®‰å…¨ç­–ç•¥é…ç½®">5.3 å®‰å…¨ç­–ç•¥é…ç½®</a></h3>
<h4 id="å®Œæ•´çš„å®‰å…¨é…ç½®ç¤ºä¾‹"><a class="header" href="#å®Œæ•´çš„å®‰å…¨é…ç½®ç¤ºä¾‹">å®Œæ•´çš„å®‰å…¨é…ç½®ç¤ºä¾‹</a></h4>
<pre><code class="language-yaml"># 1. å¯ç”¨å…¨å±€STRICT mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: global-mtls
  namespace: istio-system
spec:
  mtls:
    mode: STRICT
---
# 2. é…ç½®JWTè®¤è¯
apiVersion: security.istio.io/v1beta1
kind: RequestAuthentication
metadata:
  name: jwt-auth
  namespace: production
spec:
  jwtRules:
  - issuer: "https://auth.example.com"
    jwksUri: "https://auth.example.com/.well-known/jwks.json"
---
# 3. é»˜è®¤æ‹’ç»æ‰€æœ‰è®¿é—®
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: deny-all
  namespace: production
spec:
  {}  # ç©ºè§„åˆ™ = æ‹’ç»æ‰€æœ‰
---
# 4. ç™½åå•å…è®¸ç‰¹å®šè®¿é—®
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: allow-specific
  namespace: production
spec:
  action: ALLOW
  rules:
  - from:
    - source:
        principals: ["cluster.local/ns/production/sa/frontend"]
    to:
    - operation:
        methods: ["GET", "POST"]
        paths: ["/api/*"]
    when:
    - key: request.auth.claims[role]
      values: ["user", "admin"]
</code></pre>
<hr />
<h2 id="6-å¯è§‚æµ‹æ€§-observability"><a class="header" href="#6-å¯è§‚æµ‹æ€§-observability">6. å¯è§‚æµ‹æ€§ (Observability)</a></h2>
<h3 id="61-æŒ‡æ ‡ç›‘æ§"><a class="header" href="#61-æŒ‡æ ‡ç›‘æ§">6.1 æŒ‡æ ‡ç›‘æ§</a></h3>
<h4 id="611-prometheus-é›†æˆ"><a class="header" href="#611-prometheus-é›†æˆ">6.1.1 Prometheus é›†æˆ</a></h4>
<p><strong>å®‰è£…Prometheus</strong>:</p>
<pre><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/prometheus.yaml
</code></pre>
<p><strong>Istioè‡ªåŠ¨æ”¶é›†çš„æŒ‡æ ‡</strong>:</p>
<pre><code class="language-yaml">æ ‡å‡†æŒ‡æ ‡:
  è¯·æ±‚æŒ‡æ ‡:
    - istio_requests_total: è¯·æ±‚æ€»æ•°
    - istio_request_duration_milliseconds: è¯·æ±‚å»¶è¿Ÿ
    - istio_request_bytes: è¯·æ±‚å¤§å°
    - istio_response_bytes: å“åº”å¤§å°

  TCPæŒ‡æ ‡:
    - istio_tcp_connections_opened_total: TCPè¿æ¥æ‰“å¼€æ€»æ•°
    - istio_tcp_connections_closed_total: TCPè¿æ¥å…³é—­æ€»æ•°
    - istio_tcp_sent_bytes_total: å‘é€å­—èŠ‚æ€»æ•°
    - istio_tcp_received_bytes_total: æ¥æ”¶å­—èŠ‚æ€»æ•°
</code></pre>
<p><strong>è‡ªå®šä¹‰æŒ‡æ ‡æŸ¥è¯¢</strong>:</p>
<pre><code class="language-bash"># ç«¯å£è½¬å‘Prometheus
kubectl port-forward -n istio-system svc/prometheus 9090:9090

# è®¿é—® http://localhost:9090

# PromQLæŸ¥è¯¢ç¤ºä¾‹ï¼š

# 1. è¯·æ±‚æˆåŠŸç‡
sum(rate(istio_requests_total{response_code!~"5.*"}[5m])) / sum(rate(istio_requests_total[5m]))

# 2. P99å»¶è¿Ÿ
histogram_quantile(0.99, sum(rate(istio_request_duration_milliseconds_bucket[5m])) by (le, destination_workload))

# 3. é”™è¯¯ç‡
sum(rate(istio_requests_total{response_code=~"5.*"}[5m])) by (destination_workload)

# 4. è¯·æ±‚é€Ÿç‡(QPS)
sum(rate(istio_requests_total[1m])) by (destination_workload)
</code></pre>
<h4 id="612-grafana-ä»ªè¡¨æ¿"><a class="header" href="#612-grafana-ä»ªè¡¨æ¿">6.1.2 Grafana ä»ªè¡¨æ¿</a></h4>
<p><strong>å®‰è£…Grafana</strong>:</p>
<pre><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/grafana.yaml

# è®¿é—®Grafana
kubectl port-forward -n istio-system svc/grafana 3000:3000
# æµè§ˆå™¨æ‰“å¼€ http://localhost:3000
</code></pre>
<p><strong>Istioå†…ç½®Dashboard</strong>:</p>
<ol>
<li><strong>Istio Mesh Dashboard</strong>: æ•´ä½“ç½‘æ ¼å¥åº·çŠ¶å†µ</li>
<li><strong>Istio Service Dashboard</strong>: å•ä¸ªæœåŠ¡è¯¦ç»†æŒ‡æ ‡</li>
<li><strong>Istio Workload Dashboard</strong>: å·¥ä½œè´Ÿè½½çº§åˆ«æŒ‡æ ‡</li>
<li><strong>Istio Performance Dashboard</strong>: æ€§èƒ½åˆ†æ</li>
<li><strong>Istio Control Plane Dashboard</strong>: æ§åˆ¶å¹³é¢ç›‘æ§</li>
</ol>
<h3 id="62-åˆ†å¸ƒå¼è¿½è¸ª"><a class="header" href="#62-åˆ†å¸ƒå¼è¿½è¸ª">6.2 åˆ†å¸ƒå¼è¿½è¸ª</a></h3>
<h4 id="621-jaeger-é›†æˆ"><a class="header" href="#621-jaeger-é›†æˆ">6.2.1 Jaeger é›†æˆ</a></h4>
<p><strong>å®‰è£…Jaeger</strong>:</p>
<pre><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/jaeger.yaml
</code></pre>
<p><strong>é…ç½®è¿½è¸ªé‡‡æ ·ç‡</strong>:</p>
<pre><code class="language-yaml">apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    defaultConfig:
      tracing:
        sampling: 100.0  # é‡‡æ ·ç‡100%ï¼ˆç”Ÿäº§ç¯å¢ƒå»ºè®®1-10%ï¼‰
        zipkin:
          address: jaeger-collector.istio-system:9411
</code></pre>
<p><strong>åº”ç”¨ç¨‹åºä¼ æ’­è¿½è¸ªHeader</strong>:</p>
<pre><code class="language-java">// Spring Bootç¤ºä¾‹
@GetMapping("/api/users/{id}")
public User getUser(@PathVariable Long id, HttpServletRequest request) {
    // Istioéœ€è¦ä¼ æ’­ä»¥ä¸‹Headers:
    String[] tracingHeaders = {
        "x-request-id",
        "x-b3-traceid",
        "x-b3-spanid",
        "x-b3-parentspanid",
        "x-b3-sampled",
        "x-b3-flags",
        "x-ot-span-context"
    };

    // ä¼ æ’­Headersåˆ°ä¸‹æ¸¸æœåŠ¡
    HttpHeaders headers = new HttpHeaders();
    for (String header : tracingHeaders) {
        String value = request.getHeader(header);
        if (value != null) {
            headers.add(header, value);
        }
    }

    // è°ƒç”¨ä¸‹æ¸¸æœåŠ¡
    return restTemplate.exchange(
        "http://user-service/users/" + id,
        HttpMethod.GET,
        new HttpEntity&lt;&gt;(headers),
        User.class
    ).getBody();
}
</code></pre>
<p><strong>è®¿é—®Jaeger UI</strong>:</p>
<pre><code class="language-bash">kubectl port-forward -n istio-system svc/tracing 16686:16686
# æµè§ˆå™¨æ‰“å¼€ http://localhost:16686
</code></pre>
<h3 id="63-æ—¥å¿—ç®¡ç†"><a class="header" href="#63-æ—¥å¿—ç®¡ç†">6.3 æ—¥å¿—ç®¡ç†</a></h3>
<h4 id="631-è®¿é—®æ—¥å¿—"><a class="header" href="#631-è®¿é—®æ—¥å¿—">6.3.1 è®¿é—®æ—¥å¿—</a></h4>
<p><strong>å…¨å±€å¯ç”¨è®¿é—®æ—¥å¿—</strong>:</p>
<pre><code class="language-yaml">apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    accessLogFile: /dev/stdout
    accessLogEncoding: JSON
    accessLogFormat: |
      {
        "start_time": "%START_TIME%",
        "method": "%REQ(:METHOD)%",
        "path": "%REQ(X-ENVOY-ORIGINAL-PATH?:PATH)%",
        "protocol": "%PROTOCOL%",
        "response_code": "%RESPONSE_CODE%",
        "response_flags": "%RESPONSE_FLAGS%",
        "bytes_received": "%BYTES_RECEIVED%",
        "bytes_sent": "%BYTES_SENT%",
        "duration": "%DURATION%",
        "upstream_service_time": "%RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)%",
        "x_forwarded_for": "%REQ(X-FORWARDED-FOR)%",
        "user_agent": "%REQ(USER-AGENT)%",
        "request_id": "%REQ(X-REQUEST-ID)%",
        "authority": "%REQ(:AUTHORITY)%",
        "upstream_host": "%UPSTREAM_HOST%",
        "upstream_cluster": "%UPSTREAM_CLUSTER%"
      }
</code></pre>
<p><strong>æŸ¥çœ‹è®¿é—®æ—¥å¿—</strong>:</p>
<pre><code class="language-bash"># æŸ¥çœ‹ç‰¹å®šPodçš„è®¿é—®æ—¥å¿—
kubectl logs &lt;pod-name&gt; -c istio-proxy -n &lt;namespace&gt;

# å®æ—¶è·Ÿè¸ª
kubectl logs -f &lt;pod-name&gt; -c istio-proxy -n &lt;namespace&gt;

# ä½¿ç”¨sternï¼ˆå¤šPodæ—¥å¿—èšåˆå·¥å…·ï¼‰
stern -n &lt;namespace&gt; &lt;pod-label&gt; -c istio-proxy
</code></pre>
<h4 id="632-åº”ç”¨æ—¥å¿—èšåˆ"><a class="header" href="#632-åº”ç”¨æ—¥å¿—èšåˆ">6.3.2 åº”ç”¨æ—¥å¿—èšåˆ</a></h4>
<p><strong>ä½¿ç”¨EFK Stack</strong>:</p>
<pre><code class="language-bash"># éƒ¨ç½²Elasticsearch
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/extras/elasticsearch.yaml

# éƒ¨ç½²Fluentd
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/extras/fluentd-daemonset.yaml

# éƒ¨ç½²Kibana
kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/extras/kibana.yaml

# è®¿é—®Kibana
kubectl port-forward -n istio-system svc/kibana 5601:5601
</code></pre>
<h3 id="64-kiali-æœåŠ¡æ‹“æ‰‘"><a class="header" href="#64-kiali-æœåŠ¡æ‹“æ‰‘">6.4 Kiali æœåŠ¡æ‹“æ‰‘</a></h3>
<p><strong>å®‰è£…Kiali</strong>:</p>
<pre><code class="language-bash">kubectl apply -f https://raw.githubusercontent.com/istio/istio/release-1.20/samples/addons/kiali.yaml

# è®¿é—®Kiali
kubectl port-forward -n istio-system svc/kiali 20001:20001
# æµè§ˆå™¨æ‰“å¼€ http://localhost:20001
</code></pre>
<p><strong>Kialiæ ¸å¿ƒåŠŸèƒ½</strong>:</p>
<ol>
<li><strong>æœåŠ¡æ‹“æ‰‘å¯è§†åŒ–</strong>: å®æ—¶æŸ¥çœ‹æœåŠ¡é—´è°ƒç”¨å…³ç³»</li>
<li><strong>æµé‡åŠ¨ç”»</strong>: å¯è§†åŒ–è¯·æ±‚æµé‡å’Œé”™è¯¯</li>
<li><strong>é…ç½®éªŒè¯</strong>: æ£€æŸ¥Istioé…ç½®çš„æ­£ç¡®æ€§</li>
<li><strong>è¿½è¸ªé›†æˆ</strong>: é›†æˆJaegeré“¾è·¯è¿½è¸ª</li>
<li><strong>æŒ‡æ ‡å›¾è¡¨</strong>: é›†æˆPrometheusæŒ‡æ ‡</li>
</ol>
<p><strong>Kialiä½¿ç”¨åœºæ™¯</strong>:</p>
<pre><code class="language-yaml">å¸¸è§ç”¨é€”:
  1. æ•…éšœæ’æŸ¥:
     - å¿«é€Ÿå®šä½å“ªä¸ªæœåŠ¡å‡ºç°é”™è¯¯
     - æŸ¥çœ‹æœåŠ¡é—´è°ƒç”¨å…³ç³»
     - åˆ†æè¯·æ±‚å»¶è¿Ÿæ¥æº

  2. é…ç½®ç®¡ç†:
     - å¯è§†åŒ–ç¼–è¾‘VirtualService
     - éªŒè¯é…ç½®æ­£ç¡®æ€§
     - æŸ¥çœ‹ç”Ÿæ•ˆçš„è·¯ç”±è§„åˆ™

  3. æµé‡åˆ†æ:
     - æŸ¥çœ‹æµé‡åˆ†å¸ƒ
     - åˆ†æQPSå’Œé”™è¯¯ç‡
     - ç›‘æ§é‡‘ä¸é›€å‘å¸ƒæ•ˆæœ
</code></pre>
<hr />
<h2 id="7-istio-å®è·µæ¡ˆä¾‹"><a class="header" href="#7-istio-å®è·µæ¡ˆä¾‹">7. Istio å®è·µæ¡ˆä¾‹</a></h2>
<h3 id="71-å¾®æœåŠ¡æ²»ç†"><a class="header" href="#71-å¾®æœåŠ¡æ²»ç†">7.1 å¾®æœåŠ¡æ²»ç†</a></h3>
<h4 id="å®Œæ•´çš„ç”µå•†å¾®æœåŠ¡æ¡ˆä¾‹"><a class="header" href="#å®Œæ•´çš„ç”µå•†å¾®æœåŠ¡æ¡ˆä¾‹">å®Œæ•´çš„ç”µå•†å¾®æœåŠ¡æ¡ˆä¾‹</a></h4>
<p><strong>æ¶æ„å›¾</strong>:</p>
<pre><code>                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Gateway   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”
         â”‚ Web UI â”‚   â”‚  API   â”‚   â”‚ Mobile â”‚
         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚ Gatewayâ”‚   â”‚  API   â”‚
              â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
              â”‚            â”‚            â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
      â”‚ Product â”‚    â”‚  Order   â”‚    â”‚  User   â”‚
      â”‚ Service â”‚    â”‚ Service  â”‚    â”‚ Service â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â”‚               â”‚               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                      â”‚Database â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>éƒ¨ç½²æœåŠ¡</strong>:</p>
<pre><code class="language-yaml"># Product Service
apiVersion: apps/v1
kind: Deployment
metadata:
  name: product-service-v1
spec:
  replicas: 2
  selector:
    matchLabels:
      app: product-service
      version: v1
  template:
    metadata:
      labels:
        app: product-service
        version: v1
    spec:
      containers:
      - name: product-service
        image: myregistry/product-service:v1
        ports:
        - containerPort: 8080
        env:
        - name: DATABASE_URL
          value: "jdbc:mysql://mysql:3306/products"
---
apiVersion: v1
kind: Service
metadata:
  name: product-service
spec:
  ports:
  - port: 8080
    name: http
  selector:
    app: product-service
</code></pre>
<p><strong>é…ç½®æµé‡ç®¡ç†</strong>:</p>
<pre><code class="language-yaml"># DestinationRule
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: product-service
spec:
  host: product-service
  trafficPolicy:
    loadBalancer:
      simple: LEAST_REQUEST
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 50
        maxRequestsPerConnection: 2
    outlierDetection:
      consecutiveErrors: 5
      interval: 30s
      baseEjectionTime: 30s
  subsets:
  - name: v1
    labels:
      version: v1
  - name: v2
    labels:
      version: v2
---
# VirtualService
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: product-service
spec:
  hosts:
  - product-service
  http:
  - match:
    - headers:
        x-version:
          exact: "v2"
    route:
    - destination:
        host: product-service
        subset: v2
  - route:
    - destination:
        host: product-service
        subset: v1
      weight: 95
    - destination:
        host: product-service
        subset: v2
      weight: 5
    timeout: 3s
    retries:
      attempts: 3
      perTryTimeout: 1s
</code></pre>
<h3 id="72-ç°åº¦å‘å¸ƒ"><a class="header" href="#72-ç°åº¦å‘å¸ƒ">7.2 ç°åº¦å‘å¸ƒ</a></h3>
<h4 id="å®Œæ•´çš„ç°åº¦å‘å¸ƒæµç¨‹"><a class="header" href="#å®Œæ•´çš„ç°åº¦å‘å¸ƒæµç¨‹">å®Œæ•´çš„ç°åº¦å‘å¸ƒæµç¨‹</a></h4>
<p><strong>é˜¶æ®µ1: éƒ¨ç½²æ–°ç‰ˆæœ¬ï¼ˆæµé‡0%ï¼‰</strong></p>
<pre><code class="language-yaml">apiVersion: apps/v1
kind: Deployment
metadata:
  name: api-service-v2
spec:
  replicas: 1  # å…ˆéƒ¨ç½²1ä¸ªå®ä¾‹
  selector:
    matchLabels:
      app: api-service
      version: v2
  template:
    metadata:
      labels:
        app: api-service
        version: v2
    spec:
      containers:
      - name: api-service
        image: myregistry/api-service:v2
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-service
spec:
  hosts:
  - api-service
  http:
  - route:
    - destination:
        host: api-service
        subset: v1
      weight: 100  # 100%æµé‡åˆ°v1
    - destination:
        host: api-service
        subset: v2
      weight: 0    # 0%æµé‡åˆ°v2
</code></pre>
<p><strong>é˜¶æ®µ2: å†…éƒ¨æµ‹è¯•ï¼ˆç‰¹å®šç”¨æˆ·ï¼‰</strong></p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-service
spec:
  hosts:
  - api-service
  http:
  - match:
    - headers:
        x-canary:
          exact: "true"
    route:
    - destination:
        host: api-service
        subset: v2
  - route:
    - destination:
        host: api-service
        subset: v1
</code></pre>
<p><strong>é˜¶æ®µ3: å°æµé‡ç°åº¦ï¼ˆ5%ï¼‰</strong></p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-service
spec:
  hosts:
  - api-service
  http:
  - route:
    - destination:
        host: api-service
        subset: v1
      weight: 95
    - destination:
        host: api-service
        subset: v2
      weight: 5
</code></pre>
<p><strong>é˜¶æ®µ4: è§‚å¯ŸæŒ‡æ ‡</strong></p>
<pre><code class="language-bash"># ä½¿ç”¨PrometheusæŸ¥è¯¢é”™è¯¯ç‡
curl 'http://prometheus:9090/api/v1/query?query=sum(rate(istio_requests_total{destination_workload="api-service",response_code=~"5.*"}[5m]))/sum(rate(istio_requests_total{destination_workload="api-service"}[5m]))'

# æŸ¥è¯¢P99å»¶è¿Ÿ
curl 'http://prometheus:9090/api/v1/query?query=histogram_quantile(0.99,sum(rate(istio_request_duration_milliseconds_bucket{destination_workload="api-service"}[5m]))by(le,destination_version))'
</code></pre>
<p><strong>é˜¶æ®µ5: é€æ­¥æ‰©å¤§ï¼ˆ50%ï¼‰</strong></p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-service
spec:
  hosts:
  - api-service
  http:
  - route:
    - destination:
        host: api-service
        subset: v1
      weight: 50
    - destination:
        host: api-service
        subset: v2
      weight: 50
</code></pre>
<p><strong>é˜¶æ®µ6: å…¨é‡åˆ‡æ¢</strong></p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-service
spec:
  hosts:
  - api-service
  http:
  - route:
    - destination:
        host: api-service
        subset: v2
      weight: 100
</code></pre>
<p><strong>é˜¶æ®µ7: æ¸…ç†æ—§ç‰ˆæœ¬</strong></p>
<pre><code class="language-bash"># åˆ é™¤v1ç‰ˆæœ¬çš„Deployment
kubectl delete deployment api-service-v1
</code></pre>
<h3 id="73-è“ç»¿éƒ¨ç½²"><a class="header" href="#73-è“ç»¿éƒ¨ç½²">7.3 è“ç»¿éƒ¨ç½²</a></h3>
<pre><code class="language-yaml"># åˆå§‹çŠ¶æ€ï¼šæ‰€æœ‰æµé‡åˆ°è“è‰²ç¯å¢ƒ
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp-blue-green
spec:
  hosts:
  - myapp
  http:
  - route:
    - destination:
        host: myapp
        subset: blue
      weight: 100
---
# åˆ‡æ¢ï¼šä¸€æ¬¡æ€§åˆ‡æ¢åˆ°ç»¿è‰²ç¯å¢ƒ
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp-blue-green
spec:
  hosts:
  - myapp
  http:
  - route:
    - destination:
        host: myapp
        subset: green
      weight: 100
</code></pre>
<h3 id="74-æœåŠ¡é™æµ"><a class="header" href="#74-æœåŠ¡é™æµ">7.4 æœåŠ¡é™æµ</a></h3>
<p><strong>å…¨å±€é™æµé…ç½®</strong>:</p>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: EnvoyFilter
metadata:
  name: global-ratelimit
  namespace: istio-system
spec:
  workloadSelector:
    labels:
      istio: ingressgateway
  configPatches:
  - applyTo: HTTP_FILTER
    match:
      context: GATEWAY
      listener:
        filterChain:
          filter:
            name: "envoy.filters.network.http_connection_manager"
    patch:
      operation: INSERT_BEFORE
      value:
        name: envoy.filters.http.local_ratelimit
        typed_config:
          "@type": type.googleapis.com/udpa.type.v1.TypedStruct
          type_url: type.googleapis.com/envoy.extensions.filters.http.local_ratelimit.v3.LocalRateLimit
          value:
            stat_prefix: http_local_rate_limiter
            token_bucket:
              max_tokens: 1000
              tokens_per_fill: 1000
              fill_interval: 1s
            filter_enabled:
              runtime_key: local_rate_limit_enabled
              default_value:
                numerator: 100
                denominator: HUNDRED
            filter_enforced:
              runtime_key: local_rate_limit_enforced
              default_value:
                numerator: 100
                denominator: HUNDRED
</code></pre>
<h3 id="75-ç†”æ–­é™çº§"><a class="header" href="#75-ç†”æ–­é™çº§">7.5 ç†”æ–­é™çº§</a></h3>
<pre><code class="language-yaml">apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: backend-circuit-breaker
spec:
  host: backend-service
  trafficPolicy:
    connectionPool:
      tcp:
        maxConnections: 10
      http:
        http1MaxPendingRequests: 1
        maxRequestsPerConnection: 1
    outlierDetection:
      consecutiveGatewayErrors: 3
      interval: 30s
      baseEjectionTime: 30s
      maxEjectionPercent: 100
      minHealthPercent: 0
</code></pre>
<hr />
<h2 id="8-æ•…éšœæ’æŸ¥ä¸è°ƒä¼˜"><a class="header" href="#8-æ•…éšœæ’æŸ¥ä¸è°ƒä¼˜">8. æ•…éšœæ’æŸ¥ä¸è°ƒä¼˜</a></h2>
<h3 id="81-å¸¸è§é—®é¢˜è¯Šæ–­"><a class="header" href="#81-å¸¸è§é—®é¢˜è¯Šæ–­">8.1 å¸¸è§é—®é¢˜è¯Šæ–­</a></h3>
<h4 id="é—®é¢˜1-sidecaræœªæ³¨å…¥"><a class="header" href="#é—®é¢˜1-sidecaræœªæ³¨å…¥">é—®é¢˜1: Sidecaræœªæ³¨å…¥</a></h4>
<p><strong>ç—‡çŠ¶</strong>:</p>
<pre><code class="language-bash">kubectl get pods -n myapp
# è¾“å‡º: READYåˆ—æ˜¾ç¤º1/1è€Œä¸æ˜¯2/2
</code></pre>
<p><strong>è¯Šæ–­æ­¥éª¤</strong>:</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥å‘½åç©ºé—´æ ‡ç­¾
kubectl get namespace myapp --show-labels

# 2. æ£€æŸ¥Pod annotations
kubectl get pod &lt;pod-name&gt; -n myapp -o yaml | grep sidecar.istio.io/inject

# 3. æ£€æŸ¥istiodæ—¥å¿—
kubectl logs -n istio-system -l app=istiod
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># æ–¹æ¡ˆ1: ç»™å‘½åç©ºé—´æ·»åŠ æ ‡ç­¾
kubectl label namespace myapp istio-injection=enabled

# æ–¹æ¡ˆ2: ç»™Podæ·»åŠ annotation
apiVersion: v1
kind: Pod
metadata:
  annotations:
    sidecar.istio.io/inject: "true"

# é‡æ–°åˆ›å»ºPod
kubectl rollout restart deployment/&lt;deployment-name&gt; -n myapp
</code></pre>
<h4 id="é—®é¢˜2-503-service-unavailable"><a class="header" href="#é—®é¢˜2-503-service-unavailable">é—®é¢˜2: 503 Service Unavailable</a></h4>
<p><strong>å¯èƒ½åŸå› </strong>:</p>
<ol>
<li>ç›®æ ‡æœåŠ¡ä¸å­˜åœ¨</li>
<li>DestinationRuleé…ç½®é”™è¯¯</li>
<li>mTLSé…ç½®ä¸åŒ¹é…</li>
<li>ç†”æ–­å™¨è§¦å‘</li>
</ol>
<p><strong>è¯Šæ–­æ­¥éª¤</strong>:</p>
<pre><code class="language-bash"># 1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å­˜åœ¨
kubectl get svc &lt;service-name&gt; -n &lt;namespace&gt;

# 2. æ£€æŸ¥Endpoints
kubectl get endpoints &lt;service-name&gt; -n &lt;namespace&gt;

# 3. æ£€æŸ¥Envoyé…ç½®
istioctl proxy-config cluster &lt;pod-name&gt; -n &lt;namespace&gt;
istioctl proxy-config endpoint &lt;pod-name&gt; -n &lt;namespace&gt;

# 4. æŸ¥çœ‹Envoyè®¿é—®æ—¥å¿—
kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt; -c istio-proxy

# 5. æ£€æŸ¥mTLSé…ç½®
istioctl x describe pod &lt;pod-name&gt; -n &lt;namespace&gt;
</code></pre>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>:</p>
<pre><code class="language-bash"># å¦‚æœæ˜¯mTLSé—®é¢˜ï¼Œä¸´æ—¶è®¾ç½®ä¸ºPERMISSIVEæ¨¡å¼
kubectl apply -f - &lt;&lt;EOF
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: &lt;namespace&gt;
spec:
  mtls:
    mode: PERMISSIVE
EOF
</code></pre>
<h4 id="é—®é¢˜3-é…ç½®ä¸ç”Ÿæ•ˆ"><a class="header" href="#é—®é¢˜3-é…ç½®ä¸ç”Ÿæ•ˆ">é—®é¢˜3: é…ç½®ä¸ç”Ÿæ•ˆ</a></h4>
<p><strong>è¯Šæ–­å·¥å…·</strong>:</p>
<pre><code class="language-bash"># 1. éªŒè¯é…ç½®è¯­æ³•
istioctl analyze -n &lt;namespace&gt;

# 2. æ£€æŸ¥é…ç½®æ˜¯å¦ä¸‹å‘åˆ°Proxy
istioctl proxy-config route &lt;pod-name&gt; -n &lt;namespace&gt;

# 3. æŸ¥çœ‹é…ç½®åŒæ­¥çŠ¶æ€
istioctl proxy-status

# 4. å¯¼å‡ºEnvoyé…ç½®
istioctl proxy-config all &lt;pod-name&gt; -n &lt;namespace&gt; -o json &gt; envoy-config.json
</code></pre>
<h3 id="82-æ€§èƒ½ä¼˜åŒ–"><a class="header" href="#82-æ€§èƒ½ä¼˜åŒ–">8.2 æ€§èƒ½ä¼˜åŒ–</a></h3>
<h4 id="ä¼˜åŒ–æ§åˆ¶å¹³é¢"><a class="header" href="#ä¼˜åŒ–æ§åˆ¶å¹³é¢">ä¼˜åŒ–æ§åˆ¶å¹³é¢</a></h4>
<pre><code class="language-yaml">apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  components:
    pilot:
      k8s:
        resources:
          requests:
            cpu: 1000m
            memory: 2048Mi
          limits:
            cpu: 4000m
            memory: 4096Mi
        hpaSpec:
          minReplicas: 2
          maxReplicas: 10
          metrics:
          - type: Resource
            resource:
              name: cpu
              target:
                type: Utilization
                averageUtilization: 80
        env:
        # è°ƒæ•´æ¨é€é—´éš”
        - name: PILOT_PUSH_THROTTLE
          value: "100"
        # è°ƒæ•´é˜²æŠ–æ—¶é—´
        - name: PILOT_DEBOUNCE_AFTER
          value: "100ms"
        # è°ƒæ•´é˜²æŠ–æœ€å¤§æ—¶é—´
        - name: PILOT_DEBOUNCE_MAX
          value: "10s"
</code></pre>
<h4 id="ä¼˜åŒ–æ•°æ®å¹³é¢"><a class="header" href="#ä¼˜åŒ–æ•°æ®å¹³é¢">ä¼˜åŒ–æ•°æ®å¹³é¢</a></h4>
<pre><code class="language-yaml"># 1. è°ƒæ•´Sidecarèµ„æº
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  values:
    global:
      proxy:
        resources:
          requests:
            cpu: 100m
            memory: 128Mi
          limits:
            cpu: 2000m
            memory: 1024Mi
---
# 2. é™åˆ¶Sidecaré…ç½®èŒƒå›´
apiVersion: networking.istio.io/v1beta1
kind: Sidecar
metadata:
  name: default
  namespace: myapp
spec:
  egress:
  - hosts:
    - "./*"           # åªå…è®¸è®¿é—®åŒå‘½åç©ºé—´
    - "istio-system/*" # å’Œistio-systemå‘½åç©ºé—´çš„æœåŠ¡
</code></pre>
<h4 id="ä¼˜åŒ–è¿½è¸ªé‡‡æ ·"><a class="header" href="#ä¼˜åŒ–è¿½è¸ªé‡‡æ ·">ä¼˜åŒ–è¿½è¸ªé‡‡æ ·</a></h4>
<pre><code class="language-yaml"># ç”Ÿäº§ç¯å¢ƒé™ä½é‡‡æ ·ç‡
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    defaultConfig:
      tracing:
        sampling: 1.0  # 1%é‡‡æ ·ç‡
</code></pre>
<h3 id="83-é…ç½®éªŒè¯"><a class="header" href="#83-é…ç½®éªŒè¯">8.3 é…ç½®éªŒè¯</a></h3>
<pre><code class="language-bash"># å…¨é¢åˆ†æé…ç½®
istioctl analyze --all-namespaces

# å¸¸è§é—®é¢˜ç¤ºä¾‹ï¼š
# [IST0101] (VirtualService myapp.default) Referenced host not found: "myservice"
# [IST0102] (VirtualService myapp.default) More than one selector matches the same set of pods
# [IST0104] (Gateway mygateway.default) Failed to resolve gateway selector label: istio=ingressgateway
</code></pre>
<h3 id="84-è°ƒè¯•å·¥å…·"><a class="header" href="#84-è°ƒè¯•å·¥å…·">8.4 è°ƒè¯•å·¥å…·</a></h3>
<h4 id="istioctl-debugå‘½ä»¤"><a class="header" href="#istioctl-debugå‘½ä»¤">istioctl debugå‘½ä»¤</a></h4>
<pre><code class="language-bash"># 1. æŸ¥çœ‹Podè¯¦ç»†ä¿¡æ¯
istioctl x describe pod &lt;pod-name&gt; -n &lt;namespace&gt;

# 2. éªŒè¯è¿é€šæ€§
istioctl experimental check-inject \
  --filename deployment.yaml

# 3. æŸ¥çœ‹xDSåŒæ­¥çŠ¶æ€
istioctl proxy-status

# 4. å®æ—¶æŸ¥çœ‹xDSäº‹ä»¶
istioctl experimental wait \
  --for=distribution \
  VirtualService/myapp.default

# 5. å¯¼å‡ºEnvoyæ—¥å¿—
kubectl logs &lt;pod-name&gt; -c istio-proxy --tail=1000
</code></pre>
<hr />
<h2 id="9-istio-æœ€ä½³å®è·µ"><a class="header" href="#9-istio-æœ€ä½³å®è·µ">9. Istio æœ€ä½³å®è·µ</a></h2>
<h3 id="91-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®"><a class="header" href="#91-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®">9.1 ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å»ºè®®</a></h3>
<h4 id="é«˜å¯ç”¨é…ç½®"><a class="header" href="#é«˜å¯ç”¨é…ç½®">é«˜å¯ç”¨é…ç½®</a></h4>
<pre><code class="language-yaml">apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: production-install
spec:
  profile: production

  components:
    pilot:
      k8s:
        replicaCount: 3  # è‡³å°‘3ä¸ªå‰¯æœ¬
        hpaSpec:
          minReplicas: 3
          maxReplicas: 10
        affinity:
          podAntiAffinity:  # Podåäº²å’Œæ€§
            requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app: istiod
              topologyKey: kubernetes.io/hostname

    ingressGateways:
    - name: istio-ingressgateway
      enabled: true
      k8s:
        replicaCount: 3
        hpaSpec:
          minReplicas: 3
          maxReplicas: 10
        service:
          type: LoadBalancer
          loadBalancerSourceRanges:
          - "10.0.0.0/8"
</code></pre>
<h3 id="92-é…ç½®ç®¡ç†ç­–ç•¥"><a class="header" href="#92-é…ç½®ç®¡ç†ç­–ç•¥">9.2 é…ç½®ç®¡ç†ç­–ç•¥</a></h3>
<h4 id="gitopså·¥ä½œæµ"><a class="header" href="#gitopså·¥ä½œæµ">GitOpså·¥ä½œæµ</a></h4>
<pre><code class="language-yaml"># ä½¿ç”¨Gitç®¡ç†æ‰€æœ‰Istioé…ç½®
istio-config/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ mesh-config.yaml
â”‚   â”œâ”€â”€ gateways/
â”‚   â”œâ”€â”€ virtual-services/
â”‚   â””â”€â”€ destination-rules/
â”œâ”€â”€ overlays/
â”‚   â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ staging/
â”‚   â””â”€â”€ production/
â””â”€â”€ kustomization.yaml
</code></pre>
<h4 id="é…ç½®ç‰ˆæœ¬æ§åˆ¶"><a class="header" href="#é…ç½®ç‰ˆæœ¬æ§åˆ¶">é…ç½®ç‰ˆæœ¬æ§åˆ¶</a></h4>
<pre><code class="language-yaml"># ä¸ºé…ç½®æ·»åŠ ç‰ˆæœ¬å·
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp
  labels:
    version: "v1.2.3"
  annotations:
    config.istio.io/version: "1.2.3"
    config.istio.io/last-updated: "2024-01-15T10:00:00Z"
spec:
  # ...
</code></pre>
<h3 id="93-å‡çº§å’Œç»´æŠ¤"><a class="header" href="#93-å‡çº§å’Œç»´æŠ¤">9.3 å‡çº§å’Œç»´æŠ¤</a></h3>
<h4 id="é‡‘ä¸é›€å‡çº§istio"><a class="header" href="#é‡‘ä¸é›€å‡çº§istio">é‡‘ä¸é›€å‡çº§Istio</a></h4>
<pre><code class="language-bash"># 1. ä¸‹è½½æ–°ç‰ˆæœ¬
istioctl x precheck
istioctl install --set revision=1-20-0

# 2. é€æ­¥è¿ç§»å‘½åç©ºé—´
kubectl label namespace test-ns istio.io/rev=1-20-0 --overwrite
kubectl rollout restart deployment -n test-ns

# 3. éªŒè¯æ–°ç‰ˆæœ¬
istioctl version
istioctl proxy-status

# 4. è¿ç§»æ‰€æœ‰å‘½åç©ºé—´åï¼Œå¸è½½æ—§ç‰ˆæœ¬
istioctl x uninstall --revision=1-19-0
</code></pre>
<h3 id="94-å®‰å…¨åŠ å›º"><a class="header" href="#94-å®‰å…¨åŠ å›º">9.4 å®‰å…¨åŠ å›º</a></h3>
<pre><code class="language-yaml"># 1. å¯ç”¨STRICT mTLS
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: istio-system
spec:
  mtls:
    mode: STRICT

# 2. é»˜è®¤æ‹’ç»æ‰€æœ‰æµé‡
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: deny-all
  namespace: istio-system
spec:
  {}

# 3. é™åˆ¶Egressæµé‡
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
spec:
  meshConfig:
    outboundTrafficPolicy:
      mode: REGISTRY_ONLY  # åªå…è®¸è®¿é—®æ³¨å†Œçš„æœåŠ¡

# 4. å¯ç”¨å®¡è®¡æ—¥å¿—
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: audit-policy
spec:
  action: AUDIT
</code></pre>
<hr />
<h2 id="10-å­¦ä¹ éªŒè¯æ ‡å‡†"><a class="header" href="#10-å­¦ä¹ éªŒè¯æ ‡å‡†">10. å­¦ä¹ éªŒè¯æ ‡å‡†</a></h2>
<p>å®Œæˆæœ¬ç¬”è®°å­¦ä¹ åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š</p>
<h3 id="éªŒè¯æ ‡å‡†1-åŸºç¡€çŸ¥è¯†å¿…é¡»"><a class="header" href="#éªŒè¯æ ‡å‡†1-åŸºç¡€çŸ¥è¯†å¿…é¡»">éªŒè¯æ ‡å‡†1: åŸºç¡€çŸ¥è¯†ï¼ˆå¿…é¡»ï¼‰</a></h3>
<p><strong>æµ‹è¯•ä»»åŠ¡</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
è§£é‡ŠæœåŠ¡ç½‘æ ¼çš„æ¦‚å¿µå’ŒIstioçš„æ ¸å¿ƒä»·å€¼</li>
<li><input disabled="" type="checkbox"/>
æè¿°Istioæ¶æ„ä¸­æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢çš„èŒè´£</li>
<li><input disabled="" type="checkbox"/>
è¯´æ˜Sidecaræ¨¡å¼çš„å·¥ä½œåŸç†</li>
<li><input disabled="" type="checkbox"/>
åœ¨Kubernetesé›†ç¾¤ä¸­æˆåŠŸå®‰è£…Istio</li>
</ul>
<p><strong>éªŒè¯æ–¹å¼</strong>: åœ¨æœ¬åœ°æˆ–äº‘ç¯å¢ƒæ­å»ºIstioï¼Œéƒ¨ç½²ç¤ºä¾‹åº”ç”¨</p>
<h3 id="éªŒè¯æ ‡å‡†2-æµé‡ç®¡ç†å¿…é¡»"><a class="header" href="#éªŒè¯æ ‡å‡†2-æµé‡ç®¡ç†å¿…é¡»">éªŒè¯æ ‡å‡†2: æµé‡ç®¡ç†ï¼ˆå¿…é¡»ï¼‰</a></h3>
<p><strong>æµ‹è¯•ä»»åŠ¡</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
é…ç½®VirtualServiceå®ç°åŸºäºHeaderçš„è·¯ç”±</li>
<li><input disabled="" type="checkbox"/>
ä½¿ç”¨DestinationRuleé…ç½®è´Ÿè½½å‡è¡¡å’Œç†”æ–­</li>
<li><input disabled="" type="checkbox"/>
å®ç°é‡‘ä¸é›€å‘å¸ƒï¼ˆ10% -&gt; 50% -&gt; 100%ï¼‰</li>
<li><input disabled="" type="checkbox"/>
é…ç½®è¶…æ—¶å’Œé‡è¯•ç­–ç•¥</li>
</ul>
<p><strong>éªŒè¯æ–¹å¼</strong>: å®Œæˆä¸€ä¸ªå®Œæ•´çš„ç°åº¦å‘å¸ƒæµç¨‹ï¼Œè§‚å¯Ÿæµé‡åˆ†å¸ƒ</p>
<h3 id="éªŒè¯æ ‡å‡†3-å®‰å…¨æ§åˆ¶å¿…é¡»"><a class="header" href="#éªŒè¯æ ‡å‡†3-å®‰å…¨æ§åˆ¶å¿…é¡»">éªŒè¯æ ‡å‡†3: å®‰å…¨æ§åˆ¶ï¼ˆå¿…é¡»ï¼‰</a></h3>
<p><strong>æµ‹è¯•ä»»åŠ¡</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
å¯ç”¨å…¨å±€mTLS</li>
<li><input disabled="" type="checkbox"/>
é…ç½®åŸºäºå‘½åç©ºé—´çš„è®¿é—®æ§åˆ¶</li>
<li><input disabled="" type="checkbox"/>
å®ç°JWTè®¤è¯</li>
<li><input disabled="" type="checkbox"/>
åˆ›å»ºAuthorizationPolicyé™åˆ¶HTTPæ–¹æ³•</li>
</ul>
<p><strong>éªŒè¯æ–¹å¼</strong>: éªŒè¯æœªæˆæƒè¯·æ±‚è¢«æ‹’ç»ï¼Œæˆæƒè¯·æ±‚å¯ä»¥é€šè¿‡</p>
<h3 id="éªŒè¯æ ‡å‡†4-å¯è§‚æµ‹æ€§æ¨è"><a class="header" href="#éªŒè¯æ ‡å‡†4-å¯è§‚æµ‹æ€§æ¨è">éªŒè¯æ ‡å‡†4: å¯è§‚æµ‹æ€§ï¼ˆæ¨èï¼‰</a></h3>
<p><strong>æµ‹è¯•ä»»åŠ¡</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
æŸ¥çœ‹Prometheusä¸­çš„IstioæŒ‡æ ‡</li>
<li><input disabled="" type="checkbox"/>
ä½¿ç”¨Grafanaåˆ†ææœåŠ¡æ€§èƒ½</li>
<li><input disabled="" type="checkbox"/>
é€šè¿‡Jaegerè¿½è¸ªè¯·æ±‚é“¾è·¯</li>
<li><input disabled="" type="checkbox"/>
ä½¿ç”¨Kialiå¯è§†åŒ–æœåŠ¡æ‹“æ‰‘</li>
</ul>
<p><strong>éªŒè¯æ–¹å¼</strong>: åˆ†æä¸€æ¬¡æ…¢è¯·æ±‚çš„æ ¹å› ï¼Œå®šä½åˆ°å…·ä½“æœåŠ¡</p>
<h3 id="éªŒè¯æ ‡å‡†5-ç”Ÿäº§å®è·µè¿›é˜¶"><a class="header" href="#éªŒè¯æ ‡å‡†5-ç”Ÿäº§å®è·µè¿›é˜¶">éªŒè¯æ ‡å‡†5: ç”Ÿäº§å®è·µï¼ˆè¿›é˜¶ï¼‰</a></h3>
<p><strong>æµ‹è¯•ä»»åŠ¡</strong>:</p>
<ul>
<li><input disabled="" type="checkbox"/>
è¯Šæ–­å¹¶è§£å†³ä¸€ä¸ª503é”™è¯¯</li>
<li><input disabled="" type="checkbox"/>
å®ç°ä¸€ä¸ªå®Œæ•´çš„è“ç»¿éƒ¨ç½²</li>
<li><input disabled="" type="checkbox"/>
é…ç½®æœåŠ¡çš„é™æµå’Œç†”æ–­ç­–ç•¥</li>
<li><input disabled="" type="checkbox"/>
æ‰§è¡ŒIstioç‰ˆæœ¬å‡çº§</li>
</ul>
<p><strong>éªŒè¯æ–¹å¼</strong>: åœ¨æ¨¡æ‹Ÿç”Ÿäº§ç¯å¢ƒä¸­å®Œæˆä»¥ä¸Šä»»åŠ¡</p>
<hr />
<h2 id="11-æ‰©å±•èµ„æº"><a class="header" href="#11-æ‰©å±•èµ„æº">11. æ‰©å±•èµ„æº</a></h2>
<h3 id="å®˜æ–¹æ–‡æ¡£"><a class="header" href="#å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£</a></h3>
<ul>
<li>Istioå®˜æ–¹æ–‡æ¡£: https://istio.io/docs/</li>
<li>Istio GitHub: https://github.com/istio/istio</li>
<li>Envoyæ–‡æ¡£: https://www.envoyproxy.io/docs/</li>
</ul>
<h3 id="æ¨èä¹¦ç±"><a class="header" href="#æ¨èä¹¦ç±">æ¨èä¹¦ç±</a></h3>
<ul>
<li>ã€ŠIstioå®æˆ˜ã€‹</li>
<li>ã€ŠæœåŠ¡ç½‘æ ¼å®è·µæŒ‡å—ã€‹</li>
<li>ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istioã€‹</li>
</ul>
<h3 id="åœ¨çº¿è¯¾ç¨‹"><a class="header" href="#åœ¨çº¿è¯¾ç¨‹">åœ¨çº¿è¯¾ç¨‹</a></h3>
<ul>
<li>Istioå®˜æ–¹Workshop: https://istio.io/learn/</li>
<li>CNCF IstioåŸ¹è®­</li>
<li>Udemy Istioè¯¾ç¨‹</li>
</ul>
<h3 id="ç¤¾åŒºèµ„æº"><a class="header" href="#ç¤¾åŒºèµ„æº">ç¤¾åŒºèµ„æº</a></h3>
<ul>
<li>Istio Slack: https://istio.slack.com</li>
<li>Istio Discuss: https://discuss.istio.io</li>
<li>IstioConå¤§ä¼šè§†é¢‘</li>
</ul>
<h3 id="å®è·µé¡¹ç›®"><a class="header" href="#å®è·µé¡¹ç›®">å®è·µé¡¹ç›®</a></h3>
<ol>
<li>æ­å»ºä¸€ä¸ªå®Œæ•´çš„å¾®æœåŠ¡ç”µå•†ç³»ç»Ÿï¼Œä½¿ç”¨Istioå®ç°æ‰€æœ‰æµé‡ç®¡ç†</li>
<li>å®ç°ä¸€ä¸ªåŸºäºIstioçš„å¤šé›†ç¾¤æœåŠ¡ç½‘æ ¼</li>
<li>å¼€å‘Istioç›‘æ§å‘Šè­¦ç³»ç»Ÿ</li>
</ol>
<h3 id="è¿›é˜¶ä¸»é¢˜"><a class="header" href="#è¿›é˜¶ä¸»é¢˜">è¿›é˜¶ä¸»é¢˜</a></h3>
<ul>
<li>Istioå¤šé›†ç¾¤ç®¡ç†</li>
<li>Istioä¸Service Mesh Interfaceï¼ˆSMIï¼‰</li>
<li>Istioæ€§èƒ½è°ƒä¼˜æ·±å…¥</li>
<li>Istioæ‰©å±•å¼€å‘ï¼ˆWebAssemblyæ’ä»¶ï¼‰</li>
<li>Istioä¸Kubernetes Operatoré›†æˆ</li>
</ul>
<hr />
<h2 id="-å­¦ä¹ è®°å½•"><a class="header" href="#-å­¦ä¹ è®°å½•">ğŸ“ å­¦ä¹ è®°å½•</a></h2>
<p><strong>å»ºè®®</strong>: åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­è®°å½•ä½ çš„å®è·µç¬”è®°ã€é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆã€‚</p>
<pre><code class="language-yaml">å­¦ä¹ æ—¥å¿—æ¨¡æ¿:
  æ—¥æœŸ: 2024-01-15
  å­¦ä¹ å†…å®¹: Istioæµé‡ç®¡ç† - VirtualServiceå’ŒDestinationRule
  å®è·µæ¡ˆä¾‹:
    - å®Œæˆäº†åŸºäºHeaderçš„è·¯ç”±é…ç½®
    - å®ç°äº†reviewsæœåŠ¡çš„é‡‘ä¸é›€å‘å¸ƒ
  é‡åˆ°çš„é—®é¢˜:
    - é…ç½®ä¸ç”Ÿæ•ˆ: åŸå› æ˜¯DestinationRuleä¸­çš„subsetåç§°æ‹¼å†™é”™è¯¯
  å¿ƒå¾—ä½“ä¼š:
    - Istioçš„å£°æ˜å¼é…ç½®éå¸¸å¼ºå¤§ï¼Œä½†éœ€è¦æ³¨æ„é…ç½®çš„éªŒè¯
    - istioctl analyzeå‘½ä»¤éå¸¸æœ‰ç”¨
  ä¸‹ä¸€æ­¥è®¡åˆ’:
    - å­¦ä¹ å®‰å…¨ç›¸å…³é…ç½®
    - ç ”ç©¶mTLSçš„å·¥ä½œåŸç†
</code></pre>
<hr />
<h2 id="-æ€»ç»“"><a class="header" href="#-æ€»ç»“">ğŸ¯ æ€»ç»“</a></h2>
<p>Istioæ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„æœåŠ¡ç½‘æ ¼å¹³å°ï¼Œå®ƒèƒ½å¤Ÿä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ï¼š</p>
<ul>
<li>ğŸš€ æ™ºèƒ½çš„æµé‡ç®¡ç†èƒ½åŠ›</li>
<li>ğŸ”’ å¼ºå¤§çš„å®‰å…¨æ§åˆ¶æœºåˆ¶</li>
<li>ğŸ“Š å…¨é¢çš„å¯è§‚æµ‹æ€§æ”¯æŒ</li>
<li>ğŸ›¡ï¸ çµæ´»çš„ç­–ç•¥æ‰§è¡Œèƒ½åŠ›</li>
</ul>
<p>é€šè¿‡ç³»ç»Ÿå­¦ä¹ æœ¬ç¬”è®°ï¼Œä½ å°†æŒæ¡ä»IstioåŸºç¡€åˆ°ç”Ÿäº§å®è·µçš„å®Œæ•´çŸ¥è¯†ä½“ç³»ã€‚è®°ä½ï¼Œ<strong>å®è·µæ˜¯æœ€å¥½çš„å­¦ä¹ æ–¹å¼</strong>ï¼ŒåŠ¨æ‰‹æ­å»ºç¯å¢ƒã€éƒ¨ç½²åº”ç”¨ã€é…ç½®ç­–ç•¥ï¼Œåœ¨å®è·µä¸­åŠ æ·±ç†è§£ã€‚</p>
<p>ç¥ä½ å­¦ä¹ é¡ºåˆ©ï¼ğŸ‰</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ç¼–ç¨‹/security/ç½‘ç»œæ”»å‡».html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ç¼–ç¨‹/springcloud/springboot.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ç¼–ç¨‹/security/ç½‘ç»œæ”»å‡».html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ç¼–ç¨‹/springcloud/springboot.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

