<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>MicroPython开发完整学习指南 - 开发</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">开发</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="搜索本书内容..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="micropython开发完整学习指南"><a class="header" href="#micropython开发完整学习指南">MicroPython开发完整学习指南</a></h1>
<h2 id="目录"><a class="header" href="#目录">目录</a></h2>
<ul>
<li><a href="#%E7%AC%AC1%E7%AB%A0-micropython%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8">第1章 MicroPython基础入门</a></li>
<li><a href="#%E7%AC%AC2%E7%AB%A0-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">第2章 开发环境搭建</a></li>
<li><a href="#%E7%AC%AC3%E7%AB%A0-python%E8%AF%AD%E8%A8%80%E6%A0%B8%E5%BF%83">第3章 Python语言核心</a></li>
<li><a href="#%E7%AC%AC4%E7%AB%A0-%E7%A1%AC%E4%BB%B6%E6%8E%A7%E5%88%B6%E7%BC%96%E7%A8%8B">第4章 硬件控制编程</a></li>
<li><a href="#%E7%AC%AC5%E7%AB%A0-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B">第5章 网络编程</a></li>
<li><a href="#%E7%AC%AC6%E7%AB%A0-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">第6章 高级特性</a></li>
<li><a href="#%E7%AC%AC7%E7%AB%A0-%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE">第7章 实战项目</a></li>
</ul>
<hr />
<h2 id="前言"><a class="header" href="#前言">前言</a></h2>
<h3 id="学习目标"><a class="header" href="#学习目标">学习目标</a></h3>
<ul>
<li>掌握MicroPython语言特性和应用场景</li>
<li>熟练使用MicroPython进行硬件控制</li>
<li>实现GPIO、I2C、SPI等接口编程</li>
<li>完成物联网和嵌入式项目开发</li>
<li>掌握性能优化和内存管理</li>
</ul>
<h3 id="环境准备"><a class="header" href="#环境准备">环境准备</a></h3>
<ul>
<li>硬件：ESP32/ESP8266/PyBoard/STM32开发板</li>
<li>软件：Thonny IDE、uPyCraft、ampy工具</li>
<li>固件：MicroPython官方固件</li>
<li>工具：串口调试工具、esptool</li>
</ul>
<hr />
<h2 id="第1章-micropython基础入门"><a class="header" href="#第1章-micropython基础入门">第1章 MicroPython基础入门</a></h2>
<h3 id="11-micropython简介"><a class="header" href="#11-micropython简介">1.1 MicroPython简介</a></h3>
<h4 id="111-核心特性"><a class="header" href="#111-核心特性">1.1.1 核心特性</a></h4>
<p><strong>MicroPython是什么：</strong></p>
<ul>
<li>Python 3语言的精简高效实现</li>
<li>专为微控制器和嵌入式系统设计</li>
<li>完整的Python标准库子集</li>
<li>交互式REPL开发环境</li>
<li>低内存占用（最小256KB Flash + 16KB RAM）</li>
</ul>
<p><strong>与CPython的区别：</strong></p>
<pre><code class="language-python"># micropython_features.py - MicroPython特性演示

# 1. 原生代码装饰器
@micropython.native
def fast_calculation(n):
    """使用原生代码加速"""
    result = 0
    for i in range(n):
        result += i * i
    return result

# 2. viper代码生成器（更快）
@micropython.viper
def viper_calculation(n: int) -&gt; int:
    """使用viper编译器极速计算"""
    result = 0
    for i in range(n):
        result += i * i
    return result

# 3. 内存管理
import gc
gc.collect()  # 手动触发垃圾回收
print('Free memory:', gc.mem_free())
print('Allocated:', gc.mem_alloc())

# 4. 紧急异常缓冲区
import micropython
micropython.alloc_emergency_exception_buf(100)
</code></pre>
<h4 id="112-支持的硬件平台"><a class="header" href="#112-支持的硬件平台">1.1.2 支持的硬件平台</a></h4>
<p><strong>主流平台：</strong></p>
<ul>
<li>ESP32/ESP8266 - WiFi/蓝牙物联网</li>
<li>PyBoard - 官方开发板</li>
<li>STM32 - ARM Cortex-M系列</li>
<li>RP2040 - 树莓派Pico</li>
<li>nRF52 - 低功耗蓝牙</li>
</ul>
<pre><code class="language-python"># platform_info.py - 平台信息检测
import sys
import os

def get_platform_info():
    """获取平台信息"""
    info = {
        'platform': sys.platform,
        'version': sys.version,
        'implementation': sys.implementation.name,
    }

    # ESP32平台特定
    if sys.platform == 'esp32':
        import esp
        info['chip_id'] = esp.flash_id()
        info['flash_size'] = esp.flash_size()

    # PyBoard平台特定
    elif sys.platform == 'pyboard':
        import pyb
        info['freq'] = pyb.freq()
        info['unique_id'] = pyb.unique_id()

    return info

# 打印平台信息
for key, value in get_platform_info().items():
    print(f'{key}: {value}')
</code></pre>
<h3 id="12-应用场景"><a class="header" href="#12-应用场景">1.2 应用场景</a></h3>
<pre><code class="language-python"># application_scenarios.py - 应用场景

class IoTSensorNode:
    """物联网传感器节点"""
    def __init__(self):
        print("场景1: IoT传感器节点")
        print("- 温湿度监测")
        print("- 数据采集上传")
        print("- 低功耗运行")
        print("- WiFi/蓝牙通信")

class RoboticsControl:
    """机器人控制"""
    def __init__(self):
        print("场景2: 机器人控制")
        print("- 电机驱动控制")
        print("- 传感器数据融合")
        print("- 实时路径规划")

class HomeAutomation:
    """智能家居"""
    def __init__(self):
        print("场景3: 智能家居")
        print("- 灯光控制")
        print("- 温度调节")
        print("- 安防监控")
</code></pre>
<hr />
<h2 id="第2章-开发环境搭建"><a class="header" href="#第2章-开发环境搭建">第2章 开发环境搭建</a></h2>
<h3 id="21-固件烧录"><a class="header" href="#21-固件烧录">2.1 固件烧录</a></h3>
<h4 id="211-esp32固件烧录"><a class="header" href="#211-esp32固件烧录">2.1.1 ESP32固件烧录</a></h4>
<pre><code class="language-bash"># esp32_flash.sh - ESP32固件烧录脚本

# 1. 安装esptool
pip install esptool

# 2. 擦除Flash
esptool.py --chip esp32 --port /dev/ttyUSB0 erase_flash

# 3. 烧录固件
esptool.py --chip esp32 \
    --port /dev/ttyUSB0 \
    --baud 460800 \
    write_flash -z 0x1000 \
    esp32-20230426-v1.20.0.bin

# 4. 验证
# 串口连接，波特率115200
# 按Ctrl+C进入REPL
</code></pre>
<h3 id="22-开发工具"><a class="header" href="#22-开发工具">2.2 开发工具</a></h3>
<h4 id="221-thonny-ide"><a class="header" href="#221-thonny-ide">2.2.1 Thonny IDE</a></h4>
<pre><code class="language-python"># thonny_setup.py - Thonny配置
"""
Thonny IDE使用：

1. 安装
   - Windows: 下载安装包
   - Linux: sudo apt install thonny
   - Mac: brew install thonny

2. 配置MicroPython
   - 工具 -&gt; 选项 -&gt; 解释器
   - 选择: MicroPython (ESP32)
   - 端口: /dev/ttyUSB0

3. 快捷键
   - F5: 运行
   - Ctrl+D: 软重启
   - Ctrl+C: 中断
"""
</code></pre>
<h4 id="222-ampy工具"><a class="header" href="#222-ampy工具">2.2.2 ampy工具</a></h4>
<pre><code class="language-bash"># ampy_usage.sh - ampy命令

# 安装
pip install adafruit-ampy

# 设置环境变量
export AMPY_PORT=/dev/ttyUSB0
export AMPY_BAUD=115200

# 文件操作
ampy ls                    # 列出文件
ampy put main.py          # 上传文件
ampy get boot.py          # 下载文件
ampy mkdir lib            # 创建目录
ampy rm main.py           # 删除文件
ampy run test.py          # 运行文件
</code></pre>
<h3 id="23-repl交互"><a class="header" href="#23-repl交互">2.3 REPL交互</a></h3>
<pre><code class="language-python"># repl_guide.py - REPL使用指南
"""
REPL快捷键：

Ctrl+C: 中断程序
Ctrl+D: 软重启
Ctrl+E: 粘贴模式
Ctrl+A: 原始REPL
Ctrl+B: 正常REPL

常用命令：
help()              # 帮助
help(modules)       # 模块列表
dir(obj)            # 对象属性
import os
os.listdir('/')     # 列出文件
"""

# 快速测试
def quick_test():
    from machine import Pin
    import time

    led = Pin(2, Pin.OUT)
    for i in range(5):
        led.value(not led.value())
        time.sleep(0.5)
    print("Test OK!")
</code></pre>
<hr />
<h2 id="第3章-python语言核心"><a class="header" href="#第3章-python语言核心">第3章 Python语言核心</a></h2>
<h3 id="31-数据类型与操作"><a class="header" href="#31-数据类型与操作">3.1 数据类型与操作</a></h3>
<pre><code class="language-python"># data_types.py - 数据类型

# 基本类型
number = 42
floating = 3.14
string = "MicroPython"
boolean = True

# 集合类型
list_data = [1, 2, 3, 4, 5]
tuple_data = (1, 2, 3)
dict_data = {'key': 'value', 'count': 10}
set_data = {1, 2, 3, 4, 5}

# 字符串操作
text = "Hello MicroPython"
print(text.upper())           # 大写
print(text.lower())           # 小写
print(text.split())           # 分割
print("-".join(['a','b']))    # 连接

# 列表操作
numbers = [1, 2, 3, 4, 5]
numbers.append(6)             # 添加
numbers.extend([7, 8])        # 扩展
numbers.insert(0, 0)          # 插入
numbers.remove(3)             # 删除
numbers.sort()                # 排序

# 字典操作
config = {'ssid': 'WiFi', 'password': 'pass'}
config['ip'] = '192.168.1.1'  # 添加
value = config.get('ssid')    # 获取
config.update({'port': 80})   # 更新
</code></pre>
<h3 id="32-控制流"><a class="header" href="#32-控制流">3.2 控制流</a></h3>
<pre><code class="language-python"># control_flow.py - 控制流

# 条件判断
value = 10
if value &gt; 15:
    print("大于15")
elif value &gt; 5:
    print("大于5")
else:
    print("小于等于5")

# for循环
for i in range(10):
    print(i)

for item in ['a', 'b', 'c']:
    print(item)

# while循环
count = 0
while count &lt; 5:
    print(count)
    count += 1

# 列表推导式
squares = [x**2 for x in range(10)]
evens = [x for x in range(20) if x % 2 == 0]

# 异常处理
try:
    result = 10 / 0
except ZeroDivisionError as e:
    print(f"错误: {e}")
except Exception as e:
    print(f"其他错误: {e}")
finally:
    print("清理")
</code></pre>
<h3 id="33-函数与模块"><a class="header" href="#33-函数与模块">3.3 函数与模块</a></h3>
<pre><code class="language-python"># functions.py - 函数定义

# 基本函数
def greet(name, greeting="Hello"):
    """问候函数"""
    return f"{greeting}, {name}!"

# 默认参数
def connect_wifi(ssid, password, timeout=10):
    print(f"连接 {ssid}，超时 {timeout}秒")
    return True

# 可变参数
def sum_numbers(*args):
    return sum(args)

def print_info(**kwargs):
    for key, value in kwargs.items():
        print(f"{key}: {value}")

# Lambda函数
square = lambda x: x ** 2
add = lambda x, y: x + y

# 装饰器
def timing_decorator(func):
    def wrapper(*args, **kwargs):
        import time
        start = time.ticks_ms()
        result = func(*args, **kwargs)
        elapsed = time.ticks_diff(time.ticks_ms(), start)
        print(f"{func.__name__} 耗时: {elapsed}ms")
        return result
    return wrapper

@timing_decorator
def slow_function():
    import time
    time.sleep_ms(100)
    return "完成"

# 生成器
def fibonacci(n):
    a, b = 0, 1
    for _ in range(n):
        yield a
        a, b = b, a + b

# 使用生成器
for num in fibonacci(10):
    print(num)
</code></pre>
<h3 id="34-面向对象编程"><a class="header" href="#34-面向对象编程">3.4 面向对象编程</a></h3>
<pre><code class="language-python"># oop.py - 面向对象

# 基础类
class Sensor:
    """传感器基类"""

    def __init__(self, name, pin):
        self.name = name
        self.pin = pin
        self._value = 0

    def read(self):
        raise NotImplementedError("子类必须实现")

    def __str__(self):
        return f"Sensor({self.name}, Pin={self.pin})"

# 继承
class TemperatureSensor(Sensor):
    """温度传感器"""

    def __init__(self, name, pin, unit='C'):
        super().__init__(name, pin)
        self.unit = unit

    def read(self):
        self._value = 25.5  # 示例
        return self._value

    def to_fahrenheit(self):
        if self.unit == 'C':
            return self._value * 9/5 + 32
        return self._value

# 属性装饰器
class Motor:
    """电机控制"""

    def __init__(self):
        self._speed = 0

    @property
    def speed(self):
        return self._speed

    @speed.setter
    def speed(self, value):
        if 0 &lt;= value &lt;= 100:
            self._speed = value
        else:
            raise ValueError("速度范围0-100")

# 静态方法和类方法
class Utils:
    version = "1.0.0"

    @staticmethod
    def celsius_to_fahrenheit(c):
        return c * 9/5 + 32

    @classmethod
    def get_version(cls):
        return cls.version

# 上下文管理器
class FileHandler:
    def __init__(self, filename, mode='r'):
        self.filename = filename
        self.mode = mode

    def __enter__(self):
        self.file = open(self.filename, self.mode)
        return self.file

    def __exit__(self, exc_type, exc_val, exc_tb):
        if self.file:
            self.file.close()
        return False

# 使用
with FileHandler('data.txt', 'w') as f:
    f.write('Hello!')
</code></pre>
<hr />
<h2 id="第4章-硬件控制编程"><a class="header" href="#第4章-硬件控制编程">第4章 硬件控制编程</a></h2>
<h3 id="41-gpio操作"><a class="header" href="#41-gpio操作">4.1 GPIO操作</a></h3>
<pre><code class="language-python"># gpio.py - GPIO控制

from machine import Pin
import time

# GPIO输出
led = Pin(2, Pin.OUT)
led.on()
led.off()
led.value(1)
led.value(not led.value())

# LED闪烁
def blink_led(pin_num, times=10, delay=500):
    led = Pin(pin_num, Pin.OUT)
    for _ in range(times):
        led.on()
        time.sleep_ms(delay)
        led.off()
        time.sleep_ms(delay)

# GPIO输入
button = Pin(0, Pin.IN, Pin.PULL_UP)
state = button.value()

# GPIO中断
button_pressed = False

def button_callback(pin):
    global button_pressed
    button_pressed = True
    print("按钮按下!")

button = Pin(0, Pin.IN, Pin.PULL_UP)
button.irq(trigger=Pin.IRQ_FALLING, handler=button_callback)

# 按钮控制LED类
class ButtonLED:
    def __init__(self, button_pin, led_pin):
        self.button = Pin(button_pin, Pin.IN, Pin.PULL_UP)
        self.led = Pin(led_pin, Pin.OUT)
        self.led_state = False
        self.button.irq(trigger=Pin.IRQ_FALLING,
                       handler=self.toggle_led)

    def toggle_led(self, pin):
        self.led_state = not self.led_state
        self.led.value(self.led_state)
        print(f"LED: {'ON' if self.led_state else 'OFF'}")
</code></pre>
<h3 id="42-pwm控制"><a class="header" href="#42-pwm控制">4.2 PWM控制</a></h3>
<pre><code class="language-python"># pwm.py - PWM控制

from machine import Pin, PWM
import time

# PWM基础
pwm = PWM(Pin(25))
pwm.freq(1000)      # 频率1kHz
pwm.duty(512)       # 占空比50%

# LED呼吸灯
def breathing_led(pin_num, cycles=3):
    pwm = PWM(Pin(pin_num))
    pwm.freq(1000)

    for _ in range(cycles):
        # 渐亮
        for duty in range(0, 1024, 8):
            pwm.duty(duty)
            time.sleep_ms(10)
        # 渐暗
        for duty in range(1023, -1, -8):
            pwm.duty(duty)
            time.sleep_ms(10)

    pwm.deinit()

# 舵机控制
class Servo:
    def __init__(self, pin_num):
        self.pwm = PWM(Pin(pin_num))
        self.pwm.freq(50)

    def set_angle(self, angle):
        """设置角度0-180"""
        if not 0 &lt;= angle &lt;= 180:
            raise ValueError("角度0-180")
        duty = int(40 + (angle / 180) * 75)
        self.pwm.duty(duty)

    def sweep(self, start=0, end=180, step=10):
        for angle in range(start, end + 1, step):
            self.set_angle(angle)
            time.sleep_ms(50)

# 电机控制
class DCMotor:
    def __init__(self, pwm_pin, dir1, dir2):
        self.pwm = PWM(Pin(pwm_pin))
        self.pwm.freq(1000)
        self.dir1 = Pin(dir1, Pin.OUT)
        self.dir2 = Pin(dir2, Pin.OUT)

    def forward(self, speed):
        duty = int((speed / 100) * 1023)
        self.pwm.duty(duty)
        self.dir1.on()
        self.dir2.off()

    def backward(self, speed):
        duty = int((speed / 100) * 1023)
        self.pwm.duty(duty)
        self.dir1.off()
        self.dir2.on()

    def stop(self):
        self.pwm.duty(0)
</code></pre>
<h3 id="43-adc模数转换"><a class="header" href="#43-adc模数转换">4.3 ADC模数转换</a></h3>
<pre><code class="language-python"># adc.py - ADC控制

from machine import Pin, ADC
import time

# ADC基础
adc = ADC(Pin(34))
adc.atten(ADC.ATTN_11DB)    # 0-3.3V
adc.width(ADC.WIDTH_12BIT)  # 12位

raw_value = adc.read()
voltage = (raw_value / 4095) * 3.3

# 电位器
class Potentiometer:
    def __init__(self, pin_num):
        self.adc = ADC(Pin(pin_num))
        self.adc.atten(ADC.ATTN_11DB)
        self.adc.width(ADC.WIDTH_12BIT)

    def read_raw(self):
        return self.adc.read()

    def read_voltage(self):
        return (self.adc.read() / 4095) * 3.3

    def read_percentage(self):
        return (self.adc.read() / 4095) * 100

# 光敏电阻
class LightSensor:
    def __init__(self, pin_num, samples=10):
        self.adc = ADC(Pin(pin_num))
        self.adc.atten(ADC.ATTN_11DB)
        self.adc.width(ADC.WIDTH_12BIT)
        self.samples = samples

    def read(self):
        total = sum(self.adc.read() for _ in range(self.samples))
        return total // self.samples

    def is_dark(self, threshold=500):
        return self.read() &lt; threshold

# 土壤湿度
class SoilMoisture:
    def __init__(self, pin_num, dry=3500, wet=1500):
        self.adc = ADC(Pin(pin_num))
        self.adc.atten(ADC.ATTN_11DB)
        self.adc.width(ADC.WIDTH_12BIT)
        self.dry = dry
        self.wet = wet

    def read_moisture(self):
        value = self.adc.read()
        if value &gt;= self.dry:
            return 0
        if value &lt;= self.wet:
            return 100
        return ((self.dry - value) / (self.dry - self.wet)) * 100
</code></pre>
<h3 id="44-i2c通信"><a class="header" href="#44-i2c通信">4.4 I2C通信</a></h3>
<pre><code class="language-python"># i2c.py - I2C通信

from machine import Pin, I2C
import time

# I2C初始化
i2c = I2C(0, scl=Pin(22), sda=Pin(21), freq=100000)
devices = i2c.scan()

# OLED显示 (SSD1306)
class OLED:
    def __init__(self, width=128, height=64, addr=0x3C):
        self.width = width
        self.height = height
        self.i2c = I2C(0, scl=Pin(22), sda=Pin(21))
        self.addr = addr
        self.buffer = bytearray(height // 8 * width)
        self.init_display()

    def init_display(self):
        for cmd in [0xAE, 0xD5, 0x80, 0xA8, 0x3F, 0xAF]:
            self.write_cmd(cmd)

    def write_cmd(self, cmd):
        self.i2c.writeto(self.addr, bytes([0x00, cmd]))

    def pixel(self, x, y, color=1):
        if 0 &lt;= x &lt; self.width and 0 &lt;= y &lt; self.height:
            page = y // 8
            bit = y % 8
            index = page * self.width + x
            if color:
                self.buffer[index] |= (1 &lt;&lt; bit)
            else:
                self.buffer[index] &amp;= ~(1 &lt;&lt; bit)

# MPU6050加速度计
class MPU6050:
    def __init__(self, addr=0x68):
        self.i2c = I2C(0, scl=Pin(22), sda=Pin(21))
        self.addr = addr
        self.i2c.writeto_mem(self.addr, 0x6B, bytes([0x00]))
        time.sleep_ms(100)

    def read_raw(self, reg):
        high = self.i2c.readfrom_mem(self.addr, reg, 1)[0]
        low = self.i2c.readfrom_mem(self.addr, reg + 1, 1)[0]
        value = (high &lt;&lt; 8) | low
        return value - 65536 if value &gt; 32768 else value

    def get_accel(self):
        ax = self.read_raw(0x3B) / 16384.0
        ay = self.read_raw(0x3D) / 16384.0
        az = self.read_raw(0x3F) / 16384.0
        return ax, ay, az

    def get_temp(self):
        raw = self.read_raw(0x41)
        return raw / 340.0 + 36.53
</code></pre>
<h3 id="45-spi通信"><a class="header" href="#45-spi通信">4.5 SPI通信</a></h3>
<pre><code class="language-python"># spi.py - SPI通信

from machine import Pin, SPI

# SPI初始化
spi = SPI(1, baudrate=1000000, polarity=0, phase=0,
         sck=Pin(18), mosi=Pin(23), miso=Pin(19))

# NRF24L01无线模块
class NRF24L01:
    def __init__(self, spi, cs_pin, ce_pin):
        self.spi = spi
        self.cs = Pin(cs_pin, Pin.OUT, value=1)
        self.ce = Pin(ce_pin, Pin.OUT, value=0)

    def read_reg(self, reg):
        self.cs.value(0)
        self.spi.write(bytes([reg &amp; 0x1F]))
        value = self.spi.read(1)[0]
        self.cs.value(1)
        return value

    def write_reg(self, reg, value):
        self.cs.value(0)
        self.spi.write(bytes([0x20 | (reg &amp; 0x1F), value]))
        self.cs.value(1)

    def send_packet(self, data):
        self.cs.value(0)
        self.spi.write(bytes([0xA0]))
        self.spi.write(data)
        self.cs.value(1)
        self.ce.value(1)
        time.sleep_us(15)
        self.ce.value(0)
</code></pre>
<hr />
<h2 id="第5章-网络编程"><a class="header" href="#第5章-网络编程">第5章 网络编程</a></h2>
<h3 id="51-wifi连接"><a class="header" href="#51-wifi连接">5.1 WiFi连接</a></h3>
<pre><code class="language-python"># wifi.py - WiFi管理

import network
import time

def connect_wifi(ssid, password, timeout=10):
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)

    if not wlan.isconnected():
        print('连接WiFi...')
        wlan.connect(ssid, password)

        start = time.time()
        while not wlan.isconnected():
            if time.time() - start &gt; timeout:
                return False
            time.sleep(0.5)

    print('IP:', wlan.ifconfig()[0])
    return True

class WiFiManager:
    def __init__(self):
        self.wlan = network.WLAN(network.STA_IF)
        self.wlan.active(True)

    def scan(self):
        networks = self.wlan.scan()
        for ssid, bssid, channel, rssi, authmode, hidden in networks:
            print(f"{ssid.decode()} - {rssi}dBm")
        return networks

    def connect(self, ssid, password, timeout=10):
        self.wlan.connect(ssid, password)
        start = time.time()
        while not self.wlan.isconnected():
            if time.time() - start &gt; timeout:
                return False
            time.sleep(0.5)
        print('连接成功:', self.get_ip())
        return True

    def get_ip(self):
        return self.wlan.ifconfig()[0]
</code></pre>
<h3 id="52-http服务器"><a class="header" href="#52-http服务器">5.2 HTTP服务器</a></h3>
<pre><code class="language-python"># http_server.py - HTTP服务器

import socket

class SimpleHTTPServer:
    def __init__(self, port=80):
        self.port = port
        self.routes = {}

    def route(self, path):
        def decorator(func):
            self.routes[path] = func
            return func
        return decorator

    def start(self):
        s = socket.socket()
        s.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
        s.bind(('', self.port))
        s.listen(5)
        print(f'服务器运行: {self.port}')

        while True:
            conn, addr = s.accept()
            request = conn.recv(1024).decode()

            try:
                path = request.split(' ')[1]
                handler = self.routes.get(path, self.not_found)
                response = handler()
            except:
                response = '&lt;h1&gt;500 Error&lt;/h1&gt;'

            conn.send('HTTP/1.0 200 OK\r\n')
            conn.send('Content-Type: text/html\r\n\r\n')
            conn.send(response)
            conn.close()

    def not_found(self):
        return '&lt;h1&gt;404 Not Found&lt;/h1&gt;'

# 使用示例
server = SimpleHTTPServer()

@server.route('/')
def index():
    return '&lt;h1&gt;MicroPython Server&lt;/h1&gt;'

@server.route('/api/temp')
def api_temp():
    return '{"temperature": 25.5}'

# server.start()
</code></pre>
<h3 id="53-mqtt客户端"><a class="header" href="#53-mqtt客户端">5.3 MQTT客户端</a></h3>
<pre><code class="language-python"># mqtt_client.py - MQTT客户端

from umqtt.simple import MQTTClient
import time

class SimpleMQTT:
    def __init__(self, client_id, server, port=1883):
        self.client = MQTTClient(client_id, server, port)
        self.callbacks = {}

    def connect(self):
        self.client.set_callback(self._on_message)
        self.client.connect()
        print('MQTT连接成功')

    def _on_message(self, topic, msg):
        topic = topic.decode()
        msg = msg.decode()
        if topic in self.callbacks:
            self.callbacks[topic](msg)

    def subscribe(self, topic, callback):
        self.client.subscribe(topic)
        self.callbacks[topic] = callback
        print(f'订阅: {topic}')

    def publish(self, topic, msg):
        self.client.publish(topic, msg)

    def check_msg(self):
        self.client.check_msg()

# 使用示例
mqtt = SimpleMQTT('esp32', 'mqtt.example.com')
mqtt.connect()

def on_temp(msg):
    print('温度:', msg)

mqtt.subscribe('home/temp', on_temp)
mqtt.publish('home/status', 'online')

while True:
    mqtt.check_msg()
    time.sleep(1)
</code></pre>
<hr />
<h2 id="第6章-高级特性"><a class="header" href="#第6章-高级特性">第6章 高级特性</a></h2>
<h3 id="61-多线程"><a class="header" href="#61-多线程">6.1 多线程</a></h3>
<pre><code class="language-python"># threading.py - 多线程

import _thread
import time

# 创建线程
def worker(name, delay):
    for i in range(5):
        print(f'{name}: {i}')
        time.sleep(delay)

_thread.start_new_thread(worker, ('Thread-1', 1))
_thread.start_new_thread(worker, ('Thread-2', 1.5))

# 线程锁
lock = _thread.allocate_lock()

def thread_safe():
    lock.acquire()
    try:
        print('临界区')
        time.sleep(1)
    finally:
        lock.release()

# 生产者-消费者
queue = []
queue_lock = _thread.allocate_lock()

def producer():
    for i in range(10):
        queue_lock.acquire()
        queue.append(i)
        print(f'生产: {i}')
        queue_lock.release()
        time.sleep(0.5)

def consumer():
    while True:
        queue_lock.acquire()
        if queue:
            item = queue.pop(0)
            print(f'消费: {item}')
        queue_lock.release()
        time.sleep(1)
</code></pre>
<h3 id="62-内存管理"><a class="header" href="#62-内存管理">6.2 内存管理</a></h3>
<pre><code class="language-python"># memory.py - 内存管理

import gc
import micropython

# 内存信息
def memory_info():
    gc.collect()
    print('空闲:', gc.mem_free())
    print('已分配:', gc.mem_alloc())

# 内存优化
from micropython import const
LED_PIN = const(2)

# 使用bytearray
data = bytearray(100)

# 详细内存信息
micropython.mem_info()

# 性能优化
@micropython.native
def fast_loop(n):
    result = 0
    for i in range(n):
        result += i
    return result

@micropython.viper
def viper_loop(n: int) -&gt; int:
    result = 0
    for i in range(n):
        result += i
    return result
</code></pre>
<hr />
<h2 id="第7章-实战项目"><a class="header" href="#第7章-实战项目">第7章 实战项目</a></h2>
<h3 id="71-智能家居系统"><a class="header" href="#71-智能家居系统">7.1 智能家居系统</a></h3>
<pre><code class="language-python"># smart_home.py - 智能家居

from machine import Pin, ADC
import network
import socket

class SmartHome:
    def __init__(self):
        # 硬件初始化
        self.led = Pin(2, Pin.OUT)
        self.relay = Pin(4, Pin.OUT)
        self.temp = ADC(Pin(34))
        self.temp.atten(ADC.ATTN_11DB)

        # WiFi连接
        self.connect_wifi('SSID', 'password')

        # Web服务器
        self.start_server()

    def connect_wifi(self, ssid, password):
        wlan = network.WLAN(network.STA_IF)
        wlan.active(True)
        wlan.connect(ssid, password)
        while not wlan.isconnected():
            pass
        print('IP:', wlan.ifconfig()[0])

    def read_temp(self):
        raw = self.temp.read()
        voltage = (raw / 4095) * 3.3
        return (voltage - 0.5) * 100

    def start_server(self):
        s = socket.socket()
        s.bind(('', 80))
        s.listen(5)

        while True:
            conn, addr = s.accept()
            request = conn.recv(1024).decode()

            response = self.handle_request(request)

            conn.send('HTTP/1.1 200 OK\n')
            conn.send('Content-Type: text/html\n\n')
            conn.send(response)
            conn.close()

    def handle_request(self, request):
        if '/led/on' in request:
            self.led.on()
            return 'LED ON'
        elif '/led/off' in request:
            self.led.off()
            return 'LED OFF'
        elif '/temp' in request:
            temp = self.read_temp()
            return f'Temp: {temp:.1f}C'
        else:
            return '''
            &lt;html&gt;
            &lt;body&gt;
                &lt;h1&gt;Smart Home&lt;/h1&gt;
                &lt;a href="/led/on"&gt;LED ON&lt;/a&gt;&lt;br&gt;
                &lt;a href="/led/off"&gt;LED OFF&lt;/a&gt;&lt;br&gt;
                &lt;a href="/temp"&gt;Temperature&lt;/a&gt;
            &lt;/body&gt;
            &lt;/html&gt;
            '''

# system = SmartHome()
</code></pre>
<h3 id="72-学习效果验证"><a class="header" href="#72-学习效果验证">7.2 学习效果验证</a></h3>
<p><strong>验证标准：</strong></p>
<ol>
<li>
<p><strong>语言掌握(20分)</strong></p>
<ul>
<li><input disabled="" type="checkbox"/>
Python基础语法</li>
<li><input disabled="" type="checkbox"/>
面向对象编程</li>
<li><input disabled="" type="checkbox"/>
异常处理</li>
</ul>
</li>
<li>
<p><strong>硬件控制(30分)</strong></p>
<ul>
<li><input disabled="" type="checkbox"/>
GPIO操作</li>
<li><input disabled="" type="checkbox"/>
PWM/ADC使用</li>
<li><input disabled="" type="checkbox"/>
I2C/SPI通信</li>
</ul>
</li>
<li>
<p><strong>网络编程(30分)</strong></p>
<ul>
<li><input disabled="" type="checkbox"/>
WiFi连接</li>
<li><input disabled="" type="checkbox"/>
HTTP服务器</li>
<li><input disabled="" type="checkbox"/>
MQTT通信</li>
</ul>
</li>
<li>
<p><strong>项目开发(20分)</strong></p>
<ul>
<li><input disabled="" type="checkbox"/>
完整项目实现</li>
<li><input disabled="" type="checkbox"/>
代码优化</li>
<li><input disabled="" type="checkbox"/>
错误处理</li>
</ul>
</li>
</ol>
<h3 id="73-常见问题"><a class="header" href="#73-常见问题">7.3 常见问题</a></h3>
<p><strong>问题1: 内存不足</strong></p>
<pre><code class="language-python"># 解决方案
import gc
gc.collect()  # 频繁回收
gc.threshold(4096)  # 调整阈值
</code></pre>
<p><strong>问题2: WiFi连接失败</strong></p>
<pre><code class="language-python"># 检查
wlan.active(True)
wlan.disconnect()
wlan.connect(ssid, password)
</code></pre>
<p><strong>问题3: 代码执行慢</strong></p>
<pre><code class="language-python"># 优化
@micropython.native  # 原生代码
@micropython.viper    # Viper编译
</code></pre>
<hr />
<h2 id="总结"><a class="header" href="#总结">总结</a></h2>
<p>通过本指南学习，您已掌握：</p>
<ol>
<li>MicroPython语言特性和开发环境</li>
<li>Python编程基础和面向对象</li>
<li>GPIO、PWM、ADC、I2C、SPI等硬件接口</li>
<li>WiFi网络和HTTP/MQTT协议</li>
<li>多线程和内存管理</li>
<li>完整物联网项目开发</li>
</ol>
<p><strong>进阶方向：</strong></p>
<ul>
<li>深入嵌入式Linux</li>
<li>学习RTOS系统</li>
<li>掌握低功耗设计</li>
<li>AI边缘计算</li>
<li>参与开源项目</li>
</ul>
<p>祝学习愉快！</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../编程/embbed/linux-kernel.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../编程/embbed/stm32.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../编程/embbed/linux-kernel.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../编程/embbed/stm32.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

