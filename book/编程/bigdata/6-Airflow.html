<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Apache Airflow å­¦ä¹ ç¬”è®° - å¼€å‘</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">å¼€å‘</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="æœç´¢æœ¬ä¹¦å†…å®¹..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="apache-airflow-å­¦ä¹ ç¬”è®°"><a class="header" href="#apache-airflow-å­¦ä¹ ç¬”è®°">Apache Airflow å­¦ä¹ ç¬”è®°</a></h1>
<h2 id="-å­¦ä¹ ç›®æ ‡"><a class="header" href="#-å­¦ä¹ ç›®æ ‡">ğŸ“‹ å­¦ä¹ ç›®æ ‡</a></h2>
<ul>
<li>æ·±å…¥ç†è§£Airflowå·¥ä½œæµè°ƒåº¦åŸç†</li>
<li>æŒæ¡DAGå¼€å‘å’Œä»»åŠ¡ç¼–æ’</li>
<li>ç†Ÿç»ƒä½¿ç”¨å„ç±»Operator</li>
<li>ç†è§£è°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨æœºåˆ¶</li>
<li>æŒæ¡é›†ç¾¤éƒ¨ç½²å’Œè¿ç»´ç®¡ç†</li>
<li>å…·å¤‡Airflowç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µèƒ½åŠ›</li>
</ul>
<h2 id="1-airflow-åŸºç¡€æ¦‚å¿µ"><a class="header" href="#1-airflow-åŸºç¡€æ¦‚å¿µ">1. Airflow åŸºç¡€æ¦‚å¿µ</a></h2>
<h3 id="11-ä»€ä¹ˆæ˜¯-apache-airflow"><a class="header" href="#11-ä»€ä¹ˆæ˜¯-apache-airflow">1.1 ä»€ä¹ˆæ˜¯ Apache Airflow</a></h3>
<p>Apache Airflowæ˜¯ä¸€ä¸ªç”¨Pythonç¼–å†™çš„å·¥ä½œæµç¼–æ’å¹³å°,ç”¨äºä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºã€è°ƒåº¦å’Œç›‘æ§å·¥ä½œæµã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹:</strong></p>
<ul>
<li>åŠ¨æ€å·¥ä½œæµå®šä¹‰(ä»£ç å³é…ç½®)</li>
<li>å¯æ‰©å±•çš„æ¶æ„è®¾è®¡</li>
<li>ä¸°å¯Œçš„ç”¨æˆ·ç•Œé¢</li>
<li>å¼ºå¤§çš„è°ƒåº¦èƒ½åŠ›</li>
<li>çµæ´»çš„æ‰§è¡Œå™¨é€‰æ‹©</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯:</strong></p>
<ul>
<li>ETLæ•°æ®ç®¡é“</li>
<li>æœºå™¨å­¦ä¹ å·¥ä½œæµ</li>
<li>æ•°æ®å¤‡ä»½å’ŒåŒæ­¥</li>
<li>å®šæ—¶ä»»åŠ¡è°ƒåº¦</li>
<li>æ‰¹å¤„ç†ä½œä¸šç¼–æ’</li>
</ul>
<h3 id="12-airflow-vs-å…¶ä»–è°ƒåº¦å·¥å…·"><a class="header" href="#12-airflow-vs-å…¶ä»–è°ƒåº¦å·¥å…·">1.2 Airflow vs å…¶ä»–è°ƒåº¦å·¥å…·</a></h3>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>Airflow</th><th>Cron</th><th>Oozie</th><th>Luigi</th></tr></thead><tbody>
<tr><td>åŠ¨æ€å·¥ä½œæµ</td><td>âœ“</td><td>âœ—</td><td>âœ“</td><td>âœ“</td></tr>
<tr><td>Web UI</td><td>âœ“</td><td>âœ—</td><td>âœ“</td><td>âœ“</td></tr>
<tr><td>ä¾èµ–ç®¡ç†</td><td>å¼º</td><td>æ— </td><td>ä¸­</td><td>å¼º</td></tr>
<tr><td>Pythonç¼–å†™</td><td>âœ“</td><td>âœ—</td><td>âœ—</td><td>âœ“</td></tr>
<tr><td>åˆ†å¸ƒå¼</td><td>âœ“</td><td>âœ—</td><td>âœ“</td><td>âœ“</td></tr>
<tr><td>é‡è¯•æœºåˆ¶</td><td>âœ“</td><td>âœ—</td><td>âœ“</td><td>âœ“</td></tr>
</tbody></table>
</div>
<h3 id="13-æ ¸å¿ƒæ¦‚å¿µ"><a class="header" href="#13-æ ¸å¿ƒæ¦‚å¿µ">1.3 æ ¸å¿ƒæ¦‚å¿µ</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Airflowæ¶æ„               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Web Server (Flask)                â”‚
â”‚  â†“                                 â”‚
â”‚  Scheduler â†â†’ Metadata DB          â”‚
â”‚  â†“                                 â”‚
â”‚  Executor                          â”‚
â”‚  â”œâ”€â†’ Worker 1                      â”‚
â”‚  â”œâ”€â†’ Worker 2                      â”‚
â”‚  â””â”€â†’ Worker 3                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒç»„ä»¶:</strong></p>
<ul>
<li><strong>DAG (Directed Acyclic Graph)</strong>: æœ‰å‘æ— ç¯å›¾,å®šä¹‰å·¥ä½œæµ</li>
<li><strong>Task</strong>: DAGä¸­çš„å•ä¸ªä»»åŠ¡èŠ‚ç‚¹</li>
<li><strong>Operator</strong>: å®šä¹‰ä»»åŠ¡æ‰§è¡Œå†…å®¹çš„æ¨¡æ¿</li>
<li><strong>Scheduler</strong>: è´Ÿè´£è§¦å‘è°ƒåº¦çš„DAGå¹¶æäº¤ä»»åŠ¡</li>
<li><strong>Executor</strong>: å¤„ç†ä»»åŠ¡è¿è¡Œçš„ç»„ä»¶</li>
<li><strong>Worker</strong>: å®é™…æ‰§è¡Œä»»åŠ¡çš„è¿›ç¨‹</li>
<li><strong>Metadata Database</strong>: å­˜å‚¨DAGã€ä»»åŠ¡çŠ¶æ€ç­‰å…ƒæ•°æ®</li>
</ul>
<h2 id="2-å®‰è£…ä¸é…ç½®"><a class="header" href="#2-å®‰è£…ä¸é…ç½®">2. å®‰è£…ä¸é…ç½®</a></h2>
<h3 id="21-ç¯å¢ƒå‡†å¤‡"><a class="header" href="#21-ç¯å¢ƒå‡†å¤‡">2.1 ç¯å¢ƒå‡†å¤‡</a></h3>
<p><strong>ç³»ç»Ÿè¦æ±‚:</strong></p>
<ul>
<li>Python 3.7+</li>
<li>æ•°æ®åº“: PostgreSQL/MySQL (ç”Ÿäº§ç¯å¢ƒ)</li>
<li>æœ€å°å†…å­˜: 4GB</li>
</ul>
<h3 id="22-å®‰è£…-airflow"><a class="header" href="#22-å®‰è£…-airflow">2.2 å®‰è£… Airflow</a></h3>
<p><strong>pipå®‰è£…:</strong></p>
<pre><code class="language-bash"># è®¾ç½®Airflow Home
export AIRFLOW_HOME=~/airflow

# å®‰è£…Airflow 2.x
AIRFLOW_VERSION=2.7.0
PYTHON_VERSION="$(python --version | cut -d " " -f 2 | cut -d "." -f 1-2)"
CONSTRAINT_URL="https://raw.githubusercontent.com/apache/airflow/constraints-${AIRFLOW_VERSION}/constraints-${PYTHON_VERSION}.txt"

pip install "apache-airflow==${AIRFLOW_VERSION}" --constraint "${CONSTRAINT_URL}"

# åˆå§‹åŒ–æ•°æ®åº“
airflow db init

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
airflow users create \
    --username admin \
    --firstname Admin \
    --lastname User \
    --role Admin \
    --email admin@example.com

# å¯åŠ¨WebæœåŠ¡å™¨
airflow webserver --port 8080

# å¯åŠ¨è°ƒåº¦å™¨
airflow scheduler
</code></pre>
<p><strong>Docker Composeå®‰è£…:</strong></p>
<pre><code class="language-yaml"># docker-compose.yaml
version: '3'
services:
  postgres:
    image: postgres:13
    environment:
      POSTGRES_USER: airflow
      POSTGRES_PASSWORD: airflow
      POSTGRES_DB: airflow
    volumes:
      - postgres-db-volume:/var/lib/postgresql/data

  redis:
    image: redis:latest

  webserver:
    image: apache/airflow:2.7.0
    depends_on:
      - postgres
      - redis
    environment:
      AIRFLOW__CORE__EXECUTOR: CeleryExecutor
      AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__RESULT_BACKEND: db+postgresql://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__BROKER_URL: redis://:@redis:6379/0
    ports:
      - "8080:8080"
    command: webserver
    volumes:
      - ./dags:/opt/airflow/dags
      - ./logs:/opt/airflow/logs

  scheduler:
    image: apache/airflow:2.7.0
    depends_on:
      - postgres
      - redis
    environment:
      AIRFLOW__CORE__EXECUTOR: CeleryExecutor
      AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__RESULT_BACKEND: db+postgresql://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__BROKER_URL: redis://:@redis:6379/0
    command: scheduler
    volumes:
      - ./dags:/opt/airflow/dags
      - ./logs:/opt/airflow/logs

  worker:
    image: apache/airflow:2.7.0
    depends_on:
      - postgres
      - redis
    environment:
      AIRFLOW__CORE__EXECUTOR: CeleryExecutor
      AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: postgresql+psycopg2://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__RESULT_BACKEND: db+postgresql://airflow:airflow@postgres/airflow
      AIRFLOW__CELERY__BROKER_URL: redis://:@redis:6379/0
    command: celery worker
    volumes:
      - ./dags:/opt/airflow/dags
      - ./logs:/opt/airflow/logs

volumes:
  postgres-db-volume:
</code></pre>
<p><strong>å¯åŠ¨Docker Compose:</strong></p>
<pre><code class="language-bash">docker-compose up -d
</code></pre>
<h3 id="23-é…ç½®æ–‡ä»¶"><a class="header" href="#23-é…ç½®æ–‡ä»¶">2.3 é…ç½®æ–‡ä»¶</a></h3>
<p><strong>airflow.cfgæ ¸å¿ƒé…ç½®:</strong></p>
<pre><code class="language-ini">[core]
# Airflow Homeç›®å½•
dags_folder = /opt/airflow/dags
# DAGæ–‡ä»¶æ‰«æé—´éš”
dag_discovery_safe_mode = True
# æ‰§è¡Œå™¨ç±»å‹
executor = CeleryExecutor
# æ—¶åŒºè®¾ç½®
default_timezone = Asia/Shanghai

[database]
# å…ƒæ•°æ®åº“è¿æ¥
sql_alchemy_conn = postgresql+psycopg2://airflow:airflow@localhost/airflow

[webserver]
# WebæœåŠ¡å™¨ç«¯å£
web_server_port = 8080
# è®¤è¯åç«¯
rbac = True
# åŸºç¡€URL
base_url = http://localhost:8080

[scheduler]
# è°ƒåº¦å™¨å¿ƒè·³é—´éš”
scheduler_heartbeat_sec = 5
# æœ€å¤§çº¿ç¨‹æ•°
max_threads = 2

[celery]
# Celery broker URL
broker_url = redis://localhost:6379/0
# Celeryç»“æœåç«¯
result_backend = db+postgresql://airflow:airflow@localhost/airflow

[smtp]
# é‚®ä»¶é…ç½®
smtp_host = smtp.gmail.com
smtp_starttls = True
smtp_ssl = False
smtp_user = your-email@gmail.com
smtp_password = your-password
smtp_port = 587
smtp_mail_from = your-email@gmail.com
</code></pre>
<h2 id="3-dag-å¼€å‘"><a class="header" href="#3-dag-å¼€å‘">3. DAG å¼€å‘</a></h2>
<h3 id="31-åˆ›å»ºç¬¬ä¸€ä¸ªdag"><a class="header" href="#31-åˆ›å»ºç¬¬ä¸€ä¸ªdag">3.1 åˆ›å»ºç¬¬ä¸€ä¸ªDAG</a></h3>
<pre><code class="language-python">from datetime import datetime, timedelta
from airflow import DAG
from airflow.operators.bash import BashOperator
from airflow.operators.python import PythonOperator

# é»˜è®¤å‚æ•°
default_args = {
    'owner': 'airflow',
    'depends_on_past': False,
    'start_date': datetime(2024, 1, 1),
    'email': ['admin@example.com'],
    'email_on_failure': True,
    'email_on_retry': False,
    'retries': 1,
    'retry_delay': timedelta(minutes=5),
}

# å®šä¹‰DAG
dag = DAG(
    'my_first_dag',
    default_args=default_args,
    description='My first DAG',
    schedule_interval=timedelta(days=1),
    catchup=False,
    tags=['example'],
)

# å®šä¹‰ä»»åŠ¡
t1 = BashOperator(
    task_id='print_date',
    bash_command='date',
    dag=dag,
)

def print_hello():
    print('Hello World!')
    return 'Hello World!'

t2 = PythonOperator(
    task_id='print_hello',
    python_callable=print_hello,
    dag=dag,
)

# è®¾ç½®ä¾èµ–å…³ç³»
t1 &gt;&gt; t2  # t1æ‰§è¡Œå®Œæˆåæ‰§è¡Œt2
</code></pre>
<h3 id="32-å¸¸ç”¨operator"><a class="header" href="#32-å¸¸ç”¨operator">3.2 å¸¸ç”¨Operator</a></h3>
<p><strong>BashOperator:</strong></p>
<pre><code class="language-python">from airflow.operators.bash import BashOperator

bash_task = BashOperator(
    task_id='bash_example',
    bash_command='echo "Processing data..." &amp;&amp; sleep 5',
    dag=dag,
)

# ä½¿ç”¨æ¨¡æ¿
templated_command = """
    echo "Processing date: {{ ds }}"
    echo "Execution date: {{ execution_date }}"
"""

bash_templated = BashOperator(
    task_id='bash_templated',
    bash_command=templated_command,
    dag=dag,
)
</code></pre>
<p><strong>PythonOperator:</strong></p>
<pre><code class="language-python">from airflow.operators.python import PythonOperator

def process_data(ds, **kwargs):
    """å¤„ç†æ•°æ®å‡½æ•°"""
    print(f"Processing data for {ds}")
    # ä¸šåŠ¡é€»è¾‘
    result = {"status": "success", "records": 100}
    return result

python_task = PythonOperator(
    task_id='process_data',
    python_callable=process_data,
    provide_context=True,
    dag=dag,
)
</code></pre>
<p><strong>SQLOperator:</strong></p>
<pre><code class="language-python">from airflow.providers.postgres.operators.postgres import PostgresOperator

sql_task = PostgresOperator(
    task_id='create_table',
    postgres_conn_id='postgres_default',
    sql="""
        CREATE TABLE IF NOT EXISTS users (
            id SERIAL PRIMARY KEY,
            name VARCHAR(100),
            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
        );
    """,
    dag=dag,
)

# ä½¿ç”¨SQLæ–‡ä»¶
sql_file_task = PostgresOperator(
    task_id='insert_data',
    postgres_conn_id='postgres_default',
    sql='sql/insert_users.sql',
    dag=dag,
)
</code></pre>
<p><strong>EmailOperator:</strong></p>
<pre><code class="language-python">from airflow.operators.email import EmailOperator

send_email = EmailOperator(
    task_id='send_email',
    to='user@example.com',
    subject='Airflow Alert - {{ ds }}',
    html_content="""
        &lt;h3&gt;Task Completed&lt;/h3&gt;
        &lt;p&gt;Execution Date: {{ ds }}&lt;/p&gt;
        &lt;p&gt;Task ID: {{ task.task_id }}&lt;/p&gt;
    """,
    dag=dag,
)
</code></pre>
<h3 id="33-ä»»åŠ¡ä¾èµ–å…³ç³»"><a class="header" href="#33-ä»»åŠ¡ä¾èµ–å…³ç³»">3.3 ä»»åŠ¡ä¾èµ–å…³ç³»</a></h3>
<pre><code class="language-python"># æ–¹æ³•1: ä½¿ç”¨ä½ç§»è¿ç®—ç¬¦
task1 &gt;&gt; task2  # task2ä¾èµ–task1
task1 &gt;&gt; [task2, task3]  # task2å’Œtask3éƒ½ä¾èµ–task1
[task1, task2] &gt;&gt; task3  # task3ä¾èµ–task1å’Œtask2

# æ–¹æ³•2: ä½¿ç”¨set_upstream/set_downstream
task2.set_upstream(task1)
task1.set_downstream(task2)

# å¤æ‚ä¾èµ–ç¤ºä¾‹
"""
     t1
    / \
   t2 t3
    \ /
     t4
"""
t1 &gt;&gt; [t2, t3] &gt;&gt; t4

# é“¾å¼ä¾èµ–
from airflow.models.baseoperator import chain

chain(t1, t2, t3, t4)  # t1 &gt;&gt; t2 &gt;&gt; t3 &gt;&gt; t4
</code></pre>
<h3 id="34-xcomé€šä¿¡"><a class="header" href="#34-xcomé€šä¿¡">3.4 XComé€šä¿¡</a></h3>
<pre><code class="language-python">def push_data(**context):
    """æ¨é€æ•°æ®åˆ°XCom"""
    data = {"user_id": 123, "name": "Alice"}
    # æ–¹æ³•1: è¿”å›å€¼è‡ªåŠ¨æ¨é€
    return data

def pull_data(**context):
    """ä»XComæ‹‰å–æ•°æ®"""
    ti = context['task_instance']
    # æ‹‰å–ä¸Šæ¸¸ä»»åŠ¡çš„è¿”å›å€¼
    data = ti.xcom_pull(task_ids='push_task')
    print(f"Received data: {data}")

    # æ‰‹åŠ¨æ¨é€æ•°æ®
    ti.xcom_push(key='processed_data', value={'status': 'done'})

push_task = PythonOperator(
    task_id='push_task',
    python_callable=push_data,
    dag=dag,
)

pull_task = PythonOperator(
    task_id='pull_task',
    python_callable=pull_data,
    provide_context=True,
    dag=dag,
)

push_task &gt;&gt; pull_task
</code></pre>
<h3 id="35-åˆ†æ”¯ä»»åŠ¡"><a class="header" href="#35-åˆ†æ”¯ä»»åŠ¡">3.5 åˆ†æ”¯ä»»åŠ¡</a></h3>
<pre><code class="language-python">from airflow.operators.python import BranchPythonOperator
from airflow.operators.dummy import DummyOperator

def choose_branch(**context):
    """æ ¹æ®æ¡ä»¶é€‰æ‹©åˆ†æ”¯"""
    execution_date = context['execution_date']
    if execution_date.day % 2 == 0:
        return 'even_day_task'
    else:
        return 'odd_day_task'

branching = BranchPythonOperator(
    task_id='branching',
    python_callable=choose_branch,
    provide_context=True,
    dag=dag,
)

even_day = DummyOperator(task_id='even_day_task', dag=dag)
odd_day = DummyOperator(task_id='odd_day_task', dag=dag)
join = DummyOperator(
    task_id='join',
    trigger_rule='none_failed',  # åªè¦æœ‰ä¸€ä¸ªåˆ†æ”¯æˆåŠŸå°±ç»§ç»­
    dag=dag,
)

branching &gt;&gt; [even_day, odd_day] &gt;&gt; join
</code></pre>
<h2 id="4-è°ƒåº¦ä¸æ‰§è¡Œ"><a class="header" href="#4-è°ƒåº¦ä¸æ‰§è¡Œ">4. è°ƒåº¦ä¸æ‰§è¡Œ</a></h2>
<h3 id="41-è°ƒåº¦é…ç½®"><a class="header" href="#41-è°ƒåº¦é…ç½®">4.1 è°ƒåº¦é…ç½®</a></h3>
<p><strong>Cronè¡¨è¾¾å¼:</strong></p>
<pre><code class="language-python"># æ¯å¤©0ç‚¹æ‰§è¡Œ
dag = DAG(
    'daily_job',
    schedule_interval='0 0 * * *',
)

# æ¯å°æ—¶æ‰§è¡Œ
dag = DAG(
    'hourly_job',
    schedule_interval='0 * * * *',
)

# ä½¿ç”¨timedelta
from datetime import timedelta

dag = DAG(
    'interval_job',
    schedule_interval=timedelta(hours=6),
)

# ä½¿ç”¨é¢„è®¾
from airflow.timetables.interval import CronDataIntervalTimetable

dag = DAG(
    'preset_job',
    schedule_interval='@daily',  # @hourly, @daily, @weekly, @monthly, @yearly
)
</code></pre>
<h3 id="42-æ‰§è¡Œå™¨ç±»å‹"><a class="header" href="#42-æ‰§è¡Œå™¨ç±»å‹">4.2 æ‰§è¡Œå™¨ç±»å‹</a></h3>
<p><strong>SequentialExecutor (é»˜è®¤,å¼€å‘ç¯å¢ƒ):</strong></p>
<pre><code class="language-ini">[core]
executor = SequentialExecutor
</code></pre>
<p><strong>LocalExecutor (å•æœºå¤šè¿›ç¨‹):</strong></p>
<pre><code class="language-ini">[core]
executor = LocalExecutor
parallelism = 32
</code></pre>
<p><strong>CeleryExecutor (åˆ†å¸ƒå¼):</strong></p>
<pre><code class="language-ini">[core]
executor = CeleryExecutor

[celery]
broker_url = redis://localhost:6379/0
result_backend = db+postgresql://airflow:airflow@localhost/airflow
worker_concurrency = 16
</code></pre>
<p><strong>KubernetesExecutor (K8sç¯å¢ƒ):</strong></p>
<pre><code class="language-python">from airflow.providers.cncf.kubernetes.operators.kubernetes_pod import KubernetesPodOperator

k8s_task = KubernetesPodOperator(
    task_id='k8s_task',
    namespace='airflow',
    image='python:3.8',
    cmds=['python', '-c'],
    arguments=['print("Hello from Kubernetes!")'],
    name='airflow-k8s-pod',
    get_logs=True,
    dag=dag,
)
</code></pre>
<h3 id="43-å›å¡«backfill"><a class="header" href="#43-å›å¡«backfill">4.3 å›å¡«(Backfill)</a></h3>
<pre><code class="language-bash"># å›å¡«æŒ‡å®šæ—¶é—´æ®µçš„DAG
airflow dags backfill \
    --start-date 2024-01-01 \
    --end-date 2024-01-31 \
    my_dag_id

# é‡æ–°è¿è¡Œå¤±è´¥çš„ä»»åŠ¡
airflow dags backfill \
    --start-date 2024-01-01 \
    --end-date 2024-01-31 \
    --rerun-failed-tasks \
    my_dag_id
</code></pre>
<h2 id="5-ç›‘æ§ä¸ç®¡ç†"><a class="header" href="#5-ç›‘æ§ä¸ç®¡ç†">5. ç›‘æ§ä¸ç®¡ç†</a></h2>
<h3 id="51-web-uiåŠŸèƒ½"><a class="header" href="#51-web-uiåŠŸèƒ½">5.1 Web UIåŠŸèƒ½</a></h3>
<p><strong>ä¸»è¦è§†å›¾:</strong></p>
<ul>
<li>DAGs: æŸ¥çœ‹æ‰€æœ‰DAG</li>
<li>Grid: ç½‘æ ¼è§†å›¾,æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€</li>
<li>Graph: å›¾å½¢è§†å›¾,æŸ¥çœ‹ä»»åŠ¡ä¾èµ–</li>
<li>Gantt: ç”˜ç‰¹å›¾,æŸ¥çœ‹ä»»åŠ¡æ—¶é—´çº¿</li>
<li>Task Duration: ä»»åŠ¡æ‰§è¡Œæ—¶é—´ç»Ÿè®¡</li>
<li>Code: æŸ¥çœ‹DAGæºä»£ç </li>
</ul>
<h3 id="52-å‘½ä»¤è¡Œå·¥å…·"><a class="header" href="#52-å‘½ä»¤è¡Œå·¥å…·">5.2 å‘½ä»¤è¡Œå·¥å…·</a></h3>
<pre><code class="language-bash"># DAGç®¡ç†
airflow dags list
airflow dags show my_dag_id
airflow dags trigger my_dag_id
airflow dags pause my_dag_id
airflow dags unpause my_dag_id
airflow dags delete my_dag_id

# ä»»åŠ¡ç®¡ç†
airflow tasks list my_dag_id
airflow tasks test my_dag_id task_id 2024-01-01
airflow tasks run my_dag_id task_id 2024-01-01

# æŸ¥çœ‹æ—¥å¿—
airflow tasks logs my_dag_id task_id 2024-01-01

# æ¸…ç†æ•°æ®
airflow dags clear my_dag_id --start-date 2024-01-01 --end-date 2024-01-31
</code></pre>
<h3 id="53-ç›‘æ§æŒ‡æ ‡"><a class="header" href="#53-ç›‘æ§æŒ‡æ ‡">5.3 ç›‘æ§æŒ‡æ ‡</a></h3>
<pre><code class="language-python">from airflow.models import DagRun, TaskInstance
from airflow.utils.state import State

# è·å–DAGè¿è¡ŒçŠ¶æ€
dag_runs = DagRun.find(dag_id='my_dag_id')
for run in dag_runs:
    print(f"Run: {run.execution_date}, State: {run.state}")

# è·å–å¤±è´¥ä»»åŠ¡
failed_tasks = TaskInstance.query.filter(
    TaskInstance.state == State.FAILED,
    TaskInstance.dag_id == 'my_dag_id'
).all()

for task in failed_tasks:
    print(f"Task: {task.task_id}, Date: {task.execution_date}")
</code></pre>
<h2 id="6-é«˜çº§ç‰¹æ€§"><a class="header" href="#6-é«˜çº§ç‰¹æ€§">6. é«˜çº§ç‰¹æ€§</a></h2>
<h3 id="61-åŠ¨æ€dagç”Ÿæˆ"><a class="header" href="#61-åŠ¨æ€dagç”Ÿæˆ">6.1 åŠ¨æ€DAGç”Ÿæˆ</a></h3>
<pre><code class="language-python">from airflow import DAG
from airflow.operators.python import PythonOperator
from datetime import datetime

# åŠ¨æ€ç”Ÿæˆå¤šä¸ªDAG
def create_dag(dag_id, schedule, default_args):
    dag = DAG(
        dag_id,
        schedule_interval=schedule,
        default_args=default_args,
    )

    def process_task():
        print(f"Processing {dag_id}")

    task = PythonOperator(
        task_id='process',
        python_callable=process_task,
        dag=dag,
    )

    return dag

# åˆ›å»ºå¤šä¸ªDAG
for i in range(1, 4):
    dag_id = f'dynamic_dag_{i}'
    globals()[dag_id] = create_dag(
        dag_id,
        schedule='@daily',
        default_args={'start_date': datetime(2024, 1, 1)},
    )
</code></pre>
<h3 id="62-jinjaæ¨¡æ¿"><a class="header" href="#62-jinjaæ¨¡æ¿">6.2 Jinjaæ¨¡æ¿</a></h3>
<pre><code class="language-python"># ä½¿ç”¨å†…ç½®å˜é‡
templated_command = """
    echo "Execution date: {{ ds }}"
    echo "Execution date nodash: {{ ds_nodash }}"
    echo "Previous execution date: {{ prev_ds }}"
    echo "Next execution date: {{ next_ds }}"
    echo "DAG run ID: {{ run_id }}"
"""

bash_task = BashOperator(
    task_id='templated_task',
    bash_command=templated_command,
    dag=dag,
)

# è‡ªå®šä¹‰å®
def custom_macro():
    return "Custom Value"

dag = DAG(
    'macro_dag',
    user_defined_macros={
        'custom_func': custom_macro,
    },
)

# åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨
command = "echo {{ custom_func() }}"
</code></pre>
<h3 id="63-sensors"><a class="header" href="#63-sensors">6.3 Sensors</a></h3>
<pre><code class="language-python">from airflow.sensors.filesystem import FileSensor
from airflow.sensors.time_delta import TimeDeltaSensor
from airflow.sensors.python import PythonSensor
from datetime import timedelta

# æ–‡ä»¶ä¼ æ„Ÿå™¨
file_sensor = FileSensor(
    task_id='wait_for_file',
    filepath='/path/to/file.txt',
    poke_interval=30,  # æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    timeout=600,  # 10åˆ†é’Ÿè¶…æ—¶
    dag=dag,
)

# æ—¶é—´å»¶è¿Ÿä¼ æ„Ÿå™¨
time_sensor = TimeDeltaSensor(
    task_id='wait_5_minutes',
    delta=timedelta(minutes=5),
    dag=dag,
)

# è‡ªå®šä¹‰Pythonä¼ æ„Ÿå™¨
def check_condition(**context):
    # è‡ªå®šä¹‰æ£€æŸ¥é€»è¾‘
    import random
    return random.choice([True, False])

python_sensor = PythonSensor(
    task_id='wait_for_condition',
    python_callable=check_condition,
    poke_interval=60,
    timeout=300,
    dag=dag,
)
</code></pre>
<h3 id="64-taskgroup"><a class="header" href="#64-taskgroup">6.4 TaskGroup</a></h3>
<pre><code class="language-python">from airflow.utils.task_group import TaskGroup

with DAG('grouped_dag', start_date=datetime(2024, 1, 1)) as dag:
    start = DummyOperator(task_id='start')

    with TaskGroup('group1', tooltip='First group') as group1:
        task1 = BashOperator(task_id='task1', bash_command='echo "Task 1"')
        task2 = BashOperator(task_id='task2', bash_command='echo "Task 2"')
        task1 &gt;&gt; task2

    with TaskGroup('group2', tooltip='Second group') as group2:
        task3 = BashOperator(task_id='task3', bash_command='echo "Task 3"')
        task4 = BashOperator(task_id='task4', bash_command='echo "Task 4"')
        task3 &gt;&gt; task4

    end = DummyOperator(task_id='end')

    start &gt;&gt; [group1, group2] &gt;&gt; end
</code></pre>
<h2 id="7-é›†æˆæ¡ˆä¾‹"><a class="header" href="#7-é›†æˆæ¡ˆä¾‹">7. é›†æˆæ¡ˆä¾‹</a></h2>
<h3 id="71-sparké›†æˆ"><a class="header" href="#71-sparké›†æˆ">7.1 Sparké›†æˆ</a></h3>
<pre><code class="language-python">from airflow.providers.apache.spark.operators.spark_submit import SparkSubmitOperator

spark_task = SparkSubmitOperator(
    task_id='spark_job',
    application='/path/to/spark_job.py',
    conn_id='spark_default',
    total_executor_cores=4,
    executor_memory='2g',
    driver_memory='1g',
    application_args=['--input', '/data/input', '--output', '/data/output'],
    dag=dag,
)
</code></pre>
<h3 id="72-æ•°æ®åº“æ“ä½œ"><a class="header" href="#72-æ•°æ®åº“æ“ä½œ">7.2 æ•°æ®åº“æ“ä½œ</a></h3>
<pre><code class="language-python">from airflow.providers.mysql.operators.mysql import MySqlOperator
from airflow.providers.postgres.operators.postgres import PostgresOperator

mysql_task = MySqlOperator(
    task_id='mysql_query',
    mysql_conn_id='mysql_default',
    sql="""
        SELECT * FROM users
        WHERE created_at &gt;= '{{ ds }}'
    """,
    dag=dag,
)

postgres_task = PostgresOperator(
    task_id='postgres_insert',
    postgres_conn_id='postgres_default',
    sql="""
        INSERT INTO processed_data (date, count)
        VALUES ('{{ ds }}', {{ task_instance.xcom_pull(task_ids='count_task') }})
    """,
    dag=dag,
)
</code></pre>
<h3 id="73-apiè°ƒç”¨"><a class="header" href="#73-apiè°ƒç”¨">7.3 APIè°ƒç”¨</a></h3>
<pre><code class="language-python">from airflow.providers.http.operators.http import SimpleHttpOperator
import json

api_task = SimpleHttpOperator(
    task_id='call_api',
    http_conn_id='my_api_connection',
    endpoint='/api/v1/data',
    method='POST',
    headers={'Content-Type': 'application/json'},
    data=json.dumps({
        'date': '{{ ds }}',
        'type': 'batch'
    }),
    response_check=lambda response: response.status_code == 200,
    dag=dag,
)
</code></pre>
<h2 id="8-æœ€ä½³å®è·µ"><a class="header" href="#8-æœ€ä½³å®è·µ">8. æœ€ä½³å®è·µ</a></h2>
<h3 id="81-å¼€å‘è§„èŒƒ"><a class="header" href="#81-å¼€å‘è§„èŒƒ">8.1 å¼€å‘è§„èŒƒ</a></h3>
<pre><code class="language-python"># 1. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿä¿¡æ¯
from airflow.models import Variable

api_key = Variable.get("API_KEY")
db_password = Variable.get("DB_PASSWORD")

# 2. åˆç†è®¾ç½®é‡è¯•ç­–ç•¥
default_args = {
    'retries': 3,
    'retry_delay': timedelta(minutes=5),
    'retry_exponential_backoff': True,
    'max_retry_delay': timedelta(minutes=30),
}

# 3. ä½¿ç”¨Poolsæ§åˆ¶å¹¶å‘
# Web UI: Admin -&gt; Pools
# åœ¨Operatorä¸­ä½¿ç”¨
task = BashOperator(
    task_id='pooled_task',
    bash_command='echo "Using pool"',
    pool='my_pool',
    dag=dag,
)

# 4. åˆç†è®¾ç½®è¶…æ—¶
task = BashOperator(
    task_id='timeout_task',
    bash_command='sleep 300',
    execution_timeout=timedelta(minutes=10),
    dag=dag,
)
</code></pre>
<h3 id="82-æ€§èƒ½ä¼˜åŒ–"><a class="header" href="#82-æ€§èƒ½ä¼˜åŒ–">8.2 æ€§èƒ½ä¼˜åŒ–</a></h3>
<pre><code class="language-python"># 1. å‡å°‘DAGè§£ææ—¶é—´
# - é¿å…åœ¨DAGæ–‡ä»¶é¡¶å±‚æ‰§è¡Œè€—æ—¶æ“ä½œ
# - ä½¿ç”¨dag_discovery_safe_mode = False (è°¨æ…ä½¿ç”¨)

# 2. ä¼˜åŒ–ä»»åŠ¡å¹¶è¡Œåº¦
dag = DAG(
    'optimized_dag',
    max_active_runs=3,  # é™åˆ¶å¹¶å‘è¿è¡Œæ•°
    concurrency=10,  # é™åˆ¶å¹¶å‘ä»»åŠ¡æ•°
)

# 3. ä½¿ç”¨åˆé€‚çš„æ‰§è¡Œå™¨
# ç”Ÿäº§ç¯å¢ƒæ¨èCeleryExecutoræˆ–KubernetesExecutor

# 4. æ¸…ç†æ—§æ•°æ®
# airflow.cfgé…ç½®
# [core]
# max_active_runs_per_dag = 16
</code></pre>
<h3 id="83-é”™è¯¯å¤„ç†"><a class="header" href="#83-é”™è¯¯å¤„ç†">8.3 é”™è¯¯å¤„ç†</a></h3>
<pre><code class="language-python">def error_callback(context):
    """ä»»åŠ¡å¤±è´¥å›è°ƒ"""
    task_instance = context['task_instance']
    print(f"Task {task_instance.task_id} failed")
    # å‘é€å‘Šè­¦é€šçŸ¥
    send_alert(f"Task Failed: {task_instance.task_id}")

task = PythonOperator(
    task_id='task_with_callback',
    python_callable=my_function,
    on_failure_callback=error_callback,
    on_success_callback=success_callback,
    on_retry_callback=retry_callback,
    dag=dag,
)

# ä½¿ç”¨try-exceptå¤„ç†å¼‚å¸¸
def safe_task(**context):
    try:
        # ä¸šåŠ¡é€»è¾‘
        result = process_data()
        return result
    except Exception as e:
        # è®°å½•é”™è¯¯
        print(f"Error: {str(e)}")
        # é‡æ–°æŠ›å‡ºä»¥è§¦å‘é‡è¯•
        raise
</code></pre>
<h2 id="9-æ•…éšœæ’æŸ¥"><a class="header" href="#9-æ•…éšœæ’æŸ¥">9. æ•…éšœæ’æŸ¥</a></h2>
<h3 id="91-å¸¸è§é—®é¢˜"><a class="header" href="#91-å¸¸è§é—®é¢˜">9.1 å¸¸è§é—®é¢˜</a></h3>
<p><strong>é—®é¢˜1: DAGæœªå‡ºç°åœ¨UI</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥DAGæ–‡ä»¶è¯­æ³•é”™è¯¯
python /path/to/dag_file.py

# æŸ¥çœ‹DAGå¯¼å…¥é”™è¯¯
airflow dags list-import-errors

# æ£€æŸ¥DAGç›®å½•é…ç½®
airflow config get-value core dags_folder
</code></pre>
<p><strong>é—®é¢˜2: ä»»åŠ¡ä¸€ç›´å¤„äºé˜Ÿåˆ—çŠ¶æ€</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥Workeræ˜¯å¦è¿è¡Œ
airflow celery worker --help
ps aux | grep "airflow worker"

# æ£€æŸ¥èµ„æºæ± é…ç½®
# Web UI: Admin -&gt; Pools

# æŸ¥çœ‹ä»»åŠ¡é˜Ÿåˆ—
airflow tasks states-for-dag-run my_dag_id 2024-01-01
</code></pre>
<p><strong>é—®é¢˜3: è°ƒåº¦å™¨ä¸å·¥ä½œ</strong></p>
<pre><code class="language-bash"># æ£€æŸ¥è°ƒåº¦å™¨æ—¥å¿—
tail -f $AIRFLOW_HOME/logs/scheduler/latest/*.log

# é‡å¯è°ƒåº¦å™¨
pkill -f "airflow scheduler"
airflow scheduler -D
</code></pre>
<h3 id="92-æ—¥å¿—ç®¡ç†"><a class="header" href="#92-æ—¥å¿—ç®¡ç†">9.2 æ—¥å¿—ç®¡ç†</a></h3>
<pre><code class="language-python"># é…ç½®æ—¥å¿—çº§åˆ«
# airflow.cfg
[logging]
base_log_folder = /opt/airflow/logs
logging_level = INFO
fab_logging_level = WARN

# è‡ªå®šä¹‰æ—¥å¿—
import logging

logger = logging.getLogger(__name__)

def my_task(**context):
    logger.info("Task started")
    logger.debug("Debug information")
    logger.error("Error occurred")
</code></pre>
<h2 id="10-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²"><a class="header" href="#10-ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²">10. ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²</a></h2>
<h3 id="101-é«˜å¯ç”¨é…ç½®"><a class="header" href="#101-é«˜å¯ç”¨é…ç½®">10.1 é«˜å¯ç”¨é…ç½®</a></h3>
<pre><code class="language-yaml"># ä½¿ç”¨PostgreSQLä½œä¸ºå…ƒæ•°æ®åº“
[database]
sql_alchemy_conn = postgresql+psycopg2://user:pass@localhost:5432/airflow
sql_alchemy_pool_size = 10
sql_alchemy_max_overflow = 20

# ä½¿ç”¨Redisä½œä¸ºCelery Broker
[celery]
broker_url = redis://:password@redis-host:6379/0
result_backend = db+postgresql://user:pass@localhost:5432/airflow

# å¯åŠ¨å¤šä¸ªWorker
celery worker -q queue1
celery worker -q queue2
celery worker -q default
</code></pre>
<h3 id="102-ç›‘æ§å‘Šè­¦"><a class="header" href="#102-ç›‘æ§å‘Šè­¦">10.2 ç›‘æ§å‘Šè­¦</a></h3>
<pre><code class="language-python"># ä½¿ç”¨Prometheusç›‘æ§
from airflow.providers.prometheus.operators.prometheus import PrometheusMetric

# å¥åº·æ£€æŸ¥ç«¯ç‚¹
# http://airflow-webserver:8080/health

# è‡ªå®šä¹‰ç›‘æ§
from airflow.stats import Stats

def monitored_task(**context):
    Stats.incr('custom.task.executed')
    Stats.gauge('custom.records.processed', 1000)
    Stats.timing('custom.task.duration', 123.45)
</code></pre>
<h2 id="11-å­¦ä¹ éªŒè¯æ ‡å‡†"><a class="header" href="#11-å­¦ä¹ éªŒè¯æ ‡å‡†">11. å­¦ä¹ éªŒè¯æ ‡å‡†</a></h2>
<h3 id="-åŸºç¡€èƒ½åŠ›éªŒè¯"><a class="header" href="#-åŸºç¡€èƒ½åŠ›éªŒè¯">âœ… åŸºç¡€èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
ç†è§£Airflowæ¶æ„å’Œæ ¸å¿ƒæ¦‚å¿µ</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿå®‰è£…é…ç½®Airflowç¯å¢ƒ</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿç¼–å†™ç®€å•çš„DAG</li>
<li><input disabled="" type="checkbox"/>
æŒæ¡å¸¸ç”¨Operatorçš„ä½¿ç”¨</li>
</ul>
<h3 id="-è¿›é˜¶èƒ½åŠ›éªŒè¯"><a class="header" href="#-è¿›é˜¶èƒ½åŠ›éªŒè¯">âœ… è¿›é˜¶èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè®¾è®¡å¤æ‚çš„å·¥ä½œæµ</li>
<li><input disabled="" type="checkbox"/>
æŒæ¡ä»»åŠ¡ä¾èµ–å’Œåˆ†æ”¯é€»è¾‘</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿä½¿ç”¨Sensorså’ŒåŠ¨æ€DAG</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè¿›è¡ŒåŸºæœ¬çš„æ•…éšœæ’æŸ¥</li>
</ul>
<h3 id="-é«˜çº§èƒ½åŠ›éªŒè¯"><a class="header" href="#-é«˜çº§èƒ½åŠ›éªŒè¯">âœ… é«˜çº§èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿéƒ¨ç½²ç”Ÿäº§çº§Airflowé›†ç¾¤</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿå¼€å‘è‡ªå®šä¹‰Operatorå’ŒPlugin</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè¿›è¡Œæ€§èƒ½è°ƒä¼˜</li>
<li><input disabled="" type="checkbox"/>
å…·å¤‡ç”Ÿäº§ç¯å¢ƒè¿ç»´èƒ½åŠ›</li>
</ul>
<h2 id="12-æ‰©å±•èµ„æº"><a class="header" href="#12-æ‰©å±•èµ„æº">12. æ‰©å±•èµ„æº</a></h2>
<h3 id="å®˜æ–¹èµ„æº"><a class="header" href="#å®˜æ–¹èµ„æº">å®˜æ–¹èµ„æº</a></h3>
<ul>
<li>å®˜ç½‘: https://airflow.apache.org/</li>
<li>æ–‡æ¡£: https://airflow.apache.org/docs/</li>
<li>GitHub: https://github.com/apache/airflow</li>
</ul>
<h3 id="å­¦ä¹ å»ºè®®"><a class="header" href="#å­¦ä¹ å»ºè®®">å­¦ä¹ å»ºè®®</a></h3>
<ol>
<li>ä»ç®€å•DAGå¼€å§‹å®è·µ</li>
<li>ç†è§£è°ƒåº¦å™¨å’Œæ‰§è¡Œå™¨åŸç†</li>
<li>æŒæ¡å„ç±»Operatorä½¿ç”¨</li>
<li>å­¦ä¹ é›†ç¾¤éƒ¨ç½²å’Œè¿ç»´</li>
<li>å®è·µç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µ</li>
</ol>
<h3 id="è¿›é˜¶æ–¹å‘"><a class="header" href="#è¿›é˜¶æ–¹å‘">è¿›é˜¶æ–¹å‘</a></h3>
<ul>
<li>è‡ªå®šä¹‰Operatorå’ŒPluginå¼€å‘</li>
<li>Kubernetes Executorä¼˜åŒ–</li>
<li>å®æ—¶æ•°æ®æµé›†æˆ</li>
<li>æœºå™¨å­¦ä¹ å·¥ä½œæµç¼–æ’</li>
<li>äº‘åŸç”Ÿéƒ¨ç½²(AWS MWAA/GCP Composer)</li>
</ul>
<h3 id="ç›¸å…³æŠ€æœ¯"><a class="header" href="#ç›¸å…³æŠ€æœ¯">ç›¸å…³æŠ€æœ¯</a></h3>
<ul>
<li>Celery: åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—</li>
<li>Redis: æ¶ˆæ¯ä»£ç†</li>
<li>PostgreSQL: å…ƒæ•°æ®å­˜å‚¨</li>
<li>Kubernetes: å®¹å™¨ç¼–æ’</li>
</ul>
<h3 id="æ¨èä¹¦ç±"><a class="header" href="#æ¨èä¹¦ç±">æ¨èä¹¦ç±</a></h3>
<ul>
<li>Data Pipelines with Apache Airflow</li>
<li>Apache Airflowå®æˆ˜æŒ‡å—</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ç¼–ç¨‹/bigdata/5-ElasticSearch.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ç¼–ç¨‹/bigdata/7-HBase.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ç¼–ç¨‹/bigdata/5-ElasticSearch.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ç¼–ç¨‹/bigdata/7-HBase.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

