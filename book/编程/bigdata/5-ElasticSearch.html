<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Elasticsearch å­¦ä¹ ç¬”è®° - å¼€å‘</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>â†</kbd> or <kbd>â†’</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">å¼€å‘</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="æœç´¢æœ¬ä¹¦å†…å®¹..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="elasticsearch-å­¦ä¹ ç¬”è®°"><a class="header" href="#elasticsearch-å­¦ä¹ ç¬”è®°">Elasticsearch å­¦ä¹ ç¬”è®°</a></h1>
<h2 id="-å­¦ä¹ ç›®æ ‡"><a class="header" href="#-å­¦ä¹ ç›®æ ‡">ğŸ“‹ å­¦ä¹ ç›®æ ‡</a></h2>
<ul>
<li>æ·±å…¥ç†è§£Elasticsearchæ¶æ„å’Œæ ¸å¿ƒæ¦‚å¿µ</li>
<li>æŒæ¡ç´¢å¼•ã€æ–‡æ¡£å’Œæ˜ å°„ç®¡ç†</li>
<li>ç†Ÿç»ƒä½¿ç”¨DSLæŸ¥è¯¢è¯­è¨€è¿›è¡Œæœç´¢</li>
<li>ç†è§£èšåˆåˆ†æå’Œæ•°æ®å»ºæ¨¡</li>
<li>æŒæ¡æ€§èƒ½è°ƒä¼˜å’Œé›†ç¾¤ç®¡ç†</li>
<li>å…·å¤‡Elasticsearchç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œè¿ç»´èƒ½åŠ›</li>
</ul>
<h2 id="1-elasticsearch-åŸºç¡€æ¦‚å¿µ"><a class="header" href="#1-elasticsearch-åŸºç¡€æ¦‚å¿µ">1. Elasticsearch åŸºç¡€æ¦‚å¿µ</a></h2>
<h3 id="11-ä»€ä¹ˆæ˜¯-elasticsearch"><a class="header" href="#11-ä»€ä¹ˆæ˜¯-elasticsearch">1.1 ä»€ä¹ˆæ˜¯ Elasticsearch</a></h3>
<p>Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„åˆ†å¸ƒå¼æœç´¢å’Œåˆ†æå¼•æ“,ç”¨äºå…¨æ–‡æœç´¢ã€ç»“æ„åŒ–æœç´¢ã€åˆ†æä»¥åŠè¿™ä¸‰ä¸ªåŠŸèƒ½çš„ç»„åˆã€‚</p>
<p><strong>æ ¸å¿ƒç‰¹ç‚¹:</strong></p>
<ul>
<li>åˆ†å¸ƒå¼å®æ—¶æ–‡ä»¶å­˜å‚¨</li>
<li>åˆ†å¸ƒå¼å®æ—¶åˆ†ææœç´¢å¼•æ“</li>
<li>èƒ½å¤Ÿæ‰©å±•åˆ°ä¸Šç™¾å°æœåŠ¡å™¨</li>
<li>å¤„ç†PBçº§åˆ«çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®</li>
<li>RESTful APIæ¥å£</li>
</ul>
<p><strong>åº”ç”¨åœºæ™¯:</strong></p>
<ul>
<li>æ—¥å¿—å’Œäº‹ä»¶æ•°æ®åˆ†æ</li>
<li>å…¨æ–‡æœç´¢å¼•æ“</li>
<li>å®æ—¶åº”ç”¨ç›‘æ§</li>
<li>å®‰å…¨åˆ†æ</li>
<li>ä¸šåŠ¡åˆ†æå’Œå¯è§†åŒ–</li>
</ul>
<h3 id="12-elasticsearch-vs-ä¼ ç»Ÿæ•°æ®åº“"><a class="header" href="#12-elasticsearch-vs-ä¼ ç»Ÿæ•°æ®åº“">1.2 Elasticsearch vs ä¼ ç»Ÿæ•°æ®åº“</a></h3>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>Elasticsearch</th><th>MySQL</th><th>MongoDB</th></tr></thead><tbody>
<tr><td>æ•°æ®æ¨¡å‹</td><td>æ–‡æ¡£å‹</td><td>å…³ç³»å‹</td><td>æ–‡æ¡£å‹</td></tr>
<tr><td>æœç´¢èƒ½åŠ›</td><td>å¼º</td><td>å¼±</td><td>ä¸­</td></tr>
<tr><td>åˆ†å¸ƒå¼</td><td>åŸç”Ÿæ”¯æŒ</td><td>éœ€è¦ä¸­é—´ä»¶</td><td>åŸç”Ÿæ”¯æŒ</td></tr>
<tr><td>èšåˆåˆ†æ</td><td>å¼º</td><td>SQLèšåˆ</td><td>èšåˆç®¡é“</td></tr>
<tr><td>æ‰©å±•æ€§</td><td>æ°´å¹³æ‰©å±•</td><td>å‚ç›´æ‰©å±•</td><td>æ°´å¹³æ‰©å±•</td></tr>
<tr><td>äº‹åŠ¡æ”¯æŒ</td><td>æ— </td><td>å¼º</td><td>æœ‰é™</td></tr>
</tbody></table>
</div>
<h3 id="13-æ ¸å¿ƒæ¦‚å¿µ"><a class="header" href="#13-æ ¸å¿ƒæ¦‚å¿µ">1.3 æ ¸å¿ƒæ¦‚å¿µ</a></h3>
<pre><code>Elasticsearch      å…³ç³»æ•°æ®åº“
------------------------
Index           â†’  Database
Type (å·²åºŸå¼ƒ)   â†’  Table
Document        â†’  Row
Field           â†’  Column
Mapping         â†’  Schema
</code></pre>
<p><strong>æ ¸å¿ƒç»„ä»¶:</strong></p>
<ul>
<li><strong>Index (ç´¢å¼•)</strong>: ç±»ä¼¼äºæ•°æ®åº“,å­˜å‚¨ç›¸å…³æ–‡æ¡£çš„é›†åˆ</li>
<li><strong>Document (æ–‡æ¡£)</strong>: åŸºæœ¬æ•°æ®å•å…ƒ,JSONæ ¼å¼</li>
<li><strong>Field (å­—æ®µ)</strong>: æ–‡æ¡£ä¸­çš„é”®å€¼å¯¹</li>
<li><strong>Mapping (æ˜ å°„)</strong>: å®šä¹‰æ–‡æ¡£å­—æ®µç±»å‹å’Œå±æ€§</li>
<li><strong>Shard (åˆ†ç‰‡)</strong>: ç´¢å¼•çš„æ°´å¹³åˆ†å‰²</li>
<li><strong>Replica (å‰¯æœ¬)</strong>: åˆ†ç‰‡çš„å¤‡ä»½</li>
</ul>
<h3 id="14-æ¶æ„è®¾è®¡"><a class="header" href="#14-æ¶æ„è®¾è®¡">1.4 æ¶æ„è®¾è®¡</a></h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Elasticsearch Cluster         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Node 1 â”‚   â”‚ Node 2 â”‚   â”‚ Node 3 â”‚  â”‚
â”‚  â”‚(Master)â”‚   â”‚ (Data) â”‚   â”‚ (Data) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Index (ç´¢å¼•)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Shard 0  â”‚  â”‚ Shard 1  â”‚            â”‚
â”‚  â”‚(Primary) â”‚  â”‚(Primary) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Shard 0  â”‚  â”‚ Shard 1  â”‚            â”‚
â”‚  â”‚(Replica) â”‚  â”‚(Replica) â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>èŠ‚ç‚¹ç±»å‹:</strong></p>
<ul>
<li><strong>MasterèŠ‚ç‚¹</strong>: é›†ç¾¤ç®¡ç†ã€ç´¢å¼•åˆ›å»º/åˆ é™¤</li>
<li><strong>DataèŠ‚ç‚¹</strong>: å­˜å‚¨æ•°æ®ã€æ‰§è¡Œæœç´¢å’Œèšåˆ</li>
<li><strong>CoordinatingèŠ‚ç‚¹</strong>: è·¯ç”±è¯·æ±‚ã€åˆå¹¶ç»“æœ</li>
<li><strong>IngestèŠ‚ç‚¹</strong>: æ•°æ®é¢„å¤„ç†ç®¡é“</li>
</ul>
<h2 id="2-å®‰è£…ä¸é…ç½®"><a class="header" href="#2-å®‰è£…ä¸é…ç½®">2. å®‰è£…ä¸é…ç½®</a></h2>
<h3 id="21-ç¯å¢ƒè¦æ±‚"><a class="header" href="#21-ç¯å¢ƒè¦æ±‚">2.1 ç¯å¢ƒè¦æ±‚</a></h3>
<ul>
<li>Java 11+ (æ¨èä½¿ç”¨ESè‡ªå¸¦çš„JDK)</li>
<li>æœ€å°å†…å­˜: 2GB</li>
<li>æ¨èå†…å­˜: 4GB+</li>
<li>æ“ä½œç³»ç»Ÿ: Linux/Windows/MacOS</li>
</ul>
<h3 id="22-å•æœºå®‰è£…"><a class="header" href="#22-å•æœºå®‰è£…">2.2 å•æœºå®‰è£…</a></h3>
<p><strong>ä¸‹è½½å®‰è£…:</strong></p>
<pre><code class="language-bash"># ä¸‹è½½Elasticsearch 8.x
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.11.0-linux-x86_64.tar.gz

# è§£å‹
tar -xzf elasticsearch-8.11.0-linux-x86_64.tar.gz
cd elasticsearch-8.11.0

# å¯åŠ¨
./bin/elasticsearch

# åå°å¯åŠ¨
./bin/elasticsearch -d -p pid
</code></pre>
<p><strong>éªŒè¯å®‰è£…:</strong></p>
<pre><code class="language-bash"># æŸ¥çœ‹é›†ç¾¤å¥åº·çŠ¶æ€
curl -X GET "localhost:9200/_cluster/health?pretty"

# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯
curl -X GET "localhost:9200/_cat/nodes?v"
</code></pre>
<h3 id="23-é…ç½®æ–‡ä»¶"><a class="header" href="#23-é…ç½®æ–‡ä»¶">2.3 é…ç½®æ–‡ä»¶</a></h3>
<p><strong>config/elasticsearch.yml:</strong></p>
<pre><code class="language-yaml"># é›†ç¾¤åç§°
cluster.name: my-application

# èŠ‚ç‚¹åç§°
node.name: node-1

# æ•°æ®å’Œæ—¥å¿—è·¯å¾„
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch

# ç½‘ç»œé…ç½®
network.host: 0.0.0.0
http.port: 9200
transport.port: 9300

# é›†ç¾¤å‘ç°
discovery.seed_hosts: ["host1", "host2"]
cluster.initial_master_nodes: ["node-1", "node-2"]

# å†…å­˜é”å®š
bootstrap.memory_lock: true

# å®‰å…¨é…ç½®
xpack.security.enabled: true
xpack.security.transport.ssl.enabled: true
</code></pre>
<p><strong>config/jvm.options:</strong></p>
<pre><code># å †å†…å­˜é…ç½®(è®¾ç½®ä¸ºç›¸åŒå€¼)
-Xms4g
-Xmx4g

# GCé…ç½®
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
</code></pre>
<h3 id="24-é›†ç¾¤éƒ¨ç½²"><a class="header" href="#24-é›†ç¾¤éƒ¨ç½²">2.4 é›†ç¾¤éƒ¨ç½²</a></h3>
<p><strong>ä¸‰èŠ‚ç‚¹é›†ç¾¤é…ç½®:</strong></p>
<p><strong>èŠ‚ç‚¹1é…ç½®:</strong></p>
<pre><code class="language-yaml">cluster.name: production-cluster
node.name: node-1
node.roles: [master, data]
network.host: 192.168.1.10
discovery.seed_hosts: ["192.168.1.10", "192.168.1.11", "192.168.1.12"]
cluster.initial_master_nodes: ["node-1", "node-2", "node-3"]
</code></pre>
<p><strong>èŠ‚ç‚¹2å’ŒèŠ‚ç‚¹3é…ç½®ç±»ä¼¼,ä¿®æ”¹node.nameå’Œnetwork.hostå³å¯</strong></p>
<h2 id="3-ç´¢å¼•ç®¡ç†"><a class="header" href="#3-ç´¢å¼•ç®¡ç†">3. ç´¢å¼•ç®¡ç†</a></h2>
<h3 id="31-åˆ›å»ºç´¢å¼•"><a class="header" href="#31-åˆ›å»ºç´¢å¼•">3.1 åˆ›å»ºç´¢å¼•</a></h3>
<p><strong>ç®€å•åˆ›å»º:</strong></p>
<pre><code class="language-bash"># åˆ›å»ºç´¢å¼•
curl -X PUT "localhost:9200/my_index"

# å¸¦è®¾ç½®åˆ›å»º
curl -X PUT "localhost:9200/my_index" -H 'Content-Type: application/json' -d'
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 2
  }
}'
</code></pre>
<p><strong>å¸¦æ˜ å°„åˆ›å»º:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/products" -H 'Content-Type: application/json' -d'
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "name": {
        "type": "text",
        "analyzer": "standard"
      },
      "price": {
        "type": "double"
      },
      "category": {
        "type": "keyword"
      },
      "description": {
        "type": "text"
      },
      "created_at": {
        "type": "date"
      }
    }
  }
}'
</code></pre>
<h3 id="32-ç´¢å¼•æ“ä½œ"><a class="header" href="#32-ç´¢å¼•æ“ä½œ">3.2 ç´¢å¼•æ“ä½œ</a></h3>
<pre><code class="language-bash"># æŸ¥çœ‹ç´¢å¼•
curl -X GET "localhost:9200/_cat/indices?v"

# æŸ¥çœ‹ç´¢å¼•è¯¦æƒ…
curl -X GET "localhost:9200/my_index"

# åˆ é™¤ç´¢å¼•
curl -X DELETE "localhost:9200/my_index"

# å…³é—­ç´¢å¼•
curl -X POST "localhost:9200/my_index/_close"

# æ‰“å¼€ç´¢å¼•
curl -X POST "localhost:9200/my_index/_open"

# åˆ·æ–°ç´¢å¼•
curl -X POST "localhost:9200/my_index/_refresh"
</code></pre>
<h3 id="33-ç´¢å¼•æ¨¡æ¿"><a class="header" href="#33-ç´¢å¼•æ¨¡æ¿">3.3 ç´¢å¼•æ¨¡æ¿</a></h3>
<pre><code class="language-bash">curl -X PUT "localhost:9200/_index_template/logs_template" -H 'Content-Type: application/json' -d'
{
  "index_patterns": ["logs-*"],
  "template": {
    "settings": {
      "number_of_shards": 1,
      "number_of_replicas": 1
    },
    "mappings": {
      "properties": {
        "timestamp": {
          "type": "date"
        },
        "level": {
          "type": "keyword"
        },
        "message": {
          "type": "text"
        }
      }
    }
  }
}'
</code></pre>
<h3 id="34-åˆ«åç®¡ç†"><a class="header" href="#34-åˆ«åç®¡ç†">3.4 åˆ«åç®¡ç†</a></h3>
<pre><code class="language-bash"># åˆ›å»ºåˆ«å
curl -X POST "localhost:9200/_aliases" -H 'Content-Type: application/json' -d'
{
  "actions": [
    {
      "add": {
        "index": "logs-2024-01",
        "alias": "logs-current"
      }
    }
  ]
}'

# åˆ‡æ¢åˆ«å
curl -X POST "localhost:9200/_aliases" -H 'Content-Type: application/json' -d'
{
  "actions": [
    {"remove": {"index": "logs-2024-01", "alias": "logs-current"}},
    {"add": {"index": "logs-2024-02", "alias": "logs-current"}}
  ]
}'
</code></pre>
<h2 id="4-æ–‡æ¡£æ“ä½œ"><a class="header" href="#4-æ–‡æ¡£æ“ä½œ">4. æ–‡æ¡£æ“ä½œ</a></h2>
<h3 id="41-æ·»åŠ æ–‡æ¡£"><a class="header" href="#41-æ·»åŠ æ–‡æ¡£">4.1 æ·»åŠ æ–‡æ¡£</a></h3>
<pre><code class="language-bash"># æŒ‡å®šIDæ·»åŠ 
curl -X PUT "localhost:9200/products/_doc/1" -H 'Content-Type: application/json' -d'
{
  "name": "iPhone 15",
  "price": 999.99,
  "category": "Electronics",
  "description": "Latest iPhone model",
  "created_at": "2024-01-01T00:00:00Z"
}'

# è‡ªåŠ¨ç”ŸæˆID
curl -X POST "localhost:9200/products/_doc" -H 'Content-Type: application/json' -d'
{
  "name": "Samsung Galaxy",
  "price": 899.99,
  "category": "Electronics"
}'
</code></pre>
<h3 id="42-è·å–æ–‡æ¡£"><a class="header" href="#42-è·å–æ–‡æ¡£">4.2 è·å–æ–‡æ¡£</a></h3>
<pre><code class="language-bash"># æ ¹æ®IDè·å–
curl -X GET "localhost:9200/products/_doc/1"

# è·å–å¤šä¸ªæ–‡æ¡£
curl -X GET "localhost:9200/products/_mget" -H 'Content-Type: application/json' -d'
{
  "ids": ["1", "2", "3"]
}'
</code></pre>
<h3 id="43-æ›´æ–°æ–‡æ¡£"><a class="header" href="#43-æ›´æ–°æ–‡æ¡£">4.3 æ›´æ–°æ–‡æ¡£</a></h3>
<pre><code class="language-bash"># éƒ¨åˆ†æ›´æ–°
curl -X POST "localhost:9200/products/_update/1" -H 'Content-Type: application/json' -d'
{
  "doc": {
    "price": 899.99
  }
}'

# è„šæœ¬æ›´æ–°
curl -X POST "localhost:9200/products/_update/1" -H 'Content-Type: application/json' -d'
{
  "script": {
    "source": "ctx._source.price += params.increment",
    "params": {
      "increment": 100
    }
  }
}'
</code></pre>
<h3 id="44-åˆ é™¤æ–‡æ¡£"><a class="header" href="#44-åˆ é™¤æ–‡æ¡£">4.4 åˆ é™¤æ–‡æ¡£</a></h3>
<pre><code class="language-bash"># æ ¹æ®IDåˆ é™¤
curl -X DELETE "localhost:9200/products/_doc/1"

# æ ¹æ®æŸ¥è¯¢åˆ é™¤
curl -X POST "localhost:9200/products/_delete_by_query" -H 'Content-Type: application/json' -d'
{
  "query": {
    "match": {
      "category": "Outdated"
    }
  }
}'
</code></pre>
<h3 id="45-æ‰¹é‡æ“ä½œ"><a class="header" href="#45-æ‰¹é‡æ“ä½œ">4.5 æ‰¹é‡æ“ä½œ</a></h3>
<pre><code class="language-bash">curl -X POST "localhost:9200/_bulk" -H 'Content-Type: application/json' -d'
{"index":{"_index":"products","_id":"1"}}
{"name":"Product 1","price":100}
{"index":{"_index":"products","_id":"2"}}
{"name":"Product 2","price":200}
{"update":{"_index":"products","_id":"1"}}
{"doc":{"price":150}}
{"delete":{"_index":"products","_id":"3"}}
'
</code></pre>
<h2 id="5-æ˜ å°„-mapping"><a class="header" href="#5-æ˜ å°„-mapping">5. æ˜ å°„ (Mapping)</a></h2>
<h3 id="51-å­—æ®µç±»å‹"><a class="header" href="#51-å­—æ®µç±»å‹">5.1 å­—æ®µç±»å‹</a></h3>
<p><strong>æ–‡æœ¬ç±»å‹:</strong></p>
<pre><code class="language-json">{
  "mappings": {
    "properties": {
      "title": {
        "type": "text",
        "analyzer": "standard"
      },
      "category": {
        "type": "keyword"
      }
    }
  }
}
</code></pre>
<p><strong>æ•°å€¼ç±»å‹:</strong></p>
<pre><code class="language-json">{
  "mappings": {
    "properties": {
      "price": {"type": "double"},
      "quantity": {"type": "integer"},
      "rating": {"type": "float"}
    }
  }
}
</code></pre>
<p><strong>æ—¥æœŸç±»å‹:</strong></p>
<pre><code class="language-json">{
  "mappings": {
    "properties": {
      "created_at": {
        "type": "date",
        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis"
      }
    }
  }
}
</code></pre>
<p><strong>å¤æ‚ç±»å‹:</strong></p>
<pre><code class="language-json">{
  "mappings": {
    "properties": {
      "tags": {
        "type": "keyword"
      },
      "location": {
        "type": "geo_point"
      },
      "address": {
        "type": "object",
        "properties": {
          "city": {"type": "keyword"},
          "street": {"type": "text"}
        }
      }
    }
  }
}
</code></pre>
<h3 id="52-åŠ¨æ€æ˜ å°„"><a class="header" href="#52-åŠ¨æ€æ˜ å°„">5.2 åŠ¨æ€æ˜ å°„</a></h3>
<pre><code class="language-bash"># è®¾ç½®åŠ¨æ€æ˜ å°„
curl -X PUT "localhost:9200/dynamic_index" -H 'Content-Type: application/json' -d'
{
  "mappings": {
    "dynamic": "strict",
    "properties": {
      "name": {"type": "text"}
    }
  }
}'
</code></pre>
<p><strong>åŠ¨æ€æ˜ å°„é€‰é¡¹:</strong></p>
<ul>
<li><code>true</code>: è‡ªåŠ¨æ·»åŠ æ–°å­—æ®µ(é»˜è®¤)</li>
<li><code>false</code>: å¿½ç•¥æ–°å­—æ®µ</li>
<li><code>strict</code>: æ‹’ç»æ–°å­—æ®µ,æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<h3 id="53-åˆ†æå™¨é…ç½®"><a class="header" href="#53-åˆ†æå™¨é…ç½®">5.3 åˆ†æå™¨é…ç½®</a></h3>
<pre><code class="language-bash">curl -X PUT "localhost:9200/analyzed_index" -H 'Content-Type: application/json' -d'
{
  "settings": {
    "analysis": {
      "analyzer": {
        "my_custom_analyzer": {
          "type": "custom",
          "tokenizer": "standard",
          "filter": ["lowercase", "stop", "snowball"]
        }
      }
    }
  },
  "mappings": {
    "properties": {
      "content": {
        "type": "text",
        "analyzer": "my_custom_analyzer"
      }
    }
  }
}'
</code></pre>
<h2 id="6-æœç´¢æŸ¥è¯¢"><a class="header" href="#6-æœç´¢æŸ¥è¯¢">6. æœç´¢æŸ¥è¯¢</a></h2>
<h3 id="61-åŸºç¡€æŸ¥è¯¢"><a class="header" href="#61-åŸºç¡€æŸ¥è¯¢">6.1 åŸºç¡€æŸ¥è¯¢</a></h3>
<p><strong>MatchæŸ¥è¯¢ (å…¨æ–‡æœç´¢):</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "match": {
      "description": "smartphone"
    }
  }
}'
</code></pre>
<p><strong>TermæŸ¥è¯¢ (ç²¾ç¡®åŒ¹é…):</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "term": {
      "category": "Electronics"
    }
  }
}'
</code></pre>
<p><strong>RangeæŸ¥è¯¢ (èŒƒå›´æŸ¥è¯¢):</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "range": {
      "price": {
        "gte": 100,
        "lte": 500
      }
    }
  }
}'
</code></pre>
<h3 id="62-å¤åˆæŸ¥è¯¢"><a class="header" href="#62-å¤åˆæŸ¥è¯¢">6.2 å¤åˆæŸ¥è¯¢</a></h3>
<p><strong>BoolæŸ¥è¯¢:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "bool": {
      "must": [
        {"match": {"description": "phone"}}
      ],
      "filter": [
        {"term": {"category": "Electronics"}},
        {"range": {"price": {"gte": 500}}}
      ],
      "should": [
        {"match": {"brand": "Apple"}}
      ],
      "must_not": [
        {"term": {"status": "discontinued"}}
      ]
    }
  }
}'
</code></pre>
<p><strong>Multi-matchæŸ¥è¯¢:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "multi_match": {
      "query": "smartphone",
      "fields": ["name^2", "description", "category"]
    }
  }
}'
</code></pre>
<h3 id="63-è¿‡æ»¤å’Œæ’åº"><a class="header" href="#63-è¿‡æ»¤å’Œæ’åº">6.3 è¿‡æ»¤å’Œæ’åº</a></h3>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "match_all": {}
  },
  "post_filter": {
    "term": {
      "category": "Electronics"
    }
  },
  "sort": [
    {"price": {"order": "desc"}},
    {"_score": {"order": "desc"}}
  ],
  "from": 0,
  "size": 10
}'
</code></pre>
<h3 id="64-é«˜äº®æ˜¾ç¤º"><a class="header" href="#64-é«˜äº®æ˜¾ç¤º">6.4 é«˜äº®æ˜¾ç¤º</a></h3>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "match": {
      "description": "smartphone"
    }
  },
  "highlight": {
    "fields": {
      "description": {}
    },
    "pre_tags": ["&lt;em&gt;"],
    "post_tags": ["&lt;/em&gt;"]
  }
}'
</code></pre>
<h3 id="65-æŸ¥è¯¢å»ºè®®"><a class="header" href="#65-æŸ¥è¯¢å»ºè®®">6.5 æŸ¥è¯¢å»ºè®®</a></h3>
<pre><code class="language-bash"># Completion Suggester
curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "suggest": {
    "product-suggest": {
      "prefix": "iph",
      "completion": {
        "field": "name.suggest"
      }
    }
  }
}'

# Term Suggester
curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "suggest": {
    "text": "smartphne",
    "term-suggester": {
      "term": {
        "field": "description"
      }
    }
  }
}'
</code></pre>
<h2 id="7-èšåˆåˆ†æ"><a class="header" href="#7-èšåˆåˆ†æ">7. èšåˆåˆ†æ</a></h2>
<h3 id="71-æŒ‡æ ‡èšåˆ"><a class="header" href="#71-æŒ‡æ ‡èšåˆ">7.1 æŒ‡æ ‡èšåˆ</a></h3>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "avg_price": {
      "avg": {"field": "price"}
    },
    "max_price": {
      "max": {"field": "price"}
    },
    "min_price": {
      "min": {"field": "price"}
    },
    "sum_price": {
      "sum": {"field": "price"}
    },
    "stats_price": {
      "stats": {"field": "price"}
    }
  }
}'
</code></pre>
<h3 id="72-æ¡¶èšåˆ"><a class="header" href="#72-æ¡¶èšåˆ">7.2 æ¡¶èšåˆ</a></h3>
<p><strong>Termsèšåˆ (åˆ†ç»„):</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "categories": {
      "terms": {
        "field": "category",
        "size": 10
      }
    }
  }
}'
</code></pre>
<p><strong>Date Histogram (æ—¶é—´ç›´æ–¹å›¾):</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/logs/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "logs_over_time": {
      "date_histogram": {
        "field": "timestamp",
        "calendar_interval": "day"
      }
    }
  }
}'
</code></pre>
<p><strong>Rangeèšåˆ:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "price_ranges": {
      "range": {
        "field": "price",
        "ranges": [
          {"to": 100},
          {"from": 100, "to": 500},
          {"from": 500}
        ]
      }
    }
  }
}'
</code></pre>
<h3 id="73-åµŒå¥—èšåˆ"><a class="header" href="#73-åµŒå¥—èšåˆ">7.3 åµŒå¥—èšåˆ</a></h3>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "categories": {
      "terms": {"field": "category"},
      "aggs": {
        "avg_price": {
          "avg": {"field": "price"}
        },
        "price_ranges": {
          "range": {
            "field": "price",
            "ranges": [
              {"to": 500},
              {"from": 500}
            ]
          }
        }
      }
    }
  }
}'
</code></pre>
<h3 id="74-ç®¡é“èšåˆ"><a class="header" href="#74-ç®¡é“èšåˆ">7.4 ç®¡é“èšåˆ</a></h3>
<pre><code class="language-bash">curl -X GET "localhost:9200/sales/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "aggs": {
    "sales_per_month": {
      "date_histogram": {
        "field": "date",
        "calendar_interval": "month"
      },
      "aggs": {
        "total_sales": {
          "sum": {"field": "amount"}
        }
      }
    },
    "max_monthly_sales": {
      "max_bucket": {
        "buckets_path": "sales_per_month&gt;total_sales"
      }
    }
  }
}'
</code></pre>
<h2 id="8-æ€§èƒ½ä¼˜åŒ–"><a class="header" href="#8-æ€§èƒ½ä¼˜åŒ–">8. æ€§èƒ½ä¼˜åŒ–</a></h2>
<h3 id="81-ç´¢å¼•ä¼˜åŒ–"><a class="header" href="#81-ç´¢å¼•ä¼˜åŒ–">8.1 ç´¢å¼•ä¼˜åŒ–</a></h3>
<p><strong>æ‰¹é‡ç´¢å¼•:</strong></p>
<pre><code class="language-bash"># ä½¿ç”¨bulk API
curl -X POST "localhost:9200/_bulk" -H 'Content-Type: application/json' --data-binary @data.json

# åˆ·æ–°é—´éš”è®¾ç½®
curl -X PUT "localhost:9200/my_index/_settings" -H 'Content-Type: application/json' -d'
{
  "index": {
    "refresh_interval": "30s"
  }
}'

# ç¦ç”¨å‰¯æœ¬(å¯¼å…¥æ—¶)
curl -X PUT "localhost:9200/my_index/_settings" -H 'Content-Type: application/json' -d'
{
  "index": {
    "number_of_replicas": 0
  }
}'
</code></pre>
<p><strong>ç´¢å¼•ç”Ÿå‘½å‘¨æœŸç®¡ç†:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/_ilm/policy/logs_policy" -H 'Content-Type: application/json' -d'
{
  "policy": {
    "phases": {
      "hot": {
        "actions": {
          "rollover": {
            "max_size": "50GB",
            "max_age": "30d"
          }
        }
      },
      "warm": {
        "min_age": "7d",
        "actions": {
          "forcemerge": {
            "max_num_segments": 1
          },
          "shrink": {
            "number_of_shards": 1
          }
        }
      },
      "delete": {
        "min_age": "90d",
        "actions": {
          "delete": {}
        }
      }
    }
  }
}'
</code></pre>
<h3 id="82-æŸ¥è¯¢ä¼˜åŒ–"><a class="header" href="#82-æŸ¥è¯¢ä¼˜åŒ–">8.2 æŸ¥è¯¢ä¼˜åŒ–</a></h3>
<p><strong>ä½¿ç”¨Filter Context:</strong></p>
<pre><code class="language-json">{
  "query": {
    "bool": {
      "must": [
        {"match": {"description": "phone"}}
      ],
      "filter": [
        {"term": {"category": "Electronics"}},
        {"range": {"price": {"gte": 100}}}
      ]
    }
  }
}
</code></pre>
<p><strong>é™åˆ¶ç»“æœé›†å¤§å°:</strong></p>
<pre><code class="language-json">{
  "size": 10,
  "from": 0,
  "_source": ["name", "price", "category"]
}
</code></pre>
<p><strong>ä½¿ç”¨æœç´¢æ¨¡æ¿:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/_scripts/product_search" -H 'Content-Type: application/json' -d'
{
  "script": {
    "lang": "mustache",
    "source": {
      "query": {
        "bool": {
          "must": [
            {"match": {"{{field}}": "{{value}}"}}
          ]
        }
      }
    }
  }
}'
</code></pre>
<h3 id="83-åˆ†ç‰‡å’Œå‰¯æœ¬é…ç½®"><a class="header" href="#83-åˆ†ç‰‡å’Œå‰¯æœ¬é…ç½®">8.3 åˆ†ç‰‡å’Œå‰¯æœ¬é…ç½®</a></h3>
<pre><code class="language-bash"># è®¡ç®—åˆ†ç‰‡æ•°
# åˆ†ç‰‡æ•° = é¢„æœŸæ•°æ®é‡ / å•åˆ†ç‰‡ç›®æ ‡å¤§å°(30-50GB)

# è®¾ç½®åˆ†ç‰‡
curl -X PUT "localhost:9200/my_index" -H 'Content-Type: application/json' -d'
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  }
}'
</code></pre>
<h3 id="84-å†…å­˜å’Œjvmä¼˜åŒ–"><a class="header" href="#84-å†…å­˜å’Œjvmä¼˜åŒ–">8.4 å†…å­˜å’ŒJVMä¼˜åŒ–</a></h3>
<p><strong>elasticsearch.yml:</strong></p>
<pre><code class="language-yaml"># ç¦ç”¨swap
bootstrap.memory_lock: true

# çº¿ç¨‹æ± é…ç½®
thread_pool:
  search:
    size: 30
    queue_size: 1000
  write:
    size: 30
    queue_size: 1000
</code></pre>
<p><strong>jvm.options:</strong></p>
<pre><code># å †å†…å­˜è®¾ç½®(ä¸è¶…è¿‡32GB)
-Xms16g
-Xmx16g

# GCé…ç½®
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200
-XX:InitiatingHeapOccupancyPercent=45
</code></pre>
<h2 id="9-é›†ç¾¤ç®¡ç†"><a class="header" href="#9-é›†ç¾¤ç®¡ç†">9. é›†ç¾¤ç®¡ç†</a></h2>
<h3 id="91-é›†ç¾¤å¥åº·ç›‘æ§"><a class="header" href="#91-é›†ç¾¤å¥åº·ç›‘æ§">9.1 é›†ç¾¤å¥åº·ç›‘æ§</a></h3>
<pre><code class="language-bash"># é›†ç¾¤å¥åº·çŠ¶æ€
curl -X GET "localhost:9200/_cluster/health?pretty"

# èŠ‚ç‚¹çŠ¶æ€
curl -X GET "localhost:9200/_cat/nodes?v"

# åˆ†ç‰‡çŠ¶æ€
curl -X GET "localhost:9200/_cat/shards?v"

# ç´¢å¼•çŠ¶æ€
curl -X GET "localhost:9200/_cat/indices?v&amp;health=yellow"
</code></pre>
<p><strong>å¥åº·çŠ¶æ€:</strong></p>
<ul>
<li><code>green</code>: æ‰€æœ‰ä¸»åˆ†ç‰‡å’Œå‰¯æœ¬åˆ†ç‰‡éƒ½å·²åˆ†é…</li>
<li><code>yellow</code>: æ‰€æœ‰ä¸»åˆ†ç‰‡å·²åˆ†é…,éƒ¨åˆ†å‰¯æœ¬æœªåˆ†é…</li>
<li><code>red</code>: éƒ¨åˆ†ä¸»åˆ†ç‰‡æœªåˆ†é…</li>
</ul>
<h3 id="92-åˆ†ç‰‡åˆ†é…"><a class="header" href="#92-åˆ†ç‰‡åˆ†é…">9.2 åˆ†ç‰‡åˆ†é…</a></h3>
<pre><code class="language-bash"># æŸ¥çœ‹åˆ†ç‰‡åˆ†é…è¯´æ˜
curl -X GET "localhost:9200/_cluster/allocation/explain" -H 'Content-Type: application/json' -d'
{
  "index": "my_index",
  "shard": 0,
  "primary": true
}'

# æ‰‹åŠ¨åˆ†é…åˆ†ç‰‡
curl -X POST "localhost:9200/_cluster/reroute" -H 'Content-Type: application/json' -d'
{
  "commands": [
    {
      "move": {
        "index": "my_index",
        "shard": 0,
        "from_node": "node1",
        "to_node": "node2"
      }
    }
  ]
}'
</code></pre>
<h3 id="93-å¿«ç…§å’Œæ¢å¤"><a class="header" href="#93-å¿«ç…§å’Œæ¢å¤">9.3 å¿«ç…§å’Œæ¢å¤</a></h3>
<p><strong>åˆ›å»ºå¿«ç…§ä»“åº“:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/_snapshot/my_backup" -H 'Content-Type: application/json' -d'
{
  "type": "fs",
  "settings": {
    "location": "/mount/backups/my_backup"
  }
}'
</code></pre>
<p><strong>åˆ›å»ºå¿«ç…§:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/_snapshot/my_backup/snapshot_1?wait_for_completion=true" -H 'Content-Type: application/json' -d'
{
  "indices": "my_index",
  "ignore_unavailable": true,
  "include_global_state": false
}'
</code></pre>
<p><strong>æ¢å¤å¿«ç…§:</strong></p>
<pre><code class="language-bash">curl -X POST "localhost:9200/_snapshot/my_backup/snapshot_1/_restore" -H 'Content-Type: application/json' -d'
{
  "indices": "my_index",
  "ignore_unavailable": true
}'
</code></pre>
<h3 id="94-æ»šåŠ¨é‡å¯"><a class="header" href="#94-æ»šåŠ¨é‡å¯">9.4 æ»šåŠ¨é‡å¯</a></h3>
<pre><code class="language-bash"># 1. ç¦ç”¨åˆ†ç‰‡åˆ†é…
curl -X PUT "localhost:9200/_cluster/settings" -H 'Content-Type: application/json' -d'
{
  "persistent": {
    "cluster.routing.allocation.enable": "primaries"
  }
}'

# 2. åœæ­¢èŠ‚ç‚¹å¹¶å‡çº§

# 3. å¯åŠ¨èŠ‚ç‚¹

# 4. å¯ç”¨åˆ†ç‰‡åˆ†é…
curl -X PUT "localhost:9200/_cluster/settings" -H 'Content-Type: application/json' -d'
{
  "persistent": {
    "cluster.routing.allocation.enable": null
  }
}'
</code></pre>
<h2 id="10-java-apiä½¿ç”¨"><a class="header" href="#10-java-apiä½¿ç”¨">10. Java APIä½¿ç”¨</a></h2>
<h3 id="101-mavenä¾èµ–"><a class="header" href="#101-mavenä¾èµ–">10.1 Mavenä¾èµ–</a></h3>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
    &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
    &lt;version&gt;7.17.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3 id="102-è¿æ¥å®¢æˆ·ç«¯"><a class="header" href="#102-è¿æ¥å®¢æˆ·ç«¯">10.2 è¿æ¥å®¢æˆ·ç«¯</a></h3>
<pre><code class="language-java">import org.apache.http.HttpHost;
import org.elasticsearch.client.RestClient;
import org.elasticsearch.client.RestHighLevelClient;

public class ESClient {
    public static RestHighLevelClient getClient() {
        return new RestHighLevelClient(
            RestClient.builder(
                new HttpHost("localhost", 9200, "http")
            )
        );
    }
}
</code></pre>
<h3 id="103-ç´¢å¼•æ–‡æ¡£"><a class="header" href="#103-ç´¢å¼•æ–‡æ¡£">10.3 ç´¢å¼•æ–‡æ¡£</a></h3>
<pre><code class="language-java">import org.elasticsearch.action.index.IndexRequest;
import org.elasticsearch.action.index.IndexResponse;
import org.elasticsearch.client.RequestOptions;
import org.elasticsearch.xcontent.XContentType;

public class IndexDocument {
    public static void main(String[] args) throws IOException {
        RestHighLevelClient client = ESClient.getClient();

        IndexRequest request = new IndexRequest("products");
        request.id("1");

        String jsonString = "{" +
            "\"name\":\"iPhone 15\"," +
            "\"price\":999.99," +
            "\"category\":\"Electronics\"" +
            "}";

        request.source(jsonString, XContentType.JSON);

        IndexResponse response = client.index(request, RequestOptions.DEFAULT);
        System.out.println("Result: " + response.getResult());

        client.close();
    }
}
</code></pre>
<h3 id="104-æœç´¢æ–‡æ¡£"><a class="header" href="#104-æœç´¢æ–‡æ¡£">10.4 æœç´¢æ–‡æ¡£</a></h3>
<pre><code class="language-java">import org.elasticsearch.action.search.SearchRequest;
import org.elasticsearch.action.search.SearchResponse;
import org.elasticsearch.index.query.QueryBuilders;
import org.elasticsearch.search.builder.SearchSourceBuilder;

public class SearchDocument {
    public static void main(String[] args) throws IOException {
        RestHighLevelClient client = ESClient.getClient();

        SearchRequest searchRequest = new SearchRequest("products");
        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();

        searchSourceBuilder.query(QueryBuilders.matchQuery("name", "iPhone"));
        searchSourceBuilder.from(0);
        searchSourceBuilder.size(10);

        searchRequest.source(searchSourceBuilder);

        SearchResponse searchResponse = client.search(searchRequest, RequestOptions.DEFAULT);

        searchResponse.getHits().forEach(hit -&gt; {
            System.out.println(hit.getSourceAsString());
        });

        client.close();
    }
}
</code></pre>
<h2 id="11-å®æˆ˜æ¡ˆä¾‹"><a class="header" href="#11-å®æˆ˜æ¡ˆä¾‹">11. å®æˆ˜æ¡ˆä¾‹</a></h2>
<h3 id="111-æ—¥å¿—åˆ†æç³»ç»Ÿ"><a class="header" href="#111-æ—¥å¿—åˆ†æç³»ç»Ÿ">11.1 æ—¥å¿—åˆ†æç³»ç»Ÿ</a></h3>
<p><strong>åˆ›å»ºæ—¥å¿—ç´¢å¼•:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/app-logs" -H 'Content-Type: application/json' -d'
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  },
  "mappings": {
    "properties": {
      "timestamp": {"type": "date"},
      "level": {"type": "keyword"},
      "logger": {"type": "keyword"},
      "thread": {"type": "keyword"},
      "message": {"type": "text"},
      "exception": {"type": "text"}
    }
  }
}'
</code></pre>
<p><strong>æŸ¥è¯¢é”™è¯¯æ—¥å¿—:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/app-logs/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "bool": {
      "must": [
        {"term": {"level": "ERROR"}},
        {"range": {"timestamp": {"gte": "now-1h"}}}
      ]
    }
  },
  "sort": [{"timestamp": {"order": "desc"}}],
  "size": 100
}'
</code></pre>
<p><strong>é”™è¯¯ç»Ÿè®¡åˆ†æ:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/app-logs/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "query": {
    "term": {"level": "ERROR"}
  },
  "aggs": {
    "errors_over_time": {
      "date_histogram": {
        "field": "timestamp",
        "calendar_interval": "hour"
      }
    },
    "top_errors": {
      "terms": {
        "field": "logger",
        "size": 10
      }
    }
  }
}'
</code></pre>
<h3 id="112-ç”µå•†æœç´¢"><a class="header" href="#112-ç”µå•†æœç´¢">11.2 ç”µå•†æœç´¢</a></h3>
<p><strong>åˆ›å»ºå•†å“ç´¢å¼•:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/products" -H 'Content-Type: application/json' -d'
{
  "mappings": {
    "properties": {
      "name": {
        "type": "text",
        "analyzer": "ik_max_word",
        "fields": {
          "keyword": {"type": "keyword"}
        }
      },
      "description": {"type": "text"},
      "price": {"type": "double"},
      "sales": {"type": "integer"},
      "rating": {"type": "float"},
      "category": {"type": "keyword"},
      "tags": {"type": "keyword"},
      "brand": {"type": "keyword"},
      "created_at": {"type": "date"}
    }
  }
}'
</code></pre>
<p><strong>ç»¼åˆæœç´¢:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/products/_search" -H 'Content-Type: application/json' -d'
{
  "query": {
    "function_score": {
      "query": {
        "bool": {
          "must": [
            {"multi_match": {
              "query": "æ‰‹æœº",
              "fields": ["name^3", "description"]
            }}
          ],
          "filter": [
            {"range": {"price": {"gte": 1000, "lte": 5000}}},
            {"term": {"category": "ç”µå­äº§å“"}}
          ]
        }
      },
      "functions": [
        {
          "field_value_factor": {
            "field": "sales",
            "factor": 0.1,
            "modifier": "log1p"
          }
        },
        {
          "field_value_factor": {
            "field": "rating",
            "factor": 1.2
          }
        }
      ],
      "score_mode": "sum",
      "boost_mode": "multiply"
    }
  },
  "aggs": {
    "price_ranges": {
      "range": {
        "field": "price",
        "ranges": [
          {"to": 1000},
          {"from": 1000, "to": 3000},
          {"from": 3000, "to": 5000},
          {"from": 5000}
        ]
      }
    },
    "brands": {
      "terms": {"field": "brand", "size": 10}
    }
  }
}'
</code></pre>
<h3 id="113-å®æ—¶ç›‘æ§"><a class="header" href="#113-å®æ—¶ç›‘æ§">11.3 å®æ—¶ç›‘æ§</a></h3>
<p><strong>APMæ•°æ®ç´¢å¼•:</strong></p>
<pre><code class="language-bash">curl -X PUT "localhost:9200/apm-metrics" -H 'Content-Type: application/json' -d'
{
  "mappings": {
    "properties": {
      "timestamp": {"type": "date"},
      "service_name": {"type": "keyword"},
      "transaction_type": {"type": "keyword"},
      "duration": {"type": "long"},
      "result": {"type": "keyword"},
      "user_agent": {"type": "keyword"}
    }
  }
}'
</code></pre>
<p><strong>æ€§èƒ½åˆ†æ:</strong></p>
<pre><code class="language-bash">curl -X GET "localhost:9200/apm-metrics/_search" -H 'Content-Type: application/json' -d'
{
  "size": 0,
  "query": {
    "range": {"timestamp": {"gte": "now-1h"}}
  },
  "aggs": {
    "per_service": {
      "terms": {"field": "service_name"},
      "aggs": {
        "avg_duration": {"avg": {"field": "duration"}},
        "percentiles_duration": {
          "percentiles": {
            "field": "duration",
            "percents": [50, 95, 99]
          }
        }
      }
    }
  }
}'
</code></pre>
<h2 id="12-å¸¸è§é—®é¢˜æ’æŸ¥"><a class="header" href="#12-å¸¸è§é—®é¢˜æ’æŸ¥">12. å¸¸è§é—®é¢˜æ’æŸ¥</a></h2>
<h3 id="121-é›†ç¾¤çŠ¶æ€å¼‚å¸¸"><a class="header" href="#121-é›†ç¾¤çŠ¶æ€å¼‚å¸¸">12.1 é›†ç¾¤çŠ¶æ€å¼‚å¸¸</a></h3>
<p><strong>é—®é¢˜: é›†ç¾¤çŠ¶æ€ä¸ºRED</strong></p>
<pre><code class="language-bash"># 1. æ£€æŸ¥æœªåˆ†é…çš„åˆ†ç‰‡
curl -X GET "localhost:9200/_cat/shards?v&amp;h=index,shard,prirep,state,unassigned.reason"

# 2. æŸ¥çœ‹åˆ†é…è¯´æ˜
curl -X GET "localhost:9200/_cluster/allocation/explain?pretty"

# 3. æ‰‹åŠ¨åˆ†é…åˆ†ç‰‡
curl -X POST "localhost:9200/_cluster/reroute?retry_failed"
</code></pre>
<h3 id="122-æ€§èƒ½é—®é¢˜"><a class="header" href="#122-æ€§èƒ½é—®é¢˜">12.2 æ€§èƒ½é—®é¢˜</a></h3>
<p><strong>é—®é¢˜: æŸ¥è¯¢æ…¢</strong></p>
<pre><code class="language-bash"># 1. æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—
curl -X GET "localhost:9200/_cat/thread_pool?v&amp;h=host,name,active,queue,rejected"

# 2. åˆ†ææŸ¥è¯¢
curl -X GET "localhost:9200/my_index/_search?explain=true" -H 'Content-Type: application/json' -d'
{
  "query": {"match": {"field": "value"}}
}'

# 3. ä¼˜åŒ–å»ºè®®
# - ä½¿ç”¨filterä»£æ›¿query
# - å‡å°‘è¿”å›å­—æ®µ
# - ä½¿ç”¨routing
# - åˆç†è®¾ç½®åˆ†ç‰‡æ•°
</code></pre>
<h3 id="123-å†…å­˜æº¢å‡º"><a class="header" href="#123-å†…å­˜æº¢å‡º">12.3 å†…å­˜æº¢å‡º</a></h3>
<p><strong>é—®é¢˜: OutOfMemoryError</strong></p>
<pre><code class="language-bash"># è§£å†³æ–¹æ¡ˆ:
# 1. å¢åŠ å †å†…å­˜(ä¸è¶…è¿‡32GB)
# 2. ä½¿ç”¨doc values
# 3. ç¦ç”¨ä¸éœ€è¦çš„åŠŸèƒ½
# 4. æ¸…ç†field data cache
curl -X POST "localhost:9200/_cache/clear?fielddata=true"
</code></pre>
<h2 id="13-å­¦ä¹ éªŒè¯æ ‡å‡†"><a class="header" href="#13-å­¦ä¹ éªŒè¯æ ‡å‡†">13. å­¦ä¹ éªŒè¯æ ‡å‡†</a></h2>
<h3 id="-åŸºç¡€èƒ½åŠ›éªŒè¯"><a class="header" href="#-åŸºç¡€èƒ½åŠ›éªŒè¯">âœ… åŸºç¡€èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
ç†è§£Elasticsearchæ¶æ„å’Œæ ¸å¿ƒæ¦‚å¿µ</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿå®‰è£…é…ç½®å•æœºå’Œé›†ç¾¤ç¯å¢ƒ</li>
<li><input disabled="" type="checkbox"/>
æŒæ¡ç´¢å¼•å’Œæ–‡æ¡£çš„CRUDæ“ä½œ</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿä½¿ç”¨DSLè¿›è¡ŒåŸºç¡€æŸ¥è¯¢</li>
</ul>
<h3 id="-è¿›é˜¶èƒ½åŠ›éªŒè¯"><a class="header" href="#-è¿›é˜¶èƒ½åŠ›éªŒè¯">âœ… è¿›é˜¶èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè®¾è®¡åˆç†çš„ç´¢å¼•æ˜ å°„</li>
<li><input disabled="" type="checkbox"/>
æŒæ¡å¤æ‚æŸ¥è¯¢å’Œèšåˆåˆ†æ</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè¿›è¡Œæ€§èƒ½è°ƒä¼˜</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿä½¿ç”¨Java APIå¼€å‘</li>
</ul>
<h3 id="-é«˜çº§èƒ½åŠ›éªŒè¯"><a class="header" href="#-é«˜çº§èƒ½åŠ›éªŒè¯">âœ… é«˜çº§èƒ½åŠ›éªŒè¯</a></h3>
<ul>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè®¾è®¡é«˜å¯ç”¨é›†ç¾¤æ¶æ„</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿå¤„ç†å¤§è§„æ¨¡æ•°æ®ç´¢å¼•</li>
<li><input disabled="" type="checkbox"/>
èƒ½å¤Ÿè¿›è¡Œé›†ç¾¤è¿ç»´å’Œæ•…éšœæ’æŸ¥</li>
<li><input disabled="" type="checkbox"/>
å…·å¤‡ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µèƒ½åŠ›</li>
</ul>
<h2 id="14-æ‰©å±•èµ„æº"><a class="header" href="#14-æ‰©å±•èµ„æº">14. æ‰©å±•èµ„æº</a></h2>
<h3 id="å®˜æ–¹èµ„æº"><a class="header" href="#å®˜æ–¹èµ„æº">å®˜æ–¹èµ„æº</a></h3>
<ul>
<li>å®˜ç½‘: https://www.elastic.co/elasticsearch/</li>
<li>æ–‡æ¡£: https://www.elastic.co/guide/en/elasticsearch/reference/current/</li>
<li>GitHub: https://github.com/elastic/elasticsearch</li>
</ul>
<h3 id="å­¦ä¹ å»ºè®®"><a class="header" href="#å­¦ä¹ å»ºè®®">å­¦ä¹ å»ºè®®</a></h3>
<ol>
<li>ä»å•æœºç¯å¢ƒå¼€å§‹å®è·µ</li>
<li>ç†è§£å€’æ’ç´¢å¼•åŸç†</li>
<li>æŒæ¡DSLæŸ¥è¯¢è¯­è¨€</li>
<li>å­¦ä¹ é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†</li>
<li>å®è·µæ€§èƒ½è°ƒä¼˜æŠ€å·§</li>
</ol>
<h3 id="è¿›é˜¶æ–¹å‘"><a class="header" href="#è¿›é˜¶æ–¹å‘">è¿›é˜¶æ–¹å‘</a></h3>
<ul>
<li>ELK Stackæ•´åˆ(Elasticsearch + Logstash + Kibana)</li>
<li>Machine Learningç‰¹æ€§</li>
<li>æ—¶åºæ•°æ®å¤„ç†</li>
<li>å®‰å…¨é˜²æŠ¤å’Œæƒé™ç®¡ç†</li>
<li>äº‘åŸç”Ÿéƒ¨ç½²(Kubernetes)</li>
</ul>
<h3 id="ç›¸å…³æŠ€æœ¯"><a class="header" href="#ç›¸å…³æŠ€æœ¯">ç›¸å…³æŠ€æœ¯</a></h3>
<ul>
<li>Logstash: æ•°æ®é‡‡é›†å’Œå¤„ç†</li>
<li>Kibana: æ•°æ®å¯è§†åŒ–</li>
<li>Beats: è½»é‡çº§æ•°æ®é‡‡é›†å™¨</li>
<li>APM: åº”ç”¨æ€§èƒ½ç›‘æ§</li>
</ul>
<h3 id="æ¨èä¹¦ç±"><a class="header" href="#æ¨èä¹¦ç±">æ¨èä¹¦ç±</a></h3>
<ul>
<li>Elasticsearchæƒå¨æŒ‡å—</li>
<li>Elasticsearchå®æˆ˜</li>
<li>Elasticsearchæºç è§£æä¸ä¼˜åŒ–å®æˆ˜</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ç¼–ç¨‹/bigdata/4-Hive.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ç¼–ç¨‹/bigdata/6-Airflow.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ç¼–ç¨‹/bigdata/4-Hive.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ç¼–ç¨‹/bigdata/6-Airflow.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

