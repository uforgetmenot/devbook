<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>USB Passthrough 虚拟化透传学习笔记 - 开发</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">开发</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="搜索本书内容..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="usb-passthrough-虚拟化透传学习笔记"><a class="header" href="#usb-passthrough-虚拟化透传学习笔记">USB Passthrough 虚拟化透传学习笔记</a></h1>
<blockquote>
<p>面向 0-5 年经验的虚拟化、云桌面、运维工程师，系统掌握 USB 设备直通技术原理、KVM/libvirt/QEMU 配置、SPICE/USB 重定向、USB/IP、容器场景、安全治理与故障排查。</p>
</blockquote>
<hr />
<h2 id="学习定位与总体目标"><a class="header" href="#学习定位与总体目标">学习定位与总体目标</a></h2>
<ul>
<li><strong>学习者画像</strong>：需要在虚拟机或云桌面中使用物理 USB 设备（UKey、加密狗、打印机、摄像头等）。</li>
<li><strong>技术定位</strong>：USB Passthrough 可将宿主 USB 控制器或设备直接分配给虚拟机，或通过 SPICE/USBredir、usbip 转发，实现近乎原生的使用体验。</li>
<li><strong>学习目标</strong>：
<ol>
<li>理解 USB 架构、控制器、总线复用、直通与重定向的区别；</li>
<li>掌握 libvirt/QEMU 的 USB 控制器直通、单设备直通、SPICE usbredir 配置；</li>
<li>能够在 OpenStack、Proxmox、KubeVirt、VDI 平台部署 USB 透传方案；</li>
<li>解决常见问题（权限、热插拔、USB 2.0/3.0 兼容、带宽），制定安全策略；</li>
<li>自动化脚本与监控、文档化操作流程。</li>
</ol>
</li>
<li><strong>成果要求</strong>：
<ul>
<li>完成 USB 设备直通实验并验证；</li>
<li>配置 SPICE USB 重定向，记录性能与体验；</li>
<li>交付自动化脚本、故障排查手册、安全策略；</li>
<li>形成知识库与培训材料。</li>
</ul>
</li>
</ul>
<hr />
<h2 id="核心模块结构"><a class="header" href="#核心模块结构">核心模块结构</a></h2>
<ol>
<li><strong>模块一：USB 架构与虚拟化原理</strong> —— 控制器类型、USB 层级、直通方式。</li>
<li><strong>模块二：KVM/QEMU/libvirt USB 直通实践</strong> —— 控制器、单设备、vfio、XML 配置。</li>
<li><strong>模块三：SPICE / USBredir / USBIP 方案</strong> —— 远程重定向、Web 接入、容器化。</li>
<li><strong>模块四：云平台与 VDI 集成</strong> —— OpenStack、Proxmox、KubeVirt、桌面虚拟化案例。</li>
<li><strong>模块五：性能调优、安全治理与故障诊断</strong> —— 带宽、稳定性、日志、安全策略。</li>
<li><strong>模块六：学习路径、实战案例与验证标准</strong> —— 计划、案例、成果评估、资源。</li>
</ol>
<hr />
<h2 id="模块一usb-架构与虚拟化原理"><a class="header" href="#模块一usb-架构与虚拟化原理">模块一：USB 架构与虚拟化原理</a></h2>
<h3 id="11-usb-分层"><a class="header" href="#11-usb-分层">1.1 USB 分层</a></h3>
<ul>
<li>主机控制器（EHCI/ohci/xhci）；</li>
<li>Hub、设备（Endpoint）;</li>
<li>速率：USB1.1、2.0、3.x、4；</li>
<li>Descriptor 描述设备信息。</li>
</ul>
<h3 id="12-虚拟化方式"><a class="header" href="#12-虚拟化方式">1.2 虚拟化方式</a></h3>
<ul>
<li><strong>Hostdev Passthrough</strong>：将 USB 控制器或单个设备直接挂载；</li>
<li><strong>USB Redirection</strong>：SPICE/usbredir 将 USB over network；</li>
<li><strong>USB/IP</strong>：内核模块，通过 TCP/IP 转发；</li>
<li><strong>专用硬件</strong>：USB over Ethernet 盒子。</li>
</ul>
<h3 id="13-控制器直通-vs-单设备"><a class="header" href="#13-控制器直通-vs-单设备">1.3 控制器直通 vs 单设备</a></h3>
<div class="table-wrapper"><table><thead><tr><th>方式</th><th>优点</th><th>缺点</th></tr></thead><tbody>
<tr><td>控制器直通</td><td>全部设备可用，性能最好</td><td>占用整控制器，宿主不可用</td></tr>
<tr><td>单设备直通</td><td>灵活、细粒度</td><td>需 vfio/usb-host 支持，易断连</td></tr>
<tr><td>USBredir</td><td>跨网络、共享</td><td>延迟高，某些设备不兼容</td></tr>
<tr><td>USB/IP</td><td>通用</td><td>配置复杂，安全需关注</td></tr>
</tbody></table>
</div>
<h3 id="14-学习重点与易错点"><a class="header" href="#14-学习重点与易错点">1.4 学习重点与易错点</a></h3>
<ul>
<li><strong>重点</strong>：libvirt <code>hostdev</code> 配置、usbredir、权限；</li>
<li><strong>易错点</strong>：
<ol>
<li>控制器被宿主占用，无法直通；</li>
<li>USB 3.0 设备在 USB 2.0 控制器上工作受限；</li>
<li>热插拔后需要重新绑定；</li>
<li>USBredir 需 SPICE agent 支持；</li>
<li>安全风险（UKey、恶意设备）。</li>
</ol>
</li>
</ul>
<hr />
<h2 id="模块二kvmqemulibvirt-usb-直通"><a class="header" href="#模块二kvmqemulibvirt-usb-直通">模块二：KVM/QEMU/libvirt USB 直通</a></h2>
<h3 id="21-识别设备"><a class="header" href="#21-识别设备">2.1 识别设备</a></h3>
<ul>
<li><code>lsusb</code> 查看设备；</li>
<li><code>lsusb -t</code> 查看拓扑；</li>
<li><code>udevadm info --name=/dev/bus/usb/001/002</code>。</li>
</ul>
<h3 id="22-控制器直通"><a class="header" href="#22-控制器直通">2.2 控制器直通</a></h3>
<ul>
<li>找 PCI ID：<code>lspci | grep USB</code>；</li>
<li>vfio：<code>echo 0000:02:00.0 &gt; /sys/bus/pci/devices/.../driver/unbind</code> + <code>vfio-pci</code>；</li>
<li>libvirt XML：
<pre><code class="language-xml">&lt;hostdev mode='subsystem' type='pci' managed='yes'&gt;
  &lt;source&gt;
    &lt;address domain='0x0000' bus='0x02' slot='0x00' function='0x0'/&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;
</code></pre>
</li>
<li>适合 GPU 工作站、USB 集线器专用 VM。</li>
</ul>
<h3 id="23-单设备直通"><a class="header" href="#23-单设备直通">2.3 单设备直通</a></h3>
<ul>
<li>libvirt XML：
<pre><code class="language-xml">&lt;hostdev mode='subsystem' type='usb'&gt;
  &lt;source&gt;
    &lt;vendor id='0x0bda'/&gt;
    &lt;product id='0x8153'/&gt;
  &lt;/source&gt;
  &lt;address bus='0' device='2'/&gt;
&lt;/hostdev&gt;
</code></pre>
</li>
<li><code>vendor</code>/<code>product</code> 来自 <code>lsusb</code>；</li>
<li>传UKey、打印机、摄像头。</li>
</ul>
<h3 id="24-qemu-cli"><a class="header" href="#24-qemu-cli">2.4 QEMU CLI</a></h3>
<pre><code>-device usb-host,hostbus=1,hostaddr=2
-device nec-usb-xhci,id=xhci
</code></pre>
<ul>
<li>USB 3.0 需 <code>nec-usb-xhci</code> 控制器；</li>
<li><code>-device usb-tablet</code> for pointer。</li>
</ul>
<h3 id="25-权限与selinux"><a class="header" href="#25-权限与selinux">2.5 权限与SELinux</a></h3>
<ul>
<li><code>/dev/bus/usb</code> 需要 QEMU 访问权限；</li>
<li>使用 <code>qemu</code> 用户 + ACL：<code>setfacl -m u:qemu:rw /dev/bus/usb/001/002</code>；</li>
<li>SELinux：添加策略或 setsebool <code>virt_use_usb=1</code>。</li>
</ul>
<h3 id="26-热插拔"><a class="header" href="#26-热插拔">2.6 热插拔</a></h3>
<ul>
<li><code>virsh attach-device vm usb.xml</code>；</li>
<li><code>virsh detach-device</code>；</li>
<li>Monitor：<code>device_add</code>, <code>device_del</code>。</li>
</ul>
<h3 id="27-实践练习"><a class="header" href="#27-实践练习">2.7 实践练习</a></h3>
<ul>
<li>直通 USB 网卡/存储到 VM；</li>
<li>测试 USB 3.0 速度；</li>
<li>热插拔设备；</li>
<li>记录 XML 与日志。</li>
</ul>
<hr />
<h2 id="模块三spiceusbredirusbip"><a class="header" href="#模块三spiceusbredirusbip">模块三：SPICE/USBredir/USBIP</a></h2>
<h3 id="31-spice-usb-redirection"><a class="header" href="#31-spice-usb-redirection">3.1 SPICE USB Redirection</a></h3>
<ul>
<li>libvirt <code>&lt;redirdev type='spicevmc' bus='usb'/&gt;</code>; <code>&lt;redirfilter&gt;</code>；</li>
<li>客户端 remote-viewer -&gt; “USB 设备” 菜单；</li>
<li>与 SPICE agent 协作；</li>
<li>适合桌面、office 场景。</li>
</ul>
<h3 id="32-usbredir"><a class="header" href="#32-usbredir">3.2 usbredir</a></h3>
<ul>
<li><code>usbredirhost</code>, <code>usbredirserver</code>；</li>
<li>remote-viewer 使用 libusbredir；</li>
<li>支持跨平台；</li>
<li>某些设备（ISOCH）表现欠佳。</li>
</ul>
<h3 id="33-usbip"><a class="header" href="#33-usbip">3.3 USB/IP</a></h3>
<ul>
<li>Linux 模块 <code>usbip-core</code>；</li>
<li>Server：<code>usbipd -D</code>, <code>usbip bind -b 1-2</code>；</li>
<li>Client：<code>usbip attach -r host -b 1-2</code>；</li>
<li>需注意安全（加密、访问控制）。</li>
</ul>
<h3 id="34-容器场景"><a class="header" href="#34-容器场景">3.4 容器场景</a></h3>
<ul>
<li>Kubernetes：<code>hostNetwork + privileged + mount /dev/bus/usb</code>；</li>
<li>DevicePlugin：USB DP；</li>
<li>USBIP 结合；</li>
<li>注意多租户隔离。</li>
</ul>
<h3 id="35-实践练习"><a class="header" href="#35-实践练习">3.5 实践练习</a></h3>
<ul>
<li>配置 SPICE USB 重定向，测试 UKey；</li>
<li>使用 usbip 将设备共享给远程主机；</li>
<li>记录延迟、稳定性。</li>
</ul>
<hr />
<h2 id="模块四云平台与-vdi-集成"><a class="header" href="#模块四云平台与-vdi-集成">模块四：云平台与 VDI 集成</a></h2>
<h3 id="41-openstack"><a class="header" href="#41-openstack">4.1 OpenStack</a></h3>
<ul>
<li>Nova 支持 USB 透传（通过 PCI passthrough）；</li>
<li>使用额外的 hostdev；</li>
<li>Horizon/Console 端通过 SPICE/noVNC 配合；</li>
<li>需要配置 whitelist。</li>
</ul>
<h3 id="42-proxmox-ve"><a class="header" href="#42-proxmox-ve">4.2 Proxmox VE</a></h3>
<ul>
<li>GUI -&gt; Hardware -&gt; Add -&gt; USB Device；</li>
<li>支持 USB/IP 与 USBredir；</li>
<li>备选：SPICE 控制台。</li>
</ul>
<h3 id="43-kubevirt"><a class="header" href="#43-kubevirt">4.3 KubeVirt</a></h3>
<ul>
<li><code>hostDevice</code> 资源映射；</li>
<li>示例：
<pre><code class="language-yaml">spec:
  template:
    spec:
      domain:
        devices:
          hostDevices:
            - name: usbkey
      hostDevices:
        - name: usbkey
          deviceName: usb-1-2
</code></pre>
</li>
<li>需要 Node Feature Discovery + DevicePlugin。</li>
</ul>
<h3 id="44-vdi-平台"><a class="header" href="#44-vdi-平台">4.4 VDI 平台</a></h3>
<ul>
<li>oVirt/RHV：SPICE USBredir；</li>
<li>VMware Horizon：USB Direct-Connection；</li>
<li>Citrix：HDX USB；</li>
<li>需要策略控制、安全审计。</li>
</ul>
<h3 id="45-实践练习"><a class="header" href="#45-实践练习">4.5 实践练习</a></h3>
<ul>
<li>在 Proxmox/OpenStack/KubeVirt 中透传 USB；</li>
<li>测试多租户策略；</li>
<li>记录配置与用户体验。</li>
</ul>
<hr />
<h2 id="模块五性能安全与故障排查"><a class="header" href="#模块五性能安全与故障排查">模块五：性能、安全与故障排查</a></h2>
<h3 id="51-性能调优"><a class="header" href="#51-性能调优">5.1 性能调优</a></h3>
<ul>
<li>USB 3.0 控制器直通获得更高带宽；</li>
<li>隔离 VFIO 线程 CPU；</li>
<li>使用高质量 USB 线缆/Hub；</li>
<li>监控 <code>dmesg</code>，避免掉线。</li>
</ul>
<h3 id="52-安全策略"><a class="header" href="#52-安全策略">5.2 安全策略</a></h3>
<ul>
<li>限制可透传设备；</li>
<li>使用 USB 白名单/黑名单；</li>
<li>加密数据传输（SPICE TLS、USBIP VPN）；</li>
<li>审计 USB 使用日志。</li>
</ul>
<h3 id="53-故障排查"><a class="header" href="#53-故障排查">5.3 故障排查</a></h3>
<div class="table-wrapper"><table><thead><tr><th>现象</th><th>排查</th><th>解决</th></tr></thead><tbody>
<tr><td>VM 未识别设备</td><td>驱动/权限</td><td>安装驱动、设置 ACL</td></tr>
<tr><td>直通失败 (EBUSY)</td><td>设备占用</td><td><code>lsusb</code>, <code>fuser</code>，解绑驱动</td></tr>
<tr><td>USB 3.0 速度慢</td><td>控制器不匹配</td><td>使用 xHCI 控制器</td></tr>
<tr><td>SPICE 失效</td><td>agent 未运行</td><td>安装/重启 spice-vdagent</td></tr>
<tr><td>USBIP 断开</td><td>网络问题</td><td>检查延迟、keepalive</td></tr>
</tbody></table>
</div>
<h3 id="54-日志与监控"><a class="header" href="#54-日志与监控">5.4 日志与监控</a></h3>
<ul>
<li><code>journalctl -u libvirtd</code>；</li>
<li>QEMU 日志；</li>
<li><code>usbmon</code> 捕获 USB 流量；</li>
<li>Prometheus 自定义指标（设备在线数）。</li>
</ul>
<h3 id="55-自动化脚本"><a class="header" href="#55-自动化脚本">5.5 自动化脚本</a></h3>
<pre><code class="language-bash">#!/bin/bash
BUS=$1
DEV=$2
virsh attach-device vm1 &lt;(cat &lt;&lt;EOF
&lt;hostdev mode='subsystem' type='usb'&gt;
  &lt;source&gt;
    &lt;address bus='$BUS' device='$DEV'/&gt;
  &lt;/source&gt;
&lt;/hostdev&gt;
EOF
)
</code></pre>
<h3 id="56-实践练习"><a class="header" href="#56-实践练习">5.6 实践练习</a></h3>
<ul>
<li>模拟设备掉线并恢复；</li>
<li>制定安全白名单策略；</li>
<li>建立监控与报警；</li>
<li>汇总故障案例。</li>
</ul>
<hr />
<h2 id="模块六学习路径实战案例与验证标准"><a class="header" href="#模块六学习路径实战案例与验证标准">模块六：学习路径、实战案例与验证标准</a></h2>
<div class="table-wrapper"><table><thead><tr><th>阶段</th><th>时间</th><th>目标</th><th>行动</th><th>产出</th></tr></thead><tbody>
<tr><td>阶段 0：准备</td><td>1 天</td><td>识别 USB 控制器</td><td>环境记录</td><td></td></tr>
<tr><td>阶段 1：基础实践</td><td>3 天</td><td>控制器/设备直通</td><td>操作手册</td><td></td></tr>
<tr><td>阶段 2：高级功能</td><td>4 天</td><td>SPICE/USBredir/USBIP</td><td>调优报告</td><td></td></tr>
<tr><td>阶段 3：平台集成</td><td>4 天</td><td>OpenStack/KubeVirt/VDI</td><td>配置模板</td><td></td></tr>
<tr><td>阶段 4：运维安全</td><td>4 天</td><td>故障排查、安全策略</td><td>SOP、RCA</td><td></td></tr>
<tr><td>阶段 5：推广</td><td>持续</td><td>知识库、培训</td><td>文档</td><td></td></tr>
</tbody></table>
</div>
<h3 id="62-实战案例"><a class="header" href="#62-实战案例">6.2 实战案例</a></h3>
<ul>
<li>金融 UKey 透传到 VDI；</li>
<li>摄像头/音频设备远程使用；</li>
<li>工控 USB 加密狗在虚拟化场景；</li>
<li>Kubernetes SRIOV + USBIP 混合；</li>
<li>安全白名单策略实施。</li>
</ul>
<h3 id="63-学习成果验证标准"><a class="header" href="#63-学习成果验证标准">6.3 学习成果验证标准</a></h3>
<ol>
<li>实现 USB 控制器/设备直通；</li>
<li>配置 USB 重定向并验证；</li>
<li>自动化脚本可用；</li>
<li>故障演练记录；</li>
<li>安全策略生效；</li>
<li>知识库和培训完成；</li>
<li>制定持续改进计划。</li>
</ol>
<h3 id="64-资源拓展"><a class="header" href="#64-资源拓展">6.4 资源拓展</a></h3>
<ul>
<li>libvirt、QEMU USB 文档；</li>
<li>SPICE/usbredir 项目；</li>
<li>USBIP RFC；</li>
<li>VDI 平台文档；</li>
<li>供应商白皮书。</li>
</ul>
<hr />
<h2 id="附录"><a class="header" href="#附录">附录</a></h2>
<h3 id="命令速查"><a class="header" href="#命令速查">命令速查</a></h3>
<pre><code class="language-bash">lsusb -t
virsh nodedev-list | grep usb
virsh attach-device vm usb-host.xml
remote-viewer --spice-usbredir auto
usbip list -r host
</code></pre>
<h3 id="故障记录模板"><a class="header" href="#故障记录模板">故障记录模板</a></h3>
<pre><code>事件编号：USB-2024-05
时间：2024-08-18 10:20
现象：虚拟机识别不到加密狗
排查：
1. lsusb 显示设备被宿主占用
2. 检查发现未解绑原驱动
处理：
1. 执行 echo ... &gt; driver/unbind
2. vfio-pci 绑定后恢复
预防：
- 自动化脚本处理绑定
- 监控设备状态
</code></pre>
<blockquote>
<p>USB Passthrough 与重定向是虚拟桌面和特殊业务场景的关键能力。掌握硬件直通、软件重定向与安全治理，可为用户提供灵活可靠的 USB 体验。</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../编程/云计算/uefi.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../编程/云计算/usbredir.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../编程/云计算/uefi.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../编程/云计算/usbredir.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

