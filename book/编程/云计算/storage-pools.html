<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>虚拟化存储池（Storage Pools）学习笔记 - 开发</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../theme/pagetoc.css">
        <link rel="stylesheet" href="../../theme/help-overlay.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">开发</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="搜索本书内容..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!-- Page table of contents -->
                        <div class="sidetoc"><nav class="pagetoc"></nav></div>

                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="虚拟化存储池storage-pools学习笔记"><a class="header" href="#虚拟化存储池storage-pools学习笔记">虚拟化存储池（Storage Pools）学习笔记</a></h1>
<blockquote>
<p>面向 0-5 年经验的虚拟化、云平台、运维工程师，系统掌握 libvirt/KVM 存储池概念、类型、配置、管理自动化与故障排查。</p>
</blockquote>
<hr />
<h2 id="学习定位与总体目标"><a class="header" href="#学习定位与总体目标">学习定位与总体目标</a></h2>
<ul>
<li><strong>学习者画像</strong>：负责构建和运营虚拟化平台，需要统一管理多种存储后端（文件、LVM、NFS、iSCSI、Ceph、Gluster）。</li>
<li><strong>技术定位</strong>：libvirt Storage Pool 提供抽象层，统一管理存储资源，创建 Volume，供虚拟机磁盘使用。掌握其类型、命令和自动化流程是构建可靠存储架构的基础。</li>
<li><strong>学习目标</strong>：
<ol>
<li>理解存储池与卷（volume）概念、生命周期、XML 描述；</li>
<li>熟悉不同类型（dir、fs、netfs、iscsi、logical、rbd、gluster、zfs）的配置；</li>
<li>能够使用 virsh、virt-manager、Ansible 进行存储池创建、挂载、持久化；</li>
<li>实现自动化、监控、容量规划与备份恢复；</li>
<li>编写故障排查 SOP、最佳实践，支持云平台（OpenStack、Harvester）部署。</li>
</ol>
</li>
<li><strong>成果要求</strong>：
<ul>
<li>创建并管理多种类型存储池与卷；</li>
<li>自动化脚本或 playbook；</li>
<li>输出监控、容量规划与故障案例；</li>
<li>形成操作手册和培训材料。</li>
</ul>
</li>
</ul>
<hr />
<h2 id="核心模块结构"><a class="header" href="#核心模块结构">核心模块结构</a></h2>
<ol>
<li><strong>模块一：Storage Pool 概念与架构</strong> —— pool、volume、XML、生命周期。</li>
<li><strong>模块二：常见存储池类型与配置实践</strong> —— dir、fs、netfs、logical、iscsi、rbd、gluster 等。</li>
<li><strong>模块三：管理操作与自动化工具</strong> —— virsh、virt-manager、Ansible、Terraform。</li>
<li><strong>模块四：容量规划、监控与备份恢复</strong> —— 监控指标、扩容、卷快照、备份策略。</li>
<li><strong>模块五：故障诊断、安全治理与最佳实践</strong> —— 常见问题、日志、权限、安全策略。</li>
<li><strong>模块六：学习路径、实战案例与验证标准</strong> —— 计划、案例、成果评估、资源拓展。</li>
</ol>
<hr />
<h2 id="模块一storage-pool-概念与架构"><a class="header" href="#模块一storage-pool-概念与架构">模块一：Storage Pool 概念与架构</a></h2>
<h3 id="11-概念"><a class="header" href="#11-概念">1.1 概念</a></h3>
<ul>
<li><strong>Storage Pool</strong>：一组存储资源集合（路径、LVM VG、网络存储），由 libvirt 管理；</li>
<li><strong>Volume</strong>：池中的具体存储卷，虚拟机磁盘文件；</li>
<li>Pool 生命周期：定义 (define) → 启动 (start) → 自动启动 (autostart) → 停止 (destroy) → 删除 (undefine)。</li>
</ul>
<h3 id="12-xml-描述"><a class="header" href="#12-xml-描述">1.2 XML 描述</a></h3>
<ul>
<li>Storage Pool XML 结构：
<pre><code class="language-xml">&lt;pool type='dir'&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;target&gt;
    &lt;path&gt;/var/lib/libvirt/images&lt;/path&gt;
  &lt;/target&gt;
&lt;/pool&gt;
</code></pre>
</li>
<li>Volume XML：
<pre><code class="language-xml">&lt;volume&gt;
  &lt;name&gt;vm1.qcow2&lt;/name&gt;
  &lt;capacity unit='G'&gt;40&lt;/capacity&gt;
  &lt;target&gt;
    &lt;path&gt;/var/lib/libvirt/images/vm1.qcow2&lt;/path&gt;
    &lt;format type='qcow2'/&gt;
  &lt;/target&gt;
&lt;/volume&gt;
</code></pre>
</li>
</ul>
<h3 id="13-池类型"><a class="header" href="#13-池类型">1.3 池类型</a></h3>
<div class="table-wrapper"><table><thead><tr><th>类型</th><th>描述</th><th>场景</th></tr></thead><tbody>
<tr><td>dir</td><td>本地目录</td><td>默认、快速部署</td></tr>
<tr><td>fs</td><td>文件系统挂载点</td><td>ext4/xfs 挂载</td></tr>
<tr><td>netfs</td><td>NFS 或 CIFS</td><td>共享文件存储</td></tr>
<tr><td>logical</td><td>LVM 卷组</td><td>LVM 精细控制</td></tr>
<tr><td>iscsi</td><td>iSCSI 目标</td><td>SAN 存储</td></tr>
<tr><td>rbd</td><td>Ceph RBD</td><td>云平台集群</td></tr>
<tr><td>gluster</td><td>GlusterFS</td><td>分布式文件系统</td></tr>
<tr><td>zfs</td><td>ZFS Zpool</td><td>快照/压缩</td></tr>
<tr><td>disk</td><td>整块磁盘</td><td>裸设备</td></tr>
</tbody></table>
</div>
<h3 id="14-管理命令"><a class="header" href="#14-管理命令">1.4 管理命令</a></h3>
<ul>
<li><code>virsh pool-define</code>, <code>pool-start</code>, <code>pool-autostart</code>, <code>pool-destroy</code>, <code>pool-undefine</code>；</li>
<li><code>virsh vol-create-as</code>, <code>vol-delete</code>, <code>vol-path</code>, <code>vol-upload</code>；</li>
<li><code>virsh pool-refresh</code> 刷新池状态。</li>
</ul>
<h3 id="15-存储池与虚拟机关系"><a class="header" href="#15-存储池与虚拟机关系">1.5 存储池与虚拟机关系</a></h3>
<ul>
<li>libvirt Domain XML <code>&lt;disk&gt;</code> 通过 <code>&lt;source file&gt;</code> 或 <code>&lt;source pool&gt;</code> 关联 volume；</li>
<li>支持 <code>virt-install --disk pool=default,size=40</code>；</li>
<li>OpenStack Cinder/Nova 使用 libvirt storage backend。</li>
</ul>
<h3 id="16-学习重点与易错点"><a class="header" href="#16-学习重点与易错点">1.6 学习重点与易错点</a></h3>
<ul>
<li><strong>重点</strong>：类型差异、路径权限、volume 格式、自动化；</li>
<li><strong>易错点</strong>：
<ol>
<li>池路径权限不足导致 QEMU 无法访问；</li>
<li>忘记 <code>pool-autostart</code> 重启后不可用；</li>
<li>logical 池需 PV/VG 预先创建；</li>
<li>netfs/iscsi 需网络可达、凭证正确；</li>
<li>Ceph RBD 需 secret（<code>virsh secret-define</code>）。</li>
</ol>
</li>
</ul>
<hr />
<h2 id="模块二常见存储池类型实例"><a class="header" href="#模块二常见存储池类型实例">模块二：常见存储池类型实例</a></h2>
<h3 id="21-dir-池"><a class="header" href="#21-dir-池">2.1 dir 池</a></h3>
<ul>
<li>创建：<code>virsh pool-define-as default dir - - - - /var/lib/libvirt/images</code>；</li>
<li>启动/自动启动：<code>virsh pool-start default</code>, <code>pool-autostart default</code>；</li>
<li>Volume：<code>virsh vol-create-as default vm1.qcow2 40G --format qcow2</code>。</li>
</ul>
<h3 id="22-fs--netfs-nfs"><a class="header" href="#22-fs--netfs-nfs">2.2 fs / netfs (NFS)</a></h3>
<ul>
<li>挂载 NFS：<code>mount -t nfs storage:/export/kvm /mnt/nfs</code>;</li>
<li>XML：<code>&lt;pool type='netfs'&gt;</code> <code>&lt;host name='storage'/&gt; &lt;source dir='/export/kvm'/&gt;</code>；</li>
<li><code>virsh pool-define nfs.xml</code>；</li>
<li>需确保 <code>/etc/fstab</code> 自动挂载。</li>
</ul>
<h3 id="23-logical-lvm"><a class="header" href="#23-logical-lvm">2.3 logical (LVM)</a></h3>
<ul>
<li>创建 PV/VG：<code>pvcreate /dev/sdb</code>, <code>vgcreate vg_kvm /dev/sdb</code>;</li>
<li><code>virsh pool-define-as vg_kvm logical - - - - vg_kvm</code>;</li>
<li>创建 LV：<code>virsh vol-create-as vg_kvm vm1 40G --format raw</code>;</li>
<li>libvirt 通过 <code>lvcreate</code> 管理 LV；</li>
<li>清理：<code>virsh vol-delete vm1 vg_kvm</code>。</li>
</ul>
<h3 id="24-iscsi"><a class="header" href="#24-iscsi">2.4 iscsi</a></h3>
<ul>
<li>发现：<code>iscsiadm -m discovery -t sendtargets -p target</code>；</li>
<li>登录：<code>iscsiadm -m node -p target -l</code>;</li>
<li>Pool XML：<code>&lt;source host name='target'/&gt;&lt;source device path='iqn.2019-01.com.storage:lun1'/&gt;</code>;</li>
<li>Volume 为 LUN；</li>
<li>需要 multipath、CHAP 配置。</li>
</ul>
<h3 id="25-ceph-rbd"><a class="header" href="#25-ceph-rbd">2.5 Ceph RBD</a></h3>
<ul>
<li>配置 Ceph client：<code>ceph auth get-key client.libvirt</code>;</li>
<li><code>virsh secret-define ceph.secret.xml</code>, <code>virsh secret-set-value</code>；</li>
<li>Pool XML：<code>&lt;pool type='rbd'&gt;&lt;source name='rbd_pool'&gt;&lt;host name='ceph-mon' port='6789'/&gt;&lt;/source&gt;&lt;/pool&gt;</code>；</li>
<li>Volume：<code>virsh vol-create-as rbd_pool vm1 40G --format raw</code>;</li>
<li>与 OpenStack Cinder 共用。</li>
</ul>
<h3 id="26-glusterfszfs"><a class="header" href="#26-glusterfszfs">2.6 GlusterFS/ZFS</a></h3>
<ul>
<li>Gluster：<code>&lt;pool type='gluster'&gt;&lt;source name='gv0'&gt;&lt;host name='gfs-node'/&gt;&lt;/source&gt;&lt;/pool&gt;</code>；</li>
<li>ZFS：<code>zpool create tank /dev/sdb</code>; <code>&lt;pool type='zfs'&gt;&lt;source name='tank'/&gt;&lt;/pool&gt;</code>。</li>
</ul>
<h3 id="27-disk-池"><a class="header" href="#27-disk-池">2.7 Disk 池</a></h3>
<ul>
<li>直接使用裸磁盘或分区；</li>
<li><code>&lt;pool type='disk'&gt;&lt;source dev='/dev/sdc'/&gt;&lt;/pool&gt;</code>；</li>
<li>适合 ISO、外部驱动器。</li>
</ul>
<h3 id="28-实践练习"><a class="header" href="#28-实践练习">2.8 实践练习</a></h3>
<ul>
<li>创建 dir、logical、rbd 三种池；</li>
<li>在每个池中创建 volume；</li>
<li>记录 XML 与命令；</li>
<li>探索自动化（Ansible）。</li>
</ul>
<hr />
<h2 id="模块三管理操作与自动化"><a class="header" href="#模块三管理操作与自动化">模块三：管理操作与自动化</a></h2>
<h3 id="31-virsh-操作"><a class="header" href="#31-virsh-操作">3.1 virsh 操作</a></h3>
<ul>
<li><code>virsh pool-list --all</code>；</li>
<li><code>virsh pool-info</code>, <code>pool-dumpxml</code>;</li>
<li><code>virsh vol-list default</code>, <code>vol-dumpxml</code>;</li>
<li><code>virsh vol-upload</code>、<code>vol-download</code>；</li>
<li><code>virsh vol-clone</code> 复制。</li>
</ul>
<h3 id="32-virt-manager"><a class="header" href="#32-virt-manager">3.2 virt-manager</a></h3>
<ul>
<li>GUI 创建/管理池、volume；</li>
<li>支持选择类型、路径、容量；</li>
<li>可在 VM 创建时选择 volume；</li>
<li>适合新手和演示。</li>
</ul>
<h3 id="33-ansible"><a class="header" href="#33-ansible">3.3 Ansible</a></h3>
<pre><code class="language-yaml">- name: 创建 dir 存储池
  community.libvirt.virt_pool:
    name: images
    state: present
    xml: "{{ lookup('file', 'pool-dir.xml') }}"

- name: 创建 volume
  community.libvirt.virt_volume:
    pool: images
    name: vm1.qcow2
    capacity: 40G
    format: qcow2
</code></pre>
<ul>
<li>模块支持 dir、netfs、logical 等。</li>
</ul>
<h3 id="34-terraform"><a class="header" href="#34-terraform">3.4 Terraform</a></h3>
<ul>
<li><code>terraform-provider-libvirt</code> <code>resource "libvirt_volume"</code>；</li>
<li>通过 <code>pool</code> 属性选择；</li>
<li>结合 <code>libvirt_domain</code> 自动使用 volume。</li>
</ul>
<h3 id="35-自动化脚本"><a class="header" href="#35-自动化脚本">3.5 自动化脚本</a></h3>
<ul>
<li>Bash/Python 批量创建 volume；</li>
<li>结合 <code>qemu-img</code>, <code>virt-customize</code>；</li>
<li>维护标签、元数据（JSON）。</li>
</ul>
<h3 id="36-实践练习"><a class="header" href="#36-实践练习">3.6 实践练习</a></h3>
<ul>
<li>编写 Ansible Playbook 创建池/卷；</li>
<li>使用 Terraform 部署 VM + volume；</li>
<li>生成 volume metadata（sha256、大小）。</li>
</ul>
<hr />
<h2 id="模块四容量规划监控与备份"><a class="header" href="#模块四容量规划监控与备份">模块四：容量规划、监控与备份</a></h2>
<h3 id="41-容量规划"><a class="header" href="#41-容量规划">4.1 容量规划</a></h3>
<ul>
<li>统计 Pool 总容量、使用率：<code>virsh pool-info</code>；</li>
<li>监控 Volume 使用：文件系统、LVM、Ceph；</li>
<li>规划冗余（RAID、Ceph 副本）；</li>
<li>预留增长空间、QoS。</li>
</ul>
<h3 id="42-监控"><a class="header" href="#42-监控">4.2 监控</a></h3>
<ul>
<li>Prometheus exporter：<code>node_filesystem</code>, <code>ceph</code>, <code>gluster</code>;</li>
<li><code>virt-manager</code>/libvirt expose <code>pool-info</code>（可自定义 exporter）；</li>
<li>日志：<code>/var/log/libvirt/lvmetad</code>, <code>ceph.log</code>；</li>
<li>告警：容量使用超过阈值。</li>
</ul>
<h3 id="43-备份与快照"><a class="header" href="#43-备份与快照">4.3 备份与快照</a></h3>
<ul>
<li>dir 池可使用 <code>rsync</code>, <code>borg</code>;</li>
<li>LVM：<code>lvcreate -s</code> 快照；</li>
<li>Ceph：<code>rbd snap create</code>；</li>
<li>Gluster：<code>gluster snapshot</code>;</li>
<li>结合 <code>virsh blockcommit</code>、<code>blockpull</code>；</li>
<li>记录恢复步骤。</li>
</ul>
<h3 id="44-扩容与迁移"><a class="header" href="#44-扩容与迁移">4.4 扩容与迁移</a></h3>
<ul>
<li>dir：扩展文件系统；</li>
<li>LVM：添加 PV → 扩 VG；</li>
<li>Ceph：扩展 OSD；</li>
<li>Volume 迁移：<code>virsh vol-upload</code>、<code>virsh vol-move</code>；</li>
<li>注意 downtime 和数据一致性。</li>
</ul>
<h3 id="45-实践练习"><a class="header" href="#45-实践练习">4.5 实践练习</a></h3>
<ul>
<li>监控池容量并输出报表；</li>
<li>创建 Volume 快照并恢复；</li>
<li>规划 dir → Ceph 迁移流程；</li>
<li>记录备份脚本与策略。</li>
</ul>
<hr />
<h2 id="模块五故障诊断安全治理与最佳实践"><a class="header" href="#模块五故障诊断安全治理与最佳实践">模块五：故障诊断、安全治理与最佳实践</a></h2>
<h3 id="51-常见问题"><a class="header" href="#51-常见问题">5.1 常见问题</a></h3>
<div class="table-wrapper"><table><thead><tr><th>问题</th><th>排查</th><th>解决</th></tr></thead><tbody>
<tr><td>Pool 无法启动</td><td>权限/路径</td><td>调整 SELinux/AppArmor、权限</td></tr>
<tr><td>Volume 创建失败</td><td>空间不足</td><td>扩容池或删除旧卷</td></tr>
<tr><td>netfs 无法访问</td><td>网络/挂载</td><td>验证 NFS 服务、权限</td></tr>
<tr><td>iscsi 登录失败</td><td>CHAP 配置</td><td>检查凭证、网络、multipath</td></tr>
<tr><td>Ceph Secret 缺失</td><td><code>rbd error</code></td><td><code>virsh secret-define</code>、设置 key</td></tr>
<tr><td>Volume 无法删除</td><td>被 VM 使用</td><td>卸载 VM 或移除快照</td></tr>
</tbody></table>
</div>
<h3 id="52-排查流程"><a class="header" href="#52-排查流程">5.2 排查流程</a></h3>
<ol>
<li><code>virsh pool-list</code>, <code>pool-info</code> 检查状态；</li>
<li>查看日志：<code>journalctl -u libvirtd</code>, <code>dmesg</code>；</li>
<li>检查文件权限、SELinux (<code>setenforce 0</code> 测试)；</li>
<li>针对网络存储：<code>showmount -e</code>, <code>iscsiadm</code>, <code>ceph -s</code>；</li>
<li>记录操作，执行恢复。</li>
</ol>
<h3 id="53-安全治理"><a class="header" href="#53-安全治理">5.3 安全治理</a></h3>
<ul>
<li>访问控制：Unix 权限、SELinux、AppArmor；</li>
<li>网络存储认证（CHAP、Ceph keyring）；</li>
<li>加密存储（LUKS、Ceph encryption）；</li>
<li>审计 Volume 创建/删除操作；</li>
<li>备份数据安全存储。</li>
</ul>
<h3 id="54-最佳实践"><a class="header" href="#54-最佳实践">5.4 最佳实践</a></h3>
<ul>
<li>标准化命名、标签；</li>
<li>自动化配置（Ansible/Terraform）；</li>
<li>定期刷新 pool (<code>pool-refresh</code>)；</li>
<li>清理未使用 volume；</li>
<li>文档化流程、版本控制 XML；</li>
<li>结合监控和告警。</li>
</ul>
<h3 id="55-自动化脚本示例"><a class="header" href="#55-自动化脚本示例">5.5 自动化脚本示例</a></h3>
<pre><code class="language-bash">#!/bin/bash
POOL=$1
NAME=$2
SIZE=$3
virsh vol-create-as "$POOL" "$NAME" "$SIZE" --format qcow2
virsh vol-info "$NAME" --pool "$POOL"
</code></pre>
<h3 id="56-实践练习"><a class="header" href="#56-实践练习">5.6 实践练习</a></h3>
<ul>
<li>模拟 NFS 中断并恢复；</li>
<li>创建 volume 失败的排查；</li>
<li>编写安全基线（权限、认证、备份）；</li>
<li>生成容量报表。</li>
</ul>
<hr />
<h2 id="模块六学习路径实战案例与验证标准"><a class="header" href="#模块六学习路径实战案例与验证标准">模块六：学习路径、实战案例与验证标准</a></h2>
<h3 id="61-学习路径"><a class="header" href="#61-学习路径">6.1 学习路径</a></h3>
<div class="table-wrapper"><table><thead><tr><th>阶段</th><th>时间</th><th>目标</th><th>行动</th><th>产出</th></tr></thead><tbody>
<tr><td>阶段 0：准备</td><td>1 天</td><td>了解概念、搭建环境</td><td>阅读文档、部署测试存储</td><td>环境记录</td></tr>
<tr><td>阶段 1：基础实践</td><td>3 天</td><td>创建 dir、logical、netfs 池</td><td>操作手册、XML</td><td></td></tr>
<tr><td>阶段 2：高级类型</td><td>4 天</td><td>Ceph、iSCSI、Gluster 池</td><td>配置模板、验证报告</td><td></td></tr>
<tr><td>阶段 3：自动化</td><td>3 天</td><td>Ansible/Terraform 集成</td><td>脚本仓库、CI</td><td></td></tr>
<tr><td>阶段 4：运维治理</td><td>4 天</td><td>监控、备份、故障排查</td><td>SOP、调优报告</td><td></td></tr>
<tr><td>阶段 5：沉淀推广</td><td>持续</td><td>知识库、培训</td><td>文档、培训材料</td><td></td></tr>
</tbody></table>
</div>
<h3 id="62-实战案例"><a class="header" href="#62-实战案例">6.2 实战案例</a></h3>
<ul>
<li><strong>案例一：OpenStack 存储整合</strong>：dir + Ceph 混合，Cinder 后端，自动化管理；</li>
<li><strong>案例二：容器平台镜像仓库</strong>：NFS 存储池 + 自动扩容；</li>
<li><strong>案例三：金融业务 LVM 池</strong>：多数据中心备份，LVM 快照；</li>
<li><strong>案例四：Ceph RBD 模板</strong>：用于云平台快速部署；</li>
<li><strong>案例五：容量监控与告警</strong>：Prometheus + Grafana 看板。</li>
</ul>
<h3 id="63-学习成果验证标准"><a class="header" href="#63-学习成果验证标准">6.3 学习成果验证标准</a></h3>
<ol>
<li>创建多类型存储池并持久化；</li>
<li>完成 Volume 生命周期管理；</li>
<li>自动化脚本/Playbook 可运行；</li>
<li>监控与容量计划文档；</li>
<li>故障演练（≥2 种）及 RCA；</li>
<li>安全策略（权限、认证、备份）；</li>
<li>知识库、培训材料；</li>
<li>改进计划（扩容、迁移）。</li>
</ol>
<h3 id="64-扩展资源"><a class="header" href="#64-扩展资源">6.4 扩展资源</a></h3>
<ul>
<li>libvirt Storage Guide；</li>
<li>OpenStack Cinder 文档；</li>
<li>Ceph / Gluster 官方文档；</li>
<li>Ansible Collection <code>community.libvirt</code>；</li>
<li>关注存储厂商白皮书。</li>
</ul>
<hr />
<h2 id="附录"><a class="header" href="#附录">附录</a></h2>
<h3 id="a-常用命令速查"><a class="header" href="#a-常用命令速查">A. 常用命令速查</a></h3>
<pre><code class="language-bash">virsh pool-define-as default dir - - - - /var/lib/libvirt/images
virsh pool-start default
virsh pool-autostart default
virsh vol-create-as default vm1.qcow2 40G --format qcow2
virsh vol-info vm1.qcow2 --pool default
virsh pool-destroy default
</code></pre>
<h3 id="b-配置文件与日志"><a class="header" href="#b-配置文件与日志">B. 配置文件与日志</a></h3>
<ul>
<li><code>/etc/libvirt/storage/</code>（池 XML）</li>
<li><code>/var/lib/libvirt/images/</code>（dir 卷）</li>
<li><code>/etc/ceph/ceph.conf</code>、keyring</li>
<li><code>/var/log/libvirt/libvirtd.log</code></li>
</ul>
<h3 id="c-故障记录模板"><a class="header" href="#c-故障记录模板">C. 故障记录模板</a></h3>
<pre><code>事件编号：POOL-2024-07
时间：2024-08-15 16:00
现象：存储池 nfs_pool 无法启动
排查：
1. virsh pool-start 报错 "mount failed"
2. 检查发现 NFS 服务不可达
处理：
1. 恢复 NFS 服务
2. 重新挂载并 pool-refresh 成功
预防：
- 添加 NFS 存活监控
- 记录 SOP 和恢复步骤
</code></pre>
<blockquote>
<p>掌握存储池管理，可以在虚拟化与云平台中灵活组合多种存储后端，确保磁盘资源高效、可控、安全，为业务提供稳定的存储基础设施。</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../编程/云计算/sriov.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../编程/云计算/tpm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../编程/云计算/sriov.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../编程/云计算/tpm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../theme/segmentit.umd.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../theme/searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../theme/pagetoc.js"></script>



    </div>
    </body>
</html>

